(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[402],{5790:function(V){V.exports=function(){"use strict";var V,G,el;function define(eh,ec){if(V){if(G){var ep="var sharedChunk = {}; ("+V+")(sharedChunk); ("+G+")(sharedChunk);",ed={};V(ed),el=ec(ed),"undefined"!=typeof window&&(el.workerUrl=window.URL.createObjectURL(new Blob([ep],{type:"text/javascript"})))}else G=ec}else V=ec}return define(["exports"],function(V){let G,el;function r(V,G,el,eh){this.cx=3*V,this.bx=3*(el-V)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*G,this.by=3*(eh-G)-this.cy,this.ay=1-this.cy-this.by,this.p1x=V,this.p1y=G,this.p2x=el,this.p2y=eh}function n(V,G,el,eh){let ec=new r(V,G,el,eh);return function(V){return ec.solve(V)}}r.prototype={sampleCurveX:function(V){return((this.ax*V+this.bx)*V+this.cx)*V},sampleCurveY:function(V){return((this.ay*V+this.by)*V+this.cy)*V},sampleCurveDerivativeX:function(V){return(3*this.ax*V+2*this.bx)*V+this.cx},solveCurveX:function(V,G){if(void 0===G&&(G=1e-6),V<0)return 0;if(V>1)return 1;for(var el=V,eh=0;eh<8;eh++){var ec=this.sampleCurveX(el)-V;if(Math.abs(ec)<G)return el;var ep=this.sampleCurveDerivativeX(el);if(1e-6>Math.abs(ep))break;el-=ec/ep}var ed=0,em=1;for(el=V,eh=0;eh<20&&!(Math.abs((ec=this.sampleCurveX(el))-V)<G);eh++)V>ec?ed=el:em=el,el=.5*(em-ed)+ed;return el},solve:function(V,G){return this.sampleCurveY(this.solveCurveX(V,G))}};let eh=n(.25,.1,.25,1);function a(V,G,el){return Math.min(el,Math.max(G,V))}function s(V,G,el){let eh=el-G,ec=((V-G)%eh+eh)%eh+G;return ec===G?el:ec}function o(V,...G){for(let el of G)for(let G in el)V[G]=el[G];return V}let ec=1;function u(V,G){V.forEach(V=>{G[V]&&(G[V]=G[V].bind(G))})}function c(V,G,el){let eh={};for(let ec in V)eh[ec]=G.call(el||this,V[ec],ec,V);return eh}function h(V,G,el){let eh={};for(let ec in V)G.call(el||this,V[ec],ec,V)&&(eh[ec]=V[ec]);return eh}function p(V){return Array.isArray(V)?V.map(p):"object"==typeof V&&V?c(V,p):V}let ep={};function d(V){ep[V]||("undefined"!=typeof console&&console.warn(V),ep[V]=!0)}function y(V,G,el){return(el.y-V.y)*(G.x-V.x)>(G.y-V.y)*(el.x-V.x)}function g(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function x(V){let G={};if(V.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(V,el,eh,ec)=>{let ep=eh||ec;return G[el]=!ep||ep.toLowerCase(),""}),G["max-age"]){let V=parseInt(G["max-age"],10);isNaN(V)?delete G["max-age"]:G["max-age"]=V}return G}let ed,em,ef=null;function _(V){if(null==ef){let G=V.navigator?V.navigator.userAgent:null;ef=!!V.safari||!(!G||!(/\b(iPad|iPhone|iPod)\b/.test(G)||G.match("Safari")&&!G.match("Chrome")))}return ef}function A(V){return"undefined"!=typeof ImageBitmap&&V instanceof ImageBitmap}let eg={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(V){let G=requestAnimationFrame(V);return{cancel:()=>cancelAnimationFrame(G)}},getImageData(V,G=0){let el=window.document.createElement("canvas"),eh=el.getContext("2d");if(!eh)throw Error("failed to create canvas 2d context");return el.width=V.width,el.height=V.height,eh.drawImage(V,0,0,V.width,V.height),eh.getImageData(-G,-G,V.width+2*G,V.height+2*G)},resolveURL:V=>(ed||(ed=document.createElement("a")),ed.href=V,ed.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==em&&(em=matchMedia("(prefers-reduced-motion: reduce)")),em.matches)}};var e_=I;function I(V,G){this.x=V,this.y=G}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(V){return this.clone()._add(V)},sub:function(V){return this.clone()._sub(V)},multByPoint:function(V){return this.clone()._multByPoint(V)},divByPoint:function(V){return this.clone()._divByPoint(V)},mult:function(V){return this.clone()._mult(V)},div:function(V){return this.clone()._div(V)},rotate:function(V){return this.clone()._rotate(V)},rotateAround:function(V,G){return this.clone()._rotateAround(V,G)},matMult:function(V){return this.clone()._matMult(V)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(V){return this.x===V.x&&this.y===V.y},dist:function(V){return Math.sqrt(this.distSqr(V))},distSqr:function(V){var G=V.x-this.x,el=V.y-this.y;return G*G+el*el},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(V){return Math.atan2(this.y-V.y,this.x-V.x)},angleWith:function(V){return this.angleWithSep(V.x,V.y)},angleWithSep:function(V,G){return Math.atan2(this.x*G-this.y*V,this.x*V+this.y*G)},_matMult:function(V){var G=V[2]*this.x+V[3]*this.y;return this.x=V[0]*this.x+V[1]*this.y,this.y=G,this},_add:function(V){return this.x+=V.x,this.y+=V.y,this},_sub:function(V){return this.x-=V.x,this.y-=V.y,this},_mult:function(V){return this.x*=V,this.y*=V,this},_div:function(V){return this.x/=V,this.y/=V,this},_multByPoint:function(V){return this.x*=V.x,this.y*=V.y,this},_divByPoint:function(V){return this.x/=V.x,this.y/=V.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var V=this.y;return this.y=this.x,this.x=-V,this},_rotate:function(V){var G=Math.cos(V),el=Math.sin(V),eh=el*this.x+G*this.y;return this.x=G*this.x-el*this.y,this.y=eh,this},_rotateAround:function(V,G){var el=Math.cos(V),eh=Math.sin(V),ec=G.y+eh*(this.x-G.x)+el*(this.y-G.y);return this.x=G.x+el*(this.x-G.x)-eh*(this.y-G.y),this.y=ec,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},I.convert=function(V){return V instanceof I?V:Array.isArray(V)?new I(V[0],V[1]):V};let ey={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},ex="mapbox-tiles",ev,eb,ew=500,eT=50;function E(){"undefined"==typeof caches||ev||(ev=caches.open(ex))}let eE=1/0,eS={supported:!1,testSupport:function(V){!eM&&eA&&(eC?O(V):eI=V)}},eI,eA,eM=!1,eC=!1;function O(V){let G=V.createTexture();V.bindTexture(V.TEXTURE_2D,G);try{if(V.texImage2D(V.TEXTURE_2D,0,V.RGBA,V.RGBA,V.UNSIGNED_BYTE,eA),V.isContextLost())return;eS.supported=!0}catch(V){}V.deleteTexture(G),eM=!0}"undefined"!=typeof document&&((eA=document.createElement("img")).onload=function(){eI&&O(eI),eI=null,eC=!0},eA.onerror=function(){eM=!0,eI=null},eA.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let ez={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ez);let q=class q extends Error{constructor(V,G,el,eh){super(`AJAXError: ${G} (${V}): ${el}`),this.status=V,this.statusText=G,this.url=el,this.body=eh}};let ek=g()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function N(V,G){let el=new AbortController,eh=new Request(V.url,{method:V.method||"GET",body:V.body,credentials:V.credentials,headers:V.headers,referrer:ek(),signal:el.signal}),ec=!1,ep=!1;return"json"===V.type&&eh.headers.set("Accept","application/json"),((el,ed,em)=>{if(ep)return;let ef=Date.now();fetch(eh).then(el=>el.ok?((el,ed,em)=>{("arrayBuffer"===V.type?el.arrayBuffer():"json"===V.type?el.json():el.text()).then(V=>{ep||(ed&&em&&function(V,G,el){if(E(),!ev)return;let eh={status:G.status,statusText:G.statusText,headers:new Headers};G.headers.forEach((V,G)=>eh.headers.set(G,V));let ec=x(G.headers.get("Cache-Control")||"");ec["no-store"]||(ec["max-age"]&&eh.headers.set("Expires",new Date(el+1e3*ec["max-age"]).toUTCString()),new Date(eh.headers.get("Expires")).getTime()-el<42e4||function(V,G){if(void 0===eb)try{new Response(new ReadableStream),eb=!0}catch(V){eb=!1}eb?G(V.body):V.blob().then(G)}(G,G=>{let el=new Response(G,eh);E(),ev&&ev.then(G=>G.put(function(V){let G=V.indexOf("?");return G<0?V:V.slice(0,G)}(V.url),el)).catch(V=>d(V.message))}))}(eh,ed,em),ec=!0,G(null,V,el.headers.get("Cache-Control"),el.headers.get("Expires")))}).catch(V=>{ep||G(Error(V.message))})})(el,null,ef):el.blob().then(eh=>G(new q(el.status,el.statusText,V.url,eh)))).catch(V=>{20!==V.code&&G(Error(V.message))})})(),{cancel:()=>{ep=!0,ec||el.abort()}}}let Z=function(V,G){var el;if(/:\/\//.test(V.url)&&!/^https?:|^file:/.test(V.url)){if(g()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",V,G);if(!g()){let el=V.url.substring(0,V.url.indexOf("://"));return(ey.REGISTERED_PROTOCOLS[el]||N)(V,G)}}if(!(/^file:/.test(el=V.url)||/^file:/.test(ek())&&!/^\w+:/.test(el))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return N(V,G);if(g()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",V,G,void 0,!0)}return function(V,G){let el=new XMLHttpRequest;for(let G in el.open(V.method||"GET",V.url,!0),"arrayBuffer"===V.type&&(el.responseType="arraybuffer"),V.headers)el.setRequestHeader(G,V.headers[G]);return"json"===V.type&&(el.responseType="text",el.setRequestHeader("Accept","application/json")),el.withCredentials="include"===V.credentials,el.onerror=()=>{G(Error(el.statusText))},el.onload=()=>{if((el.status>=200&&el.status<300||0===el.status)&&null!==el.response){let eh=el.response;if("json"===V.type)try{eh=JSON.parse(el.response)}catch(V){return G(V)}G(null,eh,el.getResponseHeader("Cache-Control"),el.getResponseHeader("Expires"))}else{let eh=new Blob([el.response],{type:el.getResponseHeader("Content-Type")});G(new q(el.status,el.statusText,V.url,eh))}},el.send(V.body),{cancel:()=>el.abort()}}(V,G)},K=function(V,G){return Z(o(V,{type:"arrayBuffer"}),G)},eP="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";G=[],el=0;let H=function(V,eh){if(eS.supported&&(V.headers||(V.headers={}),V.headers.accept="image/webp,*/*"),el>=ey.MAX_PARALLEL_IMAGE_REQUESTS){let el={requestParameters:V,callback:eh,cancelled:!1,cancel(){this.cancelled=!0}};return G.push(el),el}el++;let ec=!1,n=()=>{if(!ec)for(ec=!0,el--;G.length&&el<ey.MAX_PARALLEL_IMAGE_REQUESTS;){let V=G.shift(),{requestParameters:el,callback:eh,cancelled:ec}=V;ec||(V.cancel=H(el,eh).cancel)}},ep=K(V,(V,G,el,ec)=>{var ep;n(),V?eh(V):G&&(ep=(V,G)=>{null!=V?eh(V):null!=G&&eh(null,G,{cacheControl:el,expires:ec})},"function"==typeof createImageBitmap?function(V,G){let el=new Blob([new Uint8Array(V)],{type:"image/png"});createImageBitmap(el).then(V=>{G(null,V)}).catch(V=>{G(Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(G,ep):function(V,G){let el=new Image;el.onload=()=>{G(null,el),URL.revokeObjectURL(el.src),el.onload=null,window.requestAnimationFrame(()=>{el.src=eP})},el.onerror=()=>G(Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let eh=new Blob([new Uint8Array(V)],{type:"image/png"});el.src=V.byteLength?URL.createObjectURL(eh):eP}(G,ep))});return{cancel:()=>{ep.cancel(),n()}}};function W(V,G,el){el[V]&&-1!==el[V].indexOf(G)||(el[V]=el[V]||[],el[V].push(G))}function Q(V,G,el){if(el&&el[V]){let eh=el[V].indexOf(G);-1!==eh&&el[V].splice(eh,1)}}let tt=class tt{constructor(V,G={}){o(this,G),this.type=V}};let et=class et extends tt{constructor(V,G={}){super("error",o({error:V},G))}};let rt=class rt{on(V,G){return this._listeners=this._listeners||{},W(V,G,this._listeners),this}off(V,G){return Q(V,G,this._listeners),Q(V,G,this._oneTimeListeners),this}once(V,G){return this._oneTimeListeners=this._oneTimeListeners||{},W(V,G,this._oneTimeListeners),this}fire(V,G){"string"==typeof V&&(V=new tt(V,G||{}));let el=V.type;if(this.listens(el)){V.target=this;let G=this._listeners&&this._listeners[el]?this._listeners[el].slice():[];for(let el of G)el.call(this,V);let eh=this._oneTimeListeners&&this._oneTimeListeners[el]?this._oneTimeListeners[el].slice():[];for(let G of eh)Q(el,G,this._oneTimeListeners),G.call(this,V);let ec=this._eventedParent;ec&&(o(V,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),ec.fire(V))}else V instanceof et&&console.error(V.error);return this}listens(V){return this._listeners&&this._listeners[V]&&this._listeners[V].length>0||this._oneTimeListeners&&this._oneTimeListeners[V]&&this._oneTimeListeners[V].length>0||this._eventedParent&&this._eventedParent.listens(V)}setEventedParent(V,G){return this._eventedParent=V,this._eventedParentData=G,this}};var eD={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let it=class it{constructor(V,G,el,eh){this.message=(V?`${V}: `:"")+el,eh&&(this.identifier=eh),null!=G&&G.__line__&&(this.line=G.__line__)}};function at(V){let G=V.value;return G?[new it(V.key,G,"constants have been deprecated as of v8")]:[]}function st(V,...G){for(let el of G)for(let G in el)V[G]=el[G];return V}function ot(V){return V instanceof Number||V instanceof String||V instanceof Boolean?V.valueOf():V}function lt(V){if(Array.isArray(V))return V.map(lt);if(V instanceof Object&&!(V instanceof Number||V instanceof String||V instanceof Boolean)){let G={};for(let el in V)G[el]=lt(V[el]);return G}return ot(V)}let ut=class ut extends Error{constructor(V,G){super(G),this.message=G,this.key=V}};let ct=class ct{constructor(V,G=[]){for(let[el,eh]of(this.parent=V,this.bindings={},G))this.bindings[el]=eh}concat(V){return new ct(this,V)}get(V){if(this.bindings[V])return this.bindings[V];if(this.parent)return this.parent.get(V);throw Error(`${V} not found in scope.`)}has(V){return!!this.bindings[V]||!!this.parent&&this.parent.has(V)}};let eL={kind:"null"},eR={kind:"number"},eB={kind:"string"},eF={kind:"boolean"},eO={kind:"color"},eU={kind:"object"},eV={kind:"value"},eN={kind:"collator"},e$={kind:"formatted"},eq={kind:"padding"},eG={kind:"resolvedImage"};function _t(V,G){return{kind:"array",itemType:V,N:G}}function At(V){if("array"===V.kind){let G=At(V.itemType);return"number"==typeof V.N?`array<${G}, ${V.N}>`:"value"===V.itemType.kind?"array":`array<${G}>`}return V.kind}let eZ=[eL,eR,eB,eF,eO,e$,eU,_t(eV),eq,eG];function St(V,G){if("error"===G.kind)return null;if("array"===V.kind){if("array"===G.kind&&(0===G.N&&"value"===G.itemType.kind||!St(V.itemType,G.itemType))&&("number"!=typeof V.N||V.N===G.N))return null}else{if(V.kind===G.kind)return null;if("value"===V.kind){for(let V of eZ)if(!St(V,G))return null}}return`Expected ${At(V)} but found ${At(G)} instead.`}function It(V,G){return G.some(G=>G.kind===V.kind)}function Mt(V,G){return G.some(G=>"null"===G?null===V:"array"===G?Array.isArray(V):"object"===G?V&&!Array.isArray(V)&&"object"==typeof V:G===typeof V)}var ej,eX,eW={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ct(V){return(V=Math.round(V))<0?0:V>255?255:V}function Pt(V){return Ct("%"===V[V.length-1]?parseFloat(V)/100*255:parseInt(V))}function Vt(V){var G;return(G="%"===V[V.length-1]?parseFloat(V)/100:parseFloat(V))<0?0:G>1?1:G}function Et(V,G,el){return el<0?el+=1:el>1&&(el-=1),6*el<1?V+(G-V)*el*6:2*el<1?G:3*el<2?V+(G-V)*(2/3-el)*6:V}try{eX=({}).parseCSSColor=function(V){var G,el=V.replace(/ /g,"").toLowerCase();if(el in eW)return eW[el].slice();if("#"===el[0])return 4===el.length?(G=parseInt(el.substr(1),16))>=0&&G<=4095?[(3840&G)>>4|(3840&G)>>8,240&G|(240&G)>>4,15&G|(15&G)<<4,1]:null:7===el.length&&(G=parseInt(el.substr(1),16))>=0&&G<=16777215?[(16711680&G)>>16,(65280&G)>>8,255&G,1]:null;var eh=el.indexOf("("),ec=el.indexOf(")");if(-1!==eh&&ec+1===el.length){var ep=el.substr(0,eh),ed=el.substr(eh+1,ec-(eh+1)).split(","),em=1;switch(ep){case"rgba":if(4!==ed.length)break;em=Vt(ed.pop());case"rgb":return 3!==ed.length?null:[Pt(ed[0]),Pt(ed[1]),Pt(ed[2]),em];case"hsla":if(4!==ed.length)break;em=Vt(ed.pop());case"hsl":if(3!==ed.length)break;var ef=(parseFloat(ed[0])%360+360)%360/360,eg=Vt(ed[1]),e_=Vt(ed[2]),ey=e_<=.5?e_*(eg+1):e_+eg-e_*eg,ex=2*e_-ey;return[Ct(255*Et(ex,ey,ef+1/3)),Ct(255*Et(ex,ey,ef)),Ct(255*Et(ex,ey,ef-1/3)),em]}}return null}}catch(V){}let Ft=class Ft{constructor(V,G,el,eh=1){this.r=V,this.g=G,this.b=el,this.a=eh}static parse(V){if(!V)return;if(V instanceof Ft)return V;if("string"!=typeof V)return;let G=eX(V);return G?new Ft(G[0]/255*G[3],G[1]/255*G[3],G[2]/255*G[3],G[3]):void 0}toString(){let[V,G,el,eh]=this.toArray();return`rgba(${Math.round(V)},${Math.round(G)},${Math.round(el)},${eh})`}toArray(){let{r:V,g:G,b:el,a:eh}=this;return 0===eh?[0,0,0,0]:[255*V/eh,255*G/eh,255*el/eh,eh]}};Ft.black=new Ft(0,0,0,1),Ft.white=new Ft(1,1,1,1),Ft.transparent=new Ft(0,0,0,0),Ft.red=new Ft(1,0,0,1);let Tt=class Tt{constructor(V,G,el){this.sensitivity=V?G?"variant":"case":G?"accent":"base",this.locale=el,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(V,G){return this.collator.compare(V,G)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}};let Lt=class Lt{constructor(V,G,el,eh,ec){this.text=V,this.image=G,this.scale=el,this.fontStack=eh,this.textColor=ec}};let Dt=class Dt{constructor(V){this.sections=V}static fromString(V){return new Dt([new Lt(V,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(V=>0!==V.text.length||V.image&&0!==V.image.name.length)}static factory(V){return V instanceof Dt?V:Dt.fromString(V)}toString(){return 0===this.sections.length?"":this.sections.map(V=>V.text).join("")}};let $t=class $t{constructor(V){this.values=V.slice()}static parse(V){if(V instanceof $t)return V;if("number"==typeof V)return new $t([V,V,V,V]);if(Array.isArray(V)&&!(V.length<1||V.length>4)){for(let G of V)if("number"!=typeof G)return;switch(V.length){case 1:V=[V[0],V[0],V[0],V[0]];break;case 2:V=[V[0],V[1],V[0],V[1]];break;case 3:V=[V[0],V[1],V[2],V[1]]}return new $t(V)}}toString(){return JSON.stringify(this.values)}};let Rt=class Rt{constructor(V){this.name=V.name,this.available=V.available}toString(){return this.name}static fromString(V){return V?new Rt({name:V,available:!1}):null}};function Ot(V,G,el,eh){return"number"==typeof V&&V>=0&&V<=255&&"number"==typeof G&&G>=0&&G<=255&&"number"==typeof el&&el>=0&&el<=255?void 0===eh||"number"==typeof eh&&eh>=0&&eh<=1?null:`Invalid rgba value [${[V,G,el,eh].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof eh?[V,G,el,eh]:[V,G,el]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ut(V){if(null===V||"string"==typeof V||"boolean"==typeof V||"number"==typeof V||V instanceof Ft||V instanceof Tt||V instanceof Dt||V instanceof $t||V instanceof Rt)return!0;if(Array.isArray(V)){for(let G of V)if(!Ut(G))return!1;return!0}if("object"==typeof V){for(let G in V)if(!Ut(V[G]))return!1;return!0}return!1}function qt(V){if(null===V)return eL;if("string"==typeof V)return eB;if("boolean"==typeof V)return eF;if("number"==typeof V)return eR;if(V instanceof Ft)return eO;if(V instanceof Tt)return eN;if(V instanceof Dt)return e$;if(V instanceof $t)return eq;if(V instanceof Rt)return eG;if(Array.isArray(V)){let G;let el=V.length;for(let el of V){let V=qt(el);if(G){if(G===V)continue;G=eV;break}G=V}return _t(G||eV,el)}return eU}function jt(V){let G=typeof V;return null===V?"":"string"===G||"number"===G||"boolean"===G?String(V):V instanceof Ft||V instanceof Dt||V instanceof $t||V instanceof Rt?V.toString():JSON.stringify(V)}let Nt=class Nt{constructor(V,G){this.type=V,this.value=G}static parse(V,G){if(2!==V.length)return G.error(`'literal' expression requires exactly one argument, but found ${V.length-1} instead.`);if(!Ut(V[1]))return G.error("invalid value");let el=V[1],eh=qt(el),ec=G.expectedType;return"array"===eh.kind&&0===eh.N&&ec&&"array"===ec.kind&&("number"!=typeof ec.N||0===ec.N)&&(eh=ec),new Nt(eh,el)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}};let Zt=class Zt{constructor(V){this.name="ExpressionEvaluationError",this.message=V}toJSON(){return this.message}};let eH={string:eB,number:eR,boolean:eF,object:eU};let Gt=class Gt{constructor(V,G){this.type=V,this.args=G}static parse(V,G){if(V.length<2)return G.error("Expected at least one argument.");let el,eh=1,ec=V[0];if("array"===ec){let ec,ep;if(V.length>2){let el=V[1];if("string"!=typeof el||!(el in eH)||"object"===el)return G.error('The item type argument of "array" must be one of string, number, boolean',1);ec=eH[el],eh++}else ec=eV;if(V.length>3){if(null!==V[2]&&("number"!=typeof V[2]||V[2]<0||V[2]!==Math.floor(V[2])))return G.error('The length argument to "array" must be a positive integer literal',2);ep=V[2],eh++}el=_t(ec,ep)}else{if(!eH[ec])throw Error(`Types doesn't contain name = ${ec}`);el=eH[ec]}let ep=[];for(;eh<V.length;eh++){let el=G.parse(V[eh],eh,eV);if(!el)return null;ep.push(el)}return new Gt(el,ep)}evaluate(V){for(let G=0;G<this.args.length;G++){let el=this.args[G].evaluate(V);if(!St(this.type,qt(el)))return el;if(G===this.args.length-1)throw new Zt(`Expected value to be of type ${At(this.type)}, but found ${At(qt(el))} instead.`)}throw Error()}eachChild(V){this.args.forEach(V)}outputDefined(){return this.args.every(V=>V.outputDefined())}};let eK={"to-boolean":eF,"to-color":eO,"to-number":eR,"to-string":eB};let Xt=class Xt{constructor(V,G){this.type=V,this.args=G}static parse(V,G){if(V.length<2)return G.error("Expected at least one argument.");let el=V[0];if(!eK[el])throw Error(`Can't parse ${el} as it is not part of the known types`);if(("to-boolean"===el||"to-string"===el)&&2!==V.length)return G.error("Expected one argument.");let eh=eK[el],ec=[];for(let el=1;el<V.length;el++){let eh=G.parse(V[el],el,eV);if(!eh)return null;ec.push(eh)}return new Xt(eh,ec)}evaluate(V){if("boolean"===this.type.kind)return!!this.args[0].evaluate(V);if("color"===this.type.kind){let G,el;for(let eh of this.args){if(G=eh.evaluate(V),el=null,G instanceof Ft)return G;if("string"==typeof G){let el=V.parseColor(G);if(el)return el}else if(Array.isArray(G)&&!(el=G.length<3||G.length>4?`Invalid rbga value ${JSON.stringify(G)}: expected an array containing either three or four numeric values.`:Ot(G[0],G[1],G[2],G[3])))return new Ft(G[0]/255,G[1]/255,G[2]/255,G[3])}throw new Zt(el||`Could not parse color from value '${"string"==typeof G?G:JSON.stringify(G)}'`)}if("padding"===this.type.kind){let G;for(let el of this.args){G=el.evaluate(V);let eh=$t.parse(G);if(eh)return eh}throw new Zt(`Could not parse padding from value '${"string"==typeof G?G:JSON.stringify(G)}'`)}if("number"===this.type.kind){let G=null;for(let el of this.args){if(null===(G=el.evaluate(V)))return 0;let eh=Number(G);if(!isNaN(eh))return eh}throw new Zt(`Could not convert ${JSON.stringify(G)} to number.`)}return"formatted"===this.type.kind?Dt.fromString(jt(this.args[0].evaluate(V))):"resolvedImage"===this.type.kind?Rt.fromString(jt(this.args[0].evaluate(V))):jt(this.args[0].evaluate(V))}eachChild(V){this.args.forEach(V)}outputDefined(){return this.args.every(V=>V.outputDefined())}};let eY=["Unknown","Point","LineString","Polygon"];let Ht=class Ht{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?eY[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(V){let G=this._parseColorCache[V];return G||(G=this._parseColorCache[V]=Ft.parse(V)),G}};let Wt=class Wt{constructor(V,G,el,eh){this.name=V,this.type=G,this._evaluate=el,this.args=eh}evaluate(V){return this._evaluate(V,this.args)}eachChild(V){this.args.forEach(V)}outputDefined(){return!1}static parse(V,G){let el=V[0],eh=Wt.definitions[el];if(!eh)return G.error(`Unknown expression "${el}". If you wanted a literal array, use ["literal", [...]].`,0);let ec=Array.isArray(eh)?eh[0]:eh.type,ep=Array.isArray(eh)?[[eh[1],eh[2]]]:eh.overloads,ed=ep.filter(([G])=>!Array.isArray(G)||G.length===V.length-1),em=null;for(let[eh,ep]of ed){em=new we(G.registry,G.path,null,G.scope);let ed=[],ef=!1;for(let G=1;G<V.length;G++){let el=V[G],ec=Array.isArray(eh)?eh[G-1]:eh.type,ep=em.parse(el,1+ed.length,ec);if(!ep){ef=!0;break}ed.push(ep)}if(!ef){if(Array.isArray(eh)&&eh.length!==ed.length)em.error(`Expected ${eh.length} arguments, but found ${ed.length} instead.`);else{for(let V=0;V<ed.length;V++){let G=Array.isArray(eh)?eh[V]:eh.type,el=ed[V];em.concat(V+1).checkSubtype(G,el.type)}if(0===em.errors.length)return new Wt(el,ec,ep,ed)}}}if(1===ed.length)G.errors.push(...em.errors);else{let el=(ed.length?ed:ep).map(([V])=>Array.isArray(V)?`(${V.map(At).join(", ")})`:`(${At(V.type)}...)`).join(" | "),eh=[];for(let el=1;el<V.length;el++){let ec=G.parse(V[el],1+eh.length);if(!ec)return null;eh.push(At(ec.type))}G.error(`Expected arguments of type ${el}, but found (${eh.join(", ")}) instead.`)}return null}static register(V,G){for(let el in Wt.definitions=G,G)V[el]=Wt}};let Qt=class Qt{constructor(V,G,el){this.type=eN,this.locale=el,this.caseSensitive=V,this.diacriticSensitive=G}static parse(V,G){if(2!==V.length)return G.error("Expected one argument.");let el=V[1];if("object"!=typeof el||Array.isArray(el))return G.error("Collator options argument must be an object.");let eh=G.parse(void 0!==el["case-sensitive"]&&el["case-sensitive"],1,eF);if(!eh)return null;let ec=G.parse(void 0!==el["diacritic-sensitive"]&&el["diacritic-sensitive"],1,eF);if(!ec)return null;let ep=null;return!el.locale||(ep=G.parse(el.locale,1,eB))?new Qt(eh,ec,ep):null}evaluate(V){return new Tt(this.caseSensitive.evaluate(V),this.diacriticSensitive.evaluate(V),this.locale?this.locale.evaluate(V):null)}eachChild(V){V(this.caseSensitive),V(this.diacriticSensitive),this.locale&&V(this.locale)}outputDefined(){return!1}};function ee(V,G){V[0]=Math.min(V[0],G[0]),V[1]=Math.min(V[1],G[1]),V[2]=Math.max(V[2],G[0]),V[3]=Math.max(V[3],G[1])}function re(V,G){return!(V[0]<=G[0]||V[2]>=G[2]||V[1]<=G[1]||V[3]>=G[3])}function ae(V,G){var el,eh;let ec=!1;for(let ep=0,ed=G.length;ep<ed;ep++){let ed=G[ep];for(let G=0,ep=ed.length;G<ep-1;G++){if(function(V,G,el){let eh=V[0]-G[0],ec=V[1]-G[1],ep=V[0]-el[0],ed=V[1]-el[1];return eh*ed-ep*ec==0&&eh*ep<=0&&ec*ed<=0}(V,ed[G],ed[G+1]))return!1;(el=ed[G])[1]>V[1]!=(eh=ed[G+1])[1]>V[1]&&V[0]<(eh[0]-el[0])*(V[1]-el[1])/(eh[1]-el[1])+el[0]&&(ec=!ec)}}return ec}function oe(V,G,el,eh){let ec=eh[0]-el[0],ep=eh[1]-el[1],ed=(V[0]-el[0])*ep-ec*(V[1]-el[1]),em=(G[0]-el[0])*ep-ec*(G[1]-el[1]);return ed>0&&em<0||ed<0&&em>0}function ue(V,G){for(let el=0;el<V.length;++el)if(!ae(V[el],G))return!1;for(let el=0;el<V.length-1;++el)if(function(V,G,el){var eh,ec,ep,ed;for(let em of el)for(let el=0;el<em.length-1;++el)if(0!=(ep=[(ec=em[el+1])[0]-(eh=em[el])[0],ec[1]-eh[1]])[0]*(ed=[G[0]-V[0],G[1]-V[1]])[1]-ep[1]*ed[0]&&oe(V,G,eh,ec)&&oe(eh,ec,V,G))return!0;return!1}(V[el],V[el+1],G))return!1;return!0}function he(V,G,el){let eh=[];for(let ec=0;ec<V.length;ec++){let ep=[];for(let eh=0;eh<V[ec].length;eh++){let ed=function(V,G){let el=(180+V[0])/360,eh=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+V[1]*Math.PI/360)))/360,ec=Math.pow(2,G.z);return[Math.round(el*ec*8192),Math.round(eh*ec*8192)]}(V[ec][eh],el);ee(G,ed),ep.push(ed)}eh.push(ep)}return eh}function pe(V,G,el){let eh=[];for(let ec=0;ec<V.length;ec++){let ep=he(V[ec],G,el);eh.push(ep)}return eh}function fe(V,G,el,eh){if(V[0]<el[0]||V[0]>el[2]){let G=.5*eh,ec=V[0]-el[0]>G?-eh:el[0]-V[0]>G?eh:0;0===ec&&(ec=V[0]-el[2]>G?-eh:el[2]-V[0]>G?eh:0),V[0]+=ec}ee(G,V)}function de(V,G,el,eh){let ec=8192*Math.pow(2,eh.z),ep=[8192*eh.x,8192*eh.y],ed=[];for(let eh of V)for(let V of eh){let eh=[V.x+ep[0],V.y+ep[1]];fe(eh,G,el,ec),ed.push(eh)}return ed}function ye(V,G,el,eh){let ec=8192*Math.pow(2,eh.z),ep=[8192*eh.x,8192*eh.y],ed=[];for(let el of V){let V=[];for(let eh of el){let el=[eh.x+ep[0],eh.y+ep[1]];ee(G,el),V.push(el)}ed.push(V)}if(G[2]-G[0]<=ec/2)for(let V of(G[0]=G[1]=1/0,G[2]=G[3]=-1/0,ed))for(let eh of V)fe(eh,G,el,ec);return ed}let me=class me{constructor(V,G){this.type=eF,this.geojson=V,this.geometries=G}static parse(V,G){if(2!==V.length)return G.error(`'within' expression requires exactly one argument, but found ${V.length-1} instead.`);if(Ut(V[1])){let G=V[1];if("FeatureCollection"===G.type)for(let V=0;V<G.features.length;++V){let el=G.features[V].geometry.type;if("Polygon"===el||"MultiPolygon"===el)return new me(G,G.features[V].geometry)}else if("Feature"===G.type){let V=G.geometry.type;if("Polygon"===V||"MultiPolygon"===V)return new me(G,G.geometry)}else if("Polygon"===G.type||"MultiPolygon"===G.type)return new me(G,G)}return G.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(V){if(null!=V.geometry()&&null!=V.canonicalID()){if("Point"===V.geometryType())return function(V,G){let el=[1/0,1/0,-1/0,-1/0],eh=[1/0,1/0,-1/0,-1/0],ec=V.canonicalID();if("Polygon"===G.type){let ep=he(G.coordinates,eh,ec),ed=de(V.geometry(),el,eh,ec);if(!re(el,eh))return!1;for(let V of ed)if(!ae(V,ep))return!1}if("MultiPolygon"===G.type){let ep=pe(G.coordinates,eh,ec),ed=de(V.geometry(),el,eh,ec);if(!re(el,eh))return!1;for(let V of ed)if(!function(V,G){for(let el=0;el<G.length;el++)if(ae(V,G[el]))return!0;return!1}(V,ep))return!1}return!0}(V,this.geometries);if("LineString"===V.geometryType())return function(V,G){let el=[1/0,1/0,-1/0,-1/0],eh=[1/0,1/0,-1/0,-1/0],ec=V.canonicalID();if("Polygon"===G.type){let ep=he(G.coordinates,eh,ec),ed=ye(V.geometry(),el,eh,ec);if(!re(el,eh))return!1;for(let V of ed)if(!ue(V,ep))return!1}if("MultiPolygon"===G.type){let ep=pe(G.coordinates,eh,ec),ed=ye(V.geometry(),el,eh,ec);if(!re(el,eh))return!1;for(let V of ed)if(!function(V,G){for(let el=0;el<G.length;el++)if(ue(V,G[el]))return!0;return!1}(V,ep))return!1}return!0}(V,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}};function ge(V){if(V instanceof Wt&&("get"===V.name&&1===V.args.length||"feature-state"===V.name||"has"===V.name&&1===V.args.length||"properties"===V.name||"geometry-type"===V.name||"id"===V.name||/^filter-/.test(V.name))||V instanceof me)return!1;let G=!0;return V.eachChild(V=>{G&&!ge(V)&&(G=!1)}),G}function xe(V){if(V instanceof Wt&&"feature-state"===V.name)return!1;let G=!0;return V.eachChild(V=>{G&&!xe(V)&&(G=!1)}),G}function ve(V,G){if(V instanceof Wt&&G.indexOf(V.name)>=0)return!1;let el=!0;return V.eachChild(V=>{el&&!ve(V,G)&&(el=!1)}),el}let be=class be{constructor(V,G){this.type=G.type,this.name=V,this.boundExpression=G}static parse(V,G){if(2!==V.length||"string"!=typeof V[1])return G.error("'var' expression requires exactly one string literal argument.");let el=V[1];return G.scope.has(el)?new be(el,G.scope.get(el)):G.error(`Unknown variable "${el}". Make sure "${el}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(V){return this.boundExpression.evaluate(V)}eachChild(){}outputDefined(){return!1}};let we=class we{constructor(V,G=[],el,eh=new ct,ec=[]){this.registry=V,this.path=G,this.key=G.map(V=>`[${V}]`).join(""),this.scope=eh,this.errors=ec,this.expectedType=el}parse(V,G,el,eh,ec={}){return G?this.concat(G,el,eh)._parse(V,ec):this._parse(V,ec)}_parse(V,G){function r(V,G,el){return"assert"===el?new Gt(G,[V]):"coerce"===el?new Xt(G,[V]):V}if(null!==V&&"string"!=typeof V&&"boolean"!=typeof V&&"number"!=typeof V||(V=["literal",V]),Array.isArray(V)){if(0===V.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let el=V[0];if("string"!=typeof el)return this.error(`Expression name must be a string, but found ${typeof el} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let eh=this.registry[el];if(eh){let el=eh.parse(V,this);if(!el)return null;if(this.expectedType){let V=this.expectedType,eh=el.type;if("string"!==V.kind&&"number"!==V.kind&&"boolean"!==V.kind&&"object"!==V.kind&&"array"!==V.kind||"value"!==eh.kind){if("color"!==V.kind&&"formatted"!==V.kind&&"resolvedImage"!==V.kind||"value"!==eh.kind&&"string"!==eh.kind){if("padding"!==V.kind||"value"!==eh.kind&&"number"!==eh.kind&&"array"!==eh.kind){if(this.checkSubtype(V,eh))return null}else el=r(el,V,G.typeAnnotation||"coerce")}else el=r(el,V,G.typeAnnotation||"coerce")}else el=r(el,V,G.typeAnnotation||"assert")}if(!(el instanceof Nt)&&"resolvedImage"!==el.type.kind&&function _e(V){if(V instanceof be)return _e(V.boundExpression);if(V instanceof Wt&&"error"===V.name||V instanceof Qt||V instanceof me)return!1;let G=V instanceof Xt||V instanceof Gt,el=!0;return V.eachChild(V=>{el=G?el&&_e(V):el&&V instanceof Nt}),!!el&&ge(V)&&ve(V,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(el)){let V=new Ht;try{el=new Nt(el.type,el.evaluate(V))}catch(V){return this.error(V.message),null}}return el}return this.error(`Unknown expression "${el}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===V?"'undefined' value invalid. Use null instead.":"object"==typeof V?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof V} instead.`)}concat(V,G,el){let eh="number"==typeof V?this.path.concat(V):this.path,ec=el?this.scope.concat(el):this.scope;return new we(this.registry,eh,G||null,ec,this.errors)}error(V,...G){let el=`${this.key}${G.map(V=>`[${V}]`).join("")}`;this.errors.push(new ut(el,V))}checkSubtype(V,G){let el=St(V,G);return el&&this.error(el),el}};function Ae(V,G){let el=V.length-1,eh,ec,ep=0,ed=el,em=0;for(;ep<=ed;)if(eh=V[em=Math.floor((ep+ed)/2)],ec=V[em+1],eh<=G){if(em===el||G<ec)return em;ep=em+1}else{if(!(eh>G))throw new Zt("Input is not a number.");ed=em-1}return 0}let ke=class ke{constructor(V,G,el){for(let[eh,ec]of(this.type=V,this.input=G,this.labels=[],this.outputs=[],el))this.labels.push(eh),this.outputs.push(ec)}static parse(V,G){if(V.length-1<4)return G.error(`Expected at least 4 arguments, but found only ${V.length-1}.`);if((V.length-1)%2!=0)return G.error("Expected an even number of arguments.");let el=G.parse(V[1],1,eR);if(!el)return null;let eh=[],ec=null;G.expectedType&&"value"!==G.expectedType.kind&&(ec=G.expectedType);for(let el=1;el<V.length;el+=2){let ep=1===el?-1/0:V[el],ed=V[el+1],em=el,ef=el+1;if("number"!=typeof ep)return G.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',em);if(eh.length&&eh[eh.length-1][0]>=ep)return G.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',em);let eg=G.parse(ed,ef,ec);if(!eg)return null;ec=ec||eg.type,eh.push([ep,eg])}return new ke(ec,el,eh)}evaluate(V){let G=this.labels,el=this.outputs;if(1===G.length)return el[0].evaluate(V);let eh=this.input.evaluate(V);if(eh<=G[0])return el[0].evaluate(V);let ec=G.length;return eh>=G[ec-1]?el[ec-1].evaluate(V):el[Ae(G,eh)].evaluate(V)}eachChild(V){for(let G of(V(this.input),this.outputs))V(G)}outputDefined(){return this.outputs.every(V=>V.outputDefined())}};function Se(V,G,el){return V*(1-el)+G*el}var eJ=Object.freeze({__proto__:null,number:Se,color:function(V,G,el){return new Ft(Se(V.r,G.r,el),Se(V.g,G.g,el),Se(V.b,G.b,el),Se(V.a,G.a,el))},array:function(V,G,el){return V.map((V,eh)=>Se(V,G[eh],el))},padding:function(V,G,el){let eh=V.values,ec=G.values;return new $t([Se(eh[0],ec[0],el),Se(eh[1],ec[1],el),Se(eh[2],ec[2],el),Se(eh[3],ec[3],el)])}});let eQ=4/29,e0=6/29,e1=3*e0*e0,e2=Math.PI/180,e5=180/Math.PI;function Fe(V){return V>.008856451679035631?Math.pow(V,1/3):V/e1+eQ}function Te(V){return V>e0?V*V*V:e1*(V-eQ)}function Le(V){return 255*(V<=.0031308?12.92*V:1.055*Math.pow(V,1/2.4)-.055)}function De(V){return(V/=255)<=.04045?V/12.92:Math.pow((V+.055)/1.055,2.4)}function $e(V){let G=De(V.r),el=De(V.g),eh=De(V.b),ec=Fe((.4124564*G+.3575761*el+.1804375*eh)/.95047),ep=Fe((.2126729*G+.7151522*el+.072175*eh)/1);return{l:116*ep-16,a:500*(ec-ep),b:200*(ep-Fe((.0193339*G+.119192*el+.9503041*eh)/1.08883)),alpha:V.a}}function Re(V){let G=(V.l+16)/116,el=isNaN(V.a)?G:G+V.a/500,eh=isNaN(V.b)?G:G-V.b/200;return G=1*Te(G),el=.95047*Te(el),eh=1.08883*Te(eh),new Ft(Le(3.2404542*el-1.5371385*G-.4985314*eh),Le(-.969266*el+1.8760108*G+.041556*eh),Le(.0556434*el-.2040259*G+1.0572252*eh),V.alpha)}let e4={forward:$e,reverse:Re,interpolate:function(V,G,el){return{l:Se(V.l,G.l,el),a:Se(V.a,G.a,el),b:Se(V.b,G.b,el),alpha:Se(V.alpha,G.alpha,el)}}},e3={forward:function(V){let{l:G,a:el,b:eh}=$e(V),ec=Math.atan2(eh,el)*e5;return{h:ec<0?ec+360:ec,c:Math.sqrt(el*el+eh*eh),l:G,alpha:V.a}},reverse:function(V){let G=V.h*e2,el=V.c;return Re({l:V.l,a:Math.cos(G)*el,b:Math.sin(G)*el,alpha:V.alpha})},interpolate:function(V,G,el){return{h:function(V,G,el){let eh=G-V;return V+el*(eh>180||eh<-180?eh-360*Math.round(eh/360):eh)}(V.h,G.h,el),c:Se(V.c,G.c,el),l:Se(V.l,G.l,el),alpha:Se(V.alpha,G.alpha,el)}}};var e6=Object.freeze({__proto__:null,lab:e4,hcl:e3});let Ne=class Ne{constructor(V,G,el,eh,ec){for(let[ep,ed]of(this.type=V,this.operator=G,this.interpolation=el,this.input=eh,this.labels=[],this.outputs=[],ec))this.labels.push(ep),this.outputs.push(ed)}static interpolationFactor(V,G,el,eh){let ec=0;if("exponential"===V.name)ec=Ze(G,V.base,el,eh);else if("linear"===V.name)ec=Ze(G,1,el,eh);else if("cubic-bezier"===V.name){let ep=V.controlPoints;ec=new r(ep[0],ep[1],ep[2],ep[3]).solve(Ze(G,1,el,eh))}return ec}static parse(V,G){let[el,eh,ec,...ep]=V;if(!Array.isArray(eh)||0===eh.length)return G.error("Expected an interpolation type expression.",1);if("linear"===eh[0])eh={name:"linear"};else if("exponential"===eh[0]){let V=eh[1];if("number"!=typeof V)return G.error("Exponential interpolation requires a numeric base.",1,1);eh={name:"exponential",base:V}}else{if("cubic-bezier"!==eh[0])return G.error(`Unknown interpolation type ${String(eh[0])}`,1,0);{let V=eh.slice(1);if(4!==V.length||V.some(V=>"number"!=typeof V||V<0||V>1))return G.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);eh={name:"cubic-bezier",controlPoints:V}}}if(V.length-1<4)return G.error(`Expected at least 4 arguments, but found only ${V.length-1}.`);if((V.length-1)%2!=0)return G.error("Expected an even number of arguments.");if(!(ec=G.parse(ec,2,eR)))return null;let ed=[],em=null;"interpolate-hcl"===el||"interpolate-lab"===el?em=eO:G.expectedType&&"value"!==G.expectedType.kind&&(em=G.expectedType);for(let V=0;V<ep.length;V+=2){let el=ep[V],eh=ep[V+1],ec=V+3,ef=V+4;if("number"!=typeof el)return G.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ec);if(ed.length&&ed[ed.length-1][0]>=el)return G.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ec);let eg=G.parse(eh,ef,em);if(!eg)return null;em=em||eg.type,ed.push([el,eg])}return"number"===em.kind||"color"===em.kind||"padding"===em.kind||"array"===em.kind&&"number"===em.itemType.kind&&"number"==typeof em.N?new Ne(em,el,eh,ec,ed):G.error(`Type ${At(em)} is not interpolatable.`)}evaluate(V){let G=this.labels,el=this.outputs;if(1===G.length)return el[0].evaluate(V);let eh=this.input.evaluate(V);if(eh<=G[0])return el[0].evaluate(V);let ec=G.length;if(eh>=G[ec-1])return el[ec-1].evaluate(V);let ep=Ae(G,eh),ed=Ne.interpolationFactor(this.interpolation,eh,G[ep],G[ep+1]),em=el[ep].evaluate(V),ef=el[ep+1].evaluate(V);return"interpolate"===this.operator?eJ[this.type.kind.toLowerCase()](em,ef,ed):"interpolate-hcl"===this.operator?e3.reverse(e3.interpolate(e3.forward(em),e3.forward(ef),ed)):e4.reverse(e4.interpolate(e4.forward(em),e4.forward(ef),ed))}eachChild(V){for(let G of(V(this.input),this.outputs))V(G)}outputDefined(){return this.outputs.every(V=>V.outputDefined())}};function Ze(V,G,el,eh){let ec=eh-el,ep=V-el;return 0===ec?0:1===G?ep/ec:(Math.pow(G,ep)-1)/(Math.pow(G,ec)-1)}let Ke=class Ke{constructor(V,G){this.type=V,this.args=G}static parse(V,G){if(V.length<2)return G.error("Expectected at least one argument.");let el=null,eh=G.expectedType;eh&&"value"!==eh.kind&&(el=eh);let ec=[];for(let eh of V.slice(1)){let V=G.parse(eh,1+ec.length,el,void 0,{typeAnnotation:"omit"});if(!V)return null;el=el||V.type,ec.push(V)}if(!el)throw Error("No output type");let ep=eh&&ec.some(V=>St(eh,V.type));return new Ke(ep?eV:el,ec)}evaluate(V){let G,el=null,eh=0;for(let ec of this.args)if(eh++,(el=ec.evaluate(V))&&el instanceof Rt&&!el.available&&(G||(G=el.name),el=null,eh===this.args.length&&(el=G)),null!==el)break;return el}eachChild(V){this.args.forEach(V)}outputDefined(){return this.args.every(V=>V.outputDefined())}};let Ge=class Ge{constructor(V,G){this.type=G.type,this.bindings=[].concat(V),this.result=G}evaluate(V){return this.result.evaluate(V)}eachChild(V){for(let G of this.bindings)V(G[1]);V(this.result)}static parse(V,G){if(V.length<4)return G.error(`Expected at least 3 arguments, but found ${V.length-1} instead.`);let el=[];for(let eh=1;eh<V.length-1;eh+=2){let ec=V[eh];if("string"!=typeof ec)return G.error(`Expected string, but found ${typeof ec} instead.`,eh);if(/[^a-zA-Z0-9_]/.test(ec))return G.error("Variable names must contain only alphanumeric characters or '_'.",eh);let ep=G.parse(V[eh+1],eh+1);if(!ep)return null;el.push([ec,ep])}let eh=G.parse(V[V.length-1],V.length-1,G.expectedType,el);return eh?new Ge(el,eh):null}outputDefined(){return this.result.outputDefined()}};let Je=class Je{constructor(V,G,el){this.type=V,this.index=G,this.input=el}static parse(V,G){if(3!==V.length)return G.error(`Expected 2 arguments, but found ${V.length-1} instead.`);let el=G.parse(V[1],1,eR),eh=G.parse(V[2],2,_t(G.expectedType||eV));return el&&eh?new Je(eh.type.itemType,el,eh):null}evaluate(V){let G=this.index.evaluate(V),el=this.input.evaluate(V);if(G<0)throw new Zt(`Array index out of bounds: ${G} < 0.`);if(G>=el.length)throw new Zt(`Array index out of bounds: ${G} > ${el.length-1}.`);if(G!==Math.floor(G))throw new Zt(`Array index must be an integer, but found ${G} instead.`);return el[G]}eachChild(V){V(this.index),V(this.input)}outputDefined(){return!1}};let Xe=class Xe{constructor(V,G){this.type=eF,this.needle=V,this.haystack=G}static parse(V,G){if(3!==V.length)return G.error(`Expected 2 arguments, but found ${V.length-1} instead.`);let el=G.parse(V[1],1,eV),eh=G.parse(V[2],2,eV);return el&&eh?It(el.type,[eF,eB,eR,eL,eV])?new Xe(el,eh):G.error(`Expected first argument to be of type boolean, string, number or null, but found ${At(el.type)} instead`):null}evaluate(V){let G=this.needle.evaluate(V),el=this.haystack.evaluate(V);if(!el)return!1;if(!Mt(G,["boolean","string","number","null"]))throw new Zt(`Expected first argument to be of type boolean, string, number or null, but found ${At(qt(G))} instead.`);if(!Mt(el,["string","array"]))throw new Zt(`Expected second argument to be of type array or string, but found ${At(qt(el))} instead.`);return el.indexOf(G)>=0}eachChild(V){V(this.needle),V(this.haystack)}outputDefined(){return!0}};let Ye=class Ye{constructor(V,G,el){this.type=eR,this.needle=V,this.haystack=G,this.fromIndex=el}static parse(V,G){if(V.length<=2||V.length>=5)return G.error(`Expected 3 or 4 arguments, but found ${V.length-1} instead.`);let el=G.parse(V[1],1,eV),eh=G.parse(V[2],2,eV);if(!el||!eh)return null;if(!It(el.type,[eF,eB,eR,eL,eV]))return G.error(`Expected first argument to be of type boolean, string, number or null, but found ${At(el.type)} instead`);if(4===V.length){let ec=G.parse(V[3],3,eR);return ec?new Ye(el,eh,ec):null}return new Ye(el,eh)}evaluate(V){let G=this.needle.evaluate(V),el=this.haystack.evaluate(V);if(!Mt(G,["boolean","string","number","null"]))throw new Zt(`Expected first argument to be of type boolean, string, number or null, but found ${At(qt(G))} instead.`);if(!Mt(el,["string","array"]))throw new Zt(`Expected second argument to be of type array or string, but found ${At(qt(el))} instead.`);if(this.fromIndex){let eh=this.fromIndex.evaluate(V);return el.indexOf(G,eh)}return el.indexOf(G)}eachChild(V){V(this.needle),V(this.haystack),this.fromIndex&&V(this.fromIndex)}outputDefined(){return!1}};let He=class He{constructor(V,G,el,eh,ec,ep){this.inputType=V,this.type=G,this.input=el,this.cases=eh,this.outputs=ec,this.otherwise=ep}static parse(V,G){let el,eh;if(V.length<5)return G.error(`Expected at least 4 arguments, but found only ${V.length-1}.`);if(V.length%2!=1)return G.error("Expected an even number of arguments.");G.expectedType&&"value"!==G.expectedType.kind&&(eh=G.expectedType);let ec={},ep=[];for(let ed=2;ed<V.length-1;ed+=2){let em=V[ed],ef=V[ed+1];Array.isArray(em)||(em=[em]);let eg=G.concat(ed);if(0===em.length)return eg.error("Expected at least one branch label.");for(let V of em){if("number"!=typeof V&&"string"!=typeof V)return eg.error("Branch labels must be numbers or strings.");if("number"==typeof V&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return eg.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof V&&Math.floor(V)!==V)return eg.error("Numeric branch labels must be integer values.");if(el){if(eg.checkSubtype(el,qt(V)))return null}else el=qt(V);if(void 0!==ec[String(V)])return eg.error("Branch labels must be unique.");ec[String(V)]=ep.length}let e_=G.parse(ef,ed,eh);if(!e_)return null;eh=eh||e_.type,ep.push(e_)}let ed=G.parse(V[1],1,eV);if(!ed)return null;let em=G.parse(V[V.length-1],V.length-1,eh);return em?"value"!==ed.type.kind&&G.concat(1).checkSubtype(el,ed.type)?null:new He(el,eh,ed,ec,ep,em):null}evaluate(V){let G=this.input.evaluate(V);return(qt(G)===this.inputType&&this.outputs[this.cases[G]]||this.otherwise).evaluate(V)}eachChild(V){V(this.input),this.outputs.forEach(V),V(this.otherwise)}outputDefined(){return this.outputs.every(V=>V.outputDefined())&&this.otherwise.outputDefined()}};let We=class We{constructor(V,G,el){this.type=V,this.branches=G,this.otherwise=el}static parse(V,G){let el;if(V.length<4)return G.error(`Expected at least 3 arguments, but found only ${V.length-1}.`);if(V.length%2!=0)return G.error("Expected an odd number of arguments.");G.expectedType&&"value"!==G.expectedType.kind&&(el=G.expectedType);let eh=[];for(let ec=1;ec<V.length-1;ec+=2){let ep=G.parse(V[ec],ec,eF);if(!ep)return null;let ed=G.parse(V[ec+1],ec+1,el);if(!ed)return null;eh.push([ep,ed]),el=el||ed.type}let ec=G.parse(V[V.length-1],V.length-1,el);if(!ec)return null;if(!el)throw Error("Can't infer output type");return new We(el,eh,ec)}evaluate(V){for(let[G,el]of this.branches)if(G.evaluate(V))return el.evaluate(V);return this.otherwise.evaluate(V)}eachChild(V){for(let[G,el]of this.branches)V(G),V(el);V(this.otherwise)}outputDefined(){return this.branches.every(([V,G])=>G.outputDefined())&&this.otherwise.outputDefined()}};let Qe=class Qe{constructor(V,G,el,eh){this.type=V,this.input=G,this.beginIndex=el,this.endIndex=eh}static parse(V,G){if(V.length<=2||V.length>=5)return G.error(`Expected 3 or 4 arguments, but found ${V.length-1} instead.`);let el=G.parse(V[1],1,eV),eh=G.parse(V[2],2,eR);if(!el||!eh)return null;if(!It(el.type,[_t(eV),eB,eV]))return G.error(`Expected first argument to be of type array or string, but found ${At(el.type)} instead`);if(4===V.length){let ec=G.parse(V[3],3,eR);return ec?new Qe(el.type,el,eh,ec):null}return new Qe(el.type,el,eh)}evaluate(V){let G=this.input.evaluate(V),el=this.beginIndex.evaluate(V);if(!Mt(G,["string","array"]))throw new Zt(`Expected first argument to be of type array or string, but found ${At(qt(G))} instead.`);if(this.endIndex){let eh=this.endIndex.evaluate(V);return G.slice(el,eh)}return G.slice(el)}eachChild(V){V(this.input),V(this.beginIndex),this.endIndex&&V(this.endIndex)}outputDefined(){return!1}};function tr(V,G){return"=="===V||"!="===V?"boolean"===G.kind||"string"===G.kind||"number"===G.kind||"null"===G.kind||"value"===G.kind:"string"===G.kind||"number"===G.kind||"value"===G.kind}function er(V,G,el,eh){return 0===eh.compare(G,el)}function rr(V,G,el){let eh="=="!==V&&"!="!==V;return class i{constructor(V,G,el){this.type=eF,this.lhs=V,this.rhs=G,this.collator=el,this.hasUntypedArgument="value"===V.type.kind||"value"===G.type.kind}static parse(V,G){if(3!==V.length&&4!==V.length)return G.error("Expected two or three arguments.");let el=V[0],ec=G.parse(V[1],1,eV);if(!ec)return null;if(!tr(el,ec.type))return G.concat(1).error(`"${el}" comparisons are not supported for type '${At(ec.type)}'.`);let ep=G.parse(V[2],2,eV);if(!ep)return null;if(!tr(el,ep.type))return G.concat(2).error(`"${el}" comparisons are not supported for type '${At(ep.type)}'.`);if(ec.type.kind!==ep.type.kind&&"value"!==ec.type.kind&&"value"!==ep.type.kind)return G.error(`Cannot compare types '${At(ec.type)}' and '${At(ep.type)}'.`);eh&&("value"===ec.type.kind&&"value"!==ep.type.kind?ec=new Gt(ep.type,[ec]):"value"!==ec.type.kind&&"value"===ep.type.kind&&(ep=new Gt(ec.type,[ep])));let ed=null;if(4===V.length){if("string"!==ec.type.kind&&"string"!==ep.type.kind&&"value"!==ec.type.kind&&"value"!==ep.type.kind)return G.error("Cannot use collator to compare non-string types.");if(!(ed=G.parse(V[3],3,eN)))return null}return new i(ec,ep,ed)}evaluate(ec){let ep=this.lhs.evaluate(ec),ed=this.rhs.evaluate(ec);if(eh&&this.hasUntypedArgument){let G=qt(ep),el=qt(ed);if(G.kind!==el.kind||"string"!==G.kind&&"number"!==G.kind)throw new Zt(`Expected arguments for "${V}" to be (string, string) or (number, number), but found (${G.kind}, ${el.kind}) instead.`)}if(this.collator&&!eh&&this.hasUntypedArgument){let V=qt(ep),el=qt(ed);if("string"!==V.kind||"string"!==el.kind)return G(ec,ep,ed)}return this.collator?el(ec,ep,ed,this.collator.evaluate(ec)):G(ec,ep,ed)}eachChild(V){V(this.lhs),V(this.rhs),this.collator&&V(this.collator)}outputDefined(){return!0}}}let e8=rr("==",function(V,G,el){return G===el},er),e9=rr("!=",function(V,G,el){return G!==el},function(V,G,el,eh){return!er(0,G,el,eh)}),e7=rr("<",function(V,G,el){return G<el},function(V,G,el,eh){return 0>eh.compare(G,el)}),te=rr(">",function(V,G,el){return G>el},function(V,G,el,eh){return eh.compare(G,el)>0}),ts=rr("<=",function(V,G,el){return G<=el},function(V,G,el,eh){return 0>=eh.compare(G,el)}),tl=rr(">=",function(V,G,el){return G>=el},function(V,G,el,eh){return eh.compare(G,el)>=0});let ur=class ur{constructor(V,G,el,eh,ec){this.type=eB,this.number=V,this.locale=G,this.currency=el,this.minFractionDigits=eh,this.maxFractionDigits=ec}static parse(V,G){if(3!==V.length)return G.error("Expected two arguments.");let el=G.parse(V[1],1,eR);if(!el)return null;let eh=V[2];if("object"!=typeof eh||Array.isArray(eh))return G.error("NumberFormat options argument must be an object.");let ec=null;if(eh.locale&&!(ec=G.parse(eh.locale,1,eB)))return null;let ep=null;if(eh.currency&&!(ep=G.parse(eh.currency,1,eB)))return null;let ed=null;if(eh["min-fraction-digits"]&&!(ed=G.parse(eh["min-fraction-digits"],1,eR)))return null;let em=null;return!eh["max-fraction-digits"]||(em=G.parse(eh["max-fraction-digits"],1,eR))?new ur(el,ec,ep,ed,em):null}evaluate(V){return new Intl.NumberFormat(this.locale?this.locale.evaluate(V):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(V):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(V):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(V):void 0}).format(this.number.evaluate(V))}eachChild(V){V(this.number),this.locale&&V(this.locale),this.currency&&V(this.currency),this.minFractionDigits&&V(this.minFractionDigits),this.maxFractionDigits&&V(this.maxFractionDigits)}outputDefined(){return!1}};let cr=class cr{constructor(V){this.type=e$,this.sections=V}static parse(V,G){if(V.length<2)return G.error("Expected at least one argument.");let el=V[1];if(!Array.isArray(el)&&"object"==typeof el)return G.error("First argument must be an image or text section.");let eh=[],ec=!1;for(let el=1;el<=V.length-1;++el){let ep=V[el];if(ec&&"object"==typeof ep&&!Array.isArray(ep)){ec=!1;let V=null;if(ep["font-scale"]&&!(V=G.parse(ep["font-scale"],1,eR)))return null;let el=null;if(ep["text-font"]&&!(el=G.parse(ep["text-font"],1,_t(eB))))return null;let ed=null;if(ep["text-color"]&&!(ed=G.parse(ep["text-color"],1,eO)))return null;let em=eh[eh.length-1];em.scale=V,em.font=el,em.textColor=ed}else{let ep=G.parse(V[el],1,eV);if(!ep)return null;let ed=ep.type.kind;if("string"!==ed&&"value"!==ed&&"null"!==ed&&"resolvedImage"!==ed)return G.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");ec=!0,eh.push({content:ep,scale:null,font:null,textColor:null})}}return new cr(eh)}evaluate(V){return new Dt(this.sections.map(G=>{let el=G.content.evaluate(V);return qt(el)===eG?new Lt("",el,null,null,null):new Lt(jt(el),null,G.scale?G.scale.evaluate(V):null,G.font?G.font.evaluate(V).join(","):null,G.textColor?G.textColor.evaluate(V):null)}))}eachChild(V){for(let G of this.sections)V(G.content),G.scale&&V(G.scale),G.font&&V(G.font),G.textColor&&V(G.textColor)}outputDefined(){return!1}};let hr=class hr{constructor(V){this.type=eG,this.input=V}static parse(V,G){if(2!==V.length)return G.error("Expected two arguments.");let el=G.parse(V[1],1,eB);return el?new hr(el):G.error("No image name provided.")}evaluate(V){let G=this.input.evaluate(V),el=Rt.fromString(G);return el&&V.availableImages&&(el.available=V.availableImages.indexOf(G)>-1),el}eachChild(V){V(this.input)}outputDefined(){return!1}};let pr=class pr{constructor(V){this.type=eR,this.input=V}static parse(V,G){if(2!==V.length)return G.error(`Expected 1 argument, but found ${V.length-1} instead.`);let el=G.parse(V[1],1);return el?"array"!==el.type.kind&&"string"!==el.type.kind&&"value"!==el.type.kind?G.error(`Expected argument of type string or array, but found ${At(el.type)} instead.`):new pr(el):null}evaluate(V){let G=this.input.evaluate(V);if("string"==typeof G||Array.isArray(G))return G.length;throw new Zt(`Expected value to be of type string or array, but found ${At(qt(G))} instead.`)}eachChild(V){V(this.input)}outputDefined(){return!1}};let th={"==":e8,"!=":e9,">":te,"<":e7,">=":tl,"<=":ts,array:Gt,at:Je,boolean:Gt,case:We,coalesce:Ke,collator:Qt,format:cr,image:hr,in:Xe,"index-of":Ye,interpolate:Ne,"interpolate-hcl":Ne,"interpolate-lab":Ne,length:pr,let:Ge,literal:Nt,match:He,number:Gt,"number-format":ur,object:Gt,slice:Qe,step:ke,string:Gt,"to-boolean":Xt,"to-color":Xt,"to-number":Xt,"to-string":Xt,var:be,within:me};function dr(V,[G,el,eh,ec]){G=G.evaluate(V),el=el.evaluate(V),eh=eh.evaluate(V);let ep=ec?ec.evaluate(V):1,ed=Ot(G,el,eh,ep);if(ed)throw new Zt(ed);return new Ft(G/255*ep,el/255*ep,eh/255*ep,ep)}function mr(V,G){let el=G[V];return void 0===el?null:el}function gr(V){return{type:V}}function xr(V){return{result:"success",value:V}}function vr(V){return{result:"error",value:V}}function br(V){return"data-driven"===V["property-type"]||"cross-faded-data-driven"===V["property-type"]}function wr(V){return!!V.expression&&V.expression.parameters.indexOf("zoom")>-1}function _r(V){return!!V.expression&&V.expression.interpolated}function Ar(V){return V instanceof Number?"number":V instanceof String?"string":V instanceof Boolean?"boolean":Array.isArray(V)?"array":null===V?"null":typeof V}function kr(V){return"object"==typeof V&&null!==V&&!Array.isArray(V)}function Sr(V){return V}function Mr(V,G,el){return void 0!==V?V:void 0!==G?G:void 0!==el?el:void 0}function zr(V,G,el,eh,ec){return Mr(typeof el===ec?eh[el]:void 0,V.default,G.default)}function Br(V,G,el){if("number"!==Ar(el))return Mr(V.default,G.default);let eh=V.stops.length;if(1===eh||el<=V.stops[0][0])return V.stops[0][1];if(el>=V.stops[eh-1][0])return V.stops[eh-1][1];let ec=Ae(V.stops.map(V=>V[0]),el);return V.stops[ec][1]}function Cr(V,G,el){let eh=void 0!==V.base?V.base:1;if("number"!==Ar(el))return Mr(V.default,G.default);let ec=V.stops.length;if(1===ec||el<=V.stops[0][0])return V.stops[0][1];if(el>=V.stops[ec-1][0])return V.stops[ec-1][1];let ep=Ae(V.stops.map(V=>V[0]),el),ed=function(V,G,el,eh){let ec=eh-el,ep=V-el;return 0===ec?0:1===G?ep/ec:(Math.pow(G,ep)-1)/(Math.pow(G,ec)-1)}(el,eh,V.stops[ep][0],V.stops[ep+1][0]),em=V.stops[ep][1],ef=V.stops[ep+1][1],eg=eJ[G.type]||Sr;if(V.colorSpace&&"rgb"!==V.colorSpace){let G=e6[V.colorSpace];eg=(V,el)=>G.reverse(G.interpolate(G.forward(V),G.forward(el),ed))}return"function"==typeof em.evaluate?{evaluate(...V){let G=em.evaluate.apply(void 0,V),el=ef.evaluate.apply(void 0,V);if(void 0!==G&&void 0!==el)return eg(G,el,ed)}}:eg(em,ef,ed)}function Pr(V,G,el){switch(G.type){case"color":el=Ft.parse(el);break;case"formatted":el=Dt.fromString(el.toString());break;case"resolvedImage":el=Rt.fromString(el.toString());break;case"padding":el=$t.parse(el);break;default:Ar(el)===G.type||"enum"===G.type&&G.values[el]||(el=void 0)}return Mr(el,V.default,G.default)}Wt.register(th,{error:[{kind:"error"},[eB],(V,[G])=>{throw new Zt(G.evaluate(V))}],typeof:[eB,[eV],(V,[G])=>At(qt(G.evaluate(V)))],"to-rgba":[_t(eR,4),[eO],(V,[G])=>G.evaluate(V).toArray()],rgb:[eO,[eR,eR,eR],dr],rgba:[eO,[eR,eR,eR,eR],dr],has:{type:eF,overloads:[[[eB],(V,[G])=>G.evaluate(V) in V.properties()],[[eB,eU],(V,[G,el])=>G.evaluate(V) in el.evaluate(V)]]},get:{type:eV,overloads:[[[eB],(V,[G])=>mr(G.evaluate(V),V.properties())],[[eB,eU],(V,[G,el])=>mr(G.evaluate(V),el.evaluate(V))]]},"feature-state":[eV,[eB],(V,[G])=>mr(G.evaluate(V),V.featureState||{})],properties:[eU,[],V=>V.properties()],"geometry-type":[eB,[],V=>V.geometryType()],id:[eV,[],V=>V.id()],zoom:[eR,[],V=>V.globals.zoom],"heatmap-density":[eR,[],V=>V.globals.heatmapDensity||0],"line-progress":[eR,[],V=>V.globals.lineProgress||0],accumulated:[eV,[],V=>void 0===V.globals.accumulated?null:V.globals.accumulated],"+":[eR,gr(eR),(V,G)=>{let el=0;for(let eh of G)el+=eh.evaluate(V);return el}],"*":[eR,gr(eR),(V,G)=>{let el=1;for(let eh of G)el*=eh.evaluate(V);return el}],"-":{type:eR,overloads:[[[eR,eR],(V,[G,el])=>G.evaluate(V)-el.evaluate(V)],[[eR],(V,[G])=>-G.evaluate(V)]]},"/":[eR,[eR,eR],(V,[G,el])=>G.evaluate(V)/el.evaluate(V)],"%":[eR,[eR,eR],(V,[G,el])=>G.evaluate(V)%el.evaluate(V)],ln2:[eR,[],()=>Math.LN2],pi:[eR,[],()=>Math.PI],e:[eR,[],()=>Math.E],"^":[eR,[eR,eR],(V,[G,el])=>Math.pow(G.evaluate(V),el.evaluate(V))],sqrt:[eR,[eR],(V,[G])=>Math.sqrt(G.evaluate(V))],log10:[eR,[eR],(V,[G])=>Math.log(G.evaluate(V))/Math.LN10],ln:[eR,[eR],(V,[G])=>Math.log(G.evaluate(V))],log2:[eR,[eR],(V,[G])=>Math.log(G.evaluate(V))/Math.LN2],sin:[eR,[eR],(V,[G])=>Math.sin(G.evaluate(V))],cos:[eR,[eR],(V,[G])=>Math.cos(G.evaluate(V))],tan:[eR,[eR],(V,[G])=>Math.tan(G.evaluate(V))],asin:[eR,[eR],(V,[G])=>Math.asin(G.evaluate(V))],acos:[eR,[eR],(V,[G])=>Math.acos(G.evaluate(V))],atan:[eR,[eR],(V,[G])=>Math.atan(G.evaluate(V))],min:[eR,gr(eR),(V,G)=>Math.min(...G.map(G=>G.evaluate(V)))],max:[eR,gr(eR),(V,G)=>Math.max(...G.map(G=>G.evaluate(V)))],abs:[eR,[eR],(V,[G])=>Math.abs(G.evaluate(V))],round:[eR,[eR],(V,[G])=>{let el=G.evaluate(V);return el<0?-Math.round(-el):Math.round(el)}],floor:[eR,[eR],(V,[G])=>Math.floor(G.evaluate(V))],ceil:[eR,[eR],(V,[G])=>Math.ceil(G.evaluate(V))],"filter-==":[eF,[eB,eV],(V,[G,el])=>V.properties()[G.value]===el.value],"filter-id-==":[eF,[eV],(V,[G])=>V.id()===G.value],"filter-type-==":[eF,[eB],(V,[G])=>V.geometryType()===G.value],"filter-<":[eF,[eB,eV],(V,[G,el])=>{let eh=V.properties()[G.value],ec=el.value;return typeof eh==typeof ec&&eh<ec}],"filter-id-<":[eF,[eV],(V,[G])=>{let el=V.id(),eh=G.value;return typeof el==typeof eh&&el<eh}],"filter->":[eF,[eB,eV],(V,[G,el])=>{let eh=V.properties()[G.value],ec=el.value;return typeof eh==typeof ec&&eh>ec}],"filter-id->":[eF,[eV],(V,[G])=>{let el=V.id(),eh=G.value;return typeof el==typeof eh&&el>eh}],"filter-<=":[eF,[eB,eV],(V,[G,el])=>{let eh=V.properties()[G.value],ec=el.value;return typeof eh==typeof ec&&eh<=ec}],"filter-id-<=":[eF,[eV],(V,[G])=>{let el=V.id(),eh=G.value;return typeof el==typeof eh&&el<=eh}],"filter->=":[eF,[eB,eV],(V,[G,el])=>{let eh=V.properties()[G.value],ec=el.value;return typeof eh==typeof ec&&eh>=ec}],"filter-id->=":[eF,[eV],(V,[G])=>{let el=V.id(),eh=G.value;return typeof el==typeof eh&&el>=eh}],"filter-has":[eF,[eV],(V,[G])=>G.value in V.properties()],"filter-has-id":[eF,[],V=>null!==V.id()&&void 0!==V.id()],"filter-type-in":[eF,[_t(eB)],(V,[G])=>G.value.indexOf(V.geometryType())>=0],"filter-id-in":[eF,[_t(eV)],(V,[G])=>G.value.indexOf(V.id())>=0],"filter-in-small":[eF,[eB,_t(eV)],(V,[G,el])=>el.value.indexOf(V.properties()[G.value])>=0],"filter-in-large":[eF,[eB,_t(eV)],(V,[G,el])=>(function(V,G,el,eh){for(;el<=eh;){let ec=el+eh>>1;if(G[ec]===V)return!0;G[ec]>V?eh=ec-1:el=ec+1}return!1})(V.properties()[G.value],el.value,0,el.value.length-1)],all:{type:eF,overloads:[[[eF,eF],(V,[G,el])=>G.evaluate(V)&&el.evaluate(V)],[gr(eF),(V,G)=>{for(let el of G)if(!el.evaluate(V))return!1;return!0}]]},any:{type:eF,overloads:[[[eF,eF],(V,[G,el])=>G.evaluate(V)||el.evaluate(V)],[gr(eF),(V,G)=>{for(let el of G)if(el.evaluate(V))return!0;return!1}]]},"!":[eF,[eF],(V,[G])=>!G.evaluate(V)],"is-supported-script":[eF,[eB],(V,[G])=>{let el=V.globals&&V.globals.isSupportedScript;return!el||el(G.evaluate(V))}],upcase:[eB,[eB],(V,[G])=>G.evaluate(V).toUpperCase()],downcase:[eB,[eB],(V,[G])=>G.evaluate(V).toLowerCase()],concat:[eB,gr(eV),(V,G)=>G.map(G=>jt(G.evaluate(V))).join("")],"resolved-locale":[eB,[eN],(V,[G])=>G.evaluate(V).resolvedLocale()]});let Vr=class Vr{constructor(V,G){this.expression=V,this._warningHistory={},this._evaluator=new Ht,this._defaultValue=G?"color"===G.type&&kr(G.default)?new Ft(0,0,0,0):"color"===G.type?Ft.parse(G.default)||null:"padding"===G.type?$t.parse(G.default)||null:void 0===G.default?null:G.default:null,this._enumValues=G&&"enum"===G.type?G.values:null}evaluateWithoutErrorHandling(V,G,el,eh,ec,ep){return this._evaluator.globals=V,this._evaluator.feature=G,this._evaluator.featureState=el,this._evaluator.canonical=eh,this._evaluator.availableImages=ec||null,this._evaluator.formattedSection=ep,this.expression.evaluate(this._evaluator)}evaluate(V,G,el,eh,ec,ep){this._evaluator.globals=V,this._evaluator.feature=G||null,this._evaluator.featureState=el||null,this._evaluator.canonical=eh,this._evaluator.availableImages=ec||null,this._evaluator.formattedSection=ep||null;try{let V=this.expression.evaluate(this._evaluator);if(null==V||"number"==typeof V&&V!=V)return this._defaultValue;if(this._enumValues&&!(V in this._enumValues))throw new Zt(`Expected value to be one of ${Object.keys(this._enumValues).map(V=>JSON.stringify(V)).join(", ")}, but found ${JSON.stringify(V)} instead.`);return V}catch(V){return this._warningHistory[V.message]||(this._warningHistory[V.message]=!0,"undefined"!=typeof console&&console.warn(V.message)),this._defaultValue}}};function Er(V){return Array.isArray(V)&&V.length>0&&"string"==typeof V[0]&&V[0]in th}function Fr(V,G){let el=new we(th,[],G?function(V){let G={color:eO,string:eB,number:eR,enum:eB,boolean:eF,formatted:e$,padding:eq,resolvedImage:eG};return"array"===V.type?_t(G[V.value]||eV,V.length):G[V.type]}(G):void 0),eh=el.parse(V,void 0,void 0,void 0,G&&"string"===G.type?{typeAnnotation:"coerce"}:void 0);return eh?xr(new Vr(eh,G)):vr(el.errors)}let Tr=class Tr{constructor(V,G){this.kind=V,this._styleExpression=G,this.isStateDependent="constant"!==V&&!xe(G.expression)}evaluateWithoutErrorHandling(V,G,el,eh,ec,ep){return this._styleExpression.evaluateWithoutErrorHandling(V,G,el,eh,ec,ep)}evaluate(V,G,el,eh,ec,ep){return this._styleExpression.evaluate(V,G,el,eh,ec,ep)}};let Lr=class Lr{constructor(V,G,el,eh){this.kind=V,this.zoomStops=el,this._styleExpression=G,this.isStateDependent="camera"!==V&&!xe(G.expression),this.interpolationType=eh}evaluateWithoutErrorHandling(V,G,el,eh,ec,ep){return this._styleExpression.evaluateWithoutErrorHandling(V,G,el,eh,ec,ep)}evaluate(V,G,el,eh,ec,ep){return this._styleExpression.evaluate(V,G,el,eh,ec,ep)}interpolationFactor(V,G,el){return this.interpolationType?Ne.interpolationFactor(this.interpolationType,V,G,el):0}};function Dr(V,G){let el=Fr(V,G);if("error"===el.result)return el;let eh=el.value.expression,ec=ge(eh);if(!ec&&!br(G))return vr([new ut("","data expressions not supported")]);let ep=ve(eh,["zoom"]);if(!ep&&!wr(G))return vr([new ut("","zoom expressions not supported")]);let ed=function Rr(V){let G=null;if(V instanceof Ge)G=Rr(V.result);else if(V instanceof Ke){for(let el of V.args)if(G=Rr(el))break}else(V instanceof ke||V instanceof Ne)&&V.input instanceof Wt&&"zoom"===V.input.name&&(G=V);return G instanceof ut||V.eachChild(V=>{let el=Rr(V);el instanceof ut?G=el:!G&&el?G=new ut("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):G&&el&&G!==el&&(G=new ut("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),G}(eh);return ed||ep?ed instanceof ut?vr([ed]):ed instanceof Ne&&!_r(G)?vr([new ut("",'"interpolate" expressions cannot be used with this property')]):xr(ed?new Lr(ec?"camera":"composite",el.value,ed.labels,ed instanceof Ne?ed.interpolation:void 0):new Tr(ec?"constant":"source",el.value)):vr([new ut("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}let $r=class $r{constructor(V,G){this._parameters=V,this._specification=G,st(this,function Ir(V,G){let el,eh,ec;let ep="color"===G.type,ed=V.stops&&"object"==typeof V.stops[0][0],em=ed||!(ed||void 0!==V.property),ef=V.type||(_r(G)?"exponential":"interval");if(ep||"padding"===G.type){let el=ep?Ft.parse:$t.parse;(V=st({},V)).stops&&(V.stops=V.stops.map(V=>[V[0],el(V[1])])),V.default=el(V.default?V.default:G.default)}if(V.colorSpace&&"rgb"!==V.colorSpace&&!e6[V.colorSpace])throw Error(`Unknown color space: ${V.colorSpace}`);if("exponential"===ef)el=Cr;else if("interval"===ef)el=Br;else if("categorical"===ef){for(let G of(el=zr,eh=Object.create(null),V.stops))eh[G[0]]=G[1];ec=typeof V.stops[0][0]}else{if("identity"!==ef)throw Error(`Unknown function type "${ef}"`);el=Pr}if(ed){let el={},eh=[];for(let G=0;G<V.stops.length;G++){let ec=V.stops[G],ep=ec[0].zoom;void 0===el[ep]&&(el[ep]={zoom:ep,type:V.type,property:V.property,default:V.default,stops:[]},eh.push(ep)),el[ep].stops.push([ec[0].value,ec[1]])}let ec=[];for(let V of eh)ec.push([el[V].zoom,Ir(el[V],G)]);let ep={name:"linear"};return{kind:"composite",interpolationType:ep,interpolationFactor:Ne.interpolationFactor.bind(void 0,ep),zoomStops:ec.map(V=>V[0]),evaluate:({zoom:el},eh)=>Cr({stops:ec,base:V.base},G,el).evaluate(el,eh)}}if(em){let ep="exponential"===ef?{name:"exponential",base:void 0!==V.base?V.base:1}:null;return{kind:"camera",interpolationType:ep,interpolationFactor:Ne.interpolationFactor.bind(void 0,ep),zoomStops:V.stops.map(V=>V[0]),evaluate:({zoom:ep})=>el(V,G,ep,eh,ec)}}return{kind:"source",evaluate(ep,ed){let em=ed&&ed.properties?ed.properties[V.property]:void 0;return void 0===em?Mr(V.default,G.default):el(V,G,em,eh,ec)}}}(this._parameters,this._specification))}static deserialize(V){return new $r(V._parameters,V._specification)}static serialize(V){return{_parameters:V._parameters,_specification:V._specification}}};function Or(V){let G=V.key,el=V.value,eh=V.valueSpec||{},ec=V.objectElementValidators||{},ep=V.style,ed=V.styleSpec,em=[],ef=Ar(el);if("object"!==ef)return[new it(G,el,`object expected, ${ef} found`)];for(let V in el){let ef;let eg=V.split(".")[0],e_=eh[eg]||eh["*"];if(ec[eg])ef=ec[eg];else if(eh[eg])ef=yn;else if(ec["*"])ef=ec["*"];else{if(!eh["*"]){em.push(new it(G,el[V],`unknown property "${V}"`));continue}ef=yn}em=em.concat(ef({key:(G?`${G}.`:G)+V,value:el[V],valueSpec:e_,style:ep,styleSpec:ed,object:el,objectKey:V},el))}for(let V in eh)ec[V]||eh[V].required&&void 0===eh[V].default&&void 0===el[V]&&em.push(new it(G,el,`missing required property "${V}"`));return em}function Ur(V){let G=V.value,el=V.valueSpec,eh=V.style,ec=V.styleSpec,ep=V.key,ed=V.arrayElementValidator||yn;if("array"!==Ar(G))return[new it(ep,G,`array expected, ${Ar(G)} found`)];if(el.length&&G.length!==el.length)return[new it(ep,G,`array length ${el.length} expected, length ${G.length} found`)];if(el["min-length"]&&G.length<el["min-length"])return[new it(ep,G,`array length at least ${el["min-length"]} expected, length ${G.length} found`)];let em={type:el.value,values:el.values};ec.$version<7&&(em.function=el.function),"object"===Ar(el.value)&&(em=el.value);let ef=[];for(let V=0;V<G.length;V++)ef=ef.concat(ed({array:G,arrayIndex:V,value:G[V],valueSpec:em,style:eh,styleSpec:ec,key:`${ep}[${V}]`}));return ef}function qr(V){let G=V.key,el=V.value,eh=V.valueSpec,ec=Ar(el);return"number"===ec&&el!=el&&(ec="NaN"),"number"!==ec?[new it(G,el,`number expected, ${ec} found`)]:"minimum"in eh&&el<eh.minimum?[new it(G,el,`${el} is less than the minimum value ${eh.minimum}`)]:"maximum"in eh&&el>eh.maximum?[new it(G,el,`${el} is greater than the maximum value ${eh.maximum}`)]:[]}function jr(V){let G=V.valueSpec,el=ot(V.value.type),eh,ec,ep,ed={},em="categorical"!==el&&void 0===V.value.property,ef="array"===Ar(V.value.stops)&&"array"===Ar(V.value.stops[0])&&"object"===Ar(V.value.stops[0][0]),eg=Or({key:V.key,value:V.value,valueSpec:V.styleSpec.function,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{stops:function(V){if("identity"===el)return[new it(V.key,V.value,'identity function may not have a "stops" property')];let G=[],eh=V.value;return G=G.concat(Ur({key:V.key,value:eh,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:h})),"array"===Ar(eh)&&0===eh.length&&G.push(new it(V.key,eh,"array must have at least one stop")),G},default:function(V){return yn({key:V.key,value:V.value,valueSpec:G,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===el&&em&&eg.push(new it(V.key,V.value,'missing required property "property"')),"identity"===el||V.value.stops||eg.push(new it(V.key,V.value,'missing required property "stops"')),"exponential"===el&&V.valueSpec.expression&&!_r(V.valueSpec)&&eg.push(new it(V.key,V.value,"exponential functions not supported")),V.styleSpec.$version>=8&&(em||br(V.valueSpec)?em&&!wr(V.valueSpec)&&eg.push(new it(V.key,V.value,"zoom functions not supported")):eg.push(new it(V.key,V.value,"property functions not supported"))),("categorical"===el||ef)&&void 0===V.value.property&&eg.push(new it(V.key,V.value,'"property" property is required')),eg;function h(V){let el=[],eh=V.value,em=V.key;if("array"!==Ar(eh))return[new it(em,eh,`array expected, ${Ar(eh)} found`)];if(2!==eh.length)return[new it(em,eh,`array length 2 expected, length ${eh.length} found`)];if(ef){if("object"!==Ar(eh[0]))return[new it(em,eh,`object expected, ${Ar(eh[0])} found`)];if(void 0===eh[0].zoom)return[new it(em,eh,"object stop key must have zoom")];if(void 0===eh[0].value)return[new it(em,eh,"object stop key must have value")];if(ep&&ep>ot(eh[0].zoom))return[new it(em,eh[0].zoom,"stop zoom values must appear in ascending order")];ot(eh[0].zoom)!==ep&&(ep=ot(eh[0].zoom),ec=void 0,ed={}),el=el.concat(Or({key:`${em}[0]`,value:eh[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:qr,value:p}}))}else el=el.concat(p({key:`${em}[0]`,value:eh[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},eh));return Er(lt(eh[1]))?el.concat([new it(`${em}[1]`,eh[1],"expressions are not allowed in function stops.")]):el.concat(yn({key:`${em}[1]`,value:eh[1],valueSpec:G,style:V.style,styleSpec:V.styleSpec}))}function p(V,ep){let em=Ar(V.value),ef=ot(V.value),eg=null!==V.value?V.value:ep;if(eh){if(em!==eh)return[new it(V.key,eg,`${em} stop domain type must match previous stop domain type ${eh}`)]}else eh=em;if("number"!==em&&"string"!==em&&"boolean"!==em)return[new it(V.key,eg,"stop domain value must be a number, string, or boolean")];if("number"!==em&&"categorical"!==el){let eh=`number expected, ${em} found`;return br(G)&&void 0===el&&(eh+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(V.key,eg,eh)]}return"categorical"!==el||"number"!==em||isFinite(ef)&&Math.floor(ef)===ef?"categorical"!==el&&"number"===em&&void 0!==ec&&ef<ec?[new it(V.key,eg,"stop domain values must appear in ascending order")]:(ec=ef,"categorical"===el&&ef in ed?[new it(V.key,eg,"stop domain values must be unique")]:(ed[ef]=!0,[])):[new it(V.key,eg,`integer expected, found ${ef}`)]}}function Nr(V){let G=("property"===V.expressionContext?Dr:Fr)(lt(V.value),V.valueSpec);if("error"===G.result)return G.value.map(G=>new it(`${V.key}${G.key}`,V.value,G.message));let el=G.value.expression||G.value._styleExpression.expression;if("property"===V.expressionContext&&"text-font"===V.propertyKey&&!el.outputDefined())return[new it(V.key,V.value,`Invalid data expression for "${V.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===V.expressionContext&&"layout"===V.propertyType&&!xe(el))return[new it(V.key,V.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===V.expressionContext&&!xe(el))return[new it(V.key,V.value,'"feature-state" data expressions are not supported with filters.')];if(V.expressionContext&&0===V.expressionContext.indexOf("cluster")){if(!ve(el,["zoom","feature-state"]))return[new it(V.key,V.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===V.expressionContext&&!ge(el))return[new it(V.key,V.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zr(V){let G=V.key,el=V.value,eh=V.valueSpec,ec=[];return Array.isArray(eh.values)?-1===eh.values.indexOf(ot(el))&&ec.push(new it(G,el,`expected one of [${eh.values.join(", ")}], ${JSON.stringify(el)} found`)):-1===Object.keys(eh.values).indexOf(ot(el))&&ec.push(new it(G,el,`expected one of [${Object.keys(eh.values).join(", ")}], ${JSON.stringify(el)} found`)),ec}function Kr(V){if(!0===V||!1===V)return!0;if(!Array.isArray(V)||0===V.length)return!1;switch(V[0]){case"has":return V.length>=2&&"$id"!==V[1]&&"$type"!==V[1];case"in":return V.length>=3&&("string"!=typeof V[1]||Array.isArray(V[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==V.length||Array.isArray(V[1])||Array.isArray(V[2]);case"any":case"all":for(let G of V.slice(1))if(!Kr(G)&&"boolean"!=typeof G)return!1;return!0;default:return!0}}let tu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Jr(V){if(null==V)return{filter:()=>!0,needGeometry:!1};Kr(V)||(V=function Hr(V){if(!V)return!0;let G=V[0];return V.length<=1?"any"!==G:"=="===G?Wr(V[1],V[2],"=="):"!="===G?en(Wr(V[1],V[2],"==")):"<"===G||">"===G||"<="===G||">="===G?Wr(V[1],V[2],G):"any"===G?["any"].concat(V.slice(1).map(Hr)):"all"===G?["all"].concat(V.slice(1).map(Hr)):"none"===G?["all"].concat(V.slice(1).map(Hr).map(en)):"in"===G?Qr(V[1],V.slice(2)):"!in"===G?en(Qr(V[1],V.slice(2))):"has"===G?tn(V[1]):"!has"===G?en(tn(V[1])):"within"!==G||V}(V));let G=Fr(V,tu);if("error"===G.result)throw Error(G.value.map(V=>`${V.key}: ${V.message}`).join(", "));return{filter:(V,el,eh)=>G.value.evaluate(V,el,{},eh),needGeometry:function Yr(V){if(!Array.isArray(V))return!1;if("within"===V[0])return!0;for(let G=1;G<V.length;G++)if(Yr(V[G]))return!0;return!1}(V)}}function Xr(V,G){return V<G?-1:V>G?1:0}function Wr(V,G,el){switch(V){case"$type":return[`filter-type-${el}`,G];case"$id":return[`filter-id-${el}`,G];default:return[`filter-${el}`,V,G]}}function Qr(V,G){if(0===G.length)return!1;switch(V){case"$type":return["filter-type-in",["literal",G]];case"$id":return["filter-id-in",["literal",G]];default:return G.length>200&&!G.some(V=>typeof V!=typeof G[0])?["filter-in-large",V,["literal",G.sort(Xr)]]:["filter-in-small",V,["literal",G]]}}function tn(V){switch(V){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",V]}}function en(V){return["!",V]}function rn(V){return Kr(lt(V.value))?Nr(st({},V,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function nn(V){let G=V.value,el=V.key;if("array"!==Ar(G))return[new it(el,G,`array expected, ${Ar(G)} found`)];let eh=V.styleSpec,ec,ep=[];if(G.length<1)return[new it(el,G,"filter array must have at least 1 element")];switch(ep=ep.concat(Zr({key:`${el}[0]`,value:G[0],valueSpec:eh.filter_operator,style:V.style,styleSpec:V.styleSpec})),ot(G[0])){case"<":case"<=":case">":case">=":G.length>=2&&"$type"===ot(G[1])&&ep.push(new it(el,G,`"$type" cannot be use with operator "${G[0]}"`));case"==":case"!=":3!==G.length&&ep.push(new it(el,G,`filter array for operator "${G[0]}" must have 3 elements`));case"in":case"!in":G.length>=2&&"string"!==(ec=Ar(G[1]))&&ep.push(new it(`${el}[1]`,G[1],`string expected, ${ec} found`));for(let ed=2;ed<G.length;ed++)ec=Ar(G[ed]),"$type"===ot(G[1])?ep=ep.concat(Zr({key:`${el}[${ed}]`,value:G[ed],valueSpec:eh.geometry_type,style:V.style,styleSpec:V.styleSpec})):"string"!==ec&&"number"!==ec&&"boolean"!==ec&&ep.push(new it(`${el}[${ed}]`,G[ed],`string, number, or boolean expected, ${ec} found`));break;case"any":case"all":case"none":for(let eh=1;eh<G.length;eh++)ep=ep.concat(nn({key:`${el}[${eh}]`,value:G[eh],style:V.style,styleSpec:V.styleSpec}));break;case"has":case"!has":ec=Ar(G[1]),2!==G.length?ep.push(new it(el,G,`filter array for "${G[0]}" operator must have 2 elements`)):"string"!==ec&&ep.push(new it(`${el}[1]`,G[1],`string expected, ${ec} found`));break;case"within":ec=Ar(G[1]),2!==G.length?ep.push(new it(el,G,`filter array for "${G[0]}" operator must have 2 elements`)):"object"!==ec&&ep.push(new it(`${el}[1]`,G[1],`object expected, ${ec} found`))}return ep}(V)}function an(V,G){let el;let eh=V.key,ec=V.style,ep=V.styleSpec,ed=V.value,em=V.objectKey,ef=ep[`${G}_${V.layerType}`];if(!ef)return[];let eg=em.match(/^(.*)-transition$/);if("paint"===G&&eg&&ef[eg[1]]&&ef[eg[1]].transition)return yn({key:eh,value:ed,valueSpec:ep.transition,style:ec,styleSpec:ep});let e_=V.valueSpec||ef[em];if(!e_)return[new it(eh,ed,`unknown property "${em}"`)];if("string"===Ar(ed)&&br(e_)&&!e_.tokens&&(el=/^{([^}]+)}$/.exec(ed)))return[new it(eh,ed,`"${em}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(el[1])} }\`.`)];let ey=[];return"symbol"===V.layerType&&("text-field"===em&&ec&&!ec.glyphs&&ey.push(new it(eh,ed,'use of "text-field" requires a style "glyphs" property')),"text-font"===em&&kr(lt(ed))&&"identity"===ot(ed.type)&&ey.push(new it(eh,ed,'"text-font" does not support identity functions'))),ey.concat(yn({key:V.key,value:ed,valueSpec:e_,style:ec,styleSpec:ep,expressionContext:"property",propertyType:G,propertyKey:em}))}function sn(V){return an(V,"paint")}function on(V){return an(V,"layout")}function ln(V){let G=[],el=V.value,eh=V.key,ec=V.style,ep=V.styleSpec;el.type||el.ref||G.push(new it(eh,el,'either "type" or "ref" is required'));let ed=ot(el.type),em=ot(el.ref);if(el.id){let ep=ot(el.id);for(let ed=0;ed<V.arrayIndex;ed++){let V=ec.layers[ed];ot(V.id)===ep&&G.push(new it(eh,el.id,`duplicate layer id "${el.id}", previously used at line ${V.id.__line__}`))}}if("ref"in el){let V;["type","source","source-layer","filter","layout"].forEach(V=>{V in el&&G.push(new it(eh,el[V],`"${V}" is prohibited for ref layers`))}),ec.layers.forEach(G=>{ot(G.id)===em&&(V=G)}),V?V.ref?G.push(new it(eh,el.ref,"ref cannot reference another ref layer")):ed=ot(V.type):G.push(new it(eh,el.ref,`ref layer "${em}" not found`))}else if("background"!==ed){if(el.source){let V=ec.sources&&ec.sources[el.source],ep=V&&ot(V.type);V?"vector"===ep&&"raster"===ed?G.push(new it(eh,el.source,`layer "${el.id}" requires a raster source`)):"raster"===ep&&"raster"!==ed?G.push(new it(eh,el.source,`layer "${el.id}" requires a vector source`)):"vector"!==ep||el["source-layer"]?"raster-dem"===ep&&"hillshade"!==ed?G.push(new it(eh,el.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"===ed&&el.paint&&el.paint["line-gradient"]&&("geojson"!==ep||!V.lineMetrics)&&G.push(new it(eh,el,`layer "${el.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):G.push(new it(eh,el,`layer "${el.id}" must specify a "source-layer"`)):G.push(new it(eh,el.source,`source "${el.source}" not found`))}else G.push(new it(eh,el,'missing required property "source"'))}return G=G.concat(Or({key:eh,value:el,valueSpec:ep.layer,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{"*":()=>[],type:()=>yn({key:`${eh}.type`,value:el.type,valueSpec:ep.layer.type,style:V.style,styleSpec:V.styleSpec,object:el,objectKey:"type"}),filter:rn,layout:V=>Or({layer:el,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{"*":V=>on(st({layerType:ed},V))}}),paint:V=>Or({layer:el,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{"*":V=>sn(st({layerType:ed},V))}})}}))}function un(V){let G=V.value,el=V.key,eh=Ar(G);return"string"!==eh?[new it(el,G,`string expected, ${eh} found`)]:[]}let tp={promoteId:function({key:V,value:G}){if("string"===Ar(G))return un({key:V,value:G});{let el=[];for(let eh in G)el.push(...un({key:`${V}.${eh}`,value:G[eh]}));return el}}};function hn(V){let G;let el=V.value,eh=V.key,ec=V.styleSpec,ep=V.style;if(!el.type)return[new it(eh,el,'"type" is required')];let ed=ot(el.type);switch(ed){case"vector":case"raster":case"raster-dem":return Or({key:eh,value:el,valueSpec:ec[`source_${ed.replace("-","_")}`],style:V.style,styleSpec:ec,objectElementValidators:tp});case"geojson":if(G=Or({key:eh,value:el,valueSpec:ec.source_geojson,style:ep,styleSpec:ec,objectElementValidators:tp}),el.cluster)for(let V in el.clusterProperties){let[ec,ep]=el.clusterProperties[V],ed="string"==typeof ec?[ec,["accumulated"],["get",V]]:ec;G.push(...Nr({key:`${eh}.${V}.map`,value:ep,expressionContext:"cluster-map"})),G.push(...Nr({key:`${eh}.${V}.reduce`,value:ed,expressionContext:"cluster-reduce"}))}return G;case"video":return Or({key:eh,value:el,valueSpec:ec.source_video,style:ep,styleSpec:ec});case"image":return Or({key:eh,value:el,valueSpec:ec.source_image,style:ep,styleSpec:ec});case"canvas":return[new it(eh,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zr({key:`${eh}.type`,value:el.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:ep,styleSpec:ec})}}function pn(V){let G=V.value,el=V.styleSpec,eh=el.light,ec=V.style,ep=[],ed=Ar(G);if(void 0===G)return ep;if("object"!==ed)return ep.concat([new it("light",G,`object expected, ${ed} found`)]);for(let V in G){let ed=V.match(/^(.*)-transition$/);ep=ep.concat(ed&&eh[ed[1]]&&eh[ed[1]].transition?yn({key:V,value:G[V],valueSpec:el.transition,style:ec,styleSpec:el}):eh[V]?yn({key:V,value:G[V],valueSpec:eh[V],style:ec,styleSpec:el}):[new it(V,G[V],`unknown property "${V}"`)])}return ep}function fn(V){let G=V.value,el=V.styleSpec,eh=el.terrain,ec=V.style,ep=[],ed=Ar(G);if(void 0===G)return ep;if("object"!==ed)return ep.concat([new it("terrain",G,`object expected, ${ed} found`)]);for(let V in G)ep=ep.concat(eh[V]?yn({key:V,value:G[V],valueSpec:eh[V],style:ec,styleSpec:el}):[new it(V,G[V],`unknown property "${V}"`)]);return ep}let td={"*":()=>[],array:Ur,boolean:function(V){let G=V.value,el=V.key,eh=Ar(G);return"boolean"!==eh?[new it(el,G,`boolean expected, ${eh} found`)]:[]},number:qr,color:function(V){let G=V.key,el=V.value,eh=Ar(el);return"string"!==eh?[new it(G,el,`color expected, ${eh} found`)]:null===eX(el)?[new it(G,el,`color expected, "${el}" found`)]:[]},constants:at,enum:Zr,filter:rn,function:jr,layer:ln,object:Or,source:hn,light:pn,terrain:fn,string:un,formatted:function(V){return 0===un(V).length?[]:Nr(V)},resolvedImage:function(V){return 0===un(V).length?[]:Nr(V)},padding:function(V){let G=V.key,el=V.value;if("array"===Ar(el)){if(el.length<1||el.length>4)return[new it(G,el,`padding requires 1 to 4 values; ${el.length} values found`)];let V={type:"number"},eh=[];for(let ec=0;ec<el.length;ec++)eh=eh.concat(yn({key:`${G}[${ec}]`,value:el[ec],valueSpec:V}));return eh}return qr({key:G,value:el,valueSpec:{}})}};function yn(V){let G=V.value,el=V.valueSpec,eh=V.styleSpec;return el.expression&&kr(ot(G))?jr(V):el.expression&&Er(lt(G))?Nr(V):el.type&&td[el.type]?td[el.type](V):Or(st({},V,{valueSpec:el.type?eh[el.type]:el}))}function mn(V){let G=V.value,el=V.key,eh=un(V);return eh.length||(-1===G.indexOf("{fontstack}")&&eh.push(new it(el,G,'"glyphs" url must include a "{fontstack}" token')),-1===G.indexOf("{range}")&&eh.push(new it(el,G,'"glyphs" url must include a "{range}" token'))),eh}function gn(V,G=eD){let el=[];return el=el.concat(yn({key:"",value:V,valueSpec:G.$root,styleSpec:G,style:V,objectElementValidators:{glyphs:mn,"*":()=>[]}})),V.constants&&(el=el.concat(at({key:"constants",value:V.constants,style:V,styleSpec:G}))),xn(el)}function xn(V){return[].concat(V).sort((V,G)=>V.line-G.line)}function vn(V){return function(...G){return xn(V.apply(this,G))}}gn.source=vn(hn),gn.light=vn(pn),gn.terrain=vn(fn),gn.layer=vn(ln),gn.filter=vn(rn),gn.paintProperty=vn(sn),gn.layoutProperty=vn(on);let tm=gn.light,tf=gn.paintProperty,tg=gn.layoutProperty;function kn(V,G){let el=!1;if(G&&G.length)for(let eh of G)V.fire(new et(Error(eh.message))),el=!0;return el}let Sn=class Sn{constructor(V,G,el){let eh=this.cells=[];if(V instanceof ArrayBuffer){this.arrayBuffer=V;let ec=new Int32Array(this.arrayBuffer);V=ec[0],this.d=(G=ec[1])+2*(el=ec[2]);for(let V=0;V<this.d*this.d;V++){let G=ec[3+V],el=ec[3+V+1];eh.push(G===el?null:ec.subarray(G,el))}let ep=ec[3+eh.length+1];this.keys=ec.subarray(ec[3+eh.length],ep),this.bboxes=ec.subarray(ep),this.insert=this._insertReadonly}else{this.d=G+2*el;for(let V=0;V<this.d*this.d;V++)eh.push([]);this.keys=[],this.bboxes=[]}this.n=G,this.extent=V,this.padding=el,this.scale=G/V,this.uid=0;let ec=el/G*V;this.min=-ec,this.max=V+ec}insert(V,G,el,eh,ec){this._forEachCell(G,el,eh,ec,this._insertCell,this.uid++,void 0,void 0),this.keys.push(V),this.bboxes.push(G),this.bboxes.push(el),this.bboxes.push(eh),this.bboxes.push(ec)}_insertReadonly(){throw Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(V,G,el,eh,ec,ep){this.cells[ec].push(ep)}query(V,G,el,eh,ec){let ep=this.min,ed=this.max;if(V<=ep&&G<=ep&&ed<=el&&ed<=eh&&!ec)return Array.prototype.slice.call(this.keys);{let ep=[];return this._forEachCell(V,G,el,eh,this._queryCell,ep,{},ec),ep}}_queryCell(V,G,el,eh,ec,ep,ed,em){let ef=this.cells[ec];if(null!==ef){let ec=this.keys,eg=this.bboxes;for(let e_=0;e_<ef.length;e_++){let ey=ef[e_];if(void 0===ed[ey]){let ef=4*ey;(em?em(eg[ef+0],eg[ef+1],eg[ef+2],eg[ef+3]):V<=eg[ef+2]&&G<=eg[ef+3]&&el>=eg[ef+0]&&eh>=eg[ef+1])?(ed[ey]=!0,ep.push(ec[ey])):ed[ey]=!1}}}}_forEachCell(V,G,el,eh,ec,ep,ed,em){let ef=this._convertToCellCoord(V),eg=this._convertToCellCoord(G),e_=this._convertToCellCoord(el),ey=this._convertToCellCoord(eh);for(let ex=ef;ex<=e_;ex++)for(let ef=eg;ef<=ey;ef++){let eg=this.d*ef+ex;if((!em||em(this._convertFromCellCoord(ex),this._convertFromCellCoord(ef),this._convertFromCellCoord(ex+1),this._convertFromCellCoord(ef+1)))&&ec.call(this,V,G,el,eh,eg,ep,ed,em))return}}_convertFromCellCoord(V){return(V-this.padding)/this.scale}_convertToCellCoord(V){return Math.max(0,Math.min(this.d-1,Math.floor(V*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let V=this.cells,G=3+this.cells.length+1+1,el=0;for(let V=0;V<this.cells.length;V++)el+=this.cells[V].length;let eh=new Int32Array(G+el+this.keys.length+this.bboxes.length);eh[0]=this.extent,eh[1]=this.n,eh[2]=this.padding;let ec=G;for(let G=0;G<V.length;G++){let el=V[G];eh[3+G]=ec,eh.set(el,ec),ec+=el.length}return eh[3+V.length]=ec,eh.set(this.keys,ec),ec+=this.keys.length,eh[3+V.length+1]=ec,eh.set(this.bboxes,ec),ec+=this.bboxes.length,eh.buffer}static serialize(V,G){let el=V.toArrayBuffer();return G&&G.push(el),{buffer:el}}static deserialize(V){return new Sn(V.buffer)}};let t_={};function Mn(V,G,el={}){if(t_[V])throw Error(`${V} is already registered.`);Object.defineProperty(G,"_classRegistryKey",{value:V,writeable:!1}),t_[V]={klass:G,omit:el.omit||[],shallow:el.shallow||[]}}for(let V in Mn("Object",Object),Mn("TransferableGridIndex",Sn),Mn("Color",Ft),Mn("Error",Error),Mn("AJAXError",q),Mn("ResolvedImage",Rt),Mn("StylePropertyFunction",$r),Mn("StyleExpression",Vr,{omit:["_evaluator"]}),Mn("ZoomDependentExpression",Lr),Mn("ZoomConstantExpression",Tr),Mn("CompoundExpression",Wt,{omit:["_evaluate"]}),th)th[V]._classRegistryKey||Mn(`Expression_${V}`,th[V]);function zn(V){return V&&"undefined"!=typeof ArrayBuffer&&(V instanceof ArrayBuffer||V.constructor&&"ArrayBuffer"===V.constructor.name)}function Bn(V,G){if(null==V||"boolean"==typeof V||"number"==typeof V||"string"==typeof V||V instanceof Boolean||V instanceof Number||V instanceof String||V instanceof Date||V instanceof RegExp||V instanceof Blob)return V;if(zn(V)||A(V))return G&&G.push(V),V;if(ArrayBuffer.isView(V))return G&&G.push(V.buffer),V;if(V instanceof ImageData)return G&&G.push(V.data.buffer),V;if(Array.isArray(V)){let el=[];for(let eh of V)el.push(Bn(eh,G));return el}if("object"==typeof V){let el=V.constructor,eh=el._classRegistryKey;if(!eh)throw Error("can't serialize object of unregistered class");if(!t_[eh])throw Error(`${eh} is not registered.`);let ec=el.serialize?el.serialize(V,G):{};if(el.serialize){if(G&&ec===G[G.length-1])throw Error("statically serialized object won't survive transfer of $name property")}else{for(let el in V){if(!V.hasOwnProperty(el)||t_[eh].omit.indexOf(el)>=0)continue;let ep=V[el];ec[el]=t_[eh].shallow.indexOf(el)>=0?ep:Bn(ep,G)}V instanceof Error&&(ec.message=V.message)}if(ec.$name)throw Error("$name property is reserved for worker serialization logic.");return"Object"!==eh&&(ec.$name=eh),ec}throw Error("can't serialize object of type "+typeof V)}function Cn(V){if(null==V||"boolean"==typeof V||"number"==typeof V||"string"==typeof V||V instanceof Boolean||V instanceof Number||V instanceof String||V instanceof Date||V instanceof RegExp||V instanceof Blob||zn(V)||A(V)||ArrayBuffer.isView(V)||V instanceof ImageData)return V;if(Array.isArray(V))return V.map(Cn);if("object"==typeof V){let G=V.$name||"Object";if(!t_[G])throw Error(`can't deserialize unregistered class ${G}`);let{klass:el}=t_[G];if(!el)throw Error(`can't deserialize unregistered class ${G}`);if(el.deserialize)return el.deserialize(V);let eh=Object.create(el.prototype);for(let el of Object.keys(V)){if("$name"===el)continue;let ec=V[el];eh[el]=t_[G].shallow.indexOf(el)>=0?ec:Cn(ec)}return eh}throw Error("can't deserialize object of type "+typeof V)}let Pn=class Pn{constructor(){this.first=!0}update(V,G){let el=Math.floor(V);return this.first?(this.first=!1,this.lastIntegerZoom=el,this.lastIntegerZoomTime=0,this.lastZoom=V,this.lastFloorZoom=el,!0):(this.lastFloorZoom>el?(this.lastIntegerZoom=el+1,this.lastIntegerZoomTime=G):this.lastFloorZoom<el&&(this.lastIntegerZoom=el,this.lastIntegerZoomTime=G),V!==this.lastZoom&&(this.lastZoom=V,this.lastFloorZoom=el,!0))}};let ty={"Latin-1 Supplement":V=>V>=128&&V<=255,Arabic:V=>V>=1536&&V<=1791,"Arabic Supplement":V=>V>=1872&&V<=1919,"Arabic Extended-A":V=>V>=2208&&V<=2303,"Hangul Jamo":V=>V>=4352&&V<=4607,"Unified Canadian Aboriginal Syllabics":V=>V>=5120&&V<=5759,Khmer:V=>V>=6016&&V<=6143,"Unified Canadian Aboriginal Syllabics Extended":V=>V>=6320&&V<=6399,"General Punctuation":V=>V>=8192&&V<=8303,"Letterlike Symbols":V=>V>=8448&&V<=8527,"Number Forms":V=>V>=8528&&V<=8591,"Miscellaneous Technical":V=>V>=8960&&V<=9215,"Control Pictures":V=>V>=9216&&V<=9279,"Optical Character Recognition":V=>V>=9280&&V<=9311,"Enclosed Alphanumerics":V=>V>=9312&&V<=9471,"Geometric Shapes":V=>V>=9632&&V<=9727,"Miscellaneous Symbols":V=>V>=9728&&V<=9983,"Miscellaneous Symbols and Arrows":V=>V>=11008&&V<=11263,"CJK Radicals Supplement":V=>V>=11904&&V<=12031,"Kangxi Radicals":V=>V>=12032&&V<=12255,"Ideographic Description Characters":V=>V>=12272&&V<=12287,"CJK Symbols and Punctuation":V=>V>=12288&&V<=12351,Hiragana:V=>V>=12352&&V<=12447,Katakana:V=>V>=12448&&V<=12543,Bopomofo:V=>V>=12544&&V<=12591,"Hangul Compatibility Jamo":V=>V>=12592&&V<=12687,Kanbun:V=>V>=12688&&V<=12703,"Bopomofo Extended":V=>V>=12704&&V<=12735,"CJK Strokes":V=>V>=12736&&V<=12783,"Katakana Phonetic Extensions":V=>V>=12784&&V<=12799,"Enclosed CJK Letters and Months":V=>V>=12800&&V<=13055,"CJK Compatibility":V=>V>=13056&&V<=13311,"CJK Unified Ideographs Extension A":V=>V>=13312&&V<=19903,"Yijing Hexagram Symbols":V=>V>=19904&&V<=19967,"CJK Unified Ideographs":V=>V>=19968&&V<=40959,"Yi Syllables":V=>V>=40960&&V<=42127,"Yi Radicals":V=>V>=42128&&V<=42191,"Hangul Jamo Extended-A":V=>V>=43360&&V<=43391,"Hangul Syllables":V=>V>=44032&&V<=55215,"Hangul Jamo Extended-B":V=>V>=55216&&V<=55295,"Private Use Area":V=>V>=57344&&V<=63743,"CJK Compatibility Ideographs":V=>V>=63744&&V<=64255,"Arabic Presentation Forms-A":V=>V>=64336&&V<=65023,"Vertical Forms":V=>V>=65040&&V<=65055,"CJK Compatibility Forms":V=>V>=65072&&V<=65103,"Small Form Variants":V=>V>=65104&&V<=65135,"Arabic Presentation Forms-B":V=>V>=65136&&V<=65279,"Halfwidth and Fullwidth Forms":V=>V>=65280&&V<=65519};function En(V){for(let G of V)if(Ln(G.charCodeAt(0)))return!0;return!1}function Ln(V){return!(746!==V&&747!==V&&(V<4352||!(ty["Bopomofo Extended"](V)||ty.Bopomofo(V)||ty["CJK Compatibility Forms"](V)&&!(V>=65097&&V<=65103)||ty["CJK Compatibility Ideographs"](V)||ty["CJK Compatibility"](V)||ty["CJK Radicals Supplement"](V)||ty["CJK Strokes"](V)||!(!ty["CJK Symbols and Punctuation"](V)||V>=12296&&V<=12305||V>=12308&&V<=12319||12336===V)||ty["CJK Unified Ideographs Extension A"](V)||ty["CJK Unified Ideographs"](V)||ty["Enclosed CJK Letters and Months"](V)||ty["Hangul Compatibility Jamo"](V)||ty["Hangul Jamo Extended-A"](V)||ty["Hangul Jamo Extended-B"](V)||ty["Hangul Jamo"](V)||ty["Hangul Syllables"](V)||ty.Hiragana(V)||ty["Ideographic Description Characters"](V)||ty.Kanbun(V)||ty["Kangxi Radicals"](V)||ty["Katakana Phonetic Extensions"](V)||ty.Katakana(V)&&12540!==V||!(!ty["Halfwidth and Fullwidth Forms"](V)||65288===V||65289===V||65293===V||V>=65306&&V<=65310||65339===V||65341===V||65343===V||V>=65371&&V<=65503||65507===V||V>=65512&&V<=65519)||!(!ty["Small Form Variants"](V)||V>=65112&&V<=65118||V>=65123&&V<=65126)||ty["Unified Canadian Aboriginal Syllabics"](V)||ty["Unified Canadian Aboriginal Syllabics Extended"](V)||ty["Vertical Forms"](V)||ty["Yijing Hexagram Symbols"](V)||ty["Yi Syllables"](V)||ty["Yi Radicals"](V))))}function Dn(V){return!(Ln(V)||ty["Latin-1 Supplement"](V)&&(167===V||169===V||174===V||177===V||188===V||189===V||190===V||215===V||247===V)||ty["General Punctuation"](V)&&(8214===V||8224===V||8225===V||8240===V||8241===V||8251===V||8252===V||8258===V||8263===V||8264===V||8265===V||8273===V)||ty["Letterlike Symbols"](V)||ty["Number Forms"](V)||ty["Miscellaneous Technical"](V)&&(V>=8960&&V<=8967||V>=8972&&V<=8991||V>=8996&&V<=9e3||9003===V||V>=9085&&V<=9114||V>=9150&&V<=9165||9167===V||V>=9169&&V<=9179||V>=9186&&V<=9215)||ty["Control Pictures"](V)&&9251!==V||ty["Optical Character Recognition"](V)||ty["Enclosed Alphanumerics"](V)||ty["Geometric Shapes"](V)||ty["Miscellaneous Symbols"](V)&&!(V>=9754&&V<=9759)||ty["Miscellaneous Symbols and Arrows"](V)&&(V>=11026&&V<=11055||V>=11088&&V<=11097||V>=11192&&V<=11243)||ty["CJK Symbols and Punctuation"](V)||ty.Katakana(V)||ty["Private Use Area"](V)||ty["CJK Compatibility Forms"](V)||ty["Small Form Variants"](V)||ty["Halfwidth and Fullwidth Forms"](V)||8734===V||8756===V||8757===V||V>=9984&&V<=10087||V>=10102&&V<=10131||65532===V||65533===V)}function $n(V){return V>=1424&&V<=2303||ty["Arabic Presentation Forms-A"](V)||ty["Arabic Presentation Forms-B"](V)}let tx="deferred",tv="loading",tb="loaded",tw=null,tT="unavailable",tE=null,Gn=function(V){V&&"string"==typeof V&&V.indexOf("NetworkError")>-1&&(tT="error"),tw&&tw(V)};function Jn(){tS.fire(new tt("pluginStateChange",{pluginStatus:tT,pluginURL:tE}))}let tS=new rt,Yn=function(){return tT},Hn=function(){if(tT!==tx||!tE)throw Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");tT=tv,Jn(),tE&&K({url:tE},V=>{V?Gn(V):(tT=tb,Jn())})},tI={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>tT===tb||null!=tI.applyArabicShaping,isLoading:()=>tT===tv,setState(V){if(!g())throw Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");tT=V.pluginStatus,tE=V.pluginURL},isParsed(){if(!g())throw Error("rtl-text-plugin is only parsed on the worker-threads");return null!=tI.applyArabicShaping&&null!=tI.processBidirectionalText&&null!=tI.processStyledBidirectionalText},getPluginURL(){if(!g())throw Error("rtl-text-plugin url can only be queried from the worker threads");return tE}};let Qn=class Qn{constructor(V,G){this.zoom=V,G?(this.now=G.now,this.fadeDuration=G.fadeDuration,this.zoomHistory=G.zoomHistory,this.transition=G.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Pn,this.transition={})}isSupportedScript(V){return function(V,G){for(let eh of V){var el;if(el=eh.charCodeAt(0),!G&&$n(el)||el>=2304&&el<=3583||el>=3840&&el<=4255||ty.Khmer(el))return!1}return!0}(V,tI.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let V=this.zoom,G=V-Math.floor(V),el=this.crossFadingFactor();return V>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:G+(1-G)*el}:{fromScale:.5,toScale:1,t:1-(1-el)*G}}};let ti=class ti{constructor(V,G){this.property=V,this.value=G,this.expression=function(V,G){if(kr(V))return new $r(V,G);if(Er(V)){let el=Dr(V,G);if("error"===el.result)throw Error(el.value.map(V=>`${V.key}: ${V.message}`).join(", "));return el.value}{let el=V;return"color"===G.type&&"string"==typeof V?el=Ft.parse(V):"padding"===G.type&&("number"==typeof V||Array.isArray(V))&&(el=$t.parse(V)),{kind:"constant",evaluate:()=>el}}}(void 0===G?V.specification.default:G,V.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(V,G,el){return this.property.possiblyEvaluate(this,V,G,el)}};let ei=class ei{constructor(V){this.property=V,this.value=new ti(V,void 0)}transitioned(V,G){return new ni(this.property,this.value,G,o({},V.transition,this.transition),V.now)}untransitioned(){return new ni(this.property,this.value,null,{},0)}};let ri=class ri{constructor(V){this._properties=V,this._values=Object.create(V.defaultTransitionablePropertyValues)}getValue(V){return p(this._values[V].value.value)}setValue(V,G){Object.prototype.hasOwnProperty.call(this._values,V)||(this._values[V]=new ei(this._values[V].property)),this._values[V].value=new ti(this._values[V].property,null===G?void 0:p(G))}getTransition(V){return p(this._values[V].transition)}setTransition(V,G){Object.prototype.hasOwnProperty.call(this._values,V)||(this._values[V]=new ei(this._values[V].property)),this._values[V].transition=p(G)||void 0}serialize(){let V={};for(let G of Object.keys(this._values)){let el=this.getValue(G);void 0!==el&&(V[G]=el);let eh=this.getTransition(G);void 0!==eh&&(V[`${G}-transition`]=eh)}return V}transitioned(V,G){let el=new ii(this._properties);for(let eh of Object.keys(this._values))el._values[eh]=this._values[eh].transitioned(V,G._values[eh]);return el}untransitioned(){let V=new ii(this._properties);for(let G of Object.keys(this._values))V._values[G]=this._values[G].untransitioned();return V}};let ni=class ni{constructor(V,G,el,eh,ec){this.property=V,this.value=G,this.begin=ec+eh.delay||0,this.end=this.begin+eh.duration||0,V.specification.transition&&(eh.delay||eh.duration)&&(this.prior=el)}possiblyEvaluate(V,G,el){let eh=V.now||0,ec=this.value.possiblyEvaluate(V,G,el),ep=this.prior;if(ep){if(eh>this.end||this.value.isDataDriven())return this.prior=null,ec;if(eh<this.begin)return ep.possiblyEvaluate(V,G,el);{let ed=(eh-this.begin)/(this.end-this.begin);return this.property.interpolate(ep.possiblyEvaluate(V,G,el),ec,function(V){if(V<=0)return 0;if(V>=1)return 1;let G=V*V,el=G*V;return 4*(V<.5?el:3*(V-G)+el-.75)}(ed))}}return ec}};let ii=class ii{constructor(V){this._properties=V,this._values=Object.create(V.defaultTransitioningPropertyValues)}possiblyEvaluate(V,G,el){let eh=new oi(this._properties);for(let ec of Object.keys(this._values))eh._values[ec]=this._values[ec].possiblyEvaluate(V,G,el);return eh}hasTransition(){for(let V of Object.keys(this._values))if(this._values[V].prior)return!0;return!1}};let ai=class ai{constructor(V){this._properties=V,this._values=Object.create(V.defaultPropertyValues)}getValue(V){return p(this._values[V].value)}setValue(V,G){this._values[V]=new ti(this._values[V].property,null===G?void 0:p(G))}serialize(){let V={};for(let G of Object.keys(this._values)){let el=this.getValue(G);void 0!==el&&(V[G]=el)}return V}possiblyEvaluate(V,G,el){let eh=new oi(this._properties);for(let ec of Object.keys(this._values))eh._values[ec]=this._values[ec].possiblyEvaluate(V,G,el);return eh}};let si=class si{constructor(V,G,el){this.property=V,this.value=G,this.parameters=el}isConstant(){return"constant"===this.value.kind}constantOr(V){return"constant"===this.value.kind?this.value.value:V}evaluate(V,G,el,eh){return this.property.evaluate(this.value,this.parameters,V,G,el,eh)}};let oi=class oi{constructor(V){this._properties=V,this._values=Object.create(V.defaultPossiblyEvaluatedValues)}get(V){return this._values[V]}};let li=class li{constructor(V){this.specification=V}possiblyEvaluate(V,G){if(V.isDataDriven())throw Error("Value should not be data driven");return V.expression.evaluate(G)}interpolate(V,G,el){let eh=eJ[this.specification.type];return eh?eh(V,G,el):V}};let ui=class ui{constructor(V,G){this.specification=V,this.overrides=G}possiblyEvaluate(V,G,el,eh){return new si(this,"constant"===V.expression.kind||"camera"===V.expression.kind?{kind:"constant",value:V.expression.evaluate(G,null,{},el,eh)}:V.expression,G)}interpolate(V,G,el){if("constant"!==V.value.kind||"constant"!==G.value.kind)return V;if(void 0===V.value.value||void 0===G.value.value)return new si(this,{kind:"constant",value:void 0},V.parameters);let eh=eJ[this.specification.type];return eh?new si(this,{kind:"constant",value:eh(V.value.value,G.value.value,el)},V.parameters):V}evaluate(V,G,el,eh,ec,ep){return"constant"===V.kind?V.value:V.evaluate(G,el,eh,ec,ep)}};let ci=class ci extends ui{possiblyEvaluate(V,G,el,eh){if(void 0===V.value)return new si(this,{kind:"constant",value:void 0},G);if("constant"===V.expression.kind){let ec=V.expression.evaluate(G,null,{},el,eh),ep="resolvedImage"===V.property.specification.type&&"string"!=typeof ec?ec.name:ec,ed=this._calculate(ep,ep,ep,G);return new si(this,{kind:"constant",value:ed},G)}if("camera"===V.expression.kind){let el=this._calculate(V.expression.evaluate({zoom:G.zoom-1}),V.expression.evaluate({zoom:G.zoom}),V.expression.evaluate({zoom:G.zoom+1}),G);return new si(this,{kind:"constant",value:el},G)}return new si(this,V.expression,G)}evaluate(V,G,el,eh,ec,ep){if("source"===V.kind){let ed=V.evaluate(G,el,eh,ec,ep);return this._calculate(ed,ed,ed,G)}return"composite"===V.kind?this._calculate(V.evaluate({zoom:Math.floor(G.zoom)-1},el,eh),V.evaluate({zoom:Math.floor(G.zoom)},el,eh),V.evaluate({zoom:Math.floor(G.zoom)+1},el,eh),G):V.value}_calculate(V,G,el,eh){return eh.zoom>eh.zoomHistory.lastIntegerZoom?{from:V,to:G}:{from:el,to:G}}interpolate(V){return V}};let hi=class hi{constructor(V){this.specification=V}possiblyEvaluate(V,G,el,eh){if(void 0!==V.value){if("constant"===V.expression.kind){let ec=V.expression.evaluate(G,null,{},el,eh);return this._calculate(ec,ec,ec,G)}return this._calculate(V.expression.evaluate(new Qn(Math.floor(G.zoom-1),G)),V.expression.evaluate(new Qn(Math.floor(G.zoom),G)),V.expression.evaluate(new Qn(Math.floor(G.zoom+1),G)),G)}}_calculate(V,G,el,eh){return eh.zoom>eh.zoomHistory.lastIntegerZoom?{from:V,to:G}:{from:el,to:G}}interpolate(V){return V}};let pi=class pi{constructor(V){this.specification=V}possiblyEvaluate(V,G,el,eh){return!!V.expression.evaluate(G,null,{},el,eh)}interpolate(){return!1}};let fi=class fi{constructor(V){for(let G in this.properties=V,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],V){let el=V[G];el.specification.overridable&&this.overridableProperties.push(G);let eh=this.defaultPropertyValues[G]=new ti(el,void 0),ec=this.defaultTransitionablePropertyValues[G]=new ei(el);this.defaultTransitioningPropertyValues[G]=ec.untransitioned(),this.defaultPossiblyEvaluatedValues[G]=eh.possiblyEvaluate({})}}};Mn("DataDrivenProperty",ui),Mn("DataConstantProperty",li),Mn("CrossFadedDataDrivenProperty",ci),Mn("CrossFadedProperty",hi),Mn("ColorRampProperty",pi);let tA="-transition";let yi=class yi extends rt{constructor(V,G){if(super(),this.id=V.id,this.type=V.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==V.type&&(this.metadata=V.metadata,this.minzoom=V.minzoom,this.maxzoom=V.maxzoom,"background"!==V.type&&(this.source=V.source,this.sourceLayer=V["source-layer"],this.filter=V.filter),G.layout&&(this._unevaluatedLayout=new ai(G.layout)),G.paint)){for(let el in this._transitionablePaint=new ri(G.paint),V.paint)this.setPaintProperty(el,V.paint[el],{validate:!1});for(let G in V.layout)this.setLayoutProperty(G,V.layout[G],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new oi(G.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(V){return"visibility"===V?this.visibility:this._unevaluatedLayout.getValue(V)}setLayoutProperty(V,G,el={}){null!=G&&this._validate(tg,`layers.${this.id}.layout.${V}`,V,G,el)||("visibility"!==V?this._unevaluatedLayout.setValue(V,G):this.visibility=G)}getPaintProperty(V){return V.endsWith(tA)?this._transitionablePaint.getTransition(V.slice(0,-tA.length)):this._transitionablePaint.getValue(V)}setPaintProperty(V,G,el={}){if(null!=G&&this._validate(tf,`layers.${this.id}.paint.${V}`,V,G,el))return!1;if(V.endsWith(tA))return this._transitionablePaint.setTransition(V.slice(0,-tA.length),G||void 0),!1;{let el=this._transitionablePaint._values[V],eh="cross-faded-data-driven"===el.property.specification["property-type"],ec=el.value.isDataDriven(),ep=el.value;this._transitionablePaint.setValue(V,G),this._handleSpecialPaintPropertyUpdate(V);let ed=this._transitionablePaint._values[V].value;return ed.isDataDriven()||ec||eh||this._handleOverridablePaintPropertyUpdate(V,ep,ed)}}_handleSpecialPaintPropertyUpdate(V){}_handleOverridablePaintPropertyUpdate(V,G,el){return!1}isHidden(V){return!!(this.minzoom&&V<this.minzoom)||!!(this.maxzoom&&V>=this.maxzoom)||"none"===this.visibility}updateTransitions(V){this._transitioningPaint=this._transitionablePaint.transitioned(V,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(V,G){V.getCrossfadeParameters&&(this._crossfadeParameters=V.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(V,void 0,G)),this.paint=this._transitioningPaint.possiblyEvaluate(V,void 0,G)}serialize(){let V={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(V.layout=V.layout||{},V.layout.visibility=this.visibility),h(V,(V,G)=>!(void 0===V||"layout"===G&&!Object.keys(V).length||"paint"===G&&!Object.keys(V).length))}_validate(V,G,el,eh,ec={}){return(!ec||!1!==ec.validate)&&kn(this,V.call(gn,{key:G,layerType:this.type,objectKey:el,value:eh,styleSpec:eD,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let V in this.paint._values){let G=this.paint.get(V);if(G instanceof si&&br(G.property.specification)&&("source"===G.value.kind||"composite"===G.value.kind)&&G.value.isStateDependent)return!0}return!1}};let tM={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};let gi=class gi{constructor(V,G){this._structArray=V,this._pos1=G*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}};let xi=class xi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(V,G){return V._trim(),G&&(V.isTransferred=!0,G.push(V.arrayBuffer)),{length:V.length,arrayBuffer:V.arrayBuffer}}static deserialize(V){let G=Object.create(this.prototype);return G.arrayBuffer=V.arrayBuffer,G.length=V.length,G.capacity=V.arrayBuffer.byteLength/G.bytesPerElement,G._refreshViews(),G}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(V){this.reserve(V),this.length=V}reserve(V){if(V>this.capacity){this.capacity=Math.max(V,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let G=this.uint8;this._refreshViews(),G&&this.uint8.set(G)}}_refreshViews(){throw Error("_refreshViews() must be implemented by each concrete StructArray layout")}};function vi(V,G=1){let el=0,eh=0;return{members:V.map(V=>{let ec=tM[V.type].BYTES_PER_ELEMENT,ep=el=bi(el,Math.max(G,ec)),ed=V.components||1;return eh=Math.max(eh,ec),el+=ec*ed,{name:V.name,type:V.type,components:ed,offset:ep}}),size:bi(el,Math.max(eh,G)),alignment:G}}function bi(V,G){return Math.ceil(V/G)*G}let wi=class wi extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(V,G){let el=this.length;return this.resize(el+1),this.emplace(el,V,G)}emplace(V,G,el){let eh=2*V;return this.int16[eh+0]=G,this.int16[eh+1]=el,V}};wi.prototype.bytesPerElement=4,Mn("StructArrayLayout2i4",wi);let _i=class _i extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(V,G,el,eh){let ec=this.length;return this.resize(ec+1),this.emplace(ec,V,G,el,eh)}emplace(V,G,el,eh,ec){let ep=4*V;return this.int16[ep+0]=G,this.int16[ep+1]=el,this.int16[ep+2]=eh,this.int16[ep+3]=ec,V}};_i.prototype.bytesPerElement=8,Mn("StructArrayLayout4i8",_i);let Ai=class Ai extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(V,G,el,eh,ec,ep){let ed=this.length;return this.resize(ed+1),this.emplace(ed,V,G,el,eh,ec,ep)}emplace(V,G,el,eh,ec,ep,ed){let em=6*V;return this.int16[em+0]=G,this.int16[em+1]=el,this.int16[em+2]=eh,this.int16[em+3]=ec,this.int16[em+4]=ep,this.int16[em+5]=ed,V}};Ai.prototype.bytesPerElement=12,Mn("StructArrayLayout2i4i12",Ai);let ki=class ki extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(V,G,el,eh,ec,ep){let ed=this.length;return this.resize(ed+1),this.emplace(ed,V,G,el,eh,ec,ep)}emplace(V,G,el,eh,ec,ep,ed){let em=4*V,ef=8*V;return this.int16[em+0]=G,this.int16[em+1]=el,this.uint8[ef+4]=eh,this.uint8[ef+5]=ec,this.uint8[ef+6]=ep,this.uint8[ef+7]=ed,V}};ki.prototype.bytesPerElement=8,Mn("StructArrayLayout2i4ub8",ki);let Si=class Si extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(V,G){let el=this.length;return this.resize(el+1),this.emplace(el,V,G)}emplace(V,G,el){let eh=2*V;return this.float32[eh+0]=G,this.float32[eh+1]=el,V}};Si.prototype.bytesPerElement=8,Mn("StructArrayLayout2f8",Si);let Ii=class Ii extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(V,G,el,eh,ec,ep,ed,em,ef,eg){let e_=this.length;return this.resize(e_+1),this.emplace(e_,V,G,el,eh,ec,ep,ed,em,ef,eg)}emplace(V,G,el,eh,ec,ep,ed,em,ef,eg,e_){let ey=10*V;return this.uint16[ey+0]=G,this.uint16[ey+1]=el,this.uint16[ey+2]=eh,this.uint16[ey+3]=ec,this.uint16[ey+4]=ep,this.uint16[ey+5]=ed,this.uint16[ey+6]=em,this.uint16[ey+7]=ef,this.uint16[ey+8]=eg,this.uint16[ey+9]=e_,V}};Ii.prototype.bytesPerElement=20,Mn("StructArrayLayout10ui20",Ii);let Mi=class Mi extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey){let ex=this.length;return this.resize(ex+1),this.emplace(ex,V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey)}emplace(V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex){let ev=12*V;return this.int16[ev+0]=G,this.int16[ev+1]=el,this.int16[ev+2]=eh,this.int16[ev+3]=ec,this.uint16[ev+4]=ep,this.uint16[ev+5]=ed,this.uint16[ev+6]=em,this.uint16[ev+7]=ef,this.int16[ev+8]=eg,this.int16[ev+9]=e_,this.int16[ev+10]=ey,this.int16[ev+11]=ex,V}};Mi.prototype.bytesPerElement=24,Mn("StructArrayLayout4i4ui4i24",Mi);let zi=class zi extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(V,G,el){let eh=this.length;return this.resize(eh+1),this.emplace(eh,V,G,el)}emplace(V,G,el,eh){let ec=3*V;return this.float32[ec+0]=G,this.float32[ec+1]=el,this.float32[ec+2]=eh,V}};zi.prototype.bytesPerElement=12,Mn("StructArrayLayout3f12",zi);let Bi=class Bi extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(V){let G=this.length;return this.resize(G+1),this.emplace(G,V)}emplace(V,G){return this.uint32[1*V+0]=G,V}};Bi.prototype.bytesPerElement=4,Mn("StructArrayLayout1ul4",Bi);let Ci=class Ci extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(V,G,el,eh,ec,ep,ed,em,ef){let eg=this.length;return this.resize(eg+1),this.emplace(eg,V,G,el,eh,ec,ep,ed,em,ef)}emplace(V,G,el,eh,ec,ep,ed,em,ef,eg){let e_=10*V;return this.int16[e_+0]=G,this.int16[e_+1]=el,this.int16[e_+2]=eh,this.int16[e_+3]=ec,this.int16[e_+4]=ep,this.int16[e_+5]=ed,this.uint32[5*V+3]=em,this.uint16[e_+8]=ef,this.uint16[e_+9]=eg,V}};Ci.prototype.bytesPerElement=20,Mn("StructArrayLayout6i1ul2ui20",Ci);let Pi=class Pi extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(V,G,el,eh,ec,ep){let ed=this.length;return this.resize(ed+1),this.emplace(ed,V,G,el,eh,ec,ep)}emplace(V,G,el,eh,ec,ep,ed){let em=6*V;return this.int16[em+0]=G,this.int16[em+1]=el,this.int16[em+2]=eh,this.int16[em+3]=ec,this.int16[em+4]=ep,this.int16[em+5]=ed,V}};Pi.prototype.bytesPerElement=12,Mn("StructArrayLayout2i2i2i12",Pi);let Vi=class Vi extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(V,G,el,eh,ec){let ep=this.length;return this.resize(ep+1),this.emplace(ep,V,G,el,eh,ec)}emplace(V,G,el,eh,ec,ep){let ed=4*V,em=8*V;return this.float32[ed+0]=G,this.float32[ed+1]=el,this.float32[ed+2]=eh,this.int16[em+6]=ec,this.int16[em+7]=ep,V}};Vi.prototype.bytesPerElement=16,Mn("StructArrayLayout2f1f2i16",Vi);let Ei=class Ei extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(V,G,el,eh){let ec=this.length;return this.resize(ec+1),this.emplace(ec,V,G,el,eh)}emplace(V,G,el,eh,ec){let ep=12*V,ed=3*V;return this.uint8[ep+0]=G,this.uint8[ep+1]=el,this.float32[ed+1]=eh,this.float32[ed+2]=ec,V}};Ei.prototype.bytesPerElement=12,Mn("StructArrayLayout2ub2f12",Ei);let Fi=class Fi extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(V,G,el){let eh=this.length;return this.resize(eh+1),this.emplace(eh,V,G,el)}emplace(V,G,el,eh){let ec=3*V;return this.uint16[ec+0]=G,this.uint16[ec+1]=el,this.uint16[ec+2]=eh,V}};Fi.prototype.bytesPerElement=6,Mn("StructArrayLayout3ui6",Fi);let Ti=class Ti extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew,eT){let eE=this.length;return this.resize(eE+1),this.emplace(eE,V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew,eT)}emplace(V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew,eT,eE){let eS=24*V,eI=12*V,eA=48*V;return this.int16[eS+0]=G,this.int16[eS+1]=el,this.uint16[eS+2]=eh,this.uint16[eS+3]=ec,this.uint32[eI+2]=ep,this.uint32[eI+3]=ed,this.uint32[eI+4]=em,this.uint16[eS+10]=ef,this.uint16[eS+11]=eg,this.uint16[eS+12]=e_,this.float32[eI+7]=ey,this.float32[eI+8]=ex,this.uint8[eA+36]=ev,this.uint8[eA+37]=eb,this.uint8[eA+38]=ew,this.uint32[eI+10]=eT,this.int16[eS+22]=eE,V}};Ti.prototype.bytesPerElement=48,Mn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ti);let Li=class Li extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew,eT,eE,eS,eI,eA,eM,eC,ez,ek,eP,eD,eL){let eR=this.length;return this.resize(eR+1),this.emplace(eR,V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew,eT,eE,eS,eI,eA,eM,eC,ez,ek,eP,eD,eL)}emplace(V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew,eT,eE,eS,eI,eA,eM,eC,ez,ek,eP,eD,eL,eR){let eB=34*V,eF=17*V;return this.int16[eB+0]=G,this.int16[eB+1]=el,this.int16[eB+2]=eh,this.int16[eB+3]=ec,this.int16[eB+4]=ep,this.int16[eB+5]=ed,this.int16[eB+6]=em,this.int16[eB+7]=ef,this.uint16[eB+8]=eg,this.uint16[eB+9]=e_,this.uint16[eB+10]=ey,this.uint16[eB+11]=ex,this.uint16[eB+12]=ev,this.uint16[eB+13]=eb,this.uint16[eB+14]=ew,this.uint16[eB+15]=eT,this.uint16[eB+16]=eE,this.uint16[eB+17]=eS,this.uint16[eB+18]=eI,this.uint16[eB+19]=eA,this.uint16[eB+20]=eM,this.uint16[eB+21]=eC,this.uint16[eB+22]=ez,this.uint32[eF+12]=ek,this.float32[eF+13]=eP,this.float32[eF+14]=eD,this.float32[eF+15]=eL,this.float32[eF+16]=eR,V}};Li.prototype.bytesPerElement=68,Mn("StructArrayLayout8i15ui1ul4f68",Li);let Di=class Di extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(V){let G=this.length;return this.resize(G+1),this.emplace(G,V)}emplace(V,G){return this.float32[1*V+0]=G,V}};Di.prototype.bytesPerElement=4,Mn("StructArrayLayout1f4",Di);let $i=class $i extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(V,G,el){let eh=this.length;return this.resize(eh+1),this.emplace(eh,V,G,el)}emplace(V,G,el,eh){let ec=3*V;return this.int16[ec+0]=G,this.int16[ec+1]=el,this.int16[ec+2]=eh,V}};$i.prototype.bytesPerElement=6,Mn("StructArrayLayout3i6",$i);let Ri=class Ri extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(V,G,el){let eh=this.length;return this.resize(eh+1),this.emplace(eh,V,G,el)}emplace(V,G,el,eh){let ec=4*V;return this.uint32[2*V+0]=G,this.uint16[ec+2]=el,this.uint16[ec+3]=eh,V}};Ri.prototype.bytesPerElement=8,Mn("StructArrayLayout1ul2ui8",Ri);let Oi=class Oi extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(V,G){let el=this.length;return this.resize(el+1),this.emplace(el,V,G)}emplace(V,G,el){let eh=2*V;return this.uint16[eh+0]=G,this.uint16[eh+1]=el,V}};Oi.prototype.bytesPerElement=4,Mn("StructArrayLayout2ui4",Oi);let Ui=class Ui extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(V){let G=this.length;return this.resize(G+1),this.emplace(G,V)}emplace(V,G){return this.uint16[1*V+0]=G,V}};Ui.prototype.bytesPerElement=2,Mn("StructArrayLayout1ui2",Ui);let qi=class qi extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(V,G,el,eh){let ec=this.length;return this.resize(ec+1),this.emplace(ec,V,G,el,eh)}emplace(V,G,el,eh,ec){let ep=4*V;return this.float32[ep+0]=G,this.float32[ep+1]=el,this.float32[ep+2]=eh,this.float32[ep+3]=ec,V}};qi.prototype.bytesPerElement=16,Mn("StructArrayLayout4f16",qi);let ji=class ji extends gi{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new e_(this.anchorPointX,this.anchorPointY)}};ji.prototype.size=20;let Ni=class Ni extends Ci{get(V){return new ji(this,V)}};Mn("CollisionBoxArray",Ni);let Zi=class Zi extends gi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(V){this._structArray.uint8[this._pos1+37]=V}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(V){this._structArray.uint8[this._pos1+38]=V}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(V){this._structArray.uint32[this._pos4+10]=V}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}};Zi.prototype.size=48;let Ki=class Ki extends Ti{get(V){return new Zi(this,V)}};Mn("PlacedSymbolArray",Ki);let Gi=class Gi extends gi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(V){this._structArray.uint32[this._pos4+12]=V}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}};Gi.prototype.size=68;let Ji=class Ji extends Li{get(V){return new Gi(this,V)}};Mn("SymbolInstanceArray",Ji);let Xi=class Xi extends Di{getoffsetX(V){return this.float32[1*V+0]}};Mn("GlyphOffsetArray",Xi);let Yi=class Yi extends $i{getx(V){return this.int16[3*V+0]}gety(V){return this.int16[3*V+1]}gettileUnitDistanceFromAnchor(V){return this.int16[3*V+2]}};Mn("SymbolLineVertexArray",Yi);let Hi=class Hi extends gi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}};Hi.prototype.size=8;let Wi=class Wi extends Ri{get(V){return new Hi(this,V)}};Mn("FeatureIndexArray",Wi);let Qi=class Qi extends wi{};let ta=class ta extends wi{};let ea=class ea extends wi{};let ra=class ra extends Ai{};let na=class na extends ki{};let ia=class ia extends Si{};let aa=class aa extends Ii{};let sa=class sa extends Mi{};let oa=class oa extends zi{};let la=class la extends Bi{};let ua=class ua extends Pi{};let ca=class ca extends Ei{};let ha=class ha extends Fi{};let pa=class pa extends Oi{};let tC=vi([{name:"a_pos",components:2,type:"Int16"}],4),{members:tz}=tC;let ya=class ya{constructor(V=[]){this.segments=V}prepareSegment(V,G,el,eh){let ec=this.segments[this.segments.length-1];return V>ya.MAX_VERTEX_ARRAY_LENGTH&&d(`Max vertices per segment is ${ya.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${V}`),(!ec||ec.vertexLength+V>ya.MAX_VERTEX_ARRAY_LENGTH||ec.sortKey!==eh)&&(ec={vertexOffset:G.length,primitiveOffset:el.length,vertexLength:0,primitiveLength:0},void 0!==eh&&(ec.sortKey=eh),this.segments.push(ec)),ec}get(){return this.segments}destroy(){for(let V of this.segments)for(let G in V.vaos)V.vaos[G].destroy()}static simpleSegment(V,G,el,eh){return new ya([{vertexOffset:V,primitiveOffset:G,vertexLength:el,primitiveLength:eh,vaos:{},sortKey:0}])}};function ma(V,G){return 256*(V=a(Math.floor(V),0,255))+a(Math.floor(G),0,255)}ya.MAX_VERTEX_ARRAY_LENGTH=65535,Mn("SegmentVector",ya);let tk=vi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var tP={exports:{}},tD={exports:{}};tD.exports=function(V,G){var el,eh,ec,ep,ed,em;for(eh=V.length-(el=3&V.length),ec=G,em=0;em<eh;)ed=255&V.charCodeAt(em)|(255&V.charCodeAt(++em))<<8|(255&V.charCodeAt(++em))<<16|(255&V.charCodeAt(++em))<<24,++em,ec=27492+(65535&(ep=5*(65535&(ec=(ec^=ed=(65535&(ed=(ed=(65535&ed)*3432918353+(((ed>>>16)*3432918353&65535)<<16)&4294967295)<<15|ed>>>17))*461845907+(((ed>>>16)*461845907&65535)<<16)&4294967295)<<13|ec>>>19))+((5*(ec>>>16)&65535)<<16)&4294967295))+((58964+(ep>>>16)&65535)<<16);switch(ed=0,el){case 3:ed^=(255&V.charCodeAt(em+2))<<16;case 2:ed^=(255&V.charCodeAt(em+1))<<8;case 1:ec^=ed=(65535&(ed=(ed=(65535&(ed^=255&V.charCodeAt(em)))*3432918353+(((ed>>>16)*3432918353&65535)<<16)&4294967295)<<15|ed>>>17))*461845907+(((ed>>>16)*461845907&65535)<<16)&4294967295}return ec^=V.length,ec=2246822507*(65535&(ec^=ec>>>16))+((2246822507*(ec>>>16)&65535)<<16)&4294967295,ec=3266489909*(65535&(ec^=ec>>>13))+((3266489909*(ec>>>16)&65535)<<16)&4294967295,(ec^=ec>>>16)>>>0};var tL={exports:{}};tL.exports=function(V,G){for(var el,eh=V.length,ec=G^eh,ep=0;eh>=4;)el=1540483477*(65535&(el=255&V.charCodeAt(ep)|(255&V.charCodeAt(++ep))<<8|(255&V.charCodeAt(++ep))<<16|(255&V.charCodeAt(++ep))<<24))+((1540483477*(el>>>16)&65535)<<16),ec=1540483477*(65535&ec)+((1540483477*(ec>>>16)&65535)<<16)^(el=1540483477*(65535&(el^=el>>>24))+((1540483477*(el>>>16)&65535)<<16)),eh-=4,++ep;switch(eh){case 3:ec^=(255&V.charCodeAt(ep+2))<<16;case 2:ec^=(255&V.charCodeAt(ep+1))<<8;case 1:ec=1540483477*(65535&(ec^=255&V.charCodeAt(ep)))+((1540483477*(ec>>>16)&65535)<<16)}return ec=1540483477*(65535&(ec^=ec>>>13))+((1540483477*(ec>>>16)&65535)<<16),(ec^=ec>>>15)>>>0};var tR=tD.exports,tB=tL.exports;tP.exports=tR,tP.exports.murmur3=tR,tP.exports.murmur2=tB;let Aa=class Aa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(V,G,el,eh){this.ids.push(ka(V)),this.positions.push(G,el,eh)}getPositions(V){if(!this.indexed)throw Error("Trying to get index, but feature positions are not indexed");let G=ka(V),el=0,eh=this.ids.length-1;for(;el<eh;){let V=el+eh>>1;this.ids[V]>=G?eh=V:el=V+1}let ec=[];for(;this.ids[el]===G;)ec.push({index:this.positions[3*el],start:this.positions[3*el+1],end:this.positions[3*el+2]}),el++;return ec}static serialize(V,G){let el=new Float64Array(V.ids),eh=new Uint32Array(V.positions);return function Sa(V,G,el,eh){for(;el<eh;){let ec=V[el+eh>>1],ep=el-1,ed=eh+1;for(;;){do ep++;while(V[ep]<ec);do ed--;while(V[ed]>ec);if(ep>=ed)break;Ia(V,ep,ed),Ia(G,3*ep,3*ed),Ia(G,3*ep+1,3*ed+1),Ia(G,3*ep+2,3*ed+2)}ed-el<eh-ed?(Sa(V,G,el,ed),el=ed+1):(Sa(V,G,ed+1,eh),eh=ed)}}(el,eh,0,el.length-1),G&&G.push(el.buffer,eh.buffer),{ids:el,positions:eh}}static deserialize(V){let G=new Aa;return G.ids=V.ids,G.positions=V.positions,G.indexed=!0,G}};function ka(V){let G=+V;return!isNaN(G)&&G<=Number.MAX_SAFE_INTEGER?G:tP.exports(String(V))}function Ia(V,G,el){let eh=V[G];V[G]=V[el],V[el]=eh}Mn("FeaturePositionMap",Aa);let Ma=class Ma{constructor(V,G){this.gl=V.gl,this.location=G}};let za=class za extends Ma{constructor(V,G){super(V,G),this.current=0}set(V){this.current!==V&&(this.current=V,this.gl.uniform1f(this.location,V))}};let Ba=class Ba extends Ma{constructor(V,G){super(V,G),this.current=[0,0,0,0]}set(V){V[0]===this.current[0]&&V[1]===this.current[1]&&V[2]===this.current[2]&&V[3]===this.current[3]||(this.current=V,this.gl.uniform4f(this.location,V[0],V[1],V[2],V[3]))}};let Ca=class Ca extends Ma{constructor(V,G){super(V,G),this.current=Ft.transparent}set(V){V.r===this.current.r&&V.g===this.current.g&&V.b===this.current.b&&V.a===this.current.a||(this.current=V,this.gl.uniform4f(this.location,V.r,V.g,V.b,V.a))}};let tF=new Float32Array(16);function Va(V){return[ma(255*V.r,255*V.g),ma(255*V.b,255*V.a)]}let Ea=class Ea{constructor(V,G,el){this.value=V,this.uniformNames=G.map(V=>`u_${V}`),this.type=el}setUniform(V,G,el){V.set(el.constantOr(this.value))}getBinding(V,G,el){return"color"===this.type?new Ca(V,G):new za(V,G)}};let Fa=class Fa{constructor(V,G){this.uniformNames=G.map(V=>`u_${V}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(V,G){this.pixelRatioFrom=G.pixelRatio,this.pixelRatioTo=V.pixelRatio,this.patternFrom=G.tlbr,this.patternTo=V.tlbr}setUniform(V,G,el,eh){let ec="u_pattern_to"===eh?this.patternTo:"u_pattern_from"===eh?this.patternFrom:"u_pixel_ratio_to"===eh?this.pixelRatioTo:"u_pixel_ratio_from"===eh?this.pixelRatioFrom:null;ec&&V.set(ec)}getBinding(V,G,el){return"u_pattern"===el.substr(0,9)?new Ba(V,G):new za(V,G)}};let Ta=class Ta{constructor(V,G,el,eh){this.expression=V,this.type=el,this.maxValue=0,this.paintVertexAttributes=G.map(V=>({name:`a_${V}`,type:"Float32",components:"color"===el?2:1,offset:0})),this.paintVertexArray=new eh}populatePaintArray(V,G,el,eh,ec){let ep=this.paintVertexArray.length,ed=this.expression.evaluate(new Qn(0),G,{},eh,[],ec);this.paintVertexArray.resize(V),this._setPaintValue(ep,V,ed)}updatePaintArray(V,G,el,eh){let ec=this.expression.evaluate({zoom:0},el,eh);this._setPaintValue(V,G,ec)}_setPaintValue(V,G,el){if("color"===this.type){let eh=Va(el);for(let el=V;el<G;el++)this.paintVertexArray.emplace(el,eh[0],eh[1])}else{for(let eh=V;eh<G;eh++)this.paintVertexArray.emplace(eh,el);this.maxValue=Math.max(this.maxValue,Math.abs(el))}}upload(V){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=V.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}};let La=class La{constructor(V,G,el,eh,ec,ep){this.expression=V,this.uniformNames=G.map(V=>`u_${V}_t`),this.type=el,this.useIntegerZoom=eh,this.zoom=ec,this.maxValue=0,this.paintVertexAttributes=G.map(V=>({name:`a_${V}`,type:"Float32",components:"color"===el?4:2,offset:0})),this.paintVertexArray=new ep}populatePaintArray(V,G,el,eh,ec){let ep=this.expression.evaluate(new Qn(this.zoom),G,{},eh,[],ec),ed=this.expression.evaluate(new Qn(this.zoom+1),G,{},eh,[],ec),em=this.paintVertexArray.length;this.paintVertexArray.resize(V),this._setPaintValue(em,V,ep,ed)}updatePaintArray(V,G,el,eh){let ec=this.expression.evaluate({zoom:this.zoom},el,eh),ep=this.expression.evaluate({zoom:this.zoom+1},el,eh);this._setPaintValue(V,G,ec,ep)}_setPaintValue(V,G,el,eh){if("color"===this.type){let ec=Va(el),ep=Va(eh);for(let el=V;el<G;el++)this.paintVertexArray.emplace(el,ec[0],ec[1],ep[0],ep[1])}else{for(let ec=V;ec<G;ec++)this.paintVertexArray.emplace(ec,el,eh);this.maxValue=Math.max(this.maxValue,Math.abs(el),Math.abs(eh))}}upload(V){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=V.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(V,G){let el=this.useIntegerZoom?Math.floor(G.zoom):G.zoom,eh=a(this.expression.interpolationFactor(el,this.zoom,this.zoom+1),0,1);V.set(eh)}getBinding(V,G,el){return new za(V,G)}};let Da=class Da{constructor(V,G,el,eh,ec,ep){this.expression=V,this.type=G,this.useIntegerZoom=el,this.zoom=eh,this.layerId=ep,this.zoomInPaintVertexArray=new ec,this.zoomOutPaintVertexArray=new ec}populatePaintArray(V,G,el){let eh=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(V),this.zoomOutPaintVertexArray.resize(V),this._setPaintValues(eh,V,G.patterns&&G.patterns[this.layerId],el)}updatePaintArray(V,G,el,eh,ec){this._setPaintValues(V,G,el.patterns&&el.patterns[this.layerId],ec)}_setPaintValues(V,G,el,eh){if(!eh||!el)return;let{min:ec,mid:ep,max:ed}=el,em=eh[ec],ef=eh[ep],eg=eh[ed];if(em&&ef&&eg)for(let el=V;el<G;el++)this.zoomInPaintVertexArray.emplace(el,ef.tl[0],ef.tl[1],ef.br[0],ef.br[1],em.tl[0],em.tl[1],em.br[0],em.br[1],ef.pixelRatio,em.pixelRatio),this.zoomOutPaintVertexArray.emplace(el,ef.tl[0],ef.tl[1],ef.br[0],ef.br[1],eg.tl[0],eg.tl[1],eg.br[0],eg.br[1],ef.pixelRatio,eg.pixelRatio)}upload(V){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=V.createVertexBuffer(this.zoomInPaintVertexArray,tk.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=V.createVertexBuffer(this.zoomOutPaintVertexArray,tk.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}};let $a=class $a{constructor(V,G,el){this.binders={},this._buffers=[];let eh=[];for(let ep in V.paint._values){var ec;if(!el(ep))continue;let ed=V.paint.get(ep);if(!(ed instanceof si&&br(ed.property.specification)))continue;let em=(ec=V.type,({"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]})[ep]||[ep.replace(`${ec}-`,"").replace(/-/g,"_")]),ef=ed.value,eg=ed.property.specification.type,e_=ed.property.useIntegerZoom,ey=ed.property.specification["property-type"],ex="cross-faded"===ey||"cross-faded-data-driven"===ey;if("constant"===ef.kind)this.binders[ep]=ex?new Fa(ef.value,em):new Ea(ef.value,em,eg),eh.push(`/u_${ep}`);else if("source"===ef.kind||ex){let el=Ua(ep,eg,"source");this.binders[ep]=ex?new Da(ef,eg,e_,G,el,V.id):new Ta(ef,em,eg,el),eh.push(`/a_${ep}`)}else{let V=Ua(ep,eg,"composite");this.binders[ep]=new La(ef,em,eg,e_,G,V),eh.push(`/z_${ep}`)}}this.cacheKey=eh.sort().join("")}getMaxValue(V){let G=this.binders[V];return G instanceof Ta||G instanceof La?G.maxValue:0}populatePaintArrays(V,G,el,eh,ec){for(let ep in this.binders){let ed=this.binders[ep];(ed instanceof Ta||ed instanceof La||ed instanceof Da)&&ed.populatePaintArray(V,G,el,eh,ec)}}setConstantPatternPositions(V,G){for(let el in this.binders){let eh=this.binders[el];eh instanceof Fa&&eh.setConstantPatternPositions(V,G)}}updatePaintArrays(V,G,el,eh,ec){let ep=!1;for(let ed in V){let em=G.getPositions(ed);for(let G of em){let em=el.feature(G.index);for(let el in this.binders){let ef=this.binders[el];if((ef instanceof Ta||ef instanceof La||ef instanceof Da)&&!0===ef.expression.isStateDependent){let eg=eh.paint.get(el);ef.expression=eg.value,ef.updatePaintArray(G.start,G.end,em,V[ed],ec),ep=!0}}}}return ep}defines(){let V=[];for(let G in this.binders){let el=this.binders[G];(el instanceof Ea||el instanceof Fa)&&V.push(...el.uniformNames.map(V=>`#define HAS_UNIFORM_${V}`))}return V}getBinderAttributes(){let V=[];for(let G in this.binders){let el=this.binders[G];if(el instanceof Ta||el instanceof La)for(let G=0;G<el.paintVertexAttributes.length;G++)V.push(el.paintVertexAttributes[G].name);else if(el instanceof Da)for(let G=0;G<tk.members.length;G++)V.push(tk.members[G].name)}return V}getBinderUniforms(){let V=[];for(let G in this.binders){let el=this.binders[G];if(el instanceof Ea||el instanceof Fa||el instanceof La)for(let G of el.uniformNames)V.push(G)}return V}getPaintVertexBuffers(){return this._buffers}getUniforms(V,G){let el=[];for(let eh in this.binders){let ec=this.binders[eh];if(ec instanceof Ea||ec instanceof Fa||ec instanceof La){for(let ep of ec.uniformNames)if(G[ep]){let ed=ec.getBinding(V,G[ep],ep);el.push({name:ep,property:eh,binding:ed})}}}return el}setUniforms(V,G,el,eh){for(let{name:V,property:ec,binding:ep}of G)this.binders[ec].setUniform(ep,eh,el.get(ec),V)}updatePaintBuffers(V){for(let G in this._buffers=[],this.binders){let el=this.binders[G];if(V&&el instanceof Da){let G=2===V.fromScale?el.zoomInPaintVertexBuffer:el.zoomOutPaintVertexBuffer;G&&this._buffers.push(G)}else(el instanceof Ta||el instanceof La)&&el.paintVertexBuffer&&this._buffers.push(el.paintVertexBuffer)}}upload(V){for(let G in this.binders){let el=this.binders[G];(el instanceof Ta||el instanceof La||el instanceof Da)&&el.upload(V)}this.updatePaintBuffers()}destroy(){for(let V in this.binders){let G=this.binders[V];(G instanceof Ta||G instanceof La||G instanceof Da)&&G.destroy()}}};let Ra=class Ra{constructor(V,G,el=()=>!0){for(let eh of(this.programConfigurations={},V))this.programConfigurations[eh.id]=new $a(eh,G,el);this.needsUpload=!1,this._featureMap=new Aa,this._bufferOffset=0}populatePaintArrays(V,G,el,eh,ec,ep){for(let el in this.programConfigurations)this.programConfigurations[el].populatePaintArrays(V,G,eh,ec,ep);void 0!==G.id&&this._featureMap.add(G.id,el,this._bufferOffset,V),this._bufferOffset=V,this.needsUpload=!0}updatePaintArrays(V,G,el,eh){for(let ec of el)this.needsUpload=this.programConfigurations[ec.id].updatePaintArrays(V,this._featureMap,G,ec,eh)||this.needsUpload}get(V){return this.programConfigurations[V]}upload(V){if(this.needsUpload){for(let G in this.programConfigurations)this.programConfigurations[G].upload(V);this.needsUpload=!1}}destroy(){for(let V in this.programConfigurations)this.programConfigurations[V].destroy()}};function Ua(V,G,el){let eh={"line-pattern":{source:aa,composite:aa},"fill-pattern":{source:aa,composite:aa},"fill-extrusion-pattern":{source:aa,composite:aa}}[V];return eh&&eh[el]||({color:{source:Si,composite:qi},number:{source:Di,composite:Si}})[G][el]}Mn("ConstantBinder",Ea),Mn("CrossFadedConstantBinder",Fa),Mn("SourceExpressionBinder",Ta),Mn("CrossFadedCompositeBinder",Da),Mn("CompositeExpressionBinder",La),Mn("ProgramConfiguration",$a,{omit:["_buffers"]}),Mn("ProgramConfigurationSet",Ra);let tO=-16383-1;function Za(V){let G=8192/V.extent,el=V.loadGeometry();for(let V=0;V<el.length;V++){let eh=el[V];for(let V=0;V<eh.length;V++){let el=eh[V],ec=Math.round(el.x*G),ep=Math.round(el.y*G);el.x=a(ec,tO,16383),el.y=a(ep,tO,16383),(ec<el.x||ec>el.x+1||ep<el.y||ep>el.y+1)&&d("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return el}function Ka(V,G){return{type:V.type,id:V.id,properties:V.properties,geometry:G?Za(V):[]}}function Ga(V,G,el,eh,ec){V.emplaceBack(2*G+(eh+1)/2,2*el+(ec+1)/2)}let Ja=class Ja{constructor(V){this.zoom=V.zoom,this.overscaling=V.overscaling,this.layers=V.layers,this.layerIds=this.layers.map(V=>V.id),this.index=V.index,this.hasPattern=!1,this.layoutVertexArray=new ta,this.indexArray=new ha,this.segments=new ya,this.programConfigurations=new Ra(V.layers,V.zoom),this.stateDependentLayerIds=this.layers.filter(V=>V.isStateDependent()).map(V=>V.id)}populate(V,G,el){let eh=this.layers[0],ec=[],ep=null,ed=!1;for(let{feature:G,id:em,index:ef,sourceLayerIndex:eg}of("circle"===eh.type&&(ed=!(ep=eh.layout.get("circle-sort-key")).isConstant()),V)){let V=this.layers[0]._featureFilter.needGeometry,eh=Ka(G,V);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),eh,el))continue;let e_=ed?ep.evaluate(eh,{},el):void 0,ey={id:em,properties:G.properties,type:G.type,sourceLayerIndex:eg,index:ef,geometry:V?eh.geometry:Za(G),patterns:{},sortKey:e_};ec.push(ey)}for(let eh of(ed&&ec.sort((V,G)=>V.sortKey-G.sortKey),ec)){let{geometry:ec,index:ep,sourceLayerIndex:ed}=eh,em=V[ep].feature;this.addFeature(eh,ec,ep,el),G.featureIndex.insert(em,ec,ep,ed,this.index)}}update(V,G,el){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(V,G,this.stateDependentLayers,el)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(V){this.uploaded||(this.layoutVertexBuffer=V.createVertexBuffer(this.layoutVertexArray,tz),this.indexBuffer=V.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(V),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(V,G,el,eh){for(let el of G)for(let G of el){let el=G.x,eh=G.y;if(el<0||el>=8192||eh<0||eh>=8192)continue;let ec=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,V.sortKey),ep=ec.vertexLength;Ga(this.layoutVertexArray,el,eh,-1,-1),Ga(this.layoutVertexArray,el,eh,1,-1),Ga(this.layoutVertexArray,el,eh,1,1),Ga(this.layoutVertexArray,el,eh,-1,1),this.indexArray.emplaceBack(ep,ep+1,ep+2),this.indexArray.emplaceBack(ep,ep+3,ep+2),ec.vertexLength+=4,ec.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,V,el,{},eh)}};function Xa(V,G){for(let el=0;el<V.length;el++)if(is(G,V[el]))return!0;for(let el=0;el<G.length;el++)if(is(V,G[el]))return!0;return!!Qa(V,G)}function Ha(V,G){if(1===V.length)return ns(G,V[0]);for(let el=0;el<G.length;el++){let eh=G[el];for(let G=0;G<eh.length;G++)if(is(V,eh[G]))return!0}for(let el=0;el<V.length;el++)if(ns(G,V[el]))return!0;for(let el=0;el<G.length;el++)if(Qa(V,G[el]))return!0;return!1}function Qa(V,G){if(0===V.length||0===G.length)return!1;for(let ec=0;ec<V.length-1;ec++){let ep=V[ec],ed=V[ec+1];for(let V=0;V<G.length-1;V++){var el,eh;if(y(ep,el=G[V],eh=G[V+1])!==y(ed,el,eh)&&y(ep,ed,el)!==y(ep,ed,eh))return!0}}return!1}function es(V,G,el){let eh=el*el;if(1===G.length)return V.distSqr(G[0])<eh;for(let el=1;el<G.length;el++)if(rs(V,G[el-1],G[el])<eh)return!0;return!1}function rs(V,G,el){let eh=G.distSqr(el);if(0===eh)return V.distSqr(G);let ec=((V.x-G.x)*(el.x-G.x)+(V.y-G.y)*(el.y-G.y))/eh;return V.distSqr(ec<0?G:ec>1?el:el.sub(G)._mult(ec)._add(G))}function ns(V,G){let el,eh,ec,ep=!1;for(let ed=0;ed<V.length;ed++){el=V[ed];for(let V=0,ed=el.length-1;V<el.length;ed=V++)eh=el[V],ec=el[ed],eh.y>G.y!=ec.y>G.y&&G.x<(ec.x-eh.x)*(G.y-eh.y)/(ec.y-eh.y)+eh.x&&(ep=!ep)}return ep}function is(V,G){let el=!1;for(let eh=0,ec=V.length-1;eh<V.length;ec=eh++){let ep=V[eh],ed=V[ec];ep.y>G.y!=ed.y>G.y&&G.x<(ed.x-ep.x)*(G.y-ep.y)/(ed.y-ep.y)+ep.x&&(el=!el)}return el}function ss(V,G,el){let eh=G.paint.get(V).value;return"constant"===eh.kind?eh.value:el.programConfigurations.get(G.id).getMaxValue(V)}function os(V){return Math.sqrt(V[0]*V[0]+V[1]*V[1])}function ls(V,G,el,eh,ec){if(!G[0]&&!G[1])return V;let ep=e_.convert(G)._mult(ec);"viewport"===el&&ep._rotate(-eh);let ed=[];for(let G=0;G<V.length;G++)ed.push(V[G].sub(ep));return ed}Mn("CircleBucket",Ja,{omit:["layers"]});let tU=new fi({"circle-sort-key":new ui(eD.layout_circle["circle-sort-key"])});var tV={paint:new fi({"circle-radius":new ui(eD.paint_circle["circle-radius"]),"circle-color":new ui(eD.paint_circle["circle-color"]),"circle-blur":new ui(eD.paint_circle["circle-blur"]),"circle-opacity":new ui(eD.paint_circle["circle-opacity"]),"circle-translate":new li(eD.paint_circle["circle-translate"]),"circle-translate-anchor":new li(eD.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new li(eD.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new li(eD.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ui(eD.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ui(eD.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ui(eD.paint_circle["circle-stroke-opacity"])}),layout:tU},tN="undefined"!=typeof Float32Array?Float32Array:Array;function fs(){var V=new tN(9);return tN!=Float32Array&&(V[1]=0,V[2]=0,V[3]=0,V[5]=0,V[6]=0,V[7]=0),V[0]=1,V[4]=1,V[8]=1,V}function ds(V){return V[0]=1,V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=1,V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[10]=1,V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,V}function ys(V,G,el){var eh=G[0],ec=G[1],ep=G[2],ed=G[3],em=G[4],ef=G[5],eg=G[6],e_=G[7],ey=G[8],ex=G[9],ev=G[10],eb=G[11],ew=G[12],eT=G[13],eE=G[14],eS=G[15],eI=el[0],eA=el[1],eM=el[2],eC=el[3];return V[0]=eI*eh+eA*em+eM*ey+eC*ew,V[1]=eI*ec+eA*ef+eM*ex+eC*eT,V[2]=eI*ep+eA*eg+eM*ev+eC*eE,V[3]=eI*ed+eA*e_+eM*eb+eC*eS,V[4]=(eI=el[4])*eh+(eA=el[5])*em+(eM=el[6])*ey+(eC=el[7])*ew,V[5]=eI*ec+eA*ef+eM*ex+eC*eT,V[6]=eI*ep+eA*eg+eM*ev+eC*eE,V[7]=eI*ed+eA*e_+eM*eb+eC*eS,V[8]=(eI=el[8])*eh+(eA=el[9])*em+(eM=el[10])*ey+(eC=el[11])*ew,V[9]=eI*ec+eA*ef+eM*ex+eC*eT,V[10]=eI*ep+eA*eg+eM*ev+eC*eE,V[11]=eI*ed+eA*e_+eM*eb+eC*eS,V[12]=(eI=el[12])*eh+(eA=el[13])*em+(eM=el[14])*ey+(eC=el[15])*ew,V[13]=eI*ec+eA*ef+eM*ex+eC*eT,V[14]=eI*ep+eA*eg+eM*ev+eC*eE,V[15]=eI*ed+eA*e_+eM*eb+eC*eS,V}function xs(){var V=new tN(3);return tN!=Float32Array&&(V[0]=0,V[1]=0,V[2]=0),V}function vs(V,G,el){var eh=new tN(3);return eh[0]=V,eh[1]=G,eh[2]=el,eh}function bs(V,G,el){var eh=G[0],ec=G[1],ep=G[2],ed=G[3];return V[0]=el[0]*eh+el[4]*ec+el[8]*ep+el[12]*ed,V[1]=el[1]*eh+el[5]*ec+el[9]*ep+el[13]*ed,V[2]=el[2]*eh+el[6]*ec+el[10]*ep+el[14]*ed,V[3]=el[3]*eh+el[7]*ec+el[11]*ep+el[15]*ed,V}function ws(){var V=new tN(4);return tN!=Float32Array&&(V[0]=0,V[1]=0,V[2]=0),V[3]=1,V}function _s(V,G){let el=bs([],[V.x,V.y,0,1],G);return new e_(el[0]/el[3],el[1]/el[3])}Math.hypot||(Math.hypot=function(){for(var V=0,G=arguments.length;G--;)V+=arguments[G]*arguments[G];return Math.sqrt(V)}),xs(),ig=new tN(4),tN!=Float32Array&&(ig[0]=0,ig[1]=0,ig[2]=0,ig[3]=0),xs(),vs(1,0,0),vs(0,1,0),ws(),ws(),fs(),i_=new tN(2),tN!=Float32Array&&(i_[0]=0,i_[1]=0);let As=class As extends Ja{};Mn("HeatmapBucket",As,{omit:["layers"]});var t$={paint:new fi({"heatmap-radius":new ui(eD.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ui(eD.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new li(eD.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pi(eD.paint_heatmap["heatmap-color"]),"heatmap-opacity":new li(eD.paint_heatmap["heatmap-opacity"])})};function Ss(V,{width:G,height:el},eh,ec){if(ec){if(ec instanceof Uint8ClampedArray)ec=new Uint8Array(ec.buffer);else if(ec.length!==G*el*eh)throw RangeError(`mismatched image size. expected: ${ec.length} but got: ${G*el*eh}`)}else ec=new Uint8Array(G*el*eh);return V.width=G,V.height=el,V.data=ec,V}function Is(V,{width:G,height:el},eh){if(G===V.width&&el===V.height)return;let ec=Ss({},{width:G,height:el},eh);Ms(V,ec,{x:0,y:0},{x:0,y:0},{width:Math.min(V.width,G),height:Math.min(V.height,el)},eh),V.width=G,V.height=el,V.data=ec.data}function Ms(V,G,el,eh,ec,ep){if(0===ec.width||0===ec.height)return G;if(ec.width>V.width||ec.height>V.height||el.x>V.width-ec.width||el.y>V.height-ec.height)throw RangeError("out of range source coordinates for image copy");if(ec.width>G.width||ec.height>G.height||eh.x>G.width-ec.width||eh.y>G.height-ec.height)throw RangeError("out of range destination coordinates for image copy");let ed=V.data,em=G.data;if(ed===em)throw Error("srcData equals dstData, so image is already copied");for(let ef=0;ef<ec.height;ef++){let eg=((el.y+ef)*V.width+el.x)*ep,e_=((eh.y+ef)*G.width+eh.x)*ep;for(let V=0;V<ec.width*ep;V++)em[e_+V]=ed[eg+V]}return G}let zs=class zs{constructor(V,G){Ss(this,V,1,G)}resize(V){Is(this,V,1)}clone(){return new zs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(V,G,el,eh,ec){Ms(V,G,el,eh,ec,1)}};let Bs=class Bs{constructor(V,G){Ss(this,V,4,G)}resize(V){Is(this,V,4)}replace(V,G){G?this.data.set(V):this.data=V instanceof Uint8ClampedArray?new Uint8Array(V.buffer):V}clone(){return new Bs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(V,G,el,eh,ec){Ms(V,G,el,eh,ec,4)}};function Cs(V){let G={},el=V.resolution||256,eh=V.clips?V.clips.length:1,ec=V.image||new Bs({width:el,height:eh});if(Math.log(el)/Math.LN2%1!=0)throw Error(`width is not a power of 2 - ${el}`);let a=(el,eh,ep)=>{G[V.evaluationKey]=ep;let ed=V.expression.evaluate(G);ec.data[el+eh+0]=Math.floor(255*ed.r/ed.a),ec.data[el+eh+1]=Math.floor(255*ed.g/ed.a),ec.data[el+eh+2]=Math.floor(255*ed.b/ed.a),ec.data[el+eh+3]=Math.floor(255*ed.a)};if(V.clips)for(let G=0,ec=0;G<eh;++G,ec+=4*el)for(let eh=0,ep=0;eh<el;eh++,ep+=4){let ed=eh/(el-1),{start:em,end:ef}=V.clips[G];a(ec,ep,em*(1-ed)+ef*ed)}else for(let V=0,G=0;V<el;V++,G+=4)a(0,G,V/(el-1));return ec}Mn("AlphaImage",zs),Mn("RGBAImage",Bs);var tq={paint:new fi({"hillshade-illumination-direction":new li(eD.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new li(eD.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new li(eD.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new li(eD.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new li(eD.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new li(eD.paint_hillshade["hillshade-accent-color"])})};let tG=vi([{name:"a_pos",components:2,type:"Int16"}],4),{members:tZ}=tG;var tj={exports:{}};function Ts(V,G,el){el=el||2;var eh,ec,ep,ed,em,ef,eg,e_=G&&G.length,ey=e_?G[0]*el:V.length,ex=Ls(V,0,ey,el,!0),ev=[];if(!ex||ex.next===ex.prev)return ev;if(e_&&(ex=function(V,G,el,eh){var ec,ep,ed,em=[];for(ec=0,ep=G.length;ec<ep;ec++)(ed=Ls(V,G[ec]*eh,ec<ep-1?G[ec+1]*eh:V.length,eh,!1))===ed.next&&(ed.steiner=!0),em.push(function(V){var G=V,el=V;do(G.x<el.x||G.x===el.x&&G.y<el.y)&&(el=G),G=G.next;while(G!==V);return el}(ed));for(em.sort(js),ec=0;ec<em.length;ec++)el=function(V,G){var el=function(V,G){var el,eh,ec,ep=G,ed=V.x,em=V.y,ef=-1/0;do{if(em<=ep.y&&em>=ep.next.y&&ep.next.y!==ep.y){var eg=ep.x+(em-ep.y)*(ep.next.x-ep.x)/(ep.next.y-ep.y);if(eg<=ed&&eg>ef&&(ef=eg,ec=ep.x<ep.next.x?ep:ep.next,eg===ed))return ec}ep=ep.next}while(ep!==G);if(!ec)return null;var e_,ey=ec,ex=ec.x,ev=ec.y,eb=1/0;ep=ec;do ed>=ep.x&&ep.x>=ex&&ed!==ep.x&&Js(em<ev?ed:ef,em,ex,ev,em<ev?ef:ed,em,ep.x,ep.y)&&(e_=Math.abs(em-ep.y)/(ed-ep.x),eo(ep,V)&&(e_<eb||e_===eb&&(ep.x>ec.x||ep.x===ec.x&&(el=ec,eh=ep,0>Ys(el.prev,el,eh.prev)&&0>Ys(eh.next,el,el.next))))&&(ec=ep,eb=e_)),ep=ep.next;while(ep!==ey);return ec}(V,G);if(!el)return G;var eh=ro(el,V);return Ds(eh,eh.next),Ds(el,el.next)}(em[ec],el);return el}(V,G,ex,el)),V.length>80*el){eh=ep=V[0],ec=ed=V[1];for(var eb=el;eb<ey;eb+=el)(em=V[eb])<eh&&(eh=em),(ef=V[eb+1])<ec&&(ec=ef),em>ep&&(ep=em),ef>ed&&(ed=ef);eg=0!==(eg=Math.max(ep-eh,ed-ec))?32767/eg:0}return function $s(V,G,el,eh,ec,ep,ed){if(V){!ed&&ep&&function(V,G,el,eh){var ec=V;do 0===ec.z&&(ec.z=Ks(ec.x,ec.y,G,el,eh)),ec.prevZ=ec.prev,ec.nextZ=ec.next,ec=ec.next;while(ec!==V);ec.prevZ.nextZ=null,ec.prevZ=null,function(V){var G,el,eh,ec,ep,ed,em,ef,eg=1;do{for(el=V,V=null,ep=null,ed=0;el;){for(ed++,eh=el,em=0,G=0;G<eg&&(em++,eh=eh.nextZ);G++);for(ef=eg;em>0||ef>0&&eh;)0!==em&&(0===ef||!eh||el.z<=eh.z)?(ec=el,el=el.nextZ,em--):(ec=eh,eh=eh.nextZ,ef--),ep?ep.nextZ=ec:V=ec,ec.prevZ=ep,ep=ec;el=eh}ep.nextZ=null,eg*=2}while(ed>1)}(ec)}(V,eh,ec,ep);for(var em,ef,eg=V;V.prev!==V.next;)if(em=V.prev,ef=V.next,ep?function(V,G,el,eh){var ec=V.prev,ep=V.next;if(Ys(ec,V,ep)>=0)return!1;for(var ed=ec.x,em=V.x,ef=ep.x,eg=ec.y,e_=V.y,ey=ep.y,ex=ed<em?ed<ef?ed:ef:em<ef?em:ef,ev=eg<e_?eg<ey?eg:ey:e_<ey?e_:ey,eb=ed>em?ed>ef?ed:ef:em>ef?em:ef,ew=eg>e_?eg>ey?eg:ey:e_>ey?e_:ey,eT=Ks(ex,ev,G,el,eh),eE=Ks(eb,ew,G,el,eh),eS=V.prevZ,eI=V.nextZ;eS&&eS.z>=eT&&eI&&eI.z<=eE;){if(eS.x>=ex&&eS.x<=eb&&eS.y>=ev&&eS.y<=ew&&eS!==ec&&eS!==ep&&Js(ed,eg,em,e_,ef,ey,eS.x,eS.y)&&Ys(eS.prev,eS,eS.next)>=0||(eS=eS.prevZ,eI.x>=ex&&eI.x<=eb&&eI.y>=ev&&eI.y<=ew&&eI!==ec&&eI!==ep&&Js(ed,eg,em,e_,ef,ey,eI.x,eI.y)&&Ys(eI.prev,eI,eI.next)>=0))return!1;eI=eI.nextZ}for(;eS&&eS.z>=eT;){if(eS.x>=ex&&eS.x<=eb&&eS.y>=ev&&eS.y<=ew&&eS!==ec&&eS!==ep&&Js(ed,eg,em,e_,ef,ey,eS.x,eS.y)&&Ys(eS.prev,eS,eS.next)>=0)return!1;eS=eS.prevZ}for(;eI&&eI.z<=eE;){if(eI.x>=ex&&eI.x<=eb&&eI.y>=ev&&eI.y<=ew&&eI!==ec&&eI!==ep&&Js(ed,eg,em,e_,ef,ey,eI.x,eI.y)&&Ys(eI.prev,eI,eI.next)>=0)return!1;eI=eI.nextZ}return!0}(V,eh,ec,ep):function(V){var G=V.prev,el=V.next;if(Ys(G,V,el)>=0)return!1;for(var eh=G.x,ec=V.x,ep=el.x,ed=G.y,em=V.y,ef=el.y,eg=eh<ec?eh<ep?eh:ep:ec<ep?ec:ep,e_=ed<em?ed<ef?ed:ef:em<ef?em:ef,ey=eh>ec?eh>ep?eh:ep:ec>ep?ec:ep,ex=ed>em?ed>ef?ed:ef:em>ef?em:ef,ev=el.next;ev!==G;){if(ev.x>=eg&&ev.x<=ey&&ev.y>=e_&&ev.y<=ex&&Js(eh,ed,ec,em,ep,ef,ev.x,ev.y)&&Ys(ev.prev,ev,ev.next)>=0)return!1;ev=ev.next}return!0}(V))G.push(em.i/el|0),G.push(V.i/el|0),G.push(ef.i/el|0),io(V),V=ef.next,eg=ef.next;else if((V=ef)===eg){ed?1===ed?$s(V=function(V,G,el){var eh=V;do{var ec=eh.prev,ep=eh.next.next;!Hs(ec,ep)&&Ws(ec,eh,eh.next,ep)&&eo(ec,ep)&&eo(ep,ec)&&(G.push(ec.i/el|0),G.push(eh.i/el|0),G.push(ep.i/el|0),io(eh),io(eh.next),eh=V=ep),eh=eh.next}while(eh!==V);return Ds(eh)}(Ds(V),G,el),G,el,eh,ec,ep,2):2===ed&&function(V,G,el,eh,ec,ep){var ed=V;do{for(var em,ef,eg=ed.next.next;eg!==ed.prev;){if(ed.i!==eg.i&&(em=ed,ef=eg,em.next.i!==ef.i&&em.prev.i!==ef.i&&!function(V,G){var el=V;do{if(el.i!==V.i&&el.next.i!==V.i&&el.i!==G.i&&el.next.i!==G.i&&Ws(el,el.next,V,G))return!0;el=el.next}while(el!==V);return!1}(em,ef)&&(eo(em,ef)&&eo(ef,em)&&function(V,G){var el=V,eh=!1,ec=(V.x+G.x)/2,ep=(V.y+G.y)/2;do el.y>ep!=el.next.y>ep&&el.next.y!==el.y&&ec<(el.next.x-el.x)*(ep-el.y)/(el.next.y-el.y)+el.x&&(eh=!eh),el=el.next;while(el!==V);return eh}(em,ef)&&(Ys(em.prev,em,ef.prev)||Ys(em,ef.prev,ef))||Hs(em,ef)&&Ys(em.prev,em,em.next)>0&&Ys(ef.prev,ef,ef.next)>0))){var e_=ro(ed,eg);return ed=Ds(ed,ed.next),e_=Ds(e_,e_.next),$s(ed,G,el,eh,ec,ep,0),void $s(e_,G,el,eh,ec,ep,0)}eg=eg.next}ed=ed.next}while(ed!==V)}(V,G,el,eh,ec,ep):$s(Ds(V),G,el,eh,ec,ep,1);break}}}(ex,ev,el,eh,ec,eg,0),ev}function Ls(V,G,el,eh,ec){var ep,ed;if(ec===so(V,G,el,eh)>0)for(ep=G;ep<el;ep+=eh)ed=no(ep,V[ep],V[ep+1],ed);else for(ep=el-eh;ep>=G;ep-=eh)ed=no(ep,V[ep],V[ep+1],ed);return ed&&Hs(ed,ed.next)&&(io(ed),ed=ed.next),ed}function Ds(V,G){if(!V)return V;G||(G=V);var el,eh=V;do if(el=!1,eh.steiner||!Hs(eh,eh.next)&&0!==Ys(eh.prev,eh,eh.next))eh=eh.next;else{if(io(eh),(eh=G=eh.prev)===eh.next)break;el=!0}while(el||eh!==G);return G}function js(V,G){return V.x-G.x}function Ks(V,G,el,eh,ec){return(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V=(V-el)*ec|0)|V<<8))|V<<4))|V<<2))|V<<1))|(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G=(G-eh)*ec|0)|G<<8))|G<<4))|G<<2))|G<<1))<<1}function Js(V,G,el,eh,ec,ep,ed,em){return(ec-ed)*(G-em)>=(V-ed)*(ep-em)&&(V-ed)*(eh-em)>=(el-ed)*(G-em)&&(el-ed)*(ep-em)>=(ec-ed)*(eh-em)}function Ys(V,G,el){return(G.y-V.y)*(el.x-G.x)-(G.x-V.x)*(el.y-G.y)}function Hs(V,G){return V.x===G.x&&V.y===G.y}function Ws(V,G,el,eh){var ec=to(Ys(V,G,el)),ep=to(Ys(V,G,eh)),ed=to(Ys(el,eh,V)),em=to(Ys(el,eh,G));return ec!==ep&&ed!==em||!(0!==ec||!Qs(V,el,G))||!(0!==ep||!Qs(V,eh,G))||!(0!==ed||!Qs(el,V,eh))||!(0!==em||!Qs(el,G,eh))}function Qs(V,G,el){return G.x<=Math.max(V.x,el.x)&&G.x>=Math.min(V.x,el.x)&&G.y<=Math.max(V.y,el.y)&&G.y>=Math.min(V.y,el.y)}function to(V){return V>0?1:V<0?-1:0}function eo(V,G){return 0>Ys(V.prev,V,V.next)?Ys(V,G,V.next)>=0&&Ys(V,V.prev,G)>=0:0>Ys(V,G,V.prev)||0>Ys(V,V.next,G)}function ro(V,G){var el=new ao(V.i,V.x,V.y),eh=new ao(G.i,G.x,G.y),ec=V.next,ep=G.prev;return V.next=G,G.prev=V,el.next=ec,ec.prev=el,eh.next=el,el.prev=eh,ep.next=eh,eh.prev=ep,eh}function no(V,G,el,eh){var ec=new ao(V,G,el);return eh?(ec.next=eh.next,ec.prev=eh,eh.next.prev=ec,eh.next=ec):(ec.prev=ec,ec.next=ec),ec}function io(V){V.next.prev=V.prev,V.prev.next=V.next,V.prevZ&&(V.prevZ.nextZ=V.nextZ),V.nextZ&&(V.nextZ.prevZ=V.prevZ)}function ao(V,G,el){this.i=V,this.x=G,this.y=el,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function so(V,G,el,eh){for(var ec=0,ep=G,ed=el-eh;ep<el;ep+=eh)ec+=(V[ed]-V[ep])*(V[ep+1]+V[ed+1]),ed=ep;return ec}function uo(V,G,el){var eh=V[G];V[G]=V[el],V[el]=eh}function co(V,G){return V<G?-1:V>G?1:0}function ho(V,G){let el,eh;let ec=V.length;if(ec<=1)return[V];let ep=[];for(let G=0;G<ec;G++){let ec=function(V){let G=0;for(let el,eh,ec=0,ep=V.length,ed=ep-1;ec<ep;ed=ec++)el=V[ec],G+=((eh=V[ed]).x-el.x)*(el.y+eh.y);return G}(V[G]);0!==ec&&(V[G].area=Math.abs(ec),void 0===eh&&(eh=ec<0),eh===ec<0?(el&&ep.push(el),el=[V[G]]):el.push(V[G]))}if(el&&ep.push(el),G>1)for(let V=0;V<ep.length;V++){var ed;ep[V].length<=G||(function lo(V,G,el,eh,ec){for(;eh>el;){if(eh-el>600){var ep=eh-el+1,ed=G-el+1,em=Math.log(ep),ef=.5*Math.exp(2*em/3),eg=.5*Math.sqrt(em*ef*(ep-ef)/ep)*(ed-ep/2<0?-1:1);lo(V,G,Math.max(el,Math.floor(G-ed*ef/ep+eg)),Math.min(eh,Math.floor(G+(ep-ed)*ef/ep+eg)),ec)}var e_=V[G],ey=el,ex=eh;for(uo(V,el,G),ec(V[eh],e_)>0&&uo(V,el,eh);ey<ex;){for(uo(V,ey,ex),ey++,ex--;0>ec(V[ey],e_);)ey++;for(;ec(V[ex],e_)>0;)ex--}0===ec(V[el],e_)?uo(V,el,ex):uo(V,++ex,eh),ex<=G&&(el=ex+1),G<=ex&&(eh=ex-1)}}(ed=ep[V],G,1,ep[V].length-1||ed.length-1,po||co),ep[V]=ep[V].slice(0,G))}return ep}function po(V,G){return G.area-V.area}function fo(V,G,el){let eh=el.patternDependencies,ec=!1;for(let el of G){let G=el.paint.get(`${V}-pattern`);G.isConstant()||(ec=!0);let ep=G.constantOr(null);ep&&(ec=!0,eh[ep.to]=!0,eh[ep.from]=!0)}return ec}function yo(V,G,el,eh,ec){let ep=ec.patternDependencies;for(let ed of G){let G=ed.paint.get(`${V}-pattern`).value;if("constant"!==G.kind){let V=G.evaluate({zoom:eh-1},el,{},ec.availableImages),em=G.evaluate({zoom:eh},el,{},ec.availableImages),ef=G.evaluate({zoom:eh+1},el,{},ec.availableImages);V=V&&V.name?V.name:V,em=em&&em.name?em.name:em,ef=ef&&ef.name?ef.name:ef,ep[V]=!0,ep[em]=!0,ep[ef]=!0,el.patterns[ed.id]={min:V,mid:em,max:ef}}}return el}tj.exports=Ts,tj.exports.default=Ts,Ts.deviation=function(V,G,el,eh){var ec=G&&G.length,ep=Math.abs(so(V,0,ec?G[0]*el:V.length,el));if(ec)for(var ed=0,em=G.length;ed<em;ed++)ep-=Math.abs(so(V,G[ed]*el,ed<em-1?G[ed+1]*el:V.length,el));var ef=0;for(ed=0;ed<eh.length;ed+=3){var eg=eh[ed]*el,e_=eh[ed+1]*el,ey=eh[ed+2]*el;ef+=Math.abs((V[eg]-V[ey])*(V[e_+1]-V[eg+1])-(V[eg]-V[e_])*(V[ey+1]-V[eg+1]))}return 0===ep&&0===ef?0:Math.abs((ef-ep)/ep)},Ts.flatten=function(V){for(var G=V[0][0].length,el={vertices:[],holes:[],dimensions:G},eh=0,ec=0;ec<V.length;ec++){for(var ep=0;ep<V[ec].length;ep++)for(var ed=0;ed<G;ed++)el.vertices.push(V[ec][ep][ed]);ec>0&&el.holes.push(eh+=V[ec-1].length)}return el};let mo=class mo{constructor(V){this.zoom=V.zoom,this.overscaling=V.overscaling,this.layers=V.layers,this.layerIds=this.layers.map(V=>V.id),this.index=V.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ea,this.indexArray=new ha,this.indexArray2=new pa,this.programConfigurations=new Ra(V.layers,V.zoom),this.segments=new ya,this.segments2=new ya,this.stateDependentLayerIds=this.layers.filter(V=>V.isStateDependent()).map(V=>V.id)}populate(V,G,el){this.hasPattern=fo("fill",this.layers,G);let eh=this.layers[0].layout.get("fill-sort-key"),ec=!eh.isConstant(),ep=[];for(let{feature:ed,id:em,index:ef,sourceLayerIndex:eg}of V){let V=this.layers[0]._featureFilter.needGeometry,e_=Ka(ed,V);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),e_,el))continue;let ey=ec?eh.evaluate(e_,{},el,G.availableImages):void 0,ex={id:em,properties:ed.properties,type:ed.type,sourceLayerIndex:eg,index:ef,geometry:V?e_.geometry:Za(ed),patterns:{},sortKey:ey};ep.push(ex)}for(let eh of(ec&&ep.sort((V,G)=>V.sortKey-G.sortKey),ep)){let{geometry:ec,index:ep,sourceLayerIndex:ed}=eh;if(this.hasPattern){let V=yo("fill",this.layers,eh,this.zoom,G);this.patternFeatures.push(V)}else this.addFeature(eh,ec,ep,el,{});G.featureIndex.insert(V[ep].feature,ec,ep,ed,this.index)}}update(V,G,el){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(V,G,this.stateDependentLayers,el)}addFeatures(V,G,el){for(let V of this.patternFeatures)this.addFeature(V,V.geometry,V.index,G,el)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(V){this.uploaded||(this.layoutVertexBuffer=V.createVertexBuffer(this.layoutVertexArray,tZ),this.indexBuffer=V.createIndexBuffer(this.indexArray),this.indexBuffer2=V.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(V),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(V,G,el,eh,ec){for(let V of ho(G,500)){let G=0;for(let el of V)G+=el.length;let el=this.segments.prepareSegment(G,this.layoutVertexArray,this.indexArray),eh=el.vertexLength,ec=[],ep=[];for(let G of V){if(0===G.length)continue;G!==V[0]&&ep.push(ec.length/2);let el=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),eh=el.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(eh+G.length-1,eh),ec.push(G[0].x),ec.push(G[0].y);for(let V=1;V<G.length;V++)this.layoutVertexArray.emplaceBack(G[V].x,G[V].y),this.indexArray2.emplaceBack(eh+V-1,eh+V),ec.push(G[V].x),ec.push(G[V].y);el.vertexLength+=G.length,el.primitiveLength+=G.length}let ed=tj.exports(ec,ep);for(let V=0;V<ed.length;V+=3)this.indexArray.emplaceBack(eh+ed[V],eh+ed[V+1],eh+ed[V+2]);el.vertexLength+=G,el.primitiveLength+=ed.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,V,el,ec,eh)}};Mn("FillBucket",mo,{omit:["layers","patternFeatures"]});let tX=new fi({"fill-sort-key":new ui(eD.layout_fill["fill-sort-key"])});var tW={paint:new fi({"fill-antialias":new li(eD.paint_fill["fill-antialias"]),"fill-opacity":new ui(eD.paint_fill["fill-opacity"]),"fill-color":new ui(eD.paint_fill["fill-color"]),"fill-outline-color":new ui(eD.paint_fill["fill-outline-color"]),"fill-translate":new li(eD.paint_fill["fill-translate"]),"fill-translate-anchor":new li(eD.paint_fill["fill-translate-anchor"]),"fill-pattern":new ci(eD.paint_fill["fill-pattern"])}),layout:tX};let tH=vi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),tK=vi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:tY}=tH;var tJ={};function So(V,G,el,eh,ec){this.properties={},this.extent=el,this.type=0,this._pbf=V,this._geometry=-1,this._keys=eh,this._values=ec,V.readFields(Io,this,G)}function Io(V,G,el){1==V?G.id=el.readVarint():2==V?function(V,G){for(var el=V.readVarint()+V.pos;V.pos<el;){var eh=G._keys[V.readVarint()],ec=G._values[V.readVarint()];G.properties[eh]=ec}}(el,G):3==V?G.type=el.readVarint():4==V&&(G._geometry=el.pos)}function Co(V,G){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=V,this._keys=[],this._values=[],this._features=[],V.readFields(Po,this,G),this.length=this._features.length}function Po(V,G,el){15===V?G.version=el.readVarint():1===V?G.name=el.readString():5===V?G.extent=el.readVarint():2===V?G._features.push(el.pos):3===V?G._keys.push(el.readString()):4===V&&G._values.push(function(V){for(var G=null,el=V.readVarint()+V.pos;V.pos<el;){var eh=V.readVarint()>>3;G=1===eh?V.readString():2===eh?V.readFloat():3===eh?V.readDouble():4===eh?V.readVarint64():5===eh?V.readVarint():6===eh?V.readSVarint():7===eh?V.readBoolean():null}return G}(el))}function Eo(V,G,el){if(3===V){var eh=new Co(el,el.readVarint()+el.pos);eh.length&&(G[eh.name]=eh)}}So.types=["Unknown","Point","LineString","Polygon"],So.prototype.loadGeometry=function(){var V=this._pbf;V.pos=this._geometry;for(var G,el=V.readVarint()+V.pos,eh=1,ec=0,ep=0,ed=0,em=[];V.pos<el;){if(ec<=0){var ef=V.readVarint();eh=7&ef,ec=ef>>3}if(ec--,1===eh||2===eh)ep+=V.readSVarint(),ed+=V.readSVarint(),1===eh&&(G&&em.push(G),G=[]),G.push(new e_(ep,ed));else{if(7!==eh)throw Error("unknown command "+eh);G&&G.push(G[0].clone())}}return G&&em.push(G),em},So.prototype.bbox=function(){var V=this._pbf;V.pos=this._geometry;for(var G=V.readVarint()+V.pos,el=1,eh=0,ec=0,ep=0,ed=1/0,em=-1/0,ef=1/0,eg=-1/0;V.pos<G;){if(eh<=0){var e_=V.readVarint();el=7&e_,eh=e_>>3}if(eh--,1===el||2===el)(ec+=V.readSVarint())<ed&&(ed=ec),ec>em&&(em=ec),(ep+=V.readSVarint())<ef&&(ef=ep),ep>eg&&(eg=ep);else if(7!==el)throw Error("unknown command "+el)}return[ed,ef,em,eg]},So.prototype.toGeoJSON=function(V,G,el){var eh,ec,ep=this.extent*Math.pow(2,el),ed=this.extent*V,em=this.extent*G,ef=this.loadGeometry(),eg=So.types[this.type];function c(V){for(var G=0;G<V.length;G++){var el=V[G];V[G]=[360*(el.x+ed)/ep-180,360/Math.PI*Math.atan(Math.exp((180-360*(el.y+em)/ep)*Math.PI/180))-90]}}switch(this.type){case 1:var e_=[];for(eh=0;eh<ef.length;eh++)e_[eh]=ef[eh][0];c(ef=e_);break;case 2:for(eh=0;eh<ef.length;eh++)c(ef[eh]);break;case 3:for(ef=function(V){var G=V.length;if(G<=1)return[V];for(var el,eh,ec=[],ep=0;ep<G;ep++){var ed=function(V){for(var G,el,eh=0,ec=0,ep=V.length,ed=ep-1;ec<ep;ed=ec++)eh+=((el=V[ed]).x-(G=V[ec]).x)*(G.y+el.y);return eh}(V[ep]);0!==ed&&(void 0===eh&&(eh=ed<0),eh===ed<0?(el&&ec.push(el),el=[V[ep]]):el.push(V[ep]))}return el&&ec.push(el),ec}(ef),eh=0;eh<ef.length;eh++)for(ec=0;ec<ef[eh].length;ec++)c(ef[eh][ec])}1===ef.length?ef=ef[0]:eg="Multi"+eg;var ey={type:"Feature",geometry:{type:eg,coordinates:ef},properties:this.properties};return"id"in this&&(ey.id=this.id),ey},Co.prototype.feature=function(V){if(V<0||V>=this._features.length)throw Error("feature index out of bounds");this._pbf.pos=this._features[V];var G=this._pbf.readVarint()+this._pbf.pos;return new So(this._pbf,G,this.extent,this._keys,this._values)},tJ.VectorTile=function(V,G){this.layers=V.readFields(Eo,{},G)},tJ.VectorTileFeature=So,tJ.VectorTileLayer=Co;let tQ=tJ.VectorTileFeature.types;function Lo(V,G,el,eh,ec,ep,ed,em){V.emplaceBack(G,el,2*Math.floor(8192*eh)+ed,16384*ec,16384*ep,Math.round(em))}let Do=class Do{constructor(V){this.zoom=V.zoom,this.overscaling=V.overscaling,this.layers=V.layers,this.layerIds=this.layers.map(V=>V.id),this.index=V.index,this.hasPattern=!1,this.layoutVertexArray=new ra,this.centroidVertexArray=new Qi,this.indexArray=new ha,this.programConfigurations=new Ra(V.layers,V.zoom),this.segments=new ya,this.stateDependentLayerIds=this.layers.filter(V=>V.isStateDependent()).map(V=>V.id)}populate(V,G,el){for(let{feature:eh,id:ec,index:ep,sourceLayerIndex:ed}of(this.features=[],this.hasPattern=fo("fill-extrusion",this.layers,G),V)){let V=this.layers[0]._featureFilter.needGeometry,em=Ka(eh,V);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),em,el))continue;let ef={id:ec,sourceLayerIndex:ed,index:ep,geometry:V?em.geometry:Za(eh),properties:eh.properties,type:eh.type,patterns:{}};this.hasPattern?this.features.push(yo("fill-extrusion",this.layers,ef,this.zoom,G)):this.addFeature(ef,ef.geometry,ep,el,{}),G.featureIndex.insert(eh,ef.geometry,ep,ed,this.index,!0)}}addFeatures(V,G,el){for(let V of this.features){let{geometry:eh}=V;this.addFeature(V,eh,V.index,G,el)}}update(V,G,el){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(V,G,this.stateDependentLayers,el)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(V){this.uploaded||(this.layoutVertexBuffer=V.createVertexBuffer(this.layoutVertexArray,tY),this.centroidVertexBuffer=V.createVertexBuffer(this.centroidVertexArray,tK.members,!0),this.indexBuffer=V.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(V),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(V,G,el,eh,ec){let ep={x:0,y:0,vertexCount:0};for(let el of ho(G,500)){let G=0;for(let V of el)G+=V.length;let eh=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let V of el){var ed;if(0===V.length||(ed=V).every(V=>V.x<0)||ed.every(V=>V.x>8192)||ed.every(V=>V.y<0)||ed.every(V=>V.y>8192))continue;let G=0;for(let el=0;el<V.length;el++){let ec=V[el];if(el>=1){let ed=V[el-1];if((ec.x!==ed.x||!(ec.x<0)&&!(ec.x>8192))&&(ec.y!==ed.y||!(ec.y<0)&&!(ec.y>8192))){eh.vertexLength+4>ya.MAX_VERTEX_ARRAY_LENGTH&&(eh=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let V=ec.sub(ed)._perp()._unit(),el=ed.dist(ec);G+el>32768&&(G=0),Lo(this.layoutVertexArray,ec.x,ec.y,V.x,V.y,0,0,G),Lo(this.layoutVertexArray,ec.x,ec.y,V.x,V.y,0,1,G),ep.x+=2*ec.x,ep.y+=2*ec.y,ep.vertexCount+=2,G+=el,Lo(this.layoutVertexArray,ed.x,ed.y,V.x,V.y,0,0,G),Lo(this.layoutVertexArray,ed.x,ed.y,V.x,V.y,0,1,G),ep.x+=2*ed.x,ep.y+=2*ed.y,ep.vertexCount+=2;let em=eh.vertexLength;this.indexArray.emplaceBack(em,em+2,em+1),this.indexArray.emplaceBack(em+1,em+2,em+3),eh.vertexLength+=4,eh.primitiveLength+=2}}}}if(eh.vertexLength+G>ya.MAX_VERTEX_ARRAY_LENGTH&&(eh=this.segments.prepareSegment(G,this.layoutVertexArray,this.indexArray)),"Polygon"!==tQ[V.type])continue;let ec=[],em=[],ef=eh.vertexLength;for(let V of el)if(0!==V.length){V!==el[0]&&em.push(ec.length/2);for(let G=0;G<V.length;G++){let el=V[G];Lo(this.layoutVertexArray,el.x,el.y,0,0,1,1,0),ep.x+=el.x,ep.y+=el.y,ep.vertexCount+=1,ec.push(el.x),ec.push(el.y)}}let eg=tj.exports(ec,em);for(let V=0;V<eg.length;V+=3)this.indexArray.emplaceBack(ef+eg[V],ef+eg[V+2],ef+eg[V+1]);eh.primitiveLength+=eg.length/3,eh.vertexLength+=G}for(let V=0;V<ep.vertexCount;V++)this.centroidVertexArray.emplaceBack(Math.floor(ep.x/ep.vertexCount),Math.floor(ep.y/ep.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,V,el,ec,eh)}};Mn("FillExtrusionBucket",Do,{omit:["layers","features"]});var t0={paint:new fi({"fill-extrusion-opacity":new li(eD["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ui(eD["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new li(eD["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new li(eD["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ci(eD["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ui(eD["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ui(eD["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new li(eD["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Uo(V,G){return V.x*G.x+V.y*G.y}function qo(V,G){if(1===V.length){let el,eh=0,ec=G[eh++];for(;!el||ec.equals(el);)if(!(el=G[eh++]))return 1/0;for(;eh<G.length;eh++){let ep=G[eh],ed=V[0],em=el.sub(ec),ef=ep.sub(ec),eg=ed.sub(ec),e_=Uo(em,em),ey=Uo(em,ef),ex=Uo(ef,ef),ev=Uo(eg,em),eb=Uo(eg,ef),ew=e_*ex-ey*ey,eT=(ex*ev-ey*eb)/ew,eE=(e_*eb-ey*ev)/ew,eS=ec.z*(1-eT-eE)+el.z*eT+ep.z*eE;if(isFinite(eS))return eS}return 1/0}{let V=1/0;for(let el of G)V=Math.min(V,el.z);return V}}let t1=vi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:t2}=t1,t5=vi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:t4}=t5,t3=tJ.VectorTileFeature.types,t6=Math.cos(Math.PI/180*37.5);let Yo=class Yo{constructor(V){this.zoom=V.zoom,this.overscaling=V.overscaling,this.layers=V.layers,this.layerIds=this.layers.map(V=>V.id),this.index=V.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(V=>{this.gradients[V.id]={}}),this.layoutVertexArray=new na,this.layoutVertexArray2=new ia,this.indexArray=new ha,this.programConfigurations=new Ra(V.layers,V.zoom),this.segments=new ya,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(V=>V.isStateDependent()).map(V=>V.id)}populate(V,G,el){this.hasPattern=fo("line",this.layers,G);let eh=this.layers[0].layout.get("line-sort-key"),ec=!eh.isConstant(),ep=[];for(let{feature:G,id:ed,index:em,sourceLayerIndex:ef}of V){let V=this.layers[0]._featureFilter.needGeometry,eg=Ka(G,V);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),eg,el))continue;let e_=ec?eh.evaluate(eg,{},el):void 0,ey={id:ed,properties:G.properties,type:G.type,sourceLayerIndex:ef,index:em,geometry:V?eg.geometry:Za(G),patterns:{},sortKey:e_};ep.push(ey)}for(let eh of(ec&&ep.sort((V,G)=>V.sortKey-G.sortKey),ep)){let{geometry:ec,index:ep,sourceLayerIndex:ed}=eh;if(this.hasPattern){let V=yo("line",this.layers,eh,this.zoom,G);this.patternFeatures.push(V)}else this.addFeature(eh,ec,ep,el,{});G.featureIndex.insert(V[ep].feature,ec,ep,ed,this.index)}}update(V,G,el){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(V,G,this.stateDependentLayers,el)}addFeatures(V,G,el){for(let V of this.patternFeatures)this.addFeature(V,V.geometry,V.index,G,el)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(V){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=V.createVertexBuffer(this.layoutVertexArray2,t4)),this.layoutVertexBuffer=V.createVertexBuffer(this.layoutVertexArray,t2),this.indexBuffer=V.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(V),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(V){if(V.properties&&Object.prototype.hasOwnProperty.call(V.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(V.properties,"mapbox_clip_end"))return{start:+V.properties.mapbox_clip_start,end:+V.properties.mapbox_clip_end}}addFeature(V,G,el,eh,ec){let ep=this.layers[0].layout,ed=ep.get("line-join").evaluate(V,{}),em=ep.get("line-cap"),ef=ep.get("line-miter-limit"),eg=ep.get("line-round-limit");for(let el of(this.lineClips=this.lineFeatureClips(V),G))this.addLine(el,V,ed,em,ef,eg);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,V,el,ec,eh)}addLine(V,G,el,eh,ec,ep){let ed,em,ef,eg,e_;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<V.length-1;G++)this.totalDistance+=V[G].dist(V[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let ey="Polygon"===t3[G.type],ex=V.length;for(;ex>=2&&V[ex-1].equals(V[ex-2]);)ex--;let ev=0;for(;ev<ex-1&&V[ev].equals(V[ev+1]);)ev++;if(ex<(ey?3:2))return;"bevel"===el&&(ec=1.05);let eb=this.overscaling<=16?122880/(512*this.overscaling):0,ew=this.segments.prepareSegment(10*ex,this.layoutVertexArray,this.indexArray);this.e1=this.e2=-1,ey&&(ed=V[ex-2],e_=V[ev].sub(ed)._unit()._perp());for(let G=ev;G<ex;G++){if((ef=G===ex-1?ey?V[ev+1]:void 0:V[G+1])&&V[G].equals(ef))continue;e_&&(eg=e_),ed&&(em=ed),ed=V[G],e_=ef?ef.sub(ed)._unit()._perp():eg;let eT=(eg=eg||e_).add(e_);0===eT.x&&0===eT.y||eT._unit();let eE=eg.x*e_.x+eg.y*e_.y,eS=eT.x*e_.x+eT.y*e_.y,eI=0!==eS?1/eS:1/0,eA=2*Math.sqrt(2-2*eS),eM=eS<t6&&em&&ef,eC=eg.x*e_.y-eg.y*e_.x>0;if(eM&&G>ev){let V=ed.dist(em);if(V>2*eb){let G=ed.sub(ed.sub(em)._mult(eb/V)._round());this.updateDistance(em,G),this.addCurrentVertex(G,eg,0,0,ew),em=G}}let ez=em&&ef,ek=ez?el:ey?"butt":eh;if(ez&&"round"===ek&&(eI<ep?ek="miter":eI<=2&&(ek="fakeround")),"miter"===ek&&eI>ec&&(ek="bevel"),"bevel"===ek&&(eI>2&&(ek="flipbevel"),eI<ec&&(ek="miter")),em&&this.updateDistance(em,ed),"miter"===ek)eT._mult(eI),this.addCurrentVertex(ed,eT,0,0,ew);else if("flipbevel"===ek){if(eI>100)eT=e_.mult(-1);else{let V=eI*eg.add(e_).mag()/eg.sub(e_).mag();eT._perp()._mult(V*(eC?-1:1))}this.addCurrentVertex(ed,eT,0,0,ew),this.addCurrentVertex(ed,eT.mult(-1),0,0,ew)}else if("bevel"===ek||"fakeround"===ek){let V=-Math.sqrt(eI*eI-1),G=eC?V:0,el=eC?0:V;if(em&&this.addCurrentVertex(ed,eg,G,el,ew),"fakeround"===ek){let V=Math.round(180*eA/Math.PI/20);for(let G=1;G<V;G++){let el=G/V;if(.5!==el){let V=el-.5;el+=el*V*(el-1)*((1.0904+eE*(eE*(3.55645-1.43519*eE)-3.2452))*V*V+(.848013+eE*(.215638*eE-1.06021)))}let eh=e_.sub(eg)._mult(el)._add(eg)._unit()._mult(eC?-1:1);this.addHalfVertex(ed,eh.x,eh.y,!1,eC,0,ew)}}ef&&this.addCurrentVertex(ed,e_,-G,-el,ew)}else if("butt"===ek)this.addCurrentVertex(ed,eT,0,0,ew);else if("square"===ek){let V=em?1:-1;this.addCurrentVertex(ed,eT,V,V,ew)}else"round"===ek&&(em&&(this.addCurrentVertex(ed,eg,0,0,ew),this.addCurrentVertex(ed,eg,1,1,ew,!0)),ef&&(this.addCurrentVertex(ed,e_,-1,-1,ew,!0),this.addCurrentVertex(ed,e_,0,0,ew)));if(eM&&G<ex-1){let V=ed.dist(ef);if(V>2*eb){let G=ed.add(ef.sub(ed)._mult(eb/V)._round());this.updateDistance(ed,G),this.addCurrentVertex(G,e_,0,0,ew),ed=G}}}}addCurrentVertex(V,G,el,eh,ec,ep=!1){let ed=G.y*eh-G.x,em=-G.y-G.x*eh;this.addHalfVertex(V,G.x+G.y*el,G.y-G.x*el,ep,!1,el,ec),this.addHalfVertex(V,ed,em,ep,!0,-eh,ec),this.distance>16384&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(V,G,el,eh,ec,ep))}addHalfVertex({x:V,y:G},el,eh,ec,ep,ed,em){let ef=.5*(this.lineClips?32767*this.scaledDistance:this.scaledDistance);this.layoutVertexArray.emplaceBack((V<<1)+(ec?1:0),(G<<1)+(ep?1:0),Math.round(63*el)+128,Math.round(63*eh)+128,1+(0===ed?0:ed<0?-1:1)|(63&ef)<<2,ef>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let eg=em.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,eg),em.primitiveLength++),ep?this.e2=eg:this.e1=eg}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(V,G){this.distance+=V.dist(G),this.updateScaledDistance()}};Mn("LineBucket",Yo,{omit:["layers","patternFeatures"]});let t8=new fi({"line-cap":new li(eD.layout_line["line-cap"]),"line-join":new ui(eD.layout_line["line-join"]),"line-miter-limit":new li(eD.layout_line["line-miter-limit"]),"line-round-limit":new li(eD.layout_line["line-round-limit"]),"line-sort-key":new ui(eD.layout_line["line-sort-key"])});var t9={paint:new fi({"line-opacity":new ui(eD.paint_line["line-opacity"]),"line-color":new ui(eD.paint_line["line-color"]),"line-translate":new li(eD.paint_line["line-translate"]),"line-translate-anchor":new li(eD.paint_line["line-translate-anchor"]),"line-width":new ui(eD.paint_line["line-width"]),"line-gap-width":new ui(eD.paint_line["line-gap-width"]),"line-offset":new ui(eD.paint_line["line-offset"]),"line-blur":new ui(eD.paint_line["line-blur"]),"line-dasharray":new hi(eD.paint_line["line-dasharray"]),"line-pattern":new ci(eD.paint_line["line-pattern"]),"line-gradient":new pi(eD.paint_line["line-gradient"])}),layout:t8};let t7=new class extends ui{possiblyEvaluate(V,G){return G=new Qn(Math.floor(G.zoom),{now:G.now,fadeDuration:G.fadeDuration,zoomHistory:G.zoomHistory,transition:G.transition}),super.possiblyEvaluate(V,G)}evaluate(V,G,el,eh){return G=o({},G,{zoom:Math.floor(G.zoom)}),super.evaluate(V,G,el,eh)}}(t9.paint.properties["line-width"].specification);t7.useIntegerZoom=!0;let ir=vi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),il=vi([{name:"a_projected_pos",components:3,type:"Float32"}],4);vi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let ih=vi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);vi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let ip=vi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),id=vi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);vi([{name:"triangle",components:3,type:"Uint16"}]),vi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),vi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),vi([{type:"Float32",name:"offsetX"}]),vi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);let im={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","\xa2":"￠","\xa3":"￡","\xa5":"￥","\xa6":"￤","\xac":"￢","\xaf":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var cl=function(V,G,el,eh,ec){var ep,ed,em=8*ec-eh-1,ef=(1<<em)-1,eg=ef>>1,e_=-7,ey=el?ec-1:0,ex=el?-1:1,ev=V[G+ey];for(ey+=ex,ep=ev&(1<<-e_)-1,ev>>=-e_,e_+=em;e_>0;ep=256*ep+V[G+ey],ey+=ex,e_-=8);for(ed=ep&(1<<-e_)-1,ep>>=-e_,e_+=eh;e_>0;ed=256*ed+V[G+ey],ey+=ex,e_-=8);if(0===ep)ep=1-eg;else{if(ep===ef)return ed?NaN:1/0*(ev?-1:1);ed+=Math.pow(2,eh),ep-=eg}return(ev?-1:1)*ed*Math.pow(2,ep-eh)},hl=function(V,G,el,eh,ec,ep){var ed,em,ef,eg=8*ep-ec-1,e_=(1<<eg)-1,ey=e_>>1,ex=23===ec?5960464477539062e-23:0,ev=eh?0:ep-1,eb=eh?1:-1,ew=G<0||0===G&&1/G<0?1:0;for(isNaN(G=Math.abs(G))||G===1/0?(em=isNaN(G)?1:0,ed=e_):(ed=Math.floor(Math.log(G)/Math.LN2),G*(ef=Math.pow(2,-ed))<1&&(ed--,ef*=2),(G+=ed+ey>=1?ex/ef:ex*Math.pow(2,1-ey))*ef>=2&&(ed++,ef/=2),ed+ey>=e_?(em=0,ed=e_):ed+ey>=1?(em=(G*ef-1)*Math.pow(2,ec),ed+=ey):(em=G*Math.pow(2,ey-1)*Math.pow(2,ec),ed=0));ec>=8;V[el+ev]=255&em,ev+=eb,em/=256,ec-=8);for(ed=ed<<ec|em,eg+=ec;eg>0;V[el+ev]=255&ed,ev+=eb,ed/=256,eg-=8);V[el+ev-eb]|=128*ew};function pl(V){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(V)?V:new Uint8Array(V||0),this.pos=0,this.type=0,this.length=this.buf.length}pl.Varint=0,pl.Fixed64=1,pl.Bytes=2,pl.Fixed32=5;var ig,i_,iy,ix="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function gl(V){return V.type===pl.Bytes?V.readVarint()+V.pos:V.pos+1}function vl(V,G,el){var eh=G<=16383?1:G<=2097151?2:G<=268435455?3:Math.floor(Math.log(G)/(7*Math.LN2));el.realloc(eh);for(var ec=el.pos-1;ec>=V;ec--)el.buf[ec+eh]=el.buf[ec]}function bl(V,G){for(var el=0;el<V.length;el++)G.writeVarint(V[el])}function wl(V,G){for(var el=0;el<V.length;el++)G.writeSVarint(V[el])}function _l(V,G){for(var el=0;el<V.length;el++)G.writeFloat(V[el])}function Al(V,G){for(var el=0;el<V.length;el++)G.writeDouble(V[el])}function kl(V,G){for(var el=0;el<V.length;el++)G.writeBoolean(V[el])}function Sl(V,G){for(var el=0;el<V.length;el++)G.writeFixed32(V[el])}function Il(V,G){for(var el=0;el<V.length;el++)G.writeSFixed32(V[el])}function Ml(V,G){for(var el=0;el<V.length;el++)G.writeFixed64(V[el])}function zl(V,G){for(var el=0;el<V.length;el++)G.writeSFixed64(V[el])}function Bl(V,G){return(V[G]|V[G+1]<<8|V[G+2]<<16)+16777216*V[G+3]}function Cl(V,G,el){V[el]=G,V[el+1]=G>>>8,V[el+2]=G>>>16,V[el+3]=G>>>24}function Pl(V,G){return(V[G]|V[G+1]<<8|V[G+2]<<16)+(V[G+3]<<24)}function Vl(V,G,el){1===V&&el.readMessage(El,G)}function El(V,G,el){if(3===V){let{id:V,bitmap:eh,width:ec,height:ep,left:ed,top:em,advance:ef}=el.readMessage(Fl,{});G.push({id:V,bitmap:new zs({width:ec+6,height:ep+6},eh),metrics:{width:ec,height:ep,left:ed,top:em,advance:ef}})}}function Fl(V,G,el){1===V?G.id=el.readVarint():2===V?G.bitmap=el.readBytes():3===V?G.width=el.readVarint():4===V?G.height=el.readVarint():5===V?G.left=el.readSVarint():6===V?G.top=el.readSVarint():7===V&&(G.advance=el.readVarint())}function Tl(V){let G=0,el=0;for(let eh of V)G+=eh.w*eh.h,el=Math.max(el,eh.w);V.sort((V,G)=>G.h-V.h);let eh=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(G/.95)),el),h:1/0}],ec=0,ep=0;for(let G of V)for(let V=eh.length-1;V>=0;V--){let el=eh[V];if(!(G.w>el.w||G.h>el.h)){if(G.x=el.x,G.y=el.y,ep=Math.max(ep,G.y+G.h),ec=Math.max(ec,G.x+G.w),G.w===el.w&&G.h===el.h){let G=eh.pop();V<eh.length&&(eh[V]=G)}else G.h===el.h?(el.x+=G.w,el.w-=G.w):(G.w===el.w||eh.push({x:el.x+G.w,y:el.y,w:el.w-G.w,h:G.h}),el.y+=G.h,el.h-=G.h);break}}return{w:ec,h:ep,fill:G/(ec*ep)||0}}pl.prototype={destroy:function(){this.buf=null},readFields:function(V,G,el){for(el=el||this.length;this.pos<el;){var eh=this.readVarint(),ec=eh>>3,ep=this.pos;this.type=7&eh,V(ec,G,this),this.pos===ep&&this.skip(eh)}return G},readMessage:function(V,G){return this.readFields(V,G,this.readVarint()+this.pos)},readFixed32:function(){var V=Bl(this.buf,this.pos);return this.pos+=4,V},readSFixed32:function(){var V=Pl(this.buf,this.pos);return this.pos+=4,V},readFixed64:function(){var V=Bl(this.buf,this.pos)+4294967296*Bl(this.buf,this.pos+4);return this.pos+=8,V},readSFixed64:function(){var V=Bl(this.buf,this.pos)+4294967296*Pl(this.buf,this.pos+4);return this.pos+=8,V},readFloat:function(){var V=cl(this.buf,this.pos,!0,23,4);return this.pos+=4,V},readDouble:function(){var V=cl(this.buf,this.pos,!0,52,8);return this.pos+=8,V},readVarint:function(V){var G,el,eh=this.buf;return G=127&(el=eh[this.pos++]),el<128?G:(G|=(127&(el=eh[this.pos++]))<<7,el<128?G:(G|=(127&(el=eh[this.pos++]))<<14,el<128?G:(G|=(127&(el=eh[this.pos++]))<<21,el<128?G:function(V,G,el){var eh,ec,ep,ed=el.buf;if(ec=(112&(ep=ed[el.pos++]))>>4,ep<128||(ec|=(127&(ep=ed[el.pos++]))<<3,ep<128)||(ec|=(127&(ep=ed[el.pos++]))<<10,ep<128)||(ec|=(127&(ep=ed[el.pos++]))<<17,ep<128)||(ec|=(127&(ep=ed[el.pos++]))<<24,ep<128)||(ec|=(1&(ep=ed[el.pos++]))<<31,ep<128))return eh=ec,G?4294967296*eh+(V>>>0):4294967296*(eh>>>0)+(V>>>0);throw Error("Expected varint not more than 10 bytes")}(G|=(15&(el=eh[this.pos]))<<28,V,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var V=this.readVarint();return V%2==1?-((V+1)/2):V/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var V,G=this.readVarint()+this.pos,el=this.pos;return this.pos=G,G-el>=12&&ix?(V=this.buf,ix.decode(V.subarray(el,G))):function(V,G,el){for(var eh="",ec=G;ec<el;){var ep,ed,em,ef=V[ec],eg=null,e_=ef>239?4:ef>223?3:ef>191?2:1;if(ec+e_>el)break;1===e_?ef<128&&(eg=ef):2===e_?128==(192&(ep=V[ec+1]))&&(eg=(31&ef)<<6|63&ep)<=127&&(eg=null):3===e_?(ed=V[ec+2],128==(192&(ep=V[ec+1]))&&128==(192&ed)&&((eg=(15&ef)<<12|(63&ep)<<6|63&ed)<=2047||eg>=55296&&eg<=57343)&&(eg=null)):4===e_&&(ed=V[ec+2],em=V[ec+3],128==(192&(ep=V[ec+1]))&&128==(192&ed)&&128==(192&em)&&((eg=(15&ef)<<18|(63&ep)<<12|(63&ed)<<6|63&em)<=65535||eg>=1114112)&&(eg=null)),null===eg?(eg=65533,e_=1):eg>65535&&(eg-=65536,eh+=String.fromCharCode(eg>>>10&1023|55296),eg=56320|1023&eg),eh+=String.fromCharCode(eg),ec+=e_}return eh}(this.buf,el,G)},readBytes:function(){var V=this.readVarint()+this.pos,G=this.buf.subarray(this.pos,V);return this.pos=V,G},readPackedVarint:function(V,G){if(this.type!==pl.Bytes)return V.push(this.readVarint(G));var el=gl(this);for(V=V||[];this.pos<el;)V.push(this.readVarint(G));return V},readPackedSVarint:function(V){if(this.type!==pl.Bytes)return V.push(this.readSVarint());var G=gl(this);for(V=V||[];this.pos<G;)V.push(this.readSVarint());return V},readPackedBoolean:function(V){if(this.type!==pl.Bytes)return V.push(this.readBoolean());var G=gl(this);for(V=V||[];this.pos<G;)V.push(this.readBoolean());return V},readPackedFloat:function(V){if(this.type!==pl.Bytes)return V.push(this.readFloat());var G=gl(this);for(V=V||[];this.pos<G;)V.push(this.readFloat());return V},readPackedDouble:function(V){if(this.type!==pl.Bytes)return V.push(this.readDouble());var G=gl(this);for(V=V||[];this.pos<G;)V.push(this.readDouble());return V},readPackedFixed32:function(V){if(this.type!==pl.Bytes)return V.push(this.readFixed32());var G=gl(this);for(V=V||[];this.pos<G;)V.push(this.readFixed32());return V},readPackedSFixed32:function(V){if(this.type!==pl.Bytes)return V.push(this.readSFixed32());var G=gl(this);for(V=V||[];this.pos<G;)V.push(this.readSFixed32());return V},readPackedFixed64:function(V){if(this.type!==pl.Bytes)return V.push(this.readFixed64());var G=gl(this);for(V=V||[];this.pos<G;)V.push(this.readFixed64());return V},readPackedSFixed64:function(V){if(this.type!==pl.Bytes)return V.push(this.readSFixed64());var G=gl(this);for(V=V||[];this.pos<G;)V.push(this.readSFixed64());return V},skip:function(V){var G=7&V;if(G===pl.Varint)for(;this.buf[this.pos++]>127;);else if(G===pl.Bytes)this.pos=this.readVarint()+this.pos;else if(G===pl.Fixed32)this.pos+=4;else{if(G!==pl.Fixed64)throw Error("Unimplemented type: "+G);this.pos+=8}},writeTag:function(V,G){this.writeVarint(V<<3|G)},realloc:function(V){for(var G=this.length||16;G<this.pos+V;)G*=2;if(G!==this.length){var el=new Uint8Array(G);el.set(this.buf),this.buf=el,this.length=G}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(V){this.realloc(4),Cl(this.buf,V,this.pos),this.pos+=4},writeSFixed32:function(V){this.realloc(4),Cl(this.buf,V,this.pos),this.pos+=4},writeFixed64:function(V){this.realloc(8),Cl(this.buf,-1&V,this.pos),Cl(this.buf,Math.floor(23283064365386963e-26*V),this.pos+4),this.pos+=8},writeSFixed64:function(V){this.realloc(8),Cl(this.buf,-1&V,this.pos),Cl(this.buf,Math.floor(23283064365386963e-26*V),this.pos+4),this.pos+=8},writeVarint:function(V){(V=+V||0)>268435455||V<0?function(V,G){var el,eh,ec,ep,ed;if(V>=0?(el=V%4294967296|0,eh=V/4294967296|0):(eh=~(-V/4294967296),4294967295^(el=~(-V%4294967296))?el=el+1|0:(el=0,eh=eh+1|0)),V>=18446744073709552e3||V<-18446744073709552e3)throw Error("Given varint doesn't fit into 10 bytes");G.realloc(10),ec=el,G.buf[G.pos++]=127&ec|128,ec>>>=7,G.buf[G.pos++]=127&ec|128,ec>>>=7,G.buf[G.pos++]=127&ec|128,ec>>>=7,G.buf[G.pos++]=127&ec|128,G.buf[G.pos]=127&(ec>>>=7),ed=(7&(ep=eh))<<4,G.buf[G.pos++]|=ed|((ep>>>=3)?128:0),ep&&(G.buf[G.pos++]=127&ep|((ep>>>=7)?128:0),ep&&(G.buf[G.pos++]=127&ep|((ep>>>=7)?128:0),ep&&(G.buf[G.pos++]=127&ep|((ep>>>=7)?128:0),ep&&(G.buf[G.pos++]=127&ep|((ep>>>=7)?128:0),ep&&(G.buf[G.pos++]=127&ep)))))}(V,this):(this.realloc(4),this.buf[this.pos++]=127&V|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=V>>>7&127))))},writeSVarint:function(V){this.writeVarint(V<0?-(2*V)-1:2*V)},writeBoolean:function(V){this.writeVarint(!!V)},writeString:function(V){V=String(V),this.realloc(4*V.length),this.pos++;var G=this.pos;this.pos=function(V,G,el){for(var eh,ec,ep=0;ep<G.length;ep++){if((eh=G.charCodeAt(ep))>55295&&eh<57344){if(!ec){eh>56319||ep+1===G.length?(V[el++]=239,V[el++]=191,V[el++]=189):ec=eh;continue}if(eh<56320){V[el++]=239,V[el++]=191,V[el++]=189,ec=eh;continue}eh=ec-55296<<10|eh-56320|65536,ec=null}else ec&&(V[el++]=239,V[el++]=191,V[el++]=189,ec=null);eh<128?V[el++]=eh:(eh<2048?V[el++]=eh>>6|192:(eh<65536?V[el++]=eh>>12|224:(V[el++]=eh>>18|240,V[el++]=eh>>12&63|128),V[el++]=eh>>6&63|128),V[el++]=63&eh|128)}return el}(this.buf,V,this.pos);var el=this.pos-G;el>=128&&vl(G,el,this),this.pos=G-1,this.writeVarint(el),this.pos+=el},writeFloat:function(V){this.realloc(4),hl(this.buf,V,this.pos,!0,23,4),this.pos+=4},writeDouble:function(V){this.realloc(8),hl(this.buf,V,this.pos,!0,52,8),this.pos+=8},writeBytes:function(V){var G=V.length;this.writeVarint(G),this.realloc(G);for(var el=0;el<G;el++)this.buf[this.pos++]=V[el]},writeRawMessage:function(V,G){this.pos++;var el=this.pos;V(G,this);var eh=this.pos-el;eh>=128&&vl(el,eh,this),this.pos=el-1,this.writeVarint(eh),this.pos+=eh},writeMessage:function(V,G,el){this.writeTag(V,pl.Bytes),this.writeRawMessage(G,el)},writePackedVarint:function(V,G){G.length&&this.writeMessage(V,bl,G)},writePackedSVarint:function(V,G){G.length&&this.writeMessage(V,wl,G)},writePackedBoolean:function(V,G){G.length&&this.writeMessage(V,kl,G)},writePackedFloat:function(V,G){G.length&&this.writeMessage(V,_l,G)},writePackedDouble:function(V,G){G.length&&this.writeMessage(V,Al,G)},writePackedFixed32:function(V,G){G.length&&this.writeMessage(V,Sl,G)},writePackedSFixed32:function(V,G){G.length&&this.writeMessage(V,Il,G)},writePackedFixed64:function(V,G){G.length&&this.writeMessage(V,Ml,G)},writePackedSFixed64:function(V,G){G.length&&this.writeMessage(V,zl,G)},writeBytesField:function(V,G){this.writeTag(V,pl.Bytes),this.writeBytes(G)},writeFixed32Field:function(V,G){this.writeTag(V,pl.Fixed32),this.writeFixed32(G)},writeSFixed32Field:function(V,G){this.writeTag(V,pl.Fixed32),this.writeSFixed32(G)},writeFixed64Field:function(V,G){this.writeTag(V,pl.Fixed64),this.writeFixed64(G)},writeSFixed64Field:function(V,G){this.writeTag(V,pl.Fixed64),this.writeSFixed64(G)},writeVarintField:function(V,G){this.writeTag(V,pl.Varint),this.writeVarint(G)},writeSVarintField:function(V,G){this.writeTag(V,pl.Varint),this.writeSVarint(G)},writeStringField:function(V,G){this.writeTag(V,pl.Bytes),this.writeString(G)},writeFloatField:function(V,G){this.writeTag(V,pl.Fixed32),this.writeFloat(G)},writeDoubleField:function(V,G){this.writeTag(V,pl.Fixed64),this.writeDouble(G)},writeBooleanField:function(V,G){this.writeVarintField(V,!!G)}};let Ll=class Ll{constructor(V,{pixelRatio:G,version:el,stretchX:eh,stretchY:ec,content:ep}){this.paddedRect=V,this.pixelRatio=G,this.stretchX=eh,this.stretchY=ec,this.content=ep,this.version=el}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}};let Dl=class Dl{constructor(V,G){let el={},eh={};this.haveRenderCallbacks=[];let ec=[];this.addImages(V,el,ec),this.addImages(G,eh,ec);let{w:ep,h:ed}=Tl(ec),em=new Bs({width:ep||1,height:ed||1});for(let G in V){let eh=V[G],ec=el[G].paddedRect;Bs.copy(eh.data,em,{x:0,y:0},{x:ec.x+1,y:ec.y+1},eh.data)}for(let V in G){let el=G[V],ec=eh[V].paddedRect,ep=ec.x+1,ed=ec.y+1,ef=el.data.width,eg=el.data.height;Bs.copy(el.data,em,{x:0,y:0},{x:ep,y:ed},el.data),Bs.copy(el.data,em,{x:0,y:eg-1},{x:ep,y:ed-1},{width:ef,height:1}),Bs.copy(el.data,em,{x:0,y:0},{x:ep,y:ed+eg},{width:ef,height:1}),Bs.copy(el.data,em,{x:ef-1,y:0},{x:ep-1,y:ed},{width:1,height:eg}),Bs.copy(el.data,em,{x:0,y:0},{x:ep+ef,y:ed},{width:1,height:eg})}this.image=em,this.iconPositions=el,this.patternPositions=eh}addImages(V,G,el){for(let eh in V){let ec=V[eh],ep={x:0,y:0,w:ec.data.width+2,h:ec.data.height+2};el.push(ep),G[eh]=new Ll(ep,ec),ec.hasRenderCallback&&this.haveRenderCallbacks.push(eh)}}patchUpdatedImages(V,G){for(let el in V.dispatchRenderCallbacks(this.haveRenderCallbacks),V.updatedImages)this.patchUpdatedImage(this.iconPositions[el],V.getImage(el),G),this.patchUpdatedImage(this.patternPositions[el],V.getImage(el),G)}patchUpdatedImage(V,G,el){if(!V||!G||V.version===G.version)return;V.version=G.version;let[eh,ec]=V.tl;el.update(G.data,void 0,{x:eh,y:ec})}};Mn("ImagePosition",Ll),Mn("ImageAtlas",Dl),V.WritingMode=void 0,(iy=V.WritingMode||(V.WritingMode={}))[iy.none=0]="none",iy[iy.horizontal=1]="horizontal",iy[iy.vertical=2]="vertical",iy[iy.horizontalOnly=3]="horizontalOnly";let Rl=class Rl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(V,G){let el=new Rl;return el.scale=V||1,el.fontStack=G,el}static forImage(V){let G=new Rl;return G.imageName=V,G}};let Ol=class Ol{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(V,G){let el=new Ol;for(let eh=0;eh<V.sections.length;eh++){let ec=V.sections[eh];ec.image?el.addImageSection(ec):el.addTextSection(ec,G)}return el}length(){return this.text.length}getSection(V){return this.sections[this.sectionIndex[V]]}getSectionIndex(V){return this.sectionIndex[V]}getCharCode(V){return this.text.charCodeAt(V)}verticalizePunctuation(){this.text=function(V){let G="";for(let el=0;el<V.length;el++){let eh=V.charCodeAt(el+1)||null,ec=V.charCodeAt(el-1)||null;G+=eh&&Dn(eh)&&!im[V[el+1]]||ec&&Dn(ec)&&!im[V[el-1]]||!im[V[el]]?V[el]:im[V[el]]}return G}(this.text)}trim(){let V=0;for(let G=0;G<this.text.length&&iv[this.text.charCodeAt(G)];G++)V++;let G=this.text.length;for(let el=this.text.length-1;el>=0&&el>=V&&iv[this.text.charCodeAt(el)];el--)G--;this.text=this.text.substring(V,G),this.sectionIndex=this.sectionIndex.slice(V,G)}substring(V,G){let el=new Ol;return el.text=this.text.substring(V,G),el.sectionIndex=this.sectionIndex.slice(V,G),el.sections=this.sections,el}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((V,G)=>Math.max(V,this.sections[G].scale),0)}addTextSection(V,G){this.text+=V.text,this.sections.push(Rl.forText(V.scale,V.fontStack||G));let el=this.sections.length-1;for(let G=0;G<V.text.length;++G)this.sectionIndex.push(el)}addImageSection(V){let G=V.image?V.image.name:"";if(0===G.length)return void d("Can't add FormattedSection with an empty image.");let el=this.getNextImageSectionCharCode();el?(this.text+=String.fromCharCode(el),this.sections.push(Rl.forImage(G)),this.sectionIndex.push(this.sections.length-1)):d("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}};function Ul(G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew,eT){let eE;let eS=Ol.fromFeature(G,ep);ex===V.WritingMode.vertical&&eS.verticalizePunctuation();let{processBidirectionalText:eI,processStyledBidirectionalText:eA}=tI;if(eI&&1===eS.sections.length){eE=[];let V=eI(eS.toString(),Xl(eS,e_,ed,el,ec,eb,ew));for(let G of V){let V=new Ol;V.text=G,V.sections=eS.sections;for(let el=0;el<G.length;el++)V.sectionIndex.push(0);eE.push(V)}}else if(eA){eE=[];let V=eA(eS.text,eS.sectionIndex,Xl(eS,e_,ed,el,ec,eb,ew));for(let G of V){let V=new Ol;V.text=G[0],V.sectionIndex=G[1],V.sections=eS.sections,eE.push(V)}}else eE=function(V,G){let el=[],eh=V.text,ec=0;for(let eh of G)el.push(V.substring(ec,eh)),ec=eh;return ec<eh.length&&el.push(V.substring(ec,eh.length)),el}(eS,Xl(eS,e_,ed,el,ec,eb,ew));let eM=[],eC={positionedLines:eM,text:eS.toString(),top:ey[1],bottom:ey[1],left:ey[0],right:ey[0],writingMode:ex,iconsInText:!1,verticalizable:!1};return function(G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex){let ev=0,eb=-17,ew=0,eT=0,eE="right"===ef?1:"left"===ef?0:.5,eS=0;for(let em of ep){em.trim();let ep=em.getMaxScale(),ef=(ep-1)*24,eI={positionedGlyphs:[],lineOffset:0};G.positionedLines[eS]=eI;let eA=eI.positionedGlyphs,eM=0;if(!em.length()){eb+=ed,++eS;continue}for(let ed=0;ed<em.length();ed++){let ew=em.getSection(ed),eT=em.getSectionIndex(ed),eE=em.getCharCode(ed),eS=0,eI=null,eC=null,ez=null,ek=24,eP=!(eg===V.WritingMode.horizontal||!ey&&!Ln(eE)||ey&&(iv[eE]||ty.Arabic(eE)||ty["Arabic Supplement"](eE)||ty["Arabic Extended-A"](eE)||ty["Arabic Presentation Forms-A"](eE)||ty["Arabic Presentation Forms-B"](eE)));if(ew.imageName){let V=ec[ew.imageName];if(!V)continue;ez=ew.imageName,G.iconsInText=G.iconsInText||!0,eC=V.paddedRect;let el=V.displaySize;ew.scale=24*ew.scale/ex,eI={width:el[0],height:el[1],left:1,top:-3,advance:eP?el[1]:el[0]},eS=ef+(24-el[1]*ew.scale),ek=eI.advance;let eh=eP?el[0]*ew.scale-24*ep:el[1]*ew.scale-24*ep;eh>0&&eh>eM&&(eM=eh)}else{let V=eh[ew.fontStack],G=V&&V[eE];if(G&&G.rect)eC=G.rect,eI=G.metrics;else{let V=el[ew.fontStack],G=V&&V[eE];if(!G)continue;eI=G.metrics}eS=(ep-ew.scale)*24}eP?(G.verticalizable=!0,eA.push({glyph:eE,imageName:ez,x:ev,y:eb+eS,vertical:eP,scale:ew.scale,fontStack:ew.fontStack,sectionIndex:eT,metrics:eI,rect:eC}),ev+=ek*ew.scale+e_):(eA.push({glyph:eE,imageName:ez,x:ev,y:eb+eS,vertical:eP,scale:ew.scale,fontStack:ew.fontStack,sectionIndex:eT,metrics:eI,rect:eC}),ev+=eI.advance*ew.scale+e_)}0!==eA.length&&(ew=Math.max(ev-e_,ew),function(V,G,el,eh,ec){if(!eh&&!ec)return;let ep=V[el],ed=(V[el].x+ep.metrics.advance*ep.scale)*eh;for(let G=0;G<=el;G++)V[G].x-=ed,V[G].y+=ec}(eA,0,eA.length-1,eE,eM)),ev=0;let eC=ed*ep+eM;eI.lineOffset=Math.max(eM,ef),eb+=eC,eT=Math.max(eC,eT),++eS}let eI=eb- -17,{horizontalAlign:eA,verticalAlign:eM}=Yl(em);(function(V,G,el,eh,ec,ep,ed,em,ef){let eg=(G-el)*ec,e_=0;for(let G of(e_=ep!==ed?-em*eh- -17:(-eh*ef+.5)*ed,V))for(let V of G.positionedGlyphs)V.x+=eg,V.y+=e_})(G.positionedLines,eE,eA,eM,ew,eT,ed,eI,ep.length),G.top+=-eM*eI,G.bottom=G.top+eI,G.left+=-eA*ew,G.right=G.left+ew}(eC,el,eh,ec,eE,em,ef,eg,ex,e_,ev,eT),!function(V){for(let G of V)if(0!==G.positionedGlyphs.length)return!1;return!0}(eM)&&eC}let iv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ib={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Nl(V,G,el,eh,ec,ep){if(G.imageName){let V=eh[G.imageName];return V?V.displaySize[0]*G.scale*24/ep+ec:0}{let eh=el[G.fontStack],ep=eh&&eh[V];return ep?ep.metrics.advance*G.scale+ec:0}}function Zl(V,G,el,eh){let ec=Math.pow(V-G,2);return eh?V<G?ec/2:2*ec:ec+Math.abs(el)*el}function Gl(V,G,el,eh,ec,ep){let ed=null,em=Zl(G,el,ec,ep);for(let V of eh){let eh=Zl(G-V.x,el,ec,ep)+V.badness;eh<=em&&(ed=V,em=eh)}return{index:V,x:G,priorBreak:ed,badness:em}}function Xl(V,G,el,eh,ec,ep,ed){if("point"!==ep||!V)return[];let em=[],ef=function(V,G,el,eh,ec,ep){let ed=0;for(let el=0;el<V.length();el++){let em=V.getSection(el);ed+=Nl(V.getCharCode(el),em,eh,ec,G,ep)}return ed/Math.max(1,Math.ceil(ed/el))}(V,G,el,eh,ec,ed),eg=V.text.indexOf("​")>=0,e_=0;for(let el=0;el<V.length();el++){let ep=V.getSection(el),ey=V.getCharCode(el);if(iv[ey]||(e_+=Nl(ey,ep,eh,ec,G,ed)),el<V.length()-1){let G=!(ey<11904||!(ty["Bopomofo Extended"](ey)||ty.Bopomofo(ey)||ty["CJK Compatibility Forms"](ey)||ty["CJK Compatibility Ideographs"](ey)||ty["CJK Compatibility"](ey)||ty["CJK Radicals Supplement"](ey)||ty["CJK Strokes"](ey)||ty["CJK Symbols and Punctuation"](ey)||ty["CJK Unified Ideographs Extension A"](ey)||ty["CJK Unified Ideographs"](ey)||ty["Enclosed CJK Letters and Months"](ey)||ty["Halfwidth and Fullwidth Forms"](ey)||ty.Hiragana(ey)||ty["Ideographic Description Characters"](ey)||ty["Kangxi Radicals"](ey)||ty["Katakana Phonetic Extensions"](ey)||ty.Katakana(ey)||ty["Vertical Forms"](ey)||ty["Yi Radicals"](ey)||ty["Yi Syllables"](ey)));(ib[ey]||G||ep.imageName)&&em.push(Gl(el+1,e_,ef,em,function(V,G,el){let eh=0;return 10===V&&(eh-=1e4),el&&(eh+=150),40!==V&&65288!==V||(eh+=50),41!==G&&65289!==G||(eh+=50),eh}(ey,V.getCharCode(el+1),G&&eg),!1))}}return function Jl(V){return V?Jl(V.priorBreak).concat(V.index):[]}(Gl(V.length(),e_,ef,em,0,!0))}function Yl(V){let G=.5,el=.5;switch(V){case"right":case"top-right":case"bottom-right":G=1;break;case"left":case"top-left":case"bottom-left":G=0}switch(V){case"bottom":case"bottom-right":case"bottom-left":el=1;break;case"top":case"top-right":case"top-left":el=0}return{horizontalAlign:G,verticalAlign:el}}function Ql(V,G,el,eh,ec,ep){let ed,em,ef,eg,e_;let ey=V.image;if(ey.content){let V=ey.content,G=ey.pixelRatio||1;ed=[V[0]/G,V[1]/G,ey.displaySize[0]-V[2]/G,ey.displaySize[1]-V[3]/G]}let ex=G.left*ep,ev=G.right*ep;"width"===el||"both"===el?(e_=ec[0]+ex-eh[3],ef=ec[0]+ev+eh[1]):ef=(e_=ec[0]+(ex+ev-ey.displaySize[0])/2)+ey.displaySize[0];let eb=G.top*ep,ew=G.bottom*ep;return"height"===el||"both"===el?(em=ec[1]+eb-eh[0],eg=ec[1]+ew+eh[2]):eg=(em=ec[1]+(eb+ew-ey.displaySize[1])/2)+ey.displaySize[1],{image:ey,top:em,right:ef,bottom:eg,left:e_,collisionPadding:ed}}function eu(V,G){let{expression:el}=G;if("constant"===el.kind)return{kind:"constant",layoutSize:el.evaluate(new Qn(V+1))};if("source"===el.kind)return{kind:"source"};{let{zoomStops:G,interpolationType:eh}=el,ec=0;for(;ec<G.length&&G[ec]<=V;)ec++;let ep=ec=Math.max(0,ec-1);for(;ep<G.length&&G[ep]<V+1;)ep++;ep=Math.min(G.length-1,ep);let ed=G[ec],em=G[ep];return"composite"===el.kind?{kind:"composite",minZoom:ed,maxZoom:em,interpolationType:eh}:{kind:"camera",minZoom:ed,maxZoom:em,minSize:el.evaluate(new Qn(ed)),maxSize:el.evaluate(new Qn(em)),interpolationType:eh}}}let ru=class ru extends e_{constructor(V,G,el,eh){super(V,G),this.angle=el,void 0!==eh&&(this.segment=eh)}clone(){return new ru(this.x,this.y,this.angle,this.segment)}};function nu(V,G,el,eh,ec){if(void 0===G.segment)return!0;let ep=G,ed=G.segment+1,em=0;for(;em>-el/2;){if(--ed<0)return!1;em-=V[ed].dist(ep),ep=V[ed]}em+=V[ed].dist(V[ed+1]),ed++;let ef=[],eg=0;for(;em<el/2;){let G=V[ed],el=V[ed+1];if(!el)return!1;let ep=V[ed-1].angleTo(G)-G.angleTo(el);for(ep=Math.abs((ep+3*Math.PI)%(2*Math.PI)-Math.PI),ef.push({distance:em,angleDelta:ep}),eg+=ep;em-ef[0].distance>eh;)eg-=ef.shift().angleDelta;if(eg>ec)return!1;ed++,em+=G.dist(el)}return!0}function iu(V){let G=0;for(let el=0;el<V.length-1;el++)G+=V[el].dist(V[el+1]);return G}function su(V,G){return Math.max(V?V.right-V.left:0,G?G.right-G.left:0)}function cu(V,G,el,eh,ec){let ep=[];for(let ed=0;ed<V.length;ed++){let em;let ef=V[ed];for(let V=0;V<ef.length-1;V++){let ed=ef[V],eg=ef[V+1];ed.x<G&&eg.x<G||(ed.x<G?ed=new e_(G,ed.y+(G-ed.x)/(eg.x-ed.x)*(eg.y-ed.y))._round():eg.x<G&&(eg=new e_(G,ed.y+(G-ed.x)/(eg.x-ed.x)*(eg.y-ed.y))._round()),ed.y<el&&eg.y<el||(ed.y<el?ed=new e_(ed.x+(el-ed.y)/(eg.y-ed.y)*(eg.x-ed.x),el)._round():eg.y<el&&(eg=new e_(ed.x+(el-ed.y)/(eg.y-ed.y)*(eg.x-ed.x),el)._round()),ed.x>=eh&&eg.x>=eh||(ed.x>=eh?ed=new e_(eh,ed.y+(eh-ed.x)/(eg.x-ed.x)*(eg.y-ed.y))._round():eg.x>=eh&&(eg=new e_(eh,ed.y+(eh-ed.x)/(eg.x-ed.x)*(eg.y-ed.y))._round()),ed.y>=ec&&eg.y>=ec||(ed.y>=ec?ed=new e_(ed.x+(ec-ed.y)/(eg.y-ed.y)*(eg.x-ed.x),ec)._round():eg.y>=ec&&(eg=new e_(ed.x+(ec-ed.y)/(eg.y-ed.y)*(eg.x-ed.x),ec)._round()),em&&ed.equals(em[em.length-1])||(em=[ed],ep.push(em)),em.push(eg)))))}}return ep}function hu(V,G,el,eh){let ec=[],ep=V.image,ed=ep.pixelRatio,em=ep.paddedRect.w-2,ef=ep.paddedRect.h-2,eg=V.right-V.left,ey=V.bottom-V.top,ex=ep.stretchX||[[0,em]],ev=ep.stretchY||[[0,ef]],f=(V,G)=>V+G[1]-G[0],eb=ex.reduce(f,0),ew=ev.reduce(f,0),eT=em-eb,eE=ef-ew,eS=0,eI=eb,eA=0,eM=ew,eC=0,ez=eT,ek=0,eP=eE;if(ep.content&&eh){let V=ep.content;eS=pu(ex,0,V[0]),eA=pu(ev,0,V[1]),eI=pu(ex,V[0],V[2]),eM=pu(ev,V[1],V[3]),eC=V[0]-eS,ek=V[1]-eA,ez=V[2]-V[0]-eI,eP=V[3]-V[1]-eM}let M=(eh,ec,em,ef)=>{var ex,ev,eT,eE,eD,eL,eR,eB,eF,eO,eU,eV;let eN=(eh.stretch-eS)/eI*eg+V.left,e$=(eT=eh.fixed-eC,eT-ez*eh.stretch/eb),eq=(ec.stretch-eA)/eM*ey+V.top,eG=(eL=ec.fixed-ek,eL-eP*ec.stretch/ew),eZ=(em.stretch-eS)/eI*eg+V.left,ej=(eF=em.fixed-eC,eF-ez*em.stretch/eb),eX=(ef.stretch-eA)/eM*ey+V.top,eW=(eV=ef.fixed-ek,eV-eP*ef.stretch/ew),eH=new e_(eN,eq),eK=new e_(eZ,eq),eY=new e_(eZ,eX),eJ=new e_(eN,eX),eQ=new e_(e$/ed,eG/ed),e0=new e_(ej/ed,eW/ed),e1=G*Math.PI/180;if(e1){let V=Math.sin(e1),G=Math.cos(e1),el=[G,-V,V,G];eH._matMult(el),eK._matMult(el),eJ._matMult(el),eY._matMult(el)}let e2=eh.stretch+eh.fixed,e5=ec.stretch+ec.fixed;return{tl:eH,tr:eK,bl:eJ,br:eY,tex:{x:ep.paddedRect.x+1+e2,y:ep.paddedRect.y+1+e5,w:em.stretch+em.fixed-e2,h:ef.stretch+ef.fixed-e5},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:eQ,pixelOffsetBR:e0,minFontScaleX:ez/ed/eg,minFontScaleY:eP/ed/ey,isSDF:el}};if(eh&&(ep.stretchX||ep.stretchY)){let V=fu(ex,eT,eb),G=fu(ev,eE,ew);for(let el=0;el<V.length-1;el++){let eh=V[el],ep=V[el+1];for(let V=0;V<G.length-1;V++)ec.push(M(eh,G[V],ep,G[V+1]))}}else ec.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:em+1},{fixed:0,stretch:ef+1}));return ec}function pu(V,G,el){let eh=0;for(let ec of V)eh+=Math.max(G,Math.min(el,ec[1]))-Math.max(G,Math.min(el,ec[0]));return eh}function fu(V,G,el){let eh=[{fixed:-1,stretch:0}];for(let[G,el]of V){let V=eh[eh.length-1];eh.push({fixed:G-V.stretch,stretch:V.stretch}),eh.push({fixed:G-V.stretch,stretch:V.stretch+(el-G)})}return eh.push({fixed:G+1,stretch:el}),eh}Mn("Anchor",ru);let mu=class mu{constructor(V,G,el,eh,ec,ep,ed,em,ef,eg){if(this.boxStartIndex=V.length,ef){let V=ep.top,G=ep.bottom,el=ep.collisionPadding;el&&(V-=el[1],G+=el[3]);let eh=G-V;eh>0&&(eh=Math.max(10,eh),this.circleDiameter=eh)}else{let ef=ep.top*ed-em[0],ey=ep.bottom*ed+em[2],ex=ep.left*ed-em[3],ev=ep.right*ed+em[1],eb=ep.collisionPadding;if(eb&&(ex-=eb[0]*ed,ef-=eb[1]*ed,ev+=eb[2]*ed,ey+=eb[3]*ed),eg){let V=new e_(ex,ef),G=new e_(ev,ef),el=new e_(ex,ey),eh=new e_(ev,ey),ec=eg*Math.PI/180;V._rotate(ec),G._rotate(ec),el._rotate(ec),eh._rotate(ec),ex=Math.min(V.x,G.x,el.x,eh.x),ev=Math.max(V.x,G.x,el.x,eh.x),ef=Math.min(V.y,G.y,el.y,eh.y),ey=Math.max(V.y,G.y,el.y,eh.y)}V.emplaceBack(G.x,G.y,ex,ef,ev,ey,el,eh,ec)}this.boxEndIndex=V.length}};let gu=class gu{constructor(V=[],G=xu){if(this.data=V,this.length=this.data.length,this.compare=G,this.length>0)for(let V=(this.length>>1)-1;V>=0;V--)this._down(V)}push(V){this.data.push(V),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;let V=this.data[0],G=this.data.pop();return this.length--,this.length>0&&(this.data[0]=G,this._down(0)),V}peek(){return this.data[0]}_up(V){let{data:G,compare:el}=this,eh=G[V];for(;V>0;){let ec=V-1>>1,ep=G[ec];if(el(eh,ep)>=0)break;G[V]=ep,V=ec}G[V]=eh}_down(V){let{data:G,compare:el}=this,eh=this.length>>1,ec=G[V];for(;V<eh;){let eh=1+(V<<1),ep=G[eh],ed=eh+1;if(ed<this.length&&0>el(G[ed],ep)&&(eh=ed,ep=G[ed]),el(ep,ec)>=0)break;G[V]=ep,V=eh}G[V]=ec}};function xu(V,G){return V<G?-1:V>G?1:0}function bu(V,G){return G.max-V.max}function wu(V,G,el,eh){this.p=new e_(V,G),this.h=el,this.d=function(V,G){let el=!1,eh=1/0;for(let ec=0;ec<G.length;ec++){let ep=G[ec];for(let G=0,ec=ep.length,ed=ec-1;G<ec;ed=G++){let ec=ep[G],em=ep[ed];ec.y>V.y!=em.y>V.y&&V.x<(em.x-ec.x)*(V.y-ec.y)/(em.y-ec.y)+ec.x&&(el=!el),eh=Math.min(eh,rs(V,ec,em))}}return(el?1:-1)*Math.sqrt(eh)}(this.p,eh),this.max=this.d+this.h*Math.SQRT2}let iw=Number.POSITIVE_INFINITY;function Au(V,G){return G[1]!==iw?function(V,G,el){let eh=0,ec=0;switch(G=Math.abs(G),el=Math.abs(el),V){case"top-right":case"top-left":case"top":ec=el-7;break;case"bottom-right":case"bottom-left":case"bottom":ec=7-el}switch(V){case"top-right":case"bottom-right":case"right":eh=-G;break;case"top-left":case"bottom-left":case"left":eh=G}return[eh,ec]}(V,G[0],G[1]):function(V,G){let el=0,eh=0;G<0&&(G=0);let ec=G/Math.sqrt(2);switch(V){case"top-right":case"top-left":eh=ec-7;break;case"bottom-right":case"bottom-left":eh=7-ec;break;case"bottom":eh=7-G;break;case"top":eh=G-7}switch(V){case"top-right":case"bottom-right":el=-ec;break;case"top-left":case"bottom-left":el=ec;break;case"left":el=G;break;case"right":el=-G}return[el,eh]}(V,G[0])}function ku(V){switch(V){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Mu(V,G,el,eh,ec,ep,ed,em,ef,eg,ey,ex,ev,eb,ew){let eT=function(V,G,el,eh,ec,ep,ed,em){let ef=eh.layout.get("text-rotate").evaluate(ep,{})*Math.PI/180,eg=[];for(let V of G.positionedLines)for(let eh of V.positionedGlyphs){if(!eh.rect)continue;let ep=eh.rect||{},ey=4,ex=!0,ev=1,eb=0,ew=(ec||em)&&eh.vertical,eT=eh.metrics.advance*eh.scale/2;if(em&&G.verticalizable){let G=(eh.scale-1)*24,el=(24-eh.metrics.width*eh.scale)/2;eb=V.lineOffset/2-(eh.imageName?-el:G)}if(eh.imageName){let V=ed[eh.imageName];ex=V.sdf,ey=1/(ev=V.pixelRatio)}let eE=ec?[eh.x+eT,eh.y]:[0,0],eS=ec?[0,0]:[eh.x+eT+el[0],eh.y+el[1]-eb],eI=[0,0];ew&&(eI=eS,eS=[0,0]);let eA=(eh.metrics.left-ey)*eh.scale-eT+eS[0],eM=(-eh.metrics.top-ey)*eh.scale+eS[1],eC=eA+ep.w*eh.scale/ev,ez=eM+ep.h*eh.scale/ev,ek=new e_(eA,eM),eP=new e_(eC,eM),eD=new e_(eA,ez),eL=new e_(eC,ez);if(ew){let V=new e_(-eT,eT- -17),G=-Math.PI/2,el=12-eT,ec=new e_(22-el,-(eh.imageName?el:0)),ep=new e_(...eI);ek._rotateAround(G,V)._add(ec)._add(ep),eP._rotateAround(G,V)._add(ec)._add(ep),eD._rotateAround(G,V)._add(ec)._add(ep),eL._rotateAround(G,V)._add(ec)._add(ep)}if(ef){let V=Math.sin(ef),G=Math.cos(ef),el=[G,-V,V,G];ek._matMult(el),eP._matMult(el),eD._matMult(el),eL._matMult(el)}let eR=new e_(0,0),eB=new e_(0,0);eg.push({tl:ek,tr:eP,bl:eD,br:eL,tex:ep,writingMode:G.writingMode,glyphOffset:eE,sectionIndex:eh.sectionIndex,isSDF:ex,pixelOffsetTL:eR,pixelOffsetBR:eB,minFontScaleX:0,minFontScaleY:0})}return eg}(0,el,em,ec,ep,ed,eh,V.allowVerticalPlacement),eE=V.textSizeData,eS=null;for(let el of("source"===eE.kind?(eS=[128*ec.layout.get("text-size").evaluate(ed,{})])[0]>32640&&d(`${V.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`):"composite"===eE.kind&&((eS=[128*eb.compositeTextSizes[0].evaluate(ed,{},ew),128*eb.compositeTextSizes[1].evaluate(ed,{},ew)])[0]>32640||eS[1]>32640)&&d(`${V.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`),V.addSymbols(V.text,eT,eS,em,ep,ed,eg,G,ef.lineStartIndex,ef.lineLength,ev,ew),ey))ex[el]=V.text.placedSymbolArray.length-1;return 4*eT.length}function zu(V){for(let G in V)return V[G];return null}let iT=tJ.VectorTileFeature.types,iE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Vu(V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex){let ev=em?Math.min(32640,Math.round(em[0])):0,eb=em?Math.min(32640,Math.round(em[1])):0;V.emplaceBack(G,el,Math.round(32*eh),Math.round(32*ec),ep,ed,(ev<<1)+(ef?1:0),eb,16*eg,16*e_,256*ey,256*ex)}function Eu(V,G,el){V.emplaceBack(G.x,G.y,el),V.emplaceBack(G.x,G.y,el),V.emplaceBack(G.x,G.y,el),V.emplaceBack(G.x,G.y,el)}let Tu=class Tu{constructor(V){this.layoutVertexArray=new sa,this.indexArray=new ha,this.programConfigurations=V,this.segments=new ya,this.dynamicLayoutVertexArray=new oa,this.opacityVertexArray=new la,this.placedSymbolArray=new Ki}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(V,G,el,eh){this.isEmpty()||(el&&(this.layoutVertexBuffer=V.createVertexBuffer(this.layoutVertexArray,ir.members),this.indexBuffer=V.createIndexBuffer(this.indexArray,G),this.dynamicLayoutVertexBuffer=V.createVertexBuffer(this.dynamicLayoutVertexArray,il.members,!0),this.opacityVertexBuffer=V.createVertexBuffer(this.opacityVertexArray,iE,!0),this.opacityVertexBuffer.itemSize=1),(el||eh)&&this.programConfigurations.upload(V))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}};Mn("SymbolBuffers",Tu);let Lu=class Lu{constructor(V,G,el){this.layoutVertexArray=new V,this.layoutAttributes=G,this.indexArray=new el,this.segments=new ya,this.collisionVertexArray=new ca}upload(V){this.layoutVertexBuffer=V.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=V.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=V.createVertexBuffer(this.collisionVertexArray,ih.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}};Mn("CollisionBuffers",Lu);let Du=class Du{constructor(G){this.collisionBoxArray=G.collisionBoxArray,this.zoom=G.zoom,this.overscaling=G.overscaling,this.layers=G.layers,this.layerIds=this.layers.map(V=>V.id),this.index=G.index,this.pixelRatio=G.pixelRatio,this.sourceLayerIndex=G.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ds([]),this.placementViewportMatrix=ds([]);let el=this.layers[0]._unevaluatedLayout._values;this.textSizeData=eu(this.zoom,el["text-size"]),this.iconSizeData=eu(this.zoom,el["icon-size"]);let eh=this.layers[0].layout,ec=eh.get("symbol-sort-key"),ep=eh.get("symbol-z-order");this.canOverlap="never"!==qu(eh,"text-overlap","text-allow-overlap")||"never"!==qu(eh,"icon-overlap","icon-allow-overlap")||eh.get("text-ignore-placement")||eh.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==ep&&!ec.isConstant(),this.sortFeaturesByY=("viewport-y"===ep||"auto"===ep&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===eh.get("symbol-placement")&&(this.writingModes=eh.get("text-writing-mode").map(G=>V.WritingMode[G])),this.stateDependentLayerIds=this.layers.filter(V=>V.isStateDependent()).map(V=>V.id),this.sourceID=G.sourceID}createArrays(){this.text=new Tu(new Ra(this.layers,this.zoom,V=>/^text/.test(V))),this.icon=new Tu(new Ra(this.layers,this.zoom,V=>/^icon/.test(V))),this.glyphOffsetArray=new Xi,this.lineVertexArray=new Yi,this.symbolInstances=new Ji}calculateGlyphDependencies(V,G,el,eh,ec){for(let ep=0;ep<V.length;ep++)if(G[V.charCodeAt(ep)]=!0,(el||eh)&&ec){let el=im[V.charAt(ep)];el&&(G[el.charCodeAt(0)]=!0)}}populate(G,el,eh){let ec=this.layers[0],ep=ec.layout,ed=ep.get("text-font"),em=ep.get("text-field"),ef=ep.get("icon-image"),eg=("constant"!==em.value.kind||em.value.value instanceof Dt&&!em.value.value.isEmpty()||em.value.value.toString().length>0)&&("constant"!==ed.value.kind||ed.value.value.length>0),e_="constant"!==ef.value.kind||!!ef.value.value||Object.keys(ef.parameters).length>0,ey=ep.get("symbol-sort-key");if(this.features=[],!eg&&!e_)return;let ex=el.iconDependencies,ev=el.glyphDependencies,eb=el.availableImages,ew=new Qn(this.zoom);for(let{feature:el,id:em,index:ef,sourceLayerIndex:eT}of G){let G,eE;let eS=ec._featureFilter.needGeometry,eI=Ka(el,eS);if(!ec._featureFilter.filter(ew,eI,eh))continue;if(eS||(eI.geometry=Za(el)),eg){let V=ec.getValueAndResolveTokens("text-field",eI,eh,eb),el=Dt.factory(V);(function(V){for(let G of V.sections)if(function(V){for(let G of V)if($n(G.charCodeAt(0)))return!0;return!1}(G.text))return!0;return!1})(el)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Yn()||this.hasRTLText&&tI.isParsed())&&(G=function(V,G,el){return V.sections.forEach(V=>{V.text=function(V,G,el){let eh=G.layout.get("text-transform").evaluate(el,{});return"uppercase"===eh?V=V.toLocaleUpperCase():"lowercase"===eh&&(V=V.toLocaleLowerCase()),tI.applyArabicShaping&&(V=tI.applyArabicShaping(V)),V}(V.text,G,el)}),V}(el,ec,eI))}if(e_){let V=ec.getValueAndResolveTokens("icon-image",eI,eh,eb);eE=V instanceof Rt?V:Rt.fromString(V)}if(!G&&!eE)continue;let eA=this.sortFeaturesByKey?ey.evaluate(eI,{},eh):void 0;if(this.features.push({id:em,text:G,icon:eE,index:ef,sourceLayerIndex:eT,geometry:eI.geometry,properties:el.properties,type:iT[el.type],sortKey:eA}),eE&&(ex[eE.name]=!0),G){let el=ed.evaluate(eI,{},eh).join(","),ec="viewport"!==ep.get("text-rotation-alignment")&&"point"!==ep.get("symbol-placement");for(let eh of(this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(V.WritingMode.vertical)>=0,G.sections))if(eh.image)ex[eh.image.name]=!0;else{let V=En(G.toString()),ep=eh.fontStack||el,ed=ev[ep]=ev[ep]||{};this.calculateGlyphDependencies(eh.text,ed,ec,this.allowVerticalPlacement,V)}}}"line"===ep.get("symbol-placement")&&(this.features=function(V){let G={},el={},eh=[],ec=0;function a(G){eh.push(V[G]),ec++}function s(V,G,ec){let ep=el[V];return delete el[V],el[G]=ep,eh[ep].geometry[0].pop(),eh[ep].geometry[0]=eh[ep].geometry[0].concat(ec[0]),ep}function o(V,el,ec){let ep=G[el];return delete G[el],G[V]=ep,eh[ep].geometry[0].shift(),eh[ep].geometry[0]=ec[0].concat(eh[ep].geometry[0]),ep}function l(V,G,el){let eh=el?G[0][G[0].length-1]:G[0][0];return`${V}:${eh.x}:${eh.y}`}for(let ep=0;ep<V.length;ep++){let ed=V[ep],em=ed.geometry,ef=ed.text?ed.text.toString():null;if(!ef){a(ep);continue}let eg=l(ef,em),e_=l(ef,em,!0);if(eg in el&&e_ in G&&el[eg]!==G[e_]){let V=o(eg,e_,em),ec=s(eg,e_,eh[V].geometry);delete G[eg],delete el[e_],el[l(ef,eh[ec].geometry,!0)]=ec,eh[V].geometry=null}else eg in el?s(eg,e_,em):e_ in G?o(eg,e_,em):(a(ep),G[eg]=ec-1,el[e_]=ec-1)}return eh.filter(V=>V.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((V,G)=>V.sortKey-G.sortKey)}update(V,G,el){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(V,G,this.layers,el),this.icon.programConfigurations.updatePaintArrays(V,G,this.layers,el))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(V){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(V),this.iconCollisionBox.upload(V)),this.text.upload(V,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(V,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(V,G){let el=this.lineVertexArray.length;if(void 0!==V.segment){let el=V.dist(G[V.segment+1]),eh=V.dist(G[V.segment]),ec={};for(let eh=V.segment+1;eh<G.length;eh++)ec[eh]={x:G[eh].x,y:G[eh].y,tileUnitDistanceFromAnchor:el},eh<G.length-1&&(el+=G[eh+1].dist(G[eh]));for(let el=V.segment||0;el>=0;el--)ec[el]={x:G[el].x,y:G[el].y,tileUnitDistanceFromAnchor:eh},el>0&&(eh+=G[el-1].dist(G[el]));for(let V=0;V<G.length;V++){let G=ec[V];this.lineVertexArray.emplaceBack(G.x,G.y,G.tileUnitDistanceFromAnchor)}}return{lineStartIndex:el,lineLength:this.lineVertexArray.length-el}}addSymbols(G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex){let ev=G.indexArray,eb=G.layoutVertexArray,ew=G.segments.prepareSegment(4*el.length,eb,ev,this.canOverlap?ed.sortKey:void 0),eT=this.glyphOffsetArray.length,eE=ew.vertexLength,eS=this.allowVerticalPlacement&&em===V.WritingMode.vertical?Math.PI/2:0,eI=ed.text&&ed.text.sections;for(let V=0;V<el.length;V++){let{tl:ec,tr:ep,bl:em,br:eg,tex:e_,pixelOffsetTL:ey,pixelOffsetBR:eT,minFontScaleX:eE,minFontScaleY:eA,glyphOffset:eM,isSDF:eC,sectionIndex:ez}=el[V],ek=ew.vertexLength,eP=eM[1];Vu(eb,ef.x,ef.y,ec.x,eP+ec.y,e_.x,e_.y,eh,eC,ey.x,ey.y,eE,eA),Vu(eb,ef.x,ef.y,ep.x,eP+ep.y,e_.x+e_.w,e_.y,eh,eC,eT.x,ey.y,eE,eA),Vu(eb,ef.x,ef.y,em.x,eP+em.y,e_.x,e_.y+e_.h,eh,eC,ey.x,eT.y,eE,eA),Vu(eb,ef.x,ef.y,eg.x,eP+eg.y,e_.x+e_.w,e_.y+e_.h,eh,eC,eT.x,eT.y,eE,eA),Eu(G.dynamicLayoutVertexArray,ef,eS),ev.emplaceBack(ek,ek+1,ek+2),ev.emplaceBack(ek+1,ek+2,ek+3),ew.vertexLength+=4,ew.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(eM[0]),V!==el.length-1&&ez===el[V+1].sectionIndex||G.programConfigurations.populatePaintArrays(eb.length,ed,ed.index,{},ex,eI&&eI[ez])}G.placedSymbolArray.emplaceBack(ef.x,ef.y,eT,this.glyphOffsetArray.length-eT,eE,eg,e_,ef.segment,eh?eh[0]:0,eh?eh[1]:0,ec[0],ec[1],em,0,!1,0,ey)}_addCollisionDebugVertex(V,G,el,eh,ec,ep){return G.emplaceBack(0,0),V.emplaceBack(el.x,el.y,eh,ec,Math.round(ep.x),Math.round(ep.y))}addCollisionDebugVertices(V,G,el,eh,ec,ep,ed){let em=ec.segments.prepareSegment(4,ec.layoutVertexArray,ec.indexArray),ef=em.vertexLength,eg=ec.layoutVertexArray,ey=ec.collisionVertexArray,ex=ed.anchorX,ev=ed.anchorY;this._addCollisionDebugVertex(eg,ey,ep,ex,ev,new e_(V,G)),this._addCollisionDebugVertex(eg,ey,ep,ex,ev,new e_(el,G)),this._addCollisionDebugVertex(eg,ey,ep,ex,ev,new e_(el,eh)),this._addCollisionDebugVertex(eg,ey,ep,ex,ev,new e_(V,eh)),em.vertexLength+=4;let eb=ec.indexArray;eb.emplaceBack(ef,ef+1),eb.emplaceBack(ef+1,ef+2),eb.emplaceBack(ef+2,ef+3),eb.emplaceBack(ef+3,ef),em.primitiveLength+=4}addDebugCollisionBoxes(V,G,el,eh){for(let ec=V;ec<G;ec++){let V=this.collisionBoxArray.get(ec);this.addCollisionDebugVertices(V.x1,V.y1,V.x2,V.y2,eh?this.textCollisionBox:this.iconCollisionBox,V.anchorPoint,el)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Lu(ua,ip.members,pa),this.iconCollisionBox=new Lu(ua,ip.members,pa);for(let V=0;V<this.symbolInstances.length;V++){let G=this.symbolInstances.get(V);this.addDebugCollisionBoxes(G.textBoxStartIndex,G.textBoxEndIndex,G,!0),this.addDebugCollisionBoxes(G.verticalTextBoxStartIndex,G.verticalTextBoxEndIndex,G,!0),this.addDebugCollisionBoxes(G.iconBoxStartIndex,G.iconBoxEndIndex,G,!1),this.addDebugCollisionBoxes(G.verticalIconBoxStartIndex,G.verticalIconBoxEndIndex,G,!1)}}_deserializeCollisionBoxesForSymbol(V,G,el,eh,ec,ep,ed,em,ef){let eg={};for(let eh=G;eh<el;eh++){let G=V.get(eh);eg.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},eg.textFeatureIndex=G.featureIndex;break}for(let G=eh;G<ec;G++){let el=V.get(G);eg.verticalTextBox={x1:el.x1,y1:el.y1,x2:el.x2,y2:el.y2,anchorPointX:el.anchorPointX,anchorPointY:el.anchorPointY},eg.verticalTextFeatureIndex=el.featureIndex;break}for(let G=ep;G<ed;G++){let el=V.get(G);eg.iconBox={x1:el.x1,y1:el.y1,x2:el.x2,y2:el.y2,anchorPointX:el.anchorPointX,anchorPointY:el.anchorPointY},eg.iconFeatureIndex=el.featureIndex;break}for(let G=em;G<ef;G++){let el=V.get(G);eg.verticalIconBox={x1:el.x1,y1:el.y1,x2:el.x2,y2:el.y2,anchorPointX:el.anchorPointX,anchorPointY:el.anchorPointY},eg.verticalIconFeatureIndex=el.featureIndex;break}return eg}deserializeCollisionBoxes(V){this.collisionArrays=[];for(let G=0;G<this.symbolInstances.length;G++){let el=this.symbolInstances.get(G);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(V,el.textBoxStartIndex,el.textBoxEndIndex,el.verticalTextBoxStartIndex,el.verticalTextBoxEndIndex,el.iconBoxStartIndex,el.iconBoxEndIndex,el.verticalIconBoxStartIndex,el.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(V,G){let el=V.placedSymbolArray.get(G),eh=el.vertexStartIndex+4*el.numGlyphs;for(let G=el.vertexStartIndex;G<eh;G+=4)V.indexArray.emplaceBack(G,G+1,G+2),V.indexArray.emplaceBack(G+1,G+2,G+3)}getSortedSymbolIndexes(V){if(this.sortedAngle===V&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;let G=Math.sin(V),el=Math.cos(V),eh=[],ec=[],ep=[];for(let V=0;V<this.symbolInstances.length;++V){ep.push(V);let ed=this.symbolInstances.get(V);eh.push(0|Math.round(G*ed.anchorX+el*ed.anchorY)),ec.push(ed.featureIndex)}return ep.sort((V,G)=>eh[V]-eh[G]||ec[G]-ec[V]),ep}addToSortKeyRanges(V,G){let el=this.sortKeyRanges[this.sortKeyRanges.length-1];el&&el.sortKey===G?el.symbolInstanceEnd=V+1:this.sortKeyRanges.push({sortKey:G,symbolInstanceStart:V,symbolInstanceEnd:V+1})}sortFeatures(V){if(this.sortFeaturesByY&&this.sortedAngle!==V&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){for(let G of(this.symbolInstanceIndexes=this.getSortedSymbolIndexes(V),this.sortedAngle=V,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[],this.symbolInstanceIndexes)){let V=this.symbolInstances.get(G);this.featureSortOrder.push(V.featureIndex),[V.rightJustifiedTextSymbolIndex,V.centerJustifiedTextSymbolIndex,V.leftJustifiedTextSymbolIndex].forEach((V,G,el)=>{V>=0&&el.indexOf(V)===G&&this.addIndicesForPlacedSymbol(this.text,V)}),V.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,V.verticalPlacedTextSymbolIndex),V.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,V.placedIconSymbolIndex),V.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,V.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}};Mn("SymbolBucket",Du,{omit:["layers","collisionBoxArray","features","compareText"]}),Du.MAX_GLYPHS=65535,Du.addDynamicAttributes=Eu;let iS=new fi({"symbol-placement":new li(eD.layout_symbol["symbol-placement"]),"symbol-spacing":new li(eD.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new li(eD.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ui(eD.layout_symbol["symbol-sort-key"]),"symbol-z-order":new li(eD.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new li(eD.layout_symbol["icon-allow-overlap"]),"icon-overlap":new li(eD.layout_symbol["icon-overlap"]),"icon-ignore-placement":new li(eD.layout_symbol["icon-ignore-placement"]),"icon-optional":new li(eD.layout_symbol["icon-optional"]),"icon-rotation-alignment":new li(eD.layout_symbol["icon-rotation-alignment"]),"icon-size":new ui(eD.layout_symbol["icon-size"]),"icon-text-fit":new li(eD.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new li(eD.layout_symbol["icon-text-fit-padding"]),"icon-image":new ui(eD.layout_symbol["icon-image"]),"icon-rotate":new ui(eD.layout_symbol["icon-rotate"]),"icon-padding":new ui(eD.layout_symbol["icon-padding"]),"icon-keep-upright":new li(eD.layout_symbol["icon-keep-upright"]),"icon-offset":new ui(eD.layout_symbol["icon-offset"]),"icon-anchor":new ui(eD.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new li(eD.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new li(eD.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new li(eD.layout_symbol["text-rotation-alignment"]),"text-field":new ui(eD.layout_symbol["text-field"]),"text-font":new ui(eD.layout_symbol["text-font"]),"text-size":new ui(eD.layout_symbol["text-size"]),"text-max-width":new ui(eD.layout_symbol["text-max-width"]),"text-line-height":new li(eD.layout_symbol["text-line-height"]),"text-letter-spacing":new ui(eD.layout_symbol["text-letter-spacing"]),"text-justify":new ui(eD.layout_symbol["text-justify"]),"text-radial-offset":new ui(eD.layout_symbol["text-radial-offset"]),"text-variable-anchor":new li(eD.layout_symbol["text-variable-anchor"]),"text-anchor":new ui(eD.layout_symbol["text-anchor"]),"text-max-angle":new li(eD.layout_symbol["text-max-angle"]),"text-writing-mode":new li(eD.layout_symbol["text-writing-mode"]),"text-rotate":new ui(eD.layout_symbol["text-rotate"]),"text-padding":new li(eD.layout_symbol["text-padding"]),"text-keep-upright":new li(eD.layout_symbol["text-keep-upright"]),"text-transform":new ui(eD.layout_symbol["text-transform"]),"text-offset":new ui(eD.layout_symbol["text-offset"]),"text-allow-overlap":new li(eD.layout_symbol["text-allow-overlap"]),"text-overlap":new li(eD.layout_symbol["text-overlap"]),"text-ignore-placement":new li(eD.layout_symbol["text-ignore-placement"]),"text-optional":new li(eD.layout_symbol["text-optional"])});var iI={paint:new fi({"icon-opacity":new ui(eD.paint_symbol["icon-opacity"]),"icon-color":new ui(eD.paint_symbol["icon-color"]),"icon-halo-color":new ui(eD.paint_symbol["icon-halo-color"]),"icon-halo-width":new ui(eD.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ui(eD.paint_symbol["icon-halo-blur"]),"icon-translate":new li(eD.paint_symbol["icon-translate"]),"icon-translate-anchor":new li(eD.paint_symbol["icon-translate-anchor"]),"text-opacity":new ui(eD.paint_symbol["text-opacity"]),"text-color":new ui(eD.paint_symbol["text-color"],{runtimeType:eO,getOverride:V=>V.textColor,hasOverride:V=>!!V.textColor}),"text-halo-color":new ui(eD.paint_symbol["text-halo-color"]),"text-halo-width":new ui(eD.paint_symbol["text-halo-width"]),"text-halo-blur":new ui(eD.paint_symbol["text-halo-blur"]),"text-translate":new li(eD.paint_symbol["text-translate"]),"text-translate-anchor":new li(eD.paint_symbol["text-translate-anchor"])}),layout:iS};let Ou=class Ou{constructor(V){if(void 0===V.property.overrides)throw Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=V.property.overrides?V.property.overrides.runtimeType:eL,this.defaultValue=V}evaluate(V){if(V.formattedSection){let G=this.defaultValue.property.overrides;if(G&&G.hasOverride(V.formattedSection))return G.getOverride(V.formattedSection)}return V.feature&&V.featureState?this.defaultValue.evaluate(V.feature,V.featureState):this.defaultValue.property.specification.default}eachChild(V){this.defaultValue.isConstant()||V(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}};Mn("FormatSectionOverride",Ou,{omit:["defaultValue"]});let Uu=class Uu extends yi{constructor(V){super(V,iI)}recalculate(V,G){if(super.recalculate(V,G),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){let V=this.layout.get("text-writing-mode");if(V){let G=[];for(let el of V)0>G.indexOf(el)&&G.push(el);this.layout._values["text-writing-mode"]=G}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(V,G,el,eh){var ec;let ep=this.layout.get(V).evaluate(G,{},el,eh),ed=this._unevaluatedLayout._values[V];return ed.isDataDriven()||Er(ed.value)||!ep?ep:(ec=G.properties,ep.replace(/{([^{}]+)}/g,(V,G)=>G in ec?String(ec[G]):""))}createBucket(V){return new Du(V)}queryRadius(){return 0}queryIntersectsFeature(){throw Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let V of iI.paint.overridableProperties){if(!Uu.hasPaintOverride(this.layout,V))continue;let G=this.paint.get(V),el=new Ou(G),eh=new Vr(el,G.property.specification),ec=null;ec="constant"===G.value.kind||"source"===G.value.kind?new Tr("source",eh):new Lr("composite",eh,G.value.zoomStops),this.paint._values[V]=new si(G.property,ec,G.parameters)}}_handleOverridablePaintPropertyUpdate(V,G,el){return!(!this.layout||G.isDataDriven()||el.isDataDriven())&&Uu.hasPaintOverride(this.layout,V)}static hasPaintOverride(V,G){let el=V.get("text-field"),eh=iI.paint.properties[G],ec=!1,a=V=>{for(let G of V)if(eh.overrides&&eh.overrides.hasOverride(G))return void(ec=!0)};if("constant"===el.value.kind&&el.value.value instanceof Dt)a(el.value.value.sections);else if("source"===el.value.kind){let t=V=>{ec||(V instanceof Nt&&qt(V.value)===e$?a(V.value.sections):V instanceof cr?a(V.sections):V.eachChild(t))},V=el.value;V._styleExpression&&t(V._styleExpression.expression)}return ec}};function qu(V,G,el){let eh="never",ec=V.get(G);return ec?eh=ec:V.get(el)&&(eh="always"),eh}var iA={paint:new fi({"background-color":new li(eD.paint_background["background-color"]),"background-pattern":new hi(eD.paint_background["background-pattern"]),"background-opacity":new li(eD.paint_background["background-opacity"])})},iM={paint:new fi({"raster-opacity":new li(eD.paint_raster["raster-opacity"]),"raster-hue-rotate":new li(eD.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new li(eD.paint_raster["raster-brightness-min"]),"raster-brightness-max":new li(eD.paint_raster["raster-brightness-max"]),"raster-saturation":new li(eD.paint_raster["raster-saturation"]),"raster-contrast":new li(eD.paint_raster["raster-contrast"]),"raster-resampling":new li(eD.paint_raster["raster-resampling"]),"raster-fade-duration":new li(eD.paint_raster["raster-fade-duration"])})};let Zu=class Zu extends yi{constructor(V){super(V,{}),this.onAdd=V=>{this.implementation.onAdd&&this.implementation.onAdd(V,V.painter.context.gl)},this.onRemove=V=>{this.implementation.onRemove&&this.implementation.onRemove(V,V.painter.context.gl)},this.implementation=V}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw Error("Custom layers cannot be serialized")}};let iC={circle:class extends yi{constructor(V){super(V,tV)}createBucket(V){return new Ja(V)}queryRadius(V){return ss("circle-radius",this,V)+ss("circle-stroke-width",this,V)+os(this.paint.get("circle-translate"))}queryIntersectsFeature(V,G,el,eh,ec,ep,ed,em){var ef;let eg=ls(V,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),ep.angle,ed),e_=this.paint.get("circle-radius").evaluate(G,el)+this.paint.get("circle-stroke-width").evaluate(G,el),ey="map"===this.paint.get("circle-pitch-alignment"),ex=ey?eg:eg.map(V=>_s(V,em)),ev=ey?e_*ed:e_;for(let V of eh)for(let G of V){let V=ey?G:_s(G,em),el=ev,eh=bs([],[G.x,G.y,0,1],em);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?el*=eh[3]/ep.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(el*=ep.cameraToCenterDistance/eh[3]),ef=el,is(ex,V)||es(V,ex,ef))return!0}return!1}},heatmap:class extends yi{constructor(V){super(V,t$),this._updateColorRamp()}createBucket(V){return new As(V)}_handleSpecialPaintPropertyUpdate(V){"heatmap-color"===V&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cs({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends yi{constructor(V){super(V,tq)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends yi{constructor(V){super(V,tW)}recalculate(V,G){super.recalculate(V,G);let el=this.paint._values["fill-outline-color"];"constant"===el.value.kind&&void 0===el.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(V){return new mo(V)}queryRadius(){return os(this.paint.get("fill-translate"))}queryIntersectsFeature(V,G,el,eh,ec,ep,ed){return Ha(ls(V,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),ep.angle,ed),eh)}isTileClipped(){return!0}},"fill-extrusion":class extends yi{constructor(V){super(V,t0)}createBucket(V){return new Do(V)}queryRadius(){return os(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(V,G,el,eh,ec,ep,ed,em){let ef=ls(V,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),ep.angle,ed),eg=this.paint.get("fill-extrusion-height").evaluate(G,el),ey=this.paint.get("fill-extrusion-base").evaluate(G,el),ex=function(V,G,el,eh){let ec=[];for(let el of V){let V=[el.x,el.y,0,1];bs(V,V,G),ec.push(new e_(V[0]/V[3],V[1]/V[3]))}return ec}(ef,em),ev=function(V,G,el,eh){let ec=[],ep=[],ed=eh[8]*G,em=eh[9]*G,ef=eh[10]*G,eg=eh[11]*G,ey=eh[8]*el,ex=eh[9]*el,ev=eh[10]*el,eb=eh[11]*el;for(let G of V){let V=[],el=[];for(let ec of G){let G=ec.x,ep=ec.y,ew=eh[0]*G+eh[4]*ep+eh[12],eT=eh[1]*G+eh[5]*ep+eh[13],eE=eh[2]*G+eh[6]*ep+eh[14],eS=eh[3]*G+eh[7]*ep+eh[15],eI=eE+ef,eA=eS+eg,eM=ew+ey,eC=eT+ex,ez=eE+ev,ek=eS+eb,eP=new e_((ew+ed)/eA,(eT+em)/eA);eP.z=eI/eA,V.push(eP);let eD=new e_(eM/ek,eC/ek);eD.z=ez/ek,el.push(eD)}ec.push(V),ep.push(el)}return[ec,ep]}(eh,ey,eg,em);return function(V,G,el){let eh=1/0;Ha(el,G)&&(eh=qo(el,G[0]));for(let ec=0;ec<G.length;ec++){let ep=G[ec],ed=V[ec];for(let V=0;V<ep.length-1;V++){let G=ep[V],ec=[G,ep[V+1],ed[V+1],ed[V],G];Xa(el,ec)&&(eh=Math.min(eh,qo(el,ec)))}}return eh!==1/0&&eh}(ev[0],ev[1],ex)}},line:class extends yi{constructor(V){super(V,t9),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(V){"line-gradient"===V&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ke,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(V,G){super.recalculate(V,G),this.paint._values["line-floorwidth"]=t7.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,V)}createBucket(V){return new Yo(V)}queryRadius(V){var G,el;let eh=(G=ss("line-width",this,V),(el=ss("line-gap-width",this,V))>0?el+2*G:G),ec=ss("line-offset",this,V);return eh/2+Math.abs(ec)+os(this.paint.get("line-translate"))}queryIntersectsFeature(V,G,el,eh,ec,ep,ed){var em,ef;let eg=ls(V,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),ep.angle,ed),ey=ed/2*(em=this.paint.get("line-width").evaluate(G,el),(ef=this.paint.get("line-gap-width").evaluate(G,el))>0?ef+2*em:em),ex=this.paint.get("line-offset").evaluate(G,el);return ex&&(eh=function(V,G){let el=[];for(let eh=0;eh<V.length;eh++){let ec=V[eh],ep=[];for(let V=0;V<ec.length;V++){let el=ec[V-1],eh=ec[V],ed=ec[V+1],em=0===V?new e_(0,0):eh.sub(el)._unit()._perp(),ef=V===ec.length-1?new e_(0,0):ed.sub(eh)._unit()._perp(),eg=em._add(ef)._unit(),ey=eg.x*ef.x+eg.y*ef.y;0!==ey&&eg._mult(1/ey),ep.push(eg._mult(G)._add(eh))}el.push(ep)}return el}(eh,ex*ed)),function(V,G,el){for(let eh=0;eh<G.length;eh++){let ec=G[eh];if(V.length>=3){for(let G=0;G<ec.length;G++)if(is(V,ec[G]))return!0}if(function(V,G,el){if(V.length>1){if(Qa(V,G))return!0;for(let eh=0;eh<G.length;eh++)if(es(G[eh],V,el))return!0}for(let eh=0;eh<V.length;eh++)if(es(V[eh],G,el))return!0;return!1}(V,ec,el))return!0}return!1}(eg,eh,ey)}isTileClipped(){return!0}},symbol:Uu,background:class extends yi{constructor(V){super(V,iA)}},raster:class extends yi{constructor(V){super(V,iM)}}};let Gu=class Gu{constructor(V){this._callback=V,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}};let Xu=class Xu{constructor(V,G){if(isNaN(V)||isNaN(G))throw Error(`Invalid LngLat object: (${V}, ${G})`);if(this.lng=+V,this.lat=+G,this.lat>90||this.lat<-90)throw Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xu(s(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(V){let G=Math.PI/180,el=this.lat*G,eh=V.lat*G,ec=Math.sin(el)*Math.sin(eh)+Math.cos(el)*Math.cos(eh)*Math.cos((V.lng-this.lng)*G);return 6371008.8*Math.acos(Math.min(ec,1))}toBounds(V=0){let G=360*V/40075017,el=G/Math.cos(Math.PI/180*this.lat);return new Yu(new Xu(this.lng-el,this.lat-G),new Xu(this.lng+el,this.lat+G))}static convert(V){if(V instanceof Xu)return V;if(Array.isArray(V)&&(2===V.length||3===V.length))return new Xu(Number(V[0]),Number(V[1]));if(!Array.isArray(V)&&"object"==typeof V&&null!==V)return new Xu(Number("lng"in V?V.lng:V.lon),Number(V.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}};let Yu=class Yu{constructor(V,G){V&&(G?this.setSouthWest(V).setNorthEast(G):4===V.length?this.setSouthWest([V[0],V[1]]).setNorthEast([V[2],V[3]]):this.setSouthWest(V[0]).setNorthEast(V[1]))}setNorthEast(V){return this._ne=V instanceof Xu?new Xu(V.lng,V.lat):Xu.convert(V),this}setSouthWest(V){return this._sw=V instanceof Xu?new Xu(V.lng,V.lat):Xu.convert(V),this}extend(V){let G,el;let eh=this._sw,ec=this._ne;if(V instanceof Xu)G=V,el=V;else{if(!(V instanceof Yu))return Array.isArray(V)?4===V.length||V.every(Array.isArray)?this.extend(Yu.convert(V)):this.extend(Xu.convert(V)):this;if(G=V._sw,el=V._ne,!G||!el)return this}return eh||ec?(eh.lng=Math.min(G.lng,eh.lng),eh.lat=Math.min(G.lat,eh.lat),ec.lng=Math.max(el.lng,ec.lng),ec.lat=Math.max(el.lat,ec.lat)):(this._sw=new Xu(G.lng,G.lat),this._ne=new Xu(el.lng,el.lat)),this}getCenter(){return new Xu((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Xu(this.getWest(),this.getNorth())}getSouthEast(){return new Xu(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(V){let{lng:G,lat:el}=Xu.convert(V),eh=this._sw.lng<=G&&G<=this._ne.lng;return this._sw.lng>this._ne.lng&&(eh=this._sw.lng>=G&&G>=this._ne.lng),this._sw.lat<=el&&el<=this._ne.lat&&eh}static convert(V){return V instanceof Yu?V:V?new Yu(V):V}};let iz=2*Math.PI*6371008.8;function Wu(V){return iz*Math.cos(V*Math.PI/180)}function Qu(V){return(180+V)/360}function tc(V){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+V*Math.PI/360)))/360}function rc(V){return 360/Math.PI*Math.atan(Math.exp((180-360*V)*Math.PI/180))-90}let nc=class nc{constructor(V,G,el=0){this.x=+V,this.y=+G,this.z=+el}static fromLngLat(V,G=0){let el=Xu.convert(V);return new nc(Qu(el.lng),tc(el.lat),G/Wu(el.lat))}toLngLat(){return new Xu(360*this.x-180,rc(this.y))}toAltitude(){return this.z*Wu(rc(this.y))}meterInMercatorCoordinateUnits(){return 1/iz*(1/Math.cos(rc(this.y)*Math.PI/180))}};function ic(V,G,el){var eh=2*Math.PI*6378137/256/Math.pow(2,el);return[V*eh-2*Math.PI*6378137/2,G*eh-2*Math.PI*6378137/2]}let ac=class ac{constructor(V,G,el){if(V<0||V>25||el<0||el>=Math.pow(2,V)||G<0||G>=Math.pow(2,V))throw Error(`x=${G}, y=${el}, z=${V} outside of bounds. 0<=x<${Math.pow(2,V)}, 0<=y<${Math.pow(2,V)} 0<=z<=25 `);this.z=V,this.x=G,this.y=el,this.key=lc(0,V,V,G,el)}equals(V){return this.z===V.z&&this.x===V.x&&this.y===V.y}url(V,G,el){var eh,ec,ep,ed,em;let ef=(ec=this.y,ep=this.z,ed=ic(256*(eh=this.x),256*(ec=Math.pow(2,ep)-ec-1),ep),em=ic(256*(eh+1),256*(ec+1),ep),ed[0]+","+ed[1]+","+em[0]+","+em[1]),eg=function(V,G,el){let eh,ec="";for(let ep=V;ep>0;ep--)ec+=(G&(eh=1<<ep-1)?1:0)+(el&eh?2:0);return ec}(this.z,this.x,this.y);return V[(this.x+this.y)%V.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===el?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,G>1?"@2x":"").replace(/{quadkey}/g,eg).replace(/{bbox-epsg-3857}/g,ef)}isChildOf(V){let G=this.z-V.z;return G>0&&V.x===this.x>>G&&V.y===this.y>>G}getTilePoint(V){let G=Math.pow(2,this.z);return new e_((V.x*G-this.x)*8192,(V.y*G-this.y)*8192)}toString(){return`${this.z}/${this.x}/${this.y}`}};let sc=class sc{constructor(V,G){this.wrap=V,this.canonical=G,this.key=lc(V,G.z,G.z,G.x,G.y)}};let oc=class oc{constructor(V,G,el,eh,ec){if(V<el)throw Error(`overscaledZ should be >= z; overscaledZ = ${V}; z = ${el}`);this.overscaledZ=V,this.wrap=G,this.canonical=new ac(el,+eh,+ec),this.key=lc(G,V,el,eh,ec)}clone(){return new oc(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(V){return this.overscaledZ===V.overscaledZ&&this.wrap===V.wrap&&this.canonical.equals(V.canonical)}scaledTo(V){if(V>this.overscaledZ)throw Error(`targetZ > this.overscaledZ; targetZ = ${V}; overscaledZ = ${this.overscaledZ}`);let G=this.canonical.z-V;return V>this.canonical.z?new oc(V,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new oc(V,this.wrap,V,this.canonical.x>>G,this.canonical.y>>G)}calculateScaledKey(V,G){if(V>this.overscaledZ)throw Error(`targetZ > this.overscaledZ; targetZ = ${V}; overscaledZ = ${this.overscaledZ}`);let el=this.canonical.z-V;return V>this.canonical.z?lc(this.wrap*+G,V,this.canonical.z,this.canonical.x,this.canonical.y):lc(this.wrap*+G,V,V,this.canonical.x>>el,this.canonical.y>>el)}isChildOf(V){if(V.wrap!==this.wrap)return!1;let G=this.canonical.z-V.canonical.z;return 0===V.overscaledZ||V.overscaledZ<this.overscaledZ&&V.canonical.x===this.canonical.x>>G&&V.canonical.y===this.canonical.y>>G}children(V){if(this.overscaledZ>=V)return[new oc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let G=this.canonical.z+1,el=2*this.canonical.x,eh=2*this.canonical.y;return[new oc(G,this.wrap,G,el,eh),new oc(G,this.wrap,G,el+1,eh),new oc(G,this.wrap,G,el,eh+1),new oc(G,this.wrap,G,el+1,eh+1)]}isLessThan(V){return this.wrap<V.wrap||!(this.wrap>V.wrap)&&(this.overscaledZ<V.overscaledZ||!(this.overscaledZ>V.overscaledZ)&&(this.canonical.x<V.canonical.x||!(this.canonical.x>V.canonical.x)&&this.canonical.y<V.canonical.y))}wrapped(){return new oc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(V){return new oc(this.overscaledZ,V,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(V){return this.canonical.getTilePoint(new nc(V.x-this.wrap,V.y))}};function lc(V,G,el,eh,ec){(V*=2)<0&&(V=-1*V-1);let ep=1<<el;return(ep*ep*V+ep*ec+eh).toString(36)+el.toString(36)+G.toString(36)}Mn("CanonicalTileID",ac),Mn("OverscaledTileID",oc,{omit:["posMatrix"]});let uc=class uc{constructor(V,G,el){if(this.uid=V,G.height!==G.width)throw RangeError("DEM tiles must be square");if(el&&"mapbox"!==el&&"terrarium"!==el)return void d(`"${el}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=G.height;let eh=this.dim=G.height-2;this.data=new Uint32Array(G.data.buffer),this.encoding=el||"mapbox";for(let V=0;V<eh;V++)this.data[this._idx(-1,V)]=this.data[this._idx(0,V)],this.data[this._idx(eh,V)]=this.data[this._idx(eh-1,V)],this.data[this._idx(V,-1)]=this.data[this._idx(V,0)],this.data[this._idx(V,eh)]=this.data[this._idx(V,eh-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(eh,-1)]=this.data[this._idx(eh-1,0)],this.data[this._idx(-1,eh)]=this.data[this._idx(0,eh-1)],this.data[this._idx(eh,eh)]=this.data[this._idx(eh-1,eh-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let V=0;V<eh;V++)for(let G=0;G<eh;G++){let el=this.get(V,G);el>this.max&&(this.max=el),el<this.min&&(this.min=el)}}get(V,G){let el=new Uint8Array(this.data.buffer),eh=4*this._idx(V,G);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(el[eh],el[eh+1],el[eh+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(V,G){if(V<-1||V>=this.dim+1||G<-1||G>=this.dim+1)throw RangeError("out of range source coordinates for DEM data");return(G+1)*this.stride+(V+1)}_unpackMapbox(V,G,el){return(256*V*256+256*G+el)/10-1e4}_unpackTerrarium(V,G,el){return 256*V+G+el/256-32768}getPixels(){return new Bs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(V,G,el){if(this.dim!==V.dim)throw Error("dem dimension mismatch");let eh=G*this.dim,ec=G*this.dim+this.dim,ep=el*this.dim,ed=el*this.dim+this.dim;switch(G){case -1:eh=ec-1;break;case 1:ec=eh+1}switch(el){case -1:ep=ed-1;break;case 1:ed=ep+1}let em=-G*this.dim,ef=-el*this.dim;for(let G=ep;G<ed;G++)for(let el=eh;el<ec;el++)this.data[this._idx(el,G)]=V.data[this._idx(el+em,G+ef)]}};Mn("DEMData",uc);let cc=class cc{constructor(V){this._stringToNumber={},this._numberToString=[];for(let G=0;G<V.length;G++){let el=V[G];this._stringToNumber[el]=G,this._numberToString[G]=el}}encode(V){return this._stringToNumber[V]}decode(V){if(V>=this._numberToString.length)throw Error(`Out of bounds. Index requested n=${V} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[V]}};let hc=class hc{constructor(V,G,el,eh,ec){this.type="Feature",this._vectorTileFeature=V,V._z=G,V._x=el,V._y=eh,this.properties=V.properties,this.id=ec}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(V){this._geometry=V}toJSON(){let V={geometry:this.geometry};for(let G in this)"_geometry"!==G&&"_vectorTileFeature"!==G&&(V[G]=this[G]);return V}};let pc=class pc{constructor(V,G){this.tileID=V,this.x=V.canonical.x,this.y=V.canonical.y,this.z=V.canonical.z,this.grid=new Sn(8192,16,0),this.grid3D=new Sn(8192,16,0),this.featureIndexArray=new Wi,this.promoteId=G}insert(V,G,el,eh,ec,ep){let ed=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(el,eh,ec);let em=ep?this.grid3D:this.grid;for(let V=0;V<G.length;V++){let el=G[V],eh=[1/0,1/0,-1/0,-1/0];for(let V=0;V<el.length;V++){let G=el[V];eh[0]=Math.min(eh[0],G.x),eh[1]=Math.min(eh[1],G.y),eh[2]=Math.max(eh[2],G.x),eh[3]=Math.max(eh[3],G.y)}eh[0]<8192&&eh[1]<8192&&eh[2]>=0&&eh[3]>=0&&em.insert(ed,eh[0],eh[1],eh[2],eh[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new tJ.VectorTile(new pl(this.rawTileData)).layers,this.sourceLayerCoder=new cc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(V,G,el,eh){let ec;this.loadVTLayers();let ep=V.params||{},ed=8192/V.tileSize/V.scale,em=Jr(ep.filter),ef=V.queryGeometry,eg=V.queryPadding*ed,ey=dc(ef),ex=this.grid.query(ey.minX-eg,ey.minY-eg,ey.maxX+eg,ey.maxY+eg),ev=dc(V.cameraQueryGeometry),eb=this.grid3D.query(ev.minX-eg,ev.minY-eg,ev.maxX+eg,ev.maxY+eg,(G,el,eh,ec)=>(function(V,G,el,eh,ec){for(let ep of V)if(G<=ep.x&&el<=ep.y&&eh>=ep.x&&ec>=ep.y)return!0;let ep=[new e_(G,el),new e_(G,ec),new e_(eh,ec),new e_(eh,el)];if(V.length>2){for(let G of ep)if(is(V,G))return!0}for(let G=0;G<V.length-1;G++)if(function(V,G,el){let eh=el[0],ec=el[2];if(V.x<eh.x&&G.x<eh.x||V.x>ec.x&&G.x>ec.x||V.y<eh.y&&G.y<eh.y||V.y>ec.y&&G.y>ec.y)return!1;let ep=y(V,G,el[0]);return ep!==y(V,G,el[1])||ep!==y(V,G,el[2])||ep!==y(V,G,el[3])}(V[G],V[G+1],ep))return!0;return!1})(V.cameraQueryGeometry,G-eg,el-eg,eh+eg,ec+eg));for(let V of eb)ex.push(V);ex.sort(yc);let ew={};for(let eg=0;eg<ex.length;eg++){let e_=ex[eg];if(e_===ec)continue;ec=e_;let ey=this.featureIndexArray.get(e_),ev=null;this.loadMatchingFeature(ew,ey.bucketIndex,ey.sourceLayerIndex,ey.featureIndex,em,ep.layers,ep.availableImages,G,el,eh,(G,el,eh)=>(ev||(ev=Za(G)),el.queryIntersectsFeature(ef,G,eh,ev,this.z,V.transform,ed,V.pixelPosMatrix)))}return ew}loadMatchingFeature(V,G,el,eh,ec,ep,ed,em,ef,eg,e_){let ey=this.bucketLayerIDs[G];if(ep&&!function(V,G){for(let el=0;el<V.length;el++)if(G.indexOf(V[el])>=0)return!0;return!1}(ep,ey))return;let ex=this.sourceLayerCoder.decode(el),ev=this.vtLayers[ex].feature(eh);if(ec.needGeometry){let V=Ka(ev,!0);if(!ec.filter(new Qn(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!ec.filter(new Qn(this.tileID.overscaledZ),ev))return;let eb=this.getId(ev,ex);for(let G=0;G<ey.length;G++){let el=ey[G];if(ep&&0>ep.indexOf(el))continue;let ec=em[el];if(!ec)continue;let ex={};eb&&eg&&(ex=eg.getState(ec.sourceLayer||"_geojsonTileLayer",eb));let ew=o({},ef[el]);ew.paint=fc(ew.paint,ec.paint,ev,ex,ed),ew.layout=fc(ew.layout,ec.layout,ev,ex,ed);let eT=!e_||e_(ev,ec,ex);if(!eT)continue;let eE=new hc(ev,this.z,this.x,this.y,eb);eE.layer=ew;let eS=V[el];void 0===eS&&(eS=V[el]=[]),eS.push({featureIndex:eh,feature:eE,intersectionZ:eT})}}lookupSymbolFeatures(V,G,el,eh,ec,ep,ed,em){let ef={};this.loadVTLayers();let eg=Jr(ec);for(let ec of V)this.loadMatchingFeature(ef,el,eh,ec,eg,ep,ed,em,G);return ef}hasLayer(V){for(let G of this.bucketLayerIDs)for(let el of G)if(V===el)return!0;return!1}getId(V,G){let el=V.id;return this.promoteId&&"boolean"==typeof(el=V.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[G]])&&(el=Number(el)),el}};function fc(V,G,el,eh,ec){return c(V,(V,ep)=>{let ed=G instanceof oi?G.get(ep):null;return ed&&ed.evaluate?ed.evaluate(el,eh,ec):ed})}function dc(V){let G=1/0,el=1/0,eh=-1/0,ec=-1/0;for(let ep of V)G=Math.min(G,ep.x),el=Math.min(el,ep.y),eh=Math.max(eh,ep.x),ec=Math.max(ec,ep.y);return{minX:G,minY:el,maxX:eh,maxY:ec}}function yc(V,G){return G-V}Mn("FeatureIndex",pc,{omit:["rawTileData","sourceLayerCoder"]}),V.PerformanceMarkers=void 0,(ej=V.PerformanceMarkers||(V.PerformanceMarkers={})).create="create",ej.load="load",ej.fullLoad="fullLoad";let ik=null,iP=[],iD=1e3/30;V.AJAXError=q,V.ARRAY_TYPE=tN,V.Actor=class{constructor(V,G,el){this.target=V,this.parent=G,this.mapId=el,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},u(["receive","process"],this),this.invoker=new Gu(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=g()?V:window}send(V,G,el,eh,ec=!1){let ep=Math.round(1e18*Math.random()).toString(36).substring(0,10);el&&(this.callbacks[ep]=el);let ed=_(this.globalScope)?void 0:[];return this.target.postMessage({id:ep,type:V,hasCallback:!!el,targetMapId:eh,mustQueue:ec,sourceMapId:this.mapId,data:Bn(G,ed)},ed),{cancel:()=>{el&&delete this.callbacks[ep],this.target.postMessage({id:ep,type:"<cancel>",targetMapId:eh,sourceMapId:this.mapId})}}}receive(V){let G=V.data,el=G.id;if(el&&(!G.targetMapId||this.mapId===G.targetMapId)){if("<cancel>"===G.type){delete this.tasks[el];let V=this.cancelCallbacks[el];delete this.cancelCallbacks[el],V&&V()}else g()||G.mustQueue?(this.tasks[el]=G,this.taskQueue.push(el),this.invoker.trigger()):this.processTask(el,G)}}process(){if(!this.taskQueue.length)return;let V=this.taskQueue.shift(),G=this.tasks[V];delete this.tasks[V],this.taskQueue.length&&this.invoker.trigger(),G&&this.processTask(V,G)}processTask(V,G){if("<response>"===G.type){let el=this.callbacks[V];delete this.callbacks[V],el&&(G.error?el(Cn(G.error)):el(null,Cn(G.data)))}else{let el=!1,eh=_(this.globalScope)?void 0:[],ec=G.hasCallback?(G,ec)=>{el=!0,delete this.cancelCallbacks[V],this.target.postMessage({id:V,type:"<response>",sourceMapId:this.mapId,error:G?Bn(G):null,data:Bn(ec,eh)},eh)}:V=>{el=!0},ep=null,ed=Cn(G.data);if(this.parent[G.type])ep=this.parent[G.type](G.sourceMapId,ed,ec);else if(this.parent.getWorkerSource){let V=G.type.split(".");ep=this.parent.getWorkerSource(G.sourceMapId,V[0],ed.source)[V[1]](ed,ec)}else ec(Error(`Could not find function ${G.type}`));!el&&ep&&ep.cancel&&(this.cancelCallbacks[V]=ep.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},V.AlphaImage=zs,V.CanonicalTileID=ac,V.CollisionBoxArray=Ni,V.CollisionCircleLayoutArray=class extends Vi{},V.Color=Ft,V.DEMData=uc,V.DataConstantProperty=li,V.DictionaryCoder=cc,V.EXTENT=8192,V.ErrorEvent=et,V.EvaluationParameters=Qn,V.Event=tt,V.Evented=rt,V.FeatureIndex=pc,V.FillBucket=mo,V.FillExtrusionBucket=Do,V.GeoJSONFeature=hc,V.ImageAtlas=Dl,V.ImagePosition=Ll,V.LineBucket=Yo,V.LineStripIndexArray=class extends Ui{},V.LngLat=Xu,V.LngLatBounds=Yu,V.MercatorCoordinate=nc,V.ONE_EM=24,V.OverscaledTileID=oc,V.PerformanceUtils={mark(V){performance.mark(V)},frame(V){null!=ik&&iP.push(V-ik),ik=V},clearMetrics(){for(let G in ik=null,iP=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime"),V.PerformanceMarkers)performance.clearMarks(V.PerformanceMarkers[G])},getPerformanceMetrics(){performance.measure("loadTime",V.PerformanceMarkers.create,V.PerformanceMarkers.load),performance.measure("fullLoadTime",V.PerformanceMarkers.create,V.PerformanceMarkers.fullLoad);let G=performance.getEntriesByName("loadTime")[0].duration,el=performance.getEntriesByName("fullLoadTime")[0].duration,eh=iP.length,ec=1/(iP.reduce((V,G)=>V+G,0)/eh/1e3),ep=iP.filter(V=>V>iD).reduce((V,G)=>V+(G-iD)/iD,0);return{loadTime:G,fullLoadTime:el,fps:ec,percentDroppedFrames:ep/(eh+ep)*100}}},V.PosArray=Qi,V.Properties=fi,V.QuadTriangleArray=class extends Fi{},V.RGBAImage=Bs,V.RasterBoundsArray=class extends _i{},V.RequestPerformance=class{constructor(V){this._marks={start:[V.url,"start"].join("#"),end:[V.url,"end"].join("#"),measure:V.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let V=performance.getEntriesByName(this._marks.measure);return 0===V.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),V=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),V}},V.ResourceType=ez,V.SegmentVector=ya,V.SymbolBucket=Du,V.Transitionable=ri,V.TriangleIndexArray=ha,V.Uniform1f=za,V.Uniform1i=class extends Ma{constructor(V,G){super(V,G),this.current=0}set(V){this.current!==V&&(this.current=V,this.gl.uniform1i(this.location,V))}},V.Uniform2f=class extends Ma{constructor(V,G){super(V,G),this.current=[0,0]}set(V){V[0]===this.current[0]&&V[1]===this.current[1]||(this.current=V,this.gl.uniform2f(this.location,V[0],V[1]))}},V.Uniform3f=class extends Ma{constructor(V,G){super(V,G),this.current=[0,0,0]}set(V){V[0]===this.current[0]&&V[1]===this.current[1]&&V[2]===this.current[2]||(this.current=V,this.gl.uniform3f(this.location,V[0],V[1],V[2]))}},V.Uniform4f=Ba,V.UniformColor=Ca,V.UniformMatrix4f=class extends Ma{constructor(V,G){super(V,G),this.current=tF}set(V){if(V[12]!==this.current[12]||V[0]!==this.current[0])return this.current=V,void this.gl.uniformMatrix4fv(this.location,!1,V);for(let G=1;G<16;G++)if(V[G]!==this.current[G]){this.current=V,this.gl.uniformMatrix4fv(this.location,!1,V);break}}},V.UnwrappedTileID=sc,V.ValidationError=it,V.ZoomHistory=Pn,V.add=function(V,G,el){return V[0]=G[0]+el[0],V[1]=G[1]+el[1],V[2]=G[2]+el[2],V},V.addDynamicAttributes=Eu,V.asyncAll=function(V,G,el){if(!V.length)return el(null,[]);let eh=V.length,ec=Array(V.length),ep=null;V.forEach((V,ed)=>{G(V,(V,G)=>{V&&(ep=V),ec[ed]=G,0==--eh&&el(ep,ec)})})},V.bezier=n,V.bindAll=u,V.cacheEntryPossiblyAdded=function(V){++eE>eT&&(V.getActor().send("enforceCacheSizeLimit",ew),eE=0)},V.clamp=a,V.clearTileCache=function(V){let G=caches.delete(ex);V&&G.catch(V).then(()=>V())},V.clipLine=cu,V.clone=function(V){var G=new tN(16);return G[0]=V[0],G[1]=V[1],G[2]=V[2],G[3]=V[3],G[4]=V[4],G[5]=V[5],G[6]=V[6],G[7]=V[7],G[8]=V[8],G[9]=V[9],G[10]=V[10],G[11]=V[11],G[12]=V[12],G[13]=V[13],G[14]=V[14],G[15]=V[15],G},V.clone$1=p,V.clone$2=function(V){var G=new tN(3);return G[0]=V[0],G[1]=V[1],G[2]=V[2],G},V.collisionCircleLayout=id,V.config=ey,V.copy=function(V,G){return V[0]=G[0],V[1]=G[1],V[2]=G[2],V[3]=G[3],V[4]=G[4],V[5]=G[5],V[6]=G[6],V[7]=G[7],V[8]=G[8],V[9]=G[9],V[10]=G[10],V[11]=G[11],V[12]=G[12],V[13]=G[13],V[14]=G[14],V[15]=G[15],V},V.create=function(){var V=new tN(16);return tN!=Float32Array&&(V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[11]=0,V[12]=0,V[13]=0,V[14]=0),V[0]=1,V[5]=1,V[10]=1,V[15]=1,V},V.create$1=fs,V.createExpression=Fr,V.createFilter=Jr,V.createLayout=vi,V.createStyleLayer=function(V){return"custom"===V.type?new Zu(V):new iC[V.type](V)},V.cross=function(V,G,el){var eh=G[0],ec=G[1],ep=G[2],ed=el[0],em=el[1],ef=el[2];return V[0]=ec*ef-ep*em,V[1]=ep*ed-eh*ef,V[2]=eh*em-ec*ed,V},V.dot=function(V,G){return V[0]*G[0]+V[1]*G[1]+V[2]*G[2]},V.dot$1=function(V,G){return V[0]*G[0]+V[1]*G[1]+V[2]*G[2]+V[3]*G[3]},V.ease=eh,V.emitValidationErrors=kn,V.enforceCacheSizeLimit=function(V){E(),ev&&ev.then(G=>{G.keys().then(el=>{for(let eh=0;eh<el.length-V;eh++)G.delete(el[eh])})})},V.equals=function(V,G){var el=V[0],eh=V[1],ec=V[2],ep=V[3],ed=V[4],em=V[5],ef=V[6],eg=V[7],e_=V[8],ey=V[9],ex=V[10],ev=V[11],eb=V[12],ew=V[13],eT=V[14],eE=V[15],eS=G[0],eI=G[1],eA=G[2],eM=G[3],eC=G[4],ez=G[5],ek=G[6],eP=G[7],eD=G[8],eL=G[9],eR=G[10],eB=G[11],eF=G[12],eO=G[13],eU=G[14],eV=G[15];return Math.abs(el-eS)<=1e-6*Math.max(1,Math.abs(el),Math.abs(eS))&&Math.abs(eh-eI)<=1e-6*Math.max(1,Math.abs(eh),Math.abs(eI))&&Math.abs(ec-eA)<=1e-6*Math.max(1,Math.abs(ec),Math.abs(eA))&&Math.abs(ep-eM)<=1e-6*Math.max(1,Math.abs(ep),Math.abs(eM))&&Math.abs(ed-eC)<=1e-6*Math.max(1,Math.abs(ed),Math.abs(eC))&&Math.abs(em-ez)<=1e-6*Math.max(1,Math.abs(em),Math.abs(ez))&&Math.abs(ef-ek)<=1e-6*Math.max(1,Math.abs(ef),Math.abs(ek))&&Math.abs(eg-eP)<=1e-6*Math.max(1,Math.abs(eg),Math.abs(eP))&&Math.abs(e_-eD)<=1e-6*Math.max(1,Math.abs(e_),Math.abs(eD))&&Math.abs(ey-eL)<=1e-6*Math.max(1,Math.abs(ey),Math.abs(eL))&&Math.abs(ex-eR)<=1e-6*Math.max(1,Math.abs(ex),Math.abs(eR))&&Math.abs(ev-eB)<=1e-6*Math.max(1,Math.abs(ev),Math.abs(eB))&&Math.abs(eb-eF)<=1e-6*Math.max(1,Math.abs(eb),Math.abs(eF))&&Math.abs(ew-eO)<=1e-6*Math.max(1,Math.abs(ew),Math.abs(eO))&&Math.abs(eT-eU)<=1e-6*Math.max(1,Math.abs(eT),Math.abs(eU))&&Math.abs(eE-eV)<=1e-6*Math.max(1,Math.abs(eE),Math.abs(eV))},V.evaluateSizeForFeature=function(V,{uSize:G,uSizeT:el},{lowerSize:eh,upperSize:ec}){return"source"===V.kind?eh/128:"composite"===V.kind?Se(eh/128,ec/128,el):G},V.evaluateSizeForZoom=function(V,G){let el=0,eh=0;if("constant"===V.kind)eh=V.layoutSize;else if("source"!==V.kind){let{interpolationType:ec,minZoom:ep,maxZoom:ed}=V,em=ec?a(Ne.interpolationFactor(ec,G,ep,ed),0,1):0;"camera"===V.kind?eh=Se(V.minSize,V.maxSize,em):el=em}return{uSizeT:el,uSize:eh}},V.evaluateVariableOffset=Au,V.evented=tS,V.exported=eg,V.exported$1=eS,V.extend=o,V.filterObject=h,V.fromRotation=function(V,G){var el=Math.sin(G),eh=Math.cos(G);return V[0]=eh,V[1]=el,V[2]=0,V[3]=-el,V[4]=eh,V[5]=0,V[6]=0,V[7]=0,V[8]=1,V},V.fromScaling=function(V,G){return V[0]=G[0],V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=G[1],V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[10]=G[2],V[11]=0,V[12]=0,V[13]=0,V[14]=0,V[15]=1,V},V.getAnchorAlignment=Yl,V.getAnchorJustification=ku,V.getArrayBuffer=K,V.getImage=H,V.getJSON=function(V,G){return Z(o(V,{type:"json"}),G)},V.getOverlapMode=qu,V.getRTLTextPluginStatus=Yn,V.getReferrer=ek,V.getVideo=function(V,G){let el=window.document.createElement("video");el.muted=!0,el.onloadstart=function(){G(null,el)};for(let G=0;G<V.length;G++){let eh=window.document.createElement("source");(function(V){let G=window.document.createElement("a");return G.href=V,G.protocol===window.document.location.protocol&&G.host===window.document.location.host})(V[G])||(el.crossOrigin="Anonymous"),eh.src=V[G],el.appendChild(eh)}return{cancel:()=>{}}},V.identity=ds,V.invert=function(V,G){var el=G[0],eh=G[1],ec=G[2],ep=G[3],ed=G[4],em=G[5],ef=G[6],eg=G[7],e_=G[8],ey=G[9],ex=G[10],ev=G[11],eb=G[12],ew=G[13],eT=G[14],eE=G[15],eS=el*em-eh*ed,eI=el*ef-ec*ed,eA=el*eg-ep*ed,eM=eh*ef-ec*em,eC=eh*eg-ep*em,ez=ec*eg-ep*ef,ek=e_*ew-ey*eb,eP=e_*eT-ex*eb,eD=e_*eE-ev*eb,eL=ey*eT-ex*ew,eR=ey*eE-ev*ew,eB=ex*eE-ev*eT,eF=eS*eB-eI*eR+eA*eL+eM*eD-eC*eP+ez*ek;return eF?(V[0]=(em*eB-ef*eR+eg*eL)*(eF=1/eF),V[1]=(ec*eR-eh*eB-ep*eL)*eF,V[2]=(ew*ez-eT*eC+eE*eM)*eF,V[3]=(ex*eC-ey*ez-ev*eM)*eF,V[4]=(ef*eD-ed*eB-eg*eP)*eF,V[5]=(el*eB-ec*eD+ep*eP)*eF,V[6]=(eT*eA-eb*ez-eE*eI)*eF,V[7]=(e_*ez-ex*eA+ev*eI)*eF,V[8]=(ed*eR-em*eD+eg*ek)*eF,V[9]=(eh*eD-el*eR-ep*ek)*eF,V[10]=(eb*eC-ew*eA+eE*eS)*eF,V[11]=(ey*eA-e_*eC-ev*eS)*eF,V[12]=(em*eP-ed*eL-ef*ek)*eF,V[13]=(el*eL-eh*eP+ec*ek)*eF,V[14]=(ew*eI-eb*eM-eT*eS)*eF,V[15]=(e_*eM-ey*eI+ex*eS)*eF,V):null},V.isImageBitmap=A,V.isSafari=_,V.isWorker=g,V.keysDifference=function(V,G){let el=[];for(let eh in V)eh in G||el.push(eh);return el},V.lazyLoadRTLTextPlugin=function(){tI.isLoading()||tI.isLoaded()||"deferred"!==Yn()||Hn()},V.makeRequest=Z,V.mapObject=c,V.mercatorXfromLng=Qu,V.mercatorYfromLat=tc,V.mercatorZfromAltitude=function(V,G){return V/Wu(G)},V.mul=ys,V.mul$1=function(V,G,el){return V[0]=G[0]*el[0],V[1]=G[1]*el[1],V[2]=G[2]*el[2],V[3]=G[3]*el[3],V},V.multiply=ys,V.nextPowerOfTwo=function(V){return V<=1?1:Math.pow(2,Math.ceil(Math.log(V)/Math.LN2))},V.normalize=function(V,G){var el=G[0],eh=G[1],ec=G[2],ep=el*el+eh*eh+ec*ec;return ep>0&&(ep=1/Math.sqrt(ep)),V[0]=G[0]*ep,V[1]=G[1]*ep,V[2]=G[2]*ep,V},V.number=Se,V.ortho=function(V,G,el,eh,ec,ep,ed){var em=1/(G-el),ef=1/(eh-ec),eg=1/(ep-ed);return V[0]=-2*em,V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=-2*ef,V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[10]=2*eg,V[11]=0,V[12]=(G+el)*em,V[13]=(ec+eh)*ef,V[14]=(ed+ep)*eg,V[15]=1,V},V.parseCacheControl=x,V.parseGlyphPbf=function(V){return new pl(V).readFields(Vl,[])},V.pbf=pl,V.performSymbolLayout=function(G){G.bucket.createArrays(),G.bucket.tilePixelRatio=8192/(512*G.bucket.overscaling),G.bucket.compareText={},G.bucket.iconsNeedLinear=!1;let el=G.bucket.layers[0].layout,eh=G.bucket.layers[0]._unevaluatedLayout._values,ec={layoutIconSize:eh["icon-size"].possiblyEvaluate(new Qn(G.bucket.zoom+1),G.canonical),layoutTextSize:eh["text-size"].possiblyEvaluate(new Qn(G.bucket.zoom+1),G.canonical),textMaxSize:eh["text-size"].possiblyEvaluate(new Qn(18))};if("composite"===G.bucket.textSizeData.kind){let{minZoom:V,maxZoom:el}=G.bucket.textSizeData;ec.compositeTextSizes=[eh["text-size"].possiblyEvaluate(new Qn(V),G.canonical),eh["text-size"].possiblyEvaluate(new Qn(el),G.canonical)]}if("composite"===G.bucket.iconSizeData.kind){let{minZoom:V,maxZoom:el}=G.bucket.iconSizeData;ec.compositeIconSizes=[eh["icon-size"].possiblyEvaluate(new Qn(V),G.canonical),eh["icon-size"].possiblyEvaluate(new Qn(el),G.canonical)]}let ep=24*el.get("text-line-height"),ed="viewport"!==el.get("text-rotation-alignment")&&"point"!==el.get("symbol-placement"),em=el.get("text-keep-upright"),ef=el.get("text-size");for(let eh of G.bucket.features){let eg=el.get("text-font").evaluate(eh,{},G.canonical).join(","),ey=ef.evaluate(eh,{},G.canonical),ex=ec.layoutTextSize.evaluate(eh,{},G.canonical),ev=ec.layoutIconSize.evaluate(eh,{},G.canonical),eb={horizontal:{},vertical:void 0},ew=eh.text,eT,eE=[0,0];if(ew){let ec=ew.toString(),ef=24*el.get("text-letter-spacing").evaluate(eh,{},G.canonical),e_=!function(V){for(let el of V){var G;if(G=el.charCodeAt(0),ty.Arabic(G)||ty["Arabic Supplement"](G)||ty["Arabic Extended-A"](G)||ty["Arabic Presentation Forms-A"](G)||ty["Arabic Presentation Forms-B"](G))return!1}return!0}(ec)?0:ef,ev=el.get("text-anchor").evaluate(eh,{},G.canonical),eT=el.get("text-variable-anchor");if(!eT){let V=el.get("text-radial-offset").evaluate(eh,{},G.canonical);eE=V?Au(ev,[24*V,iw]):el.get("text-offset").evaluate(eh,{},G.canonical).map(V=>24*V)}let eS=ed?"center":el.get("text-justify").evaluate(eh,{},G.canonical),eI=el.get("symbol-placement"),eA="point"===eI?24*el.get("text-max-width").evaluate(eh,{},G.canonical):0,w=()=>{G.bucket.allowVerticalPlacement&&En(ec)&&(eb.vertical=Ul(ew,G.glyphMap,G.glyphPositions,G.imagePositions,eg,eA,ep,ev,"left",e_,eE,V.WritingMode.vertical,!0,eI,ex,ey))};if(!ed&&eT){let el="auto"===eS?eT.map(V=>ku(V)):[eS],eh=!1;for(let ec=0;ec<el.length;ec++){let ed=el[ec];if(!eb.horizontal[ed]){if(eh)eb.horizontal[ed]=eb.horizontal[0];else{let el=Ul(ew,G.glyphMap,G.glyphPositions,G.imagePositions,eg,eA,ep,"center",ed,e_,eE,V.WritingMode.horizontal,!1,eI,ex,ey);el&&(eb.horizontal[ed]=el,eh=1===el.positionedLines.length)}}}w()}else{"auto"===eS&&(eS=ku(ev));let el=Ul(ew,G.glyphMap,G.glyphPositions,G.imagePositions,eg,eA,ep,ev,eS,e_,eE,V.WritingMode.horizontal,!1,eI,ex,ey);el&&(eb.horizontal[eS]=el),w(),En(ec)&&ed&&em&&(eb.vertical=Ul(ew,G.glyphMap,G.glyphPositions,G.imagePositions,eg,eA,ep,ev,eS,e_,eE,V.WritingMode.vertical,!1,eI,ex,ey))}}let eS=!1;if(eh.icon&&eh.icon.name){let V=G.imageMap[eh.icon.name];V&&(eT=function(V,G,el){let{horizontalAlign:eh,verticalAlign:ec}=Yl(el),ep=G[0]-V.displaySize[0]*eh,ed=G[1]-V.displaySize[1]*ec;return{image:V,top:ed,bottom:ed+V.displaySize[1],left:ep,right:ep+V.displaySize[0]}}(G.imagePositions[eh.icon.name],el.get("icon-offset").evaluate(eh,{},G.canonical),el.get("icon-anchor").evaluate(eh,{},G.canonical)),eS=!!V.sdf,void 0===G.bucket.sdfIcons?G.bucket.sdfIcons=eS:G.bucket.sdfIcons!==eS&&d("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(V.pixelRatio!==G.bucket.pixelRatio||0!==el.get("icon-rotate").constantOr(1))&&(G.bucket.iconsNeedLinear=!0))}let eI=zu(eb.horizontal)||eb.vertical;G.bucket.iconsInText=!!eI&&eI.iconsInText,(eI||eT)&&function(G,el,eh,ec,ep,ed,em,ef,eg,ey,ex){let ev,eb=ed.textMaxSize.evaluate(el,{});void 0===eb&&(eb=em);let ew=G.layers[0].layout,eT=ew.get("icon-offset").evaluate(el,{},ex),eE=zu(eh.horizontal),eS=em/24,eI=G.tilePixelRatio*eS,eA=G.tilePixelRatio*eb/24,eM=G.tilePixelRatio*ef,eC=G.tilePixelRatio*ew.get("symbol-spacing"),ez=ew.get("text-padding")*G.tilePixelRatio,ek=function(V,G,el,eh=1){let ec=V.get("icon-padding").evaluate(G,{},el),ep=ec&&ec.values;return[ep[0]*eh,ep[1]*eh,ep[2]*eh,ep[3]*eh]}(ew,el,ex,G.tilePixelRatio),eP=ew.get("text-max-angle")/180*Math.PI,eD="viewport"!==ew.get("text-rotation-alignment")&&"point"!==ew.get("symbol-placement"),eL="map"===ew.get("icon-rotation-alignment")&&"point"!==ew.get("symbol-placement"),eR=ew.get("symbol-placement"),eB=eC/2,eF=ew.get("icon-text-fit");ec&&"none"!==eF&&(G.allowVerticalPlacement&&eh.vertical&&(ev=Ql(ec,eh.vertical,eF,ew.get("icon-text-fit-padding"),eT,eS)),eE&&(ec=Ql(ec,eE,eF,ew.get("icon-text-fit-padding"),eT,eS)));let P=(ef,e_)=>{e_.x<0||e_.x>=8192||e_.y<0||e_.y>=8192||function(G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew,eT,eE,eS,eI,eA,eM,eC,ez,ek,eP){let eD=G.addToLineVertexArray(el,eh),eL,eR,eB,eF,eO=0,eU=0,eV=0,eN=0,e$=-1,eq=-1,eG={},eZ=tP.exports(""),ej=0,eX=0;if(void 0===ef._unevaluatedLayout.getValue("text-radial-offset")?[ej,eX]=ef.layout.get("text-offset").evaluate(eM,{},ek).map(V=>24*V):(ej=24*ef.layout.get("text-radial-offset").evaluate(eM,{},ek),eX=iw),G.allowVerticalPlacement&&ec.vertical){let V=ef.layout.get("text-rotate").evaluate(eM,{},ek)+90;eB=new mu(eg,el,e_,ey,ex,ec.vertical,ev,eb,ew,V),em&&(eF=new mu(eg,el,e_,ey,ex,em,eE,eS,ew,V))}if(ep){let eh=ef.layout.get("icon-rotate").evaluate(eM,{}),ec="none"!==ef.layout.get("icon-text-fit"),ed=hu(ep,eh,ez,ec),ev=em?hu(em,eh,ez,ec):void 0;eR=new mu(eg,el,e_,ey,ex,ep,eE,eS,!1,eh),eO=4*ed.length;let eb=G.iconSizeData,ew=null;"source"===eb.kind?(ew=[128*ef.layout.get("icon-size").evaluate(eM,{})])[0]>32640&&d(`${G.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`):"composite"===eb.kind&&((ew=[128*eC.compositeIconSizes[0].evaluate(eM,{},ek),128*eC.compositeIconSizes[1].evaluate(eM,{},ek)])[0]>32640||ew[1]>32640)&&d(`${G.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`),G.addSymbols(G.icon,ed,ew,eA,eI,eM,V.WritingMode.none,el,eD.lineStartIndex,eD.lineLength,-1,ek),e$=G.icon.placedSymbolArray.length-1,ev&&(eU=4*ev.length,G.addSymbols(G.icon,ev,ew,eA,eI,eM,V.WritingMode.vertical,el,eD.lineStartIndex,eD.lineLength,-1,ek),eq=G.icon.placedSymbolArray.length-1)}let eW=Object.keys(ec.horizontal);for(let eh of eW){let ep=ec.horizontal[eh];if(!eL){eZ=tP.exports(ep.text);let V=ef.layout.get("text-rotate").evaluate(eM,{},ek);eL=new mu(eg,el,e_,ey,ex,ep,ev,eb,ew,V)}let em=1===ep.positionedLines.length;if(eV+=Mu(G,el,ep,ed,ef,ew,eM,eT,eD,ec.vertical?V.WritingMode.horizontal:V.WritingMode.horizontalOnly,em?eW:[eh],eG,e$,eC,ek),em)break}ec.vertical&&(eN+=Mu(G,el,ec.vertical,ed,ef,ew,eM,eT,eD,V.WritingMode.vertical,["vertical"],eG,eq,eC,ek));let eH=eL?eL.boxStartIndex:G.collisionBoxArray.length,eK=eL?eL.boxEndIndex:G.collisionBoxArray.length,eY=eB?eB.boxStartIndex:G.collisionBoxArray.length,eJ=eB?eB.boxEndIndex:G.collisionBoxArray.length,eQ=eR?eR.boxStartIndex:G.collisionBoxArray.length,e0=eR?eR.boxEndIndex:G.collisionBoxArray.length,e1=eF?eF.boxStartIndex:G.collisionBoxArray.length,e2=eF?eF.boxEndIndex:G.collisionBoxArray.length,e5=-1,W=(V,G)=>V&&V.circleDiameter?Math.max(V.circleDiameter,G):G;e5=W(eL,e5),e5=W(eB,e5),e5=W(eR,e5),e5=W(eF,e5);let e4=e5>-1?1:0;e4&&(e5*=eP/24),G.glyphOffsetArray.length>=Du.MAX_GLYPHS&&d("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==eM.sortKey&&G.addToSortKeyRanges(G.symbolInstances.length,eM.sortKey),G.symbolInstances.emplaceBack(el.x,el.y,eG.right>=0?eG.right:-1,eG.center>=0?eG.center:-1,eG.left>=0?eG.left:-1,eG.vertical||-1,e$,eq,eZ,eH,eK,eY,eJ,eQ,e0,e1,e2,e_,eV,eN,eO,eU,e4,0,ev,ej,eX,e5)}(G,e_,ef,eh,ec,ep,ev,G.layers[0],G.collisionBoxArray,el.index,el.sourceLayerIndex,G.index,eI,[ez,ez,ez,ez],eD,eg,eM,ek,eL,eT,el,ed,ey,ex,em)};if("line"===eR)for(let V of cu(el.geometry,0,0,8192,8192)){let el=function(V,G,el,eh,ec,ep,ed,em,ef){let eg=eh?.6*ep*ed:0,e_=su(eh,ec),ey=e_*ed,ex=0===V[0].x||V[0].x===ef||0===V[0].y||V[0].y===ef;return G-ey<G/4&&(G=ey+G/4),function uu(V,G,el,eh,ec,ep,ed,em,ef){let eg=ep/2,e_=iu(V),ey=0,ex=G-el,ev=[];for(let G=0;G<V.length-1;G++){let ed=V[G],em=V[G+1],eb=ed.dist(em),ew=em.angleTo(ed);for(;ex+el<ey+eb;){ex+=el;let eT=(ex-ey)/eb,eE=Se(ed.x,em.x,eT),eS=Se(ed.y,em.y,eT);if(eE>=0&&eE<ef&&eS>=0&&eS<ef&&ex-eg>=0&&ex+eg<=e_){let el=new ru(eE,eS,ew,G);el._round(),eh&&!nu(V,el,ep,eh,ec)||ev.push(el)}}ey+=eb}return em||ev.length||ed||(ev=uu(V,ey/2,el,eh,ec,ep,ed,!0,ef)),ev}(V,ex?G/2*em%G:(e_/2+2*ep)*ed*em%G,G,eg,el,ey,ex,!1,ef)}(V,eC,eP,eh.vertical||eE,ec,24,eA,G.overscaling,8192);for(let eh of el)eE&&function(V,G,el,eh){let ec=V.compareText;if(G in ec){let V=ec[G];for(let G=V.length-1;G>=0;G--)if(eh.dist(V[G])<el)return!0}else ec[G]=[];return ec[G].push(eh),!1}(G,eE.text,eB,eh)||P(V,eh)}else if("line-center"===eR){for(let V of el.geometry)if(V.length>1){let G=function(V,G,el,eh,ec,ep){let ed=el?.6*24*ep:0,em=su(el,eh)*ep,ef=0,eg=iu(V)/2;for(let el=0;el<V.length-1;el++){let eh=V[el],ec=V[el+1],ep=eh.dist(ec);if(ef+ep>eg){let e_=(eg-ef)/ep,ey=Se(eh.x,ec.x,e_),ex=Se(eh.y,ec.y,e_),ev=new ru(ey,ex,ec.angleTo(eh),el);return ev._round(),!ed||nu(V,ev,em,ed,G)?ev:void 0}ef+=ep}}(V,eP,eh.vertical||eE,ec,0,eA);G&&P(V,G)}}else if("Polygon"===el.type)for(let V of ho(el.geometry,0)){let G=function(V,G=1,el=!1){let eh=1/0,ec=1/0,ep=-1/0,ed=-1/0,em=V[0];for(let V=0;V<em.length;V++){let G=em[V];(!V||G.x<eh)&&(eh=G.x),(!V||G.y<ec)&&(ec=G.y),(!V||G.x>ep)&&(ep=G.x),(!V||G.y>ed)&&(ed=G.y)}let ef=Math.min(ep-eh,ed-ec),eg=ef/2,ey=new gu([],bu);if(0===ef)return new e_(eh,ec);for(let G=eh;G<ep;G+=ef)for(let el=ec;el<ed;el+=ef)ey.push(new wu(G+eg,el+eg,eg,V));let ex=function(V){let G=0,el=0,eh=0,ec=V[0];for(let V=0,ep=ec.length,ed=ep-1;V<ep;ed=V++){let ep=ec[V],em=ec[ed],ef=ep.x*em.y-em.x*ep.y;el+=(ep.x+em.x)*ef,eh+=(ep.y+em.y)*ef,G+=3*ef}return new wu(el/G,eh/G,0,V)}(V),ev=ey.length;for(;ey.length;){let eh=ey.pop();(eh.d>ex.d||!ex.d)&&(ex=eh,el&&console.log("found best %d after %d probes",Math.round(1e4*eh.d)/1e4,ev)),eh.max-ex.d<=G||(eg=eh.h/2,ey.push(new wu(eh.p.x-eg,eh.p.y-eg,eg,V)),ey.push(new wu(eh.p.x+eg,eh.p.y-eg,eg,V)),ey.push(new wu(eh.p.x-eg,eh.p.y+eg,eg,V)),ey.push(new wu(eh.p.x+eg,eh.p.y+eg,eg,V)),ev+=4)}return el&&(console.log(`num probes: ${ev}`),console.log(`best distance: ${ex.d}`)),ex.p}(V,16);P(V[0],new ru(G.x,G.y,0))}else if("LineString"===el.type)for(let V of el.geometry)P(V,new ru(V[0].x,V[0].y,0));else if("Point"===el.type)for(let V of el.geometry)for(let G of V)P([G],new ru(G.x,G.y,0))}(G.bucket,eh,eb,eT,G.imageMap,ec,ex,ev,eE,eS,G.canonical)}G.showCollisionBoxes&&G.bucket.generateCollisionDebugBuffers()},V.perspective=function(V,G,el,eh,ec){var ep,ed=1/Math.tan(G/2);return V[0]=ed/el,V[1]=0,V[2]=0,V[3]=0,V[4]=0,V[5]=ed,V[6]=0,V[7]=0,V[8]=0,V[9]=0,V[11]=-1,V[12]=0,V[13]=0,V[15]=0,null!=ec&&ec!==1/0?(V[10]=(ec+eh)*(ep=1/(eh-ec)),V[14]=2*ec*eh*ep):(V[10]=-1,V[14]=-2*eh),V},V.pick=function(V,G){let el={};for(let eh=0;eh<G.length;eh++){let ec=G[eh];ec in V&&(el[ec]=V[ec])}return el},V.plugin=tI,V.pointGeometry=e_,V.polygonIntersectsPolygon=Xa,V.potpack=Tl,V.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],V.register=Mn,V.registerForPluginStateChange=function(V){return V({pluginStatus:tT,pluginURL:tE}),tS.on("pluginStateChange",V),V},V.renderColorRamp=Cs,V.rotateX=function(V,G,el){var eh=Math.sin(el),ec=Math.cos(el),ep=G[4],ed=G[5],em=G[6],ef=G[7],eg=G[8],e_=G[9],ey=G[10],ex=G[11];return G!==V&&(V[0]=G[0],V[1]=G[1],V[2]=G[2],V[3]=G[3],V[12]=G[12],V[13]=G[13],V[14]=G[14],V[15]=G[15]),V[4]=ep*ec+eg*eh,V[5]=ed*ec+e_*eh,V[6]=em*ec+ey*eh,V[7]=ef*ec+ex*eh,V[8]=eg*ec-ep*eh,V[9]=e_*ec-ed*eh,V[10]=ey*ec-em*eh,V[11]=ex*ec-ef*eh,V},V.rotateZ=function(V,G,el){var eh=Math.sin(el),ec=Math.cos(el),ep=G[0],ed=G[1],em=G[2],ef=G[3],eg=G[4],e_=G[5],ey=G[6],ex=G[7];return G!==V&&(V[8]=G[8],V[9]=G[9],V[10]=G[10],V[11]=G[11],V[12]=G[12],V[13]=G[13],V[14]=G[14],V[15]=G[15]),V[0]=ep*ec+eg*eh,V[1]=ed*ec+e_*eh,V[2]=em*ec+ey*eh,V[3]=ef*ec+ex*eh,V[4]=eg*ec-ep*eh,V[5]=e_*ec-ed*eh,V[6]=ey*ec-em*eh,V[7]=ex*ec-ef*eh,V},V.scale=function(V,G,el){var eh=el[0],ec=el[1],ep=el[2];return V[0]=G[0]*eh,V[1]=G[1]*eh,V[2]=G[2]*eh,V[3]=G[3]*eh,V[4]=G[4]*ec,V[5]=G[5]*ec,V[6]=G[6]*ec,V[7]=G[7]*ec,V[8]=G[8]*ep,V[9]=G[9]*ep,V[10]=G[10]*ep,V[11]=G[11]*ep,V[12]=G[12],V[13]=G[13],V[14]=G[14],V[15]=G[15],V},V.scale$1=function(V,G,el){return V[0]=G[0]*el,V[1]=G[1]*el,V[2]=G[2]*el,V},V.setCacheLimits=function(V,G){ew=V,eT=G},V.setRTLTextPlugin=function(V,G,el=!1){if(tT===tx||tT===tv||tT===tb)throw Error("setRTLTextPlugin cannot be called multiple times.");tE=eg.resolveURL(V),tT=tx,tw=G,Jn(),el||Hn()},V.spec=eD,V.sphericalToCartesian=function([V,G,el]){return G+=90,{x:V*Math.cos(G*=Math.PI/180)*Math.sin(el*=Math.PI/180),y:V*Math.sin(G)*Math.sin(el),z:V*Math.cos(el)}},V.sqrLen=function(V){var G=V[0],el=V[1];return G*G+el*el},V.sub=function(V,G,el){return V[0]=G[0]-el[0],V[1]=G[1]-el[1],V[2]=G[2]-el[2],V},V.toEvaluationFeature=Ka,V.transformMat3=function(V,G,el){var eh=G[0],ec=G[1],ep=G[2];return V[0]=eh*el[0]+ec*el[3]+ep*el[6],V[1]=eh*el[1]+ec*el[4]+ep*el[7],V[2]=eh*el[2]+ec*el[5]+ep*el[8],V},V.transformMat4=bs,V.transformMat4$1=function(V,G,el){var eh=G[0],ec=G[1];return V[0]=el[0]*eh+el[4]*ec+el[12],V[1]=el[1]*eh+el[5]*ec+el[13],V},V.translate=function(V,G,el){var eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew=el[0],eT=el[1],eE=el[2];return G===V?(V[12]=G[0]*ew+G[4]*eT+G[8]*eE+G[12],V[13]=G[1]*ew+G[5]*eT+G[9]*eE+G[13],V[14]=G[2]*ew+G[6]*eT+G[10]*eE+G[14],V[15]=G[3]*ew+G[7]*eT+G[11]*eE+G[15]):(ec=G[1],ep=G[2],ed=G[3],em=G[4],ef=G[5],eg=G[6],e_=G[7],ey=G[8],ex=G[9],ev=G[10],eb=G[11],V[0]=eh=G[0],V[1]=ec,V[2]=ep,V[3]=ed,V[4]=em,V[5]=ef,V[6]=eg,V[7]=e_,V[8]=ey,V[9]=ex,V[10]=ev,V[11]=eb,V[12]=eh*ew+em*eT+ey*eE+G[12],V[13]=ec*ew+ef*eT+ex*eE+G[13],V[14]=ep*ew+eg*eT+ev*eE+G[14],V[15]=ed*ew+e_*eT+eb*eE+G[15]),V},V.triggerPluginCompletionEvent=Gn,V.unicodeBlockLookup=ty,V.uniqueId=function(){return ec++},V.validateCustomStyleLayer=function(V){let G=[],el=V.id;return void 0===el&&G.push({message:`layers.${el}: missing required property "id"`}),void 0===V.render&&G.push({message:`layers.${el}: missing required method "render"`}),V.renderingMode&&"2d"!==V.renderingMode&&"3d"!==V.renderingMode&&G.push({message:`layers.${el}: property "renderingMode" must be either "2d" or "3d"`}),G},V.validateLight=tm,V.validateStyle=gn,V.vectorTile=tJ,V.warnOnce=d,V.wrap=s}),define(["./shared"],function(V){let i=class i{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(G,el){for(let el of G){this._layerConfigs[el.id]=el;let G=this._layers[el.id]=V.createStyleLayer(el);G._featureFilter=V.createFilter(G.filter),this.keyCache[el.id]&&delete this.keyCache[el.id]}for(let V of el)delete this.keyCache[V],delete this._layerConfigs[V],delete this._layers[V];this.familiesBySource={};let eh=function(G,el){let eh={};for(let ec=0;ec<G.length;ec++){let ep=el&&el[G[ec].id]||function(G){let el="";for(let eh of V.refProperties)el+=`/${function t(V){let G=typeof V;if("number"===G||"boolean"===G||"string"===G||null==V)return JSON.stringify(V);if(Array.isArray(V)){let G="[";for(let el of V)G+=`${t(el)},`;return`${G}]`}let el=Object.keys(V).sort(),eh="{";for(let G=0;G<el.length;G++)eh+=`${JSON.stringify(el[G])}:${t(V[el[G]])},`;return`${eh}}`}(G[eh])}`;return el}(G[ec]);el&&(el[G[ec].id]=ep);let ed=eh[ep];ed||(ed=eh[ep]=[]),ed.push(G[ec])}let ec=[];for(let V in eh)ec.push(eh[V]);return ec}(Object.values(this._layerConfigs),this.keyCache);for(let V of eh){let G=V.map(V=>this._layers[V.id]),el=G[0];if("none"===el.visibility)continue;let eh=el.source||"",ec=this.familiesBySource[eh];ec||(ec=this.familiesBySource[eh]={});let ep=el.sourceLayer||"_geojsonTileLayer",ed=ec[ep];ed||(ed=ec[ep]=[]),ed.push(G)}}};let r=class r{constructor(G){let el={},eh=[];for(let V in G){let ec=G[V],ep=el[V]={};for(let V in ec){let G=ec[+V];if(!G||0===G.bitmap.width||0===G.bitmap.height)continue;let el={x:0,y:0,w:G.bitmap.width+2,h:G.bitmap.height+2};eh.push(el),ep[V]={rect:el,metrics:G.metrics}}}let{w:ec,h:ep}=V.potpack(eh),ed=new V.AlphaImage({width:ec||1,height:ep||1});for(let eh in G){let ec=G[eh];for(let G in ec){let ep=ec[+G];if(!ep||0===ep.bitmap.width||0===ep.bitmap.height)continue;let em=el[eh][G].rect;V.AlphaImage.copy(ep.bitmap,ed,{x:0,y:0},{x:em.x+1,y:em.y+1},ep.bitmap)}}this.image=ed,this.positions=el}};V.register("GlyphAtlas",r);let n=class n{constructor(G){this.tileID=new V.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId}parse(G,el,eh,ec,ep){let ed,em,ef,eg;this.status="parsing",this.data=G,this.collisionBoxArray=new V.CollisionBoxArray;let e_=new V.DictionaryCoder(Object.keys(G.layers).sort()),ey=new V.FeatureIndex(this.tileID,this.promoteId);ey.bucketLayerIDs=[];let ex={},ev={featureIndex:ey,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:eh},eb=el.familiesBySource[this.source];for(let el in eb){let ec=G.layers[el];if(!ec)continue;1===ec.version&&V.warnOnce(`Vector tile source "${this.source}" layer "${el}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ep=e_.encode(el),ed=[];for(let V=0;V<ec.length;V++){let G=ec.feature(V),eh=ey.getId(G,el);ed.push({feature:G,id:eh,index:V,sourceLayerIndex:ep})}for(let G of eb[el]){let el=G[0];el.source!==this.source&&V.warnOnce(`layer.source = ${el.source} does not equal this.source = ${this.source}`),el.minzoom&&this.zoom<Math.floor(el.minzoom)||el.maxzoom&&this.zoom>=el.maxzoom||"none"!==el.visibility&&(s(G,this.zoom,eh),(ex[el.id]=el.createBucket({index:ey.bucketLayerIDs.length,layers:G,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ep,sourceID:this.source})).populate(ed,ev,this.tileID.canonical),ey.bucketLayerIDs.push(G.map(V=>V.id)))}}let ew=V.mapObject(ev.glyphDependencies,V=>Object.keys(V).map(Number));Object.keys(ew).length?ec.send("getGlyphs",{uid:this.uid,stacks:ew},(V,G)=>{ed||(ed=V,em=G,w.call(this))}):em={};let eT=Object.keys(ev.iconDependencies);eT.length?ec.send("getImages",{icons:eT,source:this.source,tileID:this.tileID,type:"icons"},(V,G)=>{ed||(ed=V,ef=G,w.call(this))}):ef={};let eE=Object.keys(ev.patternDependencies);function w(){if(ed)return ep(ed);if(em&&ef&&eg){let G=new r(em),el=new V.ImageAtlas(ef,eg);for(let ec in ex){let ep=ex[ec];ep instanceof V.SymbolBucket?(s(ep.layers,this.zoom,eh),V.performSymbolLayout({bucket:ep,glyphMap:em,glyphPositions:G.positions,imageMap:ef,imagePositions:el.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ep.hasPattern&&(ep instanceof V.LineBucket||ep instanceof V.FillBucket||ep instanceof V.FillExtrusionBucket)&&(s(ep.layers,this.zoom,eh),ep.addFeatures(ev,this.tileID.canonical,el.patternPositions))}this.status="done",ep(null,{buckets:Object.values(ex).filter(V=>!V.isEmpty()),featureIndex:ey,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:G.image,imageAtlas:el,glyphMap:this.returnDependencies?em:null,iconMap:this.returnDependencies?ef:null,glyphPositions:this.returnDependencies?G.positions:null})}}eE.length?ec.send("getImages",{icons:eE,source:this.source,tileID:this.tileID,type:"patterns"},(V,G)=>{ed||(ed=V,eg=G,w.call(this))}):eg={},w.call(this)}};function s(G,el,eh){let ec=new V.EvaluationParameters(el);for(let V of G)V.recalculate(ec,eh)}function a(G,el){let eh=V.getArrayBuffer(G.request,(G,eh,ec,ep)=>{G?el(G):eh&&el(null,{vectorTile:new V.vectorTile.VectorTile(new V.pbf(eh)),rawData:eh,cacheControl:ec,expires:ep})});return()=>{eh.cancel(),el()}}let l=class l{constructor(V,G,el,eh){this.actor=V,this.layerIndex=G,this.availableImages=el,this.loadVectorData=eh||a,this.loading={},this.loaded={}}loadTile(G,el){let eh=G.uid;this.loading||(this.loading={});let ec=!!(G&&G.request&&G.request.collectResourceTiming)&&new V.RequestPerformance(G.request),ep=this.loading[eh]=new n(G);ep.abort=this.loadVectorData(G,(G,ed)=>{if(delete this.loading[eh],G||!ed)return ep.status="done",this.loaded[eh]=ep,el(G);let em=ed.rawData,ef={};ed.expires&&(ef.expires=ed.expires),ed.cacheControl&&(ef.cacheControl=ed.cacheControl);let eg={};if(ec){let V=ec.finish();V&&(eg.resourceTiming=JSON.parse(JSON.stringify(V)))}ep.vectorTile=ed.vectorTile,ep.parse(ed.vectorTile,this.layerIndex,this.availableImages,this.actor,(G,eh)=>{if(G||!eh)return el(G);el(null,V.extend({rawTileData:em.slice(0)},eh,ef,eg))}),this.loaded=this.loaded||{},this.loaded[eh]=ep})}reloadTile(V,G){let el=this.loaded,eh=V.uid,ec=this;if(el&&el[eh]){let ep=el[eh];ep.showCollisionBoxes=V.showCollisionBoxes;let s=(V,el)=>{let eh=ep.reloadCallback;eh&&(delete ep.reloadCallback,ep.parse(ep.vectorTile,ec.layerIndex,this.availableImages,ec.actor,eh)),G(V,el)};"parsing"===ep.status?ep.reloadCallback=s:"done"===ep.status&&(ep.vectorTile?ep.parse(ep.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(V,G){let el=this.loading,eh=V.uid;el&&el[eh]&&el[eh].abort&&(el[eh].abort(),delete el[eh]),G()}removeTile(V,G){let el=this.loaded,eh=V.uid;el&&el[eh]&&delete el[eh],G()}};let c=class c{constructor(){this.loaded={}}loadTile(G,el){let{uid:eh,encoding:ec,rawImageData:ep}=G,ed=V.isImageBitmap(ep)?this.getImageData(ep):ep,em=new V.DEMData(eh,ed,ec);this.loaded=this.loaded||{},this.loaded[eh]=em,el(null,em)}getImageData(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);let el=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new V.RGBAImage({width:el.width,height:el.height},el.data)}removeTile(V){let G=this.loaded,el=V.uid;G&&G[el]&&delete G[el]}};var G,u=function e(V,G){var el,eh=V&&V.type;if("FeatureCollection"===eh)for(el=0;el<V.features.length;el++)e(V.features[el],G);else if("GeometryCollection"===eh)for(el=0;el<V.geometries.length;el++)e(V.geometries[el],G);else if("Feature"===eh)e(V.geometry,G);else if("Polygon"===eh)h(V.coordinates,G);else if("MultiPolygon"===eh)for(el=0;el<V.coordinates.length;el++)h(V.coordinates[el],G);return V};function h(V,G){if(0!==V.length){p(V[0],G);for(var el=1;el<V.length;el++)p(V[el],!G)}}function p(V,G){for(var el=0,eh=0,ec=0,ep=V.length,ed=ep-1;ec<ep;ed=ec++){var em=(V[ec][0]-V[ed][0])*(V[ed][1]+V[ec][1]),ef=el+em;eh+=Math.abs(el)>=Math.abs(em)?el-ef+em:em-ef+el,el=ef}el+eh>=0!=!!G&&V.reverse()}let el=V.vectorTile.VectorTileFeature.prototype.toGeoJSON;let d=class d{constructor(G){this._feature=G,this.extent=V.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))}loadGeometry(){if(1===this._feature.type){let G=[];for(let el of this._feature.geometry)G.push([new V.pointGeometry(el[0],el[1])]);return G}{let G=[];for(let el of this._feature.geometry){let eh=[];for(let G of el)eh.push(new V.pointGeometry(G[0],G[1]));G.push(eh)}return G}}toGeoJSON(V,G,eh){return el.call(this,V,G,eh)}};let g=class g{constructor(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=V.EXTENT,this.length=G.length,this._features=G}feature(V){return new d(this._features[V])}};var eh={exports:{}},ec=V.pointGeometry,ep=V.vectorTile.VectorTileFeature;function w(V,G){this.options=G||{},this.features=V,this.length=V.length}function S(V,G){this.id="number"==typeof V.id?V.id:void 0,this.type=V.type,this.rawGeometry=1===V.type?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=G||4096}w.prototype.feature=function(V){return new S(this.features[V],this.options.extent)},S.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var G=0;G<V.length;G++){for(var el=V[G],eh=[],ep=0;ep<el.length;ep++)eh.push(new ec(el[ep][0],el[ep][1]));this.geometry.push(eh)}return this.geometry},S.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,G=1/0,el=-1/0,eh=1/0,ec=-1/0,ep=0;ep<V.length;ep++)for(var ed=V[ep],em=0;em<ed.length;em++){var ef=ed[em];G=Math.min(G,ef.x),el=Math.max(el,ef.x),eh=Math.min(eh,ef.y),ec=Math.max(ec,ef.y)}return[G,eh,el,ec]},S.prototype.toGeoJSON=ep.prototype.toGeoJSON;var ed=V.pbf;function b(V){var G=new ed;return function(V,G){for(var el in V.layers)G.writeMessage(3,k,V.layers[el])}(V,G),G.finish()}function k(V,G){G.writeVarintField(15,V.version||1),G.writeStringField(1,V.name||""),G.writeVarintField(5,V.extent||4096);var el,eh={keys:[],values:[],keycache:{},valuecache:{}};for(el=0;el<V.length;el++)eh.feature=V.feature(el),G.writeMessage(2,P,eh);var ec=eh.keys;for(el=0;el<ec.length;el++)G.writeStringField(3,ec[el]);var ep=eh.values;for(el=0;el<ep.length;el++)G.writeMessage(4,L,ep[el])}function P(V,G){var el=V.feature;void 0!==el.id&&G.writeVarintField(1,el.id),G.writeMessage(2,T,V),G.writeVarintField(3,el.type),G.writeMessage(4,D,el)}function T(V,G){var el=V.feature,eh=V.keys,ec=V.values,ep=V.keycache,ed=V.valuecache;for(var em in el.properties){var ef=el.properties[em],eg=ep[em];if(null!==ef){void 0===eg&&(eh.push(em),ep[em]=eg=eh.length-1),G.writeVarint(eg);var e_=typeof ef;"string"!==e_&&"boolean"!==e_&&"number"!==e_&&(ef=JSON.stringify(ef));var ey=e_+":"+ef,ex=ed[ey];void 0===ex&&(ec.push(ef),ed[ey]=ex=ec.length-1),G.writeVarint(ex)}}}function D(V,G){for(var el=V.loadGeometry(),eh=V.type,ec=0,ep=0,ed=el.length,em=0;em<ed;em++){var ef=el[em],eg=1;1===eh&&(eg=ef.length),G.writeVarint((eg<<3)+1);for(var e_=3===eh?ef.length-1:ef.length,ey=0;ey<e_;ey++){1===ey&&1!==eh&&G.writeVarint((e_-1<<3)+2);var ex=ef[ey].x-ec,ev=ef[ey].y-ep;G.writeVarint(ex<<1^ex>>31),G.writeVarint(ev<<1^ev>>31),ec+=ex,ep+=ev}3===eh&&G.writeVarint(15)}}function L(V,G){var el=typeof V;"string"===el?G.writeStringField(1,V):"boolean"===el?G.writeBooleanField(7,V):"number"===el&&(V%1!=0?G.writeDoubleField(3,V):V<0?G.writeSVarintField(6,V):G.writeVarintField(5,V))}function E(V,G,el,eh){F(V,el,eh),F(G,2*el,2*eh),F(G,2*el+1,2*eh+1)}function F(V,G,el){let eh=V[G];V[G]=V[el],V[el]=eh}function N(V,G,el,eh){let ec=V-el,ep=G-eh;return ec*ec+ep*ep}eh.exports=b,eh.exports.fromVectorTileJs=b,eh.exports.fromGeojsonVt=function(V,G){G=G||{};var el={};for(var eh in V)el[eh]=new w(V[eh].features,G),el[eh].name=eh,el[eh].version=G.version,el[eh].extent=G.extent;return b({layers:el})},eh.exports.GeoJSONWrapper=w;let A=V=>V[0],B=V=>V[1];let J=class J{constructor(V,G=A,el=B,eh=64,ec=Float64Array){this.nodeSize=eh,this.points=V;let ep=V.length<65536?Uint16Array:Uint32Array,ed=this.ids=new ep(V.length),em=this.coords=new ec(2*V.length);for(let eh=0;eh<V.length;eh++)ed[eh]=eh,em[2*eh]=G(V[eh]),em[2*eh+1]=el(V[eh]);!function z(V,G,el,eh,ec,ep){if(ec-eh<=el)return;let ed=eh+ec>>1;(function O(V,G,el,eh,ec,ep){for(;ec>eh;){if(ec-eh>600){let ed=ec-eh+1,em=el-eh+1,ef=Math.log(ed),eg=.5*Math.exp(2*ef/3),e_=.5*Math.sqrt(ef*eg*(ed-eg)/ed)*(em-ed/2<0?-1:1);O(V,G,el,Math.max(eh,Math.floor(el-em*eg/ed+e_)),Math.min(ec,Math.floor(el+(ed-em)*eg/ed+e_)),ep)}let ed=G[2*el+ep],em=eh,ef=ec;for(E(V,G,eh,el),G[2*ec+ep]>ed&&E(V,G,eh,ec);em<ef;){for(E(V,G,em,ef),em++,ef--;G[2*em+ep]<ed;)em++;for(;G[2*ef+ep]>ed;)ef--}G[2*eh+ep]===ed?E(V,G,eh,ef):E(V,G,++ef,ec),ef<=el&&(eh=ef+1),el<=ef&&(ec=ef-1)}})(V,G,ed,eh,ec,ep%2),z(V,G,el,eh,ed-1,ep+1),z(V,G,el,ed+1,ec,ep+1)}(ed,em,eh,0,ed.length-1,0)}range(V,G,el,eh){return function(V,G,el,eh,ec,ep,ed){let em,ef;let eg=[0,V.length-1,0],e_=[];for(;eg.length;){let ey=eg.pop(),ex=eg.pop(),ev=eg.pop();if(ex-ev<=ed){for(let ed=ev;ed<=ex;ed++)em=G[2*ed],ef=G[2*ed+1],em>=el&&em<=ec&&ef>=eh&&ef<=ep&&e_.push(V[ed]);continue}let eb=Math.floor((ev+ex)/2);em=G[2*eb],ef=G[2*eb+1],em>=el&&em<=ec&&ef>=eh&&ef<=ep&&e_.push(V[eb]);let ew=(ey+1)%2;(0===ey?el<=em:eh<=ef)&&(eg.push(ev),eg.push(eb-1),eg.push(ew)),(0===ey?ec>=em:ep>=ef)&&(eg.push(eb+1),eg.push(ex),eg.push(ew))}return e_}(this.ids,this.coords,V,G,el,eh,this.nodeSize)}within(V,G,el){return function(V,G,el,eh,ec,ep){let ed=[0,V.length-1,0],em=[],ef=ec*ec;for(;ed.length;){let eg=ed.pop(),e_=ed.pop(),ey=ed.pop();if(e_-ey<=ep){for(let ec=ey;ec<=e_;ec++)N(G[2*ec],G[2*ec+1],el,eh)<=ef&&em.push(V[ec]);continue}let ex=Math.floor((ey+e_)/2),ev=G[2*ex],eb=G[2*ex+1];N(ev,eb,el,eh)<=ef&&em.push(V[ex]);let ew=(eg+1)%2;(0===eg?el-ec<=ev:eh-ec<=eb)&&(ed.push(ey),ed.push(ex-1),ed.push(ew)),(0===eg?el+ec>=ev:eh+ec>=eb)&&(ed.push(ex+1),ed.push(e_),ed.push(ew))}return em}(this.ids,this.coords,V,G,el,this.nodeSize)}};let em={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:V=>V},ef=Math.fround||(G=new Float32Array(1),V=>(G[0]=+V,G[0]));let Y=class Y{constructor(V){this.options=H(Object.create(em),V),this.trees=Array(this.options.maxZoom+1)}load(V){let{log:G,minZoom:el,maxZoom:eh,nodeSize:ec}=this.options;G&&console.time("total time");let ep=`prepare ${V.length} points`;G&&console.time(ep),this.points=V;let ed=[];for(let G=0;G<V.length;G++)V[G].geometry&&ed.push(function(V,G){let[el,eh]=V.geometry.coordinates;return{x:ef($(el)),y:ef(q(eh)),zoom:1/0,index:G,parentId:-1}}(V[G],G));this.trees[eh+1]=new J(ed,K,Q,ec,Float32Array),G&&console.timeEnd(ep);for(let V=eh;V>=el;V--){let el=+Date.now();ed=this._cluster(ed,V),this.trees[V]=new J(ed,K,Q,ec,Float32Array),G&&console.log("z%d: %d clusters in %dms",V,ed.length,+Date.now()-el)}return G&&console.timeEnd("total time"),this}getClusters(V,G){let el=((V[0]+180)%360+360)%360-180,eh=Math.max(-90,Math.min(90,V[1])),ec=180===V[2]?180:((V[2]+180)%360+360)%360-180,ep=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)el=-180,ec=180;else if(el>ec){let V=this.getClusters([el,eh,180,ep],G),ed=this.getClusters([-180,eh,ec,ep],G);return V.concat(ed)}let ed=this.trees[this._limitZoom(G)],em=ed.range($(el),q(ep),$(ec),q(eh)),ef=[];for(let V of em){let G=ed.points[V];ef.push(G.numPoints?R(G):this.points[G.index])}return ef}getChildren(V){let G=this._getOriginId(V),el=this._getOriginZoom(V),eh="No cluster with the specified id.",ec=this.trees[el];if(!ec)throw Error(eh);let ep=ec.points[G];if(!ep)throw Error(eh);let ed=this.options.radius/(this.options.extent*Math.pow(2,el-1)),em=ec.within(ep.x,ep.y,ed),ef=[];for(let G of em){let el=ec.points[G];el.parentId===V&&ef.push(el.numPoints?R(el):this.points[el.index])}if(0===ef.length)throw Error(eh);return ef}getLeaves(V,G,el){let eh=[];return this._appendLeaves(eh,V,G=G||10,el=el||0,0),eh}getTile(V,G,el){let eh=this.trees[this._limitZoom(V)],ec=Math.pow(2,V),{extent:ep,radius:ed}=this.options,em=ed/ep,ef=(el-em)/ec,eg=(el+1+em)/ec,e_={features:[]};return this._addTileFeatures(eh.range((G-em)/ec,ef,(G+1+em)/ec,eg),eh.points,G,el,ec,e_),0===G&&this._addTileFeatures(eh.range(1-em/ec,ef,1,eg),eh.points,ec,el,ec,e_),G===ec-1&&this._addTileFeatures(eh.range(0,ef,em/ec,eg),eh.points,-1,el,ec,e_),e_.features.length?e_:null}getClusterExpansionZoom(V){let G=this._getOriginZoom(V)-1;for(;G<=this.options.maxZoom;){let el=this.getChildren(V);if(G++,1!==el.length)break;V=el[0].properties.cluster_id}return G}_appendLeaves(V,G,el,eh,ec){let ep=this.getChildren(G);for(let G of ep){let ep=G.properties;if(ep&&ep.cluster?ec+ep.point_count<=eh?ec+=ep.point_count:ec=this._appendLeaves(V,ep.cluster_id,el,eh,ec):ec<eh?ec++:V.push(G),V.length===el)break}return ec}_addTileFeatures(V,G,el,eh,ec,ep){for(let ed of V){let V,em,ef,eg;let e_=G[ed],ey=e_.numPoints;if(ey)V=W(e_),em=e_.x,ef=e_.y;else{let G=this.points[e_.index];V=G.properties,em=$(G.geometry.coordinates[0]),ef=q(G.geometry.coordinates[1])}let ex={type:1,geometry:[[Math.round(this.options.extent*(em*ec-el)),Math.round(this.options.extent*(ef*ec-eh))]],tags:V};ey?eg=e_.id:this.options.generateId?eg=e_.index:this.points[e_.index].id&&(eg=this.points[e_.index].id),void 0!==eg&&(ex.id=eg),ep.features.push(ex)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,G){let el=[],{radius:eh,extent:ec,reduce:ep,minPoints:ed}=this.options,em=eh/(ec*Math.pow(2,G));for(let eh=0;eh<V.length;eh++){let ec=V[eh];if(ec.zoom<=G)continue;ec.zoom=G;let ev=this.trees[G+1],eb=ev.within(ec.x,ec.y,em),ew=ec.numPoints||1,eT=ew;for(let V of eb){let el=ev.points[V];el.zoom>G&&(eT+=el.numPoints||1)}if(eT>ew&&eT>=ed){var eg,e_,ey,ex;let V=ec.x*ew,ed=ec.y*ew,em=ep&&ew>1?this._map(ec,!0):null,eE=(eh<<5)+(G+1)+this.points.length;for(let el of eb){let eh=ev.points[el];if(eh.zoom<=G)continue;eh.zoom=G;let ef=eh.numPoints||1;V+=eh.x*ef,ed+=eh.y*ef,eh.parentId=eE,ep&&(em||(em=this._map(ec,!0)),ep(em,this._map(eh)))}ec.parentId=eE,el.push((eg=V/eT,e_=ed/eT,ey=eT,ex=em,{x:ef(eg),y:ef(e_),zoom:1/0,id:eE,parentId:-1,numPoints:ey,properties:ex}))}else if(el.push(ec),eT>1)for(let V of eb){let eh=ev.points[V];eh.zoom<=G||(eh.zoom=G,el.push(eh))}}return el}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,G){if(V.numPoints)return G?H({},V.properties):V.properties;let el=this.points[V.index].properties,eh=this.options.map(el);return G&&eh===el?H({},eh):eh}};function R(V){return{type:"Feature",id:V.id,properties:W(V),geometry:{type:"Point",coordinates:[360*(V.x-.5),function(V){let G=(180-360*V)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}(V.y)]}}}function W(V){let G=V.numPoints,el=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G;return H(H({},V.properties),{cluster:!0,cluster_id:V.id,point_count:G,point_count_abbreviated:el})}function $(V){return V/360+.5}function q(V){let G=Math.sin(V*Math.PI/180),el=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return el<0?0:el>1?1:el}function H(V,G){for(let el in G)V[el]=G[el];return V}function K(V){return V.x}function Q(V){return V.y}function oe(V,G,el,eh){var ec={id:void 0===V?null:V,type:G,geometry:el,tags:eh,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(V){var G=V.geometry,el=V.type;if("Point"===el||"MultiPoint"===el||"LineString"===el)ie(V,G);else if("Polygon"===el||"MultiLineString"===el)for(var eh=0;eh<G.length;eh++)ie(V,G[eh]);else if("MultiPolygon"===el)for(eh=0;eh<G.length;eh++)for(var ec=0;ec<G[eh].length;ec++)ie(V,G[eh][ec])}(ec),ec}function ie(V,G){for(var el=0;el<G.length;el+=3)V.minX=Math.min(V.minX,G[el]),V.minY=Math.min(V.minY,G[el+1]),V.maxX=Math.max(V.maxX,G[el]),V.maxY=Math.max(V.maxY,G[el+1])}function re(V,G,el,eh){if(G.geometry){var ec=G.geometry.coordinates,ep=G.geometry.type,ed=Math.pow(el.tolerance/((1<<el.maxZoom)*el.extent),2),em=[],ef=G.id;if(el.promoteId?ef=G.properties[el.promoteId]:el.generateId&&(ef=eh||0),"Point"===ep)ne(ec,em);else if("MultiPoint"===ep)for(var eg=0;eg<ec.length;eg++)ne(ec[eg],em);else if("LineString"===ep)se(ec,em,ed,!1);else if("MultiLineString"===ep){if(el.lineMetrics){for(eg=0;eg<ec.length;eg++)se(ec[eg],em=[],ed,!1),V.push(oe(ef,"LineString",em,G.properties));return}ae(ec,em,ed,!1)}else if("Polygon"===ep)ae(ec,em,ed,!0);else{if("MultiPolygon"!==ep){if("GeometryCollection"===ep){for(eg=0;eg<G.geometry.geometries.length;eg++)re(V,{id:ef,geometry:G.geometry.geometries[eg],properties:G.properties},el,eh);return}throw Error("Input data is not a valid GeoJSON object.")}for(eg=0;eg<ec.length;eg++){var e_=[];ae(ec[eg],e_,ed,!0),em.push(e_)}}V.push(oe(ef,ep,em,G.properties))}}function ne(V,G){var el;G.push(V[0]/360+.5),G.push(ce(V[1])),G.push(0)}function se(V,G,el,eh){for(var ec,ep,ed=0,em=0;em<V.length;em++){var ef,eg=V[em][0]/360+.5,e_=ce(V[em][1]);G.push(eg),G.push(e_),G.push(0),em>0&&(ed+=eh?(ec*e_-eg*ep)/2:Math.sqrt(Math.pow(eg-ec,2)+Math.pow(e_-ep,2))),ec=eg,ep=e_}var ey=G.length-3;G[2]=1,function ee(V,G,el,eh){for(var ec,ep=eh,ed=el-G>>1,em=el-G,ef=V[G],eg=V[G+1],e_=V[el],ey=V[el+1],ex=G+3;ex<el;ex+=3){var ev=function(V,G,el,eh,ec,ep){var ed=ec-el,em=ep-eh;if(0!==ed||0!==em){var ef=((V-el)*ed+(G-eh)*em)/(ed*ed+em*em);ef>1?(el=ec,eh=ep):ef>0&&(el+=ed*ef,eh+=em*ef)}return(ed=V-el)*ed+(em=G-eh)*em}(V[ex],V[ex+1],ef,eg,e_,ey);if(ev>ep)ec=ex,ep=ev;else if(ev===ep){var eb=Math.abs(ex-ed);eb<em&&(ec=ex,em=eb)}}ep>eh&&(ec-G>3&&ee(V,G,ec,eh),V[ec+2]=ep,el-ec>3&&ee(V,ec,el,eh))}(G,0,ey,el),G[ey+2]=1,G.size=Math.abs(ed),G.start=0,G.end=G.size}function ae(V,G,el,eh){for(var ec=0;ec<V.length;ec++){var ep=[];se(V[ec],ep,el,eh),G.push(ep)}}function ce(V){var G=Math.sin(V*Math.PI/180),el=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return el<0?0:el>1?1:el}function ue(V,G,el,eh,ec,ep,ed,em){if(eh/=G,ep>=(el/=G)&&ed<eh)return V;if(ed<el||ep>=eh)return null;for(var ef=[],eg=0;eg<V.length;eg++){var e_=V[eg],ey=e_.geometry,ex=e_.type,ev=0===ec?e_.minX:e_.minY,eb=0===ec?e_.maxX:e_.maxY;if(ev>=el&&eb<eh)ef.push(e_);else if(!(eb<el||ev>=eh)){var ew=[];if("Point"===ex||"MultiPoint"===ex)(function(V,G,el,eh,ec){for(var ep=0;ep<V.length;ep+=3){var ed=V[ep+ec];ed>=el&&ed<=eh&&(G.push(V[ep]),G.push(V[ep+1]),G.push(V[ep+2]))}})(ey,ew,el,eh,ec);else if("LineString"===ex)pe(ey,ew,el,eh,ec,!1,em.lineMetrics);else if("MultiLineString"===ex)de(ey,ew,el,eh,ec,!1);else if("Polygon"===ex)de(ey,ew,el,eh,ec,!0);else if("MultiPolygon"===ex)for(var eT=0;eT<ey.length;eT++){var eE=[];de(ey[eT],eE,el,eh,ec,!0),eE.length&&ew.push(eE)}if(ew.length){if(em.lineMetrics&&"LineString"===ex){for(eT=0;eT<ew.length;eT++)ef.push(oe(e_.id,ex,ew[eT],e_.tags));continue}"LineString"!==ex&&"MultiLineString"!==ex||(1===ew.length?(ex="LineString",ew=ew[0]):ex="MultiLineString"),"Point"!==ex&&"MultiPoint"!==ex||(ex=3===ew.length?"Point":"MultiPoint"),ef.push(oe(e_.id,ex,ew,e_.tags))}}}return ef.length?ef:null}function pe(V,G,el,eh,ec,ep,ed){for(var em,ef,eg=fe(V),e_=0===ec?me:ye,ey=V.start,ex=0;ex<V.length-3;ex+=3){var ev=V[ex],eb=V[ex+1],ew=V[ex+2],eT=V[ex+3],eE=V[ex+4],eS=0===ec?ev:eb,eI=0===ec?eT:eE,eA=!1;ed&&(em=Math.sqrt(Math.pow(ev-eT,2)+Math.pow(eb-eE,2))),eS<el?eI>el&&(ef=e_(eg,ev,eb,eT,eE,el),ed&&(eg.start=ey+em*ef)):eS>eh?eI<eh&&(ef=e_(eg,ev,eb,eT,eE,eh),ed&&(eg.start=ey+em*ef)):ge(eg,ev,eb,ew),eI<el&&eS>=el&&(ef=e_(eg,ev,eb,eT,eE,el),eA=!0),eI>eh&&eS<=eh&&(ef=e_(eg,ev,eb,eT,eE,eh),eA=!0),!ep&&eA&&(ed&&(eg.end=ey+em*ef),G.push(eg),eg=fe(V)),ed&&(ey+=em)}var eM=V.length-3;ev=V[eM],eb=V[eM+1],ew=V[eM+2],(eS=0===ec?ev:eb)>=el&&eS<=eh&&ge(eg,ev,eb,ew),eM=eg.length-3,ep&&eM>=3&&(eg[eM]!==eg[0]||eg[eM+1]!==eg[1])&&ge(eg,eg[0],eg[1],eg[2]),eg.length&&G.push(eg)}function fe(V){var G=[];return G.size=V.size,G.start=V.start,G.end=V.end,G}function de(V,G,el,eh,ec,ep){for(var ed=0;ed<V.length;ed++)pe(V[ed],G,el,eh,ec,ep,!1)}function ge(V,G,el,eh){V.push(G),V.push(el),V.push(eh)}function me(V,G,el,eh,ec,ep){var ed=(ep-G)/(eh-G);return V.push(ep),V.push(el+(ec-el)*ed),V.push(1),ed}function ye(V,G,el,eh,ec,ep){var ed=(ep-el)/(ec-el);return V.push(G+(eh-G)*ed),V.push(ep),V.push(1),ed}function ve(V,G){for(var el=[],eh=0;eh<V.length;eh++){var ec,ep=V[eh],ed=ep.type;if("Point"===ed||"MultiPoint"===ed||"LineString"===ed)ec=xe(ep.geometry,G);else if("MultiLineString"===ed||"Polygon"===ed){ec=[];for(var em=0;em<ep.geometry.length;em++)ec.push(xe(ep.geometry[em],G))}else if("MultiPolygon"===ed)for(ec=[],em=0;em<ep.geometry.length;em++){for(var ef=[],eg=0;eg<ep.geometry[em].length;eg++)ef.push(xe(ep.geometry[em][eg],G));ec.push(ef)}el.push(oe(ep.id,ed,ec,ep.tags))}return el}function xe(V,G){var el=[];el.size=V.size,void 0!==V.start&&(el.start=V.start,el.end=V.end);for(var eh=0;eh<V.length;eh+=3)el.push(V[eh]+G,V[eh+1],V[eh+2]);return el}function we(V,G){if(V.transformed)return V;var el,eh,ec,ep=1<<V.z,ed=V.x,em=V.y;for(el=0;el<V.features.length;el++){var ef=V.features[el],eg=ef.geometry,e_=ef.type;if(ef.geometry=[],1===e_)for(eh=0;eh<eg.length;eh+=2)ef.geometry.push(Se(eg[eh],eg[eh+1],G,ep,ed,em));else for(eh=0;eh<eg.length;eh++){var ey=[];for(ec=0;ec<eg[eh].length;ec+=2)ey.push(Se(eg[eh][ec],eg[eh][ec+1],G,ep,ed,em));ef.geometry.push(ey)}}return V.transformed=!0,V}function Se(V,G,el,eh,ec,ep){return[Math.round(el*(V*eh-ec)),Math.round(el*(G*eh-ep))]}function be(V,G,el,eh,ec,ep){var ed=eh*eh;if(eh>0&&G.size<(ec?ed:eh))el.numPoints+=G.length/3;else{for(var em=[],ef=0;ef<G.length;ef+=3)(0===eh||G[ef+2]>ed)&&(el.numSimplified++,em.push(G[ef]),em.push(G[ef+1])),el.numPoints++;ec&&function(V,G){for(var el=0,eh=0,ec=V.length,ep=ec-2;eh<ec;ep=eh,eh+=2)el+=(V[eh]-V[ep])*(V[eh+1]+V[ep+1]);if(el>0===G)for(eh=0,ec=V.length;eh<ec/2;eh+=2){var ed=V[eh],em=V[eh+1];V[eh]=V[ec-2-eh],V[eh+1]=V[ec-1-eh],V[ec-2-eh]=ed,V[ec-1-eh]=em}}(em,ep),V.push(em)}}function ke(V,G){var el,eh,ec,ep,ed,em,ef=(G=this.options=function(V,G){for(var el in G)V[el]=G[el];return V}(Object.create(this.options),G)).debug;if(ef&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw Error("promoteId and generateId cannot be used together.");var eg=function(V,G){var el=[];if("FeatureCollection"===V.type)for(var eh=0;eh<V.features.length;eh++)re(el,V.features[eh],G,eh);else re(el,"Feature"===V.type?V:{geometry:V},G);return el}(V,G);this.tiles={},this.tileCoords=[],ef&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),el=eg,ec=(eh=G).buffer/eh.extent,ep=el,ed=ue(el,1,-1-ec,ec,0,-1,2,eh),em=ue(el,1,1-ec,2+ec,0,-1,2,eh),(ed||em)&&(ep=ue(el,1,-ec,1+ec,0,-1,2,eh)||[],ed&&(ep=ve(ed,1).concat(ep)),em&&(ep=ep.concat(ve(em,-1)))),(eg=ep).length&&this.splitTile(eg,0,0,0),ef&&(eg.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Pe(V,G,el){return 32*((1<<V)*el+G)+V}function Te(V,G){let el=V.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);let ec=this._geoJSONIndex.getTile(el.z,el.x,el.y);if(!ec)return G(null,null);let ep=new g(ec.features),ed=eh.exports(ep);0===ed.byteOffset&&ed.byteLength===ed.buffer.byteLength||(ed=new Uint8Array(ed)),G(null,{vectorTile:ep,rawData:ed.buffer})}ke.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ke.prototype.splitTile=function(V,G,el,eh,ec,ep,ed){for(var em=[V,G,el,eh],ef=this.options,eg=ef.debug;em.length;){eh=em.pop(),el=em.pop(),G=em.pop(),V=em.pop();var e_=1<<G,ey=Pe(G,el,eh),ex=this.tiles[ey];if(!ex&&(eg>1&&console.time("creation"),ex=this.tiles[ey]=function(V,G,el,eh,ec){for(var ep=G===ec.maxZoom?0:ec.tolerance/((1<<G)*ec.extent),ed={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:el,y:eh,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},em=0;em<V.length;em++){ed.numFeatures++,function(V,G,el,eh){var ec=G.geometry,ep=G.type,ed=[];if("Point"===ep||"MultiPoint"===ep)for(var em=0;em<ec.length;em+=3)ed.push(ec[em]),ed.push(ec[em+1]),V.numPoints++,V.numSimplified++;else if("LineString"===ep)be(ed,ec,V,el,!1,!1);else if("MultiLineString"===ep||"Polygon"===ep)for(em=0;em<ec.length;em++)be(ed,ec[em],V,el,"Polygon"===ep,0===em);else if("MultiPolygon"===ep)for(var ef=0;ef<ec.length;ef++){var eg=ec[ef];for(em=0;em<eg.length;em++)be(ed,eg[em],V,el,!0,0===em)}if(ed.length){var e_=G.tags||null;if("LineString"===ep&&eh.lineMetrics){for(var ey in e_={},G.tags)e_[ey]=G.tags[ey];e_.mapbox_clip_start=ec.start/ec.size,e_.mapbox_clip_end=ec.end/ec.size}var ex={geometry:ed,type:"Polygon"===ep||"MultiPolygon"===ep?3:"LineString"===ep||"MultiLineString"===ep?2:1,tags:e_};null!==G.id&&(ex.id=G.id),V.features.push(ex)}}(ed,V[em],ep,ec);var ef=V[em].minX,eg=V[em].minY,e_=V[em].maxX,ey=V[em].maxY;ef<ed.minX&&(ed.minX=ef),eg<ed.minY&&(ed.minY=eg),e_>ed.maxX&&(ed.maxX=e_),ey>ed.maxY&&(ed.maxY=ey)}return ed}(V,G,el,eh,ef),this.tileCoords.push({z:G,x:el,y:eh}),eg)){eg>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,el,eh,ex.numFeatures,ex.numPoints,ex.numSimplified),console.timeEnd("creation"));var ev="z"+G;this.stats[ev]=(this.stats[ev]||0)+1,this.total++}if(ex.source=V,ec){if(G===ef.maxZoom||G===ec)continue;var eb=1<<ec-G;if(el!==Math.floor(ep/eb)||eh!==Math.floor(ed/eb))continue}else if(G===ef.indexMaxZoom||ex.numPoints<=ef.indexMaxPoints)continue;if(ex.source=null,0!==V.length){eg>1&&console.time("clipping");var ew,eT,eE,eS,eI,eA,eM=.5*ef.buffer/ef.extent,eC=.5-eM,ez=.5+eM,ek=1+eM;ew=eT=eE=eS=null,eI=ue(V,e_,el-eM,el+ez,0,ex.minX,ex.maxX,ef),eA=ue(V,e_,el+eC,el+ek,0,ex.minX,ex.maxX,ef),V=null,eI&&(ew=ue(eI,e_,eh-eM,eh+ez,1,ex.minY,ex.maxY,ef),eT=ue(eI,e_,eh+eC,eh+ek,1,ex.minY,ex.maxY,ef),eI=null),eA&&(eE=ue(eA,e_,eh-eM,eh+ez,1,ex.minY,ex.maxY,ef),eS=ue(eA,e_,eh+eC,eh+ek,1,ex.minY,ex.maxY,ef),eA=null),eg>1&&console.timeEnd("clipping"),em.push(ew||[],G+1,2*el,2*eh),em.push(eT||[],G+1,2*el,2*eh+1),em.push(eE||[],G+1,2*el+1,2*eh),em.push(eS||[],G+1,2*el+1,2*eh+1)}}},ke.prototype.getTile=function(V,G,el){var eh=this.options,ec=eh.extent,ep=eh.debug;if(V<0||V>24)return null;var ed=1<<V,em=Pe(V,G=(G%ed+ed)%ed,el);if(this.tiles[em])return we(this.tiles[em],ec);ep>1&&console.log("drilling down to z%d-%d-%d",V,G,el);for(var ef,eg=V,e_=G,ey=el;!ef&&eg>0;)eg--,e_=Math.floor(e_/2),ey=Math.floor(ey/2),ef=this.tiles[Pe(eg,e_,ey)];return ef&&ef.source?(ep>1&&console.log("found parent tile z%d-%d-%d",eg,e_,ey),ep>1&&console.time("drilling down"),this.splitTile(ef.source,eg,e_,ey,V,G,el),ep>1&&console.timeEnd("drilling down"),this.tiles[em]?we(this.tiles[em],ec):null):null};let Ce=class Ce extends l{constructor(V,G,el,eh){super(V,G,el,Te),eh&&(this.loadGeoJSON=eh)}loadData(G,el){var eh;null===(eh=this._pendingRequest)||void 0===eh||eh.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});let ec=!!(G&&G.request&&G.request.collectResourceTiming)&&new V.RequestPerformance(G.request);this._pendingCallback=el,this._pendingRequest=this.loadGeoJSON(G,(eh,ep)=>{if(delete this._pendingCallback,delete this._pendingRequest,eh||!ep)return el(eh);if("object"!=typeof ep)return el(Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{u(ep,!0);try{var ed,em;if(G.filter){let el=V.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===el.result)throw Error(el.value.map(V=>`${V.key}: ${V.message}`).join(", "));let eh=ep.features.filter(V=>el.value.evaluate({zoom:0},V));ep={type:"FeatureCollection",features:eh}}this._geoJSONIndex=G.cluster?new Y(function({superclusterOptions:G,clusterProperties:el}){if(!el||!G)return G;let eh={},ec={},ep={accumulated:null,zoom:0},ed={properties:null},em=Object.keys(el);for(let G of em){let[ep,ed]=el[G],em=V.createExpression(ed),ef=V.createExpression("string"==typeof ep?[ep,["accumulated"],["get",G]]:ep);eh[G]=em.value,ec[G]=ef.value}return G.map=V=>{ed.properties=V;let G={};for(let V of em)G[V]=eh[V].evaluate(ep,ed);return G},G.reduce=(V,G)=>{for(let el of(ed.properties=G,em))ep.accumulated=V[el],V[el]=ec[el].evaluate(ep,ed)},G}(G)).load(ep.features):(ed=ep,em=G.geojsonVtOptions,new ke(ed,em))}catch(V){return el(V)}this.loaded={};let eh={};if(ec){let V=ec.finish();V&&(eh.resourceTiming={},eh.resourceTiming[G.source]=JSON.parse(JSON.stringify(V)))}el(null,eh)}})}reloadTile(V,G){let el=this.loaded;return el&&el[V.uid]?super.reloadTile(V,G):this.loadTile(V,G)}loadGeoJSON(G,el){if(G.request)return V.getJSON(G.request,el);if("string"==typeof G.data)try{el(null,JSON.parse(G.data))}catch(V){el(Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}else el(Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(V,G){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),G()}getClusterExpansionZoom(V,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(V){G(V)}}getClusterChildren(V,G){try{G(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(V){G(V)}}getClusterLeaves(V,G){try{G(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(V){G(V)}}};let _e=class _e{constructor(G){this.self=G,this.actor=new V.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:l,geojson:Ce},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,G)=>{if(this.workerSourceTypes[V])throw Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=G},this.self.registerRTLTextPlugin=G=>{if(V.plugin.isParsed())throw Error("RTL text plugin already registered.");V.plugin.applyArabicShaping=G.applyArabicShaping,V.plugin.processBidirectionalText=G.processBidirectionalText,V.plugin.processStyledBidirectionalText=G.processStyledBidirectionalText}}setReferrer(V,G){this.referrer=G}setImages(V,G,el){for(let el in this.availableImages[V]=G,this.workerSources[V]){let eh=this.workerSources[V][el];for(let V in eh)eh[V].availableImages=G}el()}setLayers(V,G,el){this.getLayerIndex(V).replace(G),el()}updateLayers(V,G,el){this.getLayerIndex(V).update(G.layers,G.removedIds),el()}loadTile(V,G,el){this.getWorkerSource(V,G.type,G.source).loadTile(G,el)}loadDEMTile(V,G,el){this.getDEMWorkerSource(V,G.source).loadTile(G,el)}reloadTile(V,G,el){this.getWorkerSource(V,G.type,G.source).reloadTile(G,el)}abortTile(V,G,el){this.getWorkerSource(V,G.type,G.source).abortTile(G,el)}removeTile(V,G,el){this.getWorkerSource(V,G.type,G.source).removeTile(G,el)}removeDEMTile(V,G){this.getDEMWorkerSource(V,G.source).removeTile(G)}removeSource(V,G,el){if(!this.workerSources[V]||!this.workerSources[V][G.type]||!this.workerSources[V][G.type][G.source])return;let eh=this.workerSources[V][G.type][G.source];delete this.workerSources[V][G.type][G.source],void 0!==eh.removeSource?eh.removeSource(G,el):el()}loadWorkerSource(V,G,el){try{this.self.importScripts(G.url),el()}catch(V){el(V.toString())}}syncRTLPluginState(G,el,eh){try{V.plugin.setState(el);let G=V.plugin.getPluginURL();if(V.plugin.isLoaded()&&!V.plugin.isParsed()&&null!=G){this.self.importScripts(G);let el=V.plugin.isParsed();eh(el?void 0:Error(`RTL Text Plugin failed to import scripts from ${G}`),el)}}catch(V){eh(V.toString())}}getAvailableImages(V){let G=this.availableImages[V];return G||(G=[]),G}getLayerIndex(V){let G=this.layerIndexes[V];return G||(G=this.layerIndexes[V]=new i),G}getWorkerSource(V,G,el){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][G]||(this.workerSources[V][G]={}),this.workerSources[V][G][el]||(this.workerSources[V][G][el]=new this.workerSourceTypes[G]({send:(G,el,eh)=>{this.actor.send(G,el,eh,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][G][el]}getDEMWorkerSource(V,G){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][G]||(this.demWorkerSources[V][G]=new c),this.demWorkerSources[V][G]}enforceCacheSizeLimit(G,el){V.enforceCacheSizeLimit(el)}};return V.isWorker()&&(self.worker=new _e(self)),_e}),define(["./shared"],function(V){let G,el,eh;function i(V){var G;return"undefined"!=typeof window&&"undefined"!=typeof document&&!!Array.prototype&&!!Array.prototype.every&&!!Array.prototype.filter&&!!Array.prototype.forEach&&!!Array.prototype.indexOf&&!!Array.prototype.lastIndexOf&&!!Array.prototype.map&&!!Array.prototype.some&&!!Array.prototype.reduce&&!!Array.prototype.reduceRight&&!!Array.isArray&&!!Function.prototype&&!!Function.prototype.bind&&!!Object.keys&&!!Object.create&&!!Object.getPrototypeOf&&!!Object.getOwnPropertyNames&&!!Object.isSealed&&!!Object.isFrozen&&!!Object.isExtensible&&!!Object.getOwnPropertyDescriptor&&!!Object.defineProperty&&!!Object.defineProperties&&!!Object.seal&&!!Object.freeze&&!!Object.preventExtensions&&!!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)&&!!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var V,G,el=new Blob([""],{type:"text/javascript"}),eh=URL.createObjectURL(el);try{G=new Worker(eh),V=!0}catch(G){V=!1}return G&&G.terminate(),URL.revokeObjectURL(eh),V}()&&"Uint8ClampedArray"in window&&!!ArrayBuffer.isView&&!!function(){var V=document.createElement("canvas");V.width=V.height=1;var G=V.getContext("2d");if(!G)return!1;var el=G.getImageData(0,0,1,1);return el&&el.width===V.width}()&&(void 0===ec[G=V&&V.failIfMajorPerformanceCaveat]&&(ec[G]=function(V){var G,el,eh,ec=(G=document.createElement("canvas"),(el=Object.create(i.webGLContextAttributes)).failIfMajorPerformanceCaveat=V,G.getContext("webgl",el)||G.getContext("experimental-webgl",el));if(!ec)return!1;try{eh=ec.createShader(ec.VERTEX_SHADER)}catch(V){return!1}return!(!eh||ec.isContextLost())&&(ec.shaderSource(eh,"void main() {}"),ec.compileShader(eh),!0===ec.getShaderParameter(eh,ec.COMPILE_STATUS))}(G)),!!ec[G]&&!document.documentMode)}var ec={};function a(V,G){if(Array.isArray(V)){if(!Array.isArray(G)||V.length!==G.length)return!1;for(let el=0;el<V.length;el++)if(!a(V[el],G[el]))return!1;return!0}if("object"==typeof V&&null!==V&&null!==G){if("object"!=typeof G||Object.keys(V).length!==Object.keys(G).length)return!1;for(let el in V)if(!a(V[el],G[el]))return!1;return!0}return V===G}i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let r=class r{static testProp(V){if(!r.docStyle)return V[0];for(let G=0;G<V.length;G++)if(V[G]in r.docStyle)return V[G];return V[0]}static create(V,G,el){let eh=window.document.createElement(V);return void 0!==G&&(eh.className=G),el&&el.appendChild(eh),eh}static createNS(V,G){return window.document.createElementNS(V,G)}static disableDrag(){r.docStyle&&r.selectProp&&(r.userSelect=r.docStyle[r.selectProp],r.docStyle[r.selectProp]="none")}static enableDrag(){r.docStyle&&r.selectProp&&(r.docStyle[r.selectProp]=r.userSelect)}static setTransform(V,G){V.style[r.transformProp]=G}static addEventListener(V,G,el,eh={}){V.addEventListener(G,el,"passive"in eh?eh:eh.capture)}static removeEventListener(V,G,el,eh={}){V.removeEventListener(G,el,"passive"in eh?eh:eh.capture)}static suppressClickInternal(V){V.preventDefault(),V.stopPropagation(),window.removeEventListener("click",r.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",r.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",r.suppressClickInternal,!0)},0)}static mousePos(G,el){let eh=G.getBoundingClientRect();return new V.pointGeometry(el.clientX-eh.left-G.clientLeft,el.clientY-eh.top-G.clientTop)}static touchPos(G,el){let eh=G.getBoundingClientRect(),ec=[];for(let ep=0;ep<el.length;ep++)ec.push(new V.pointGeometry(el[ep].clientX-eh.left-G.clientLeft,el[ep].clientY-eh.top-G.clientTop));return ec}static mouseButton(V){return V.button}static remove(V){V.parentNode&&V.parentNode.removeChild(V)}};r.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,r.selectProp=r.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),r.transformProp=r.testProp(["transform","WebkitTransform"]);let s=class s{constructor(V){this._transformRequestFn=V}transformRequest(V,G){return this._transformRequestFn&&this._transformRequestFn(V,G)||{url:V}}normalizeSpriteURL(V,G,el){let eh=function(V){let G=V.match(ep);if(!G)throw Error(`Unable to parse URL "${V}"`);return{protocol:G[1],authority:G[2],path:G[3]||"/",params:G[4]?G[4].split("&"):[]}}(V);return eh.path+=`${G}${el}`,function(V){let G=V.params.length?`?${V.params.join("&")}`:"";return`${V.protocol}://${V.authority}${V.path}${G}`}(eh)}setTransformRequest(V){this._transformRequestFn=V}};let ep=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;let l=class l{constructor(V,G,el,eh){this.context=V,this.format=el,this.texture=V.gl.createTexture(),this.update(G,eh)}update(G,el,eh){let{width:ec,height:ep}=G,ed=!(this.size&&this.size[0]===ec&&this.size[1]===ep||eh),{context:em}=this,{gl:ef}=em;if(this.useMipmap=!!(el&&el.useMipmap),ef.bindTexture(ef.TEXTURE_2D,this.texture),em.pixelStoreUnpackFlipY.set(!1),em.pixelStoreUnpack.set(1),em.pixelStoreUnpackPremultiplyAlpha.set(this.format===ef.RGBA&&(!el||!1!==el.premultiply)),ed)this.size=[ec,ep],G instanceof HTMLImageElement||G instanceof HTMLCanvasElement||G instanceof HTMLVideoElement||G instanceof ImageData||V.isImageBitmap(G)?ef.texImage2D(ef.TEXTURE_2D,0,this.format,this.format,ef.UNSIGNED_BYTE,G):ef.texImage2D(ef.TEXTURE_2D,0,this.format,ec,ep,0,this.format,ef.UNSIGNED_BYTE,G.data);else{let{x:el,y:ed}=eh||{x:0,y:0};G instanceof HTMLImageElement||G instanceof HTMLCanvasElement||G instanceof HTMLVideoElement||G instanceof ImageData||V.isImageBitmap(G)?ef.texSubImage2D(ef.TEXTURE_2D,0,el,ed,ef.RGBA,ef.UNSIGNED_BYTE,G):ef.texSubImage2D(ef.TEXTURE_2D,0,el,ed,ec,ep,ef.RGBA,ef.UNSIGNED_BYTE,G.data)}this.useMipmap&&this.isSizePowerOfTwo()&&ef.generateMipmap(ef.TEXTURE_2D)}bind(V,G,el){let{context:eh}=this,{gl:ec}=eh;ec.bindTexture(ec.TEXTURE_2D,this.texture),el!==ec.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(el=ec.LINEAR),V!==this.filter&&(ec.texParameteri(ec.TEXTURE_2D,ec.TEXTURE_MAG_FILTER,V),ec.texParameteri(ec.TEXTURE_2D,ec.TEXTURE_MIN_FILTER,el||V),this.filter=V),G!==this.wrap&&(ec.texParameteri(ec.TEXTURE_2D,ec.TEXTURE_WRAP_S,G),ec.texParameteri(ec.TEXTURE_2D,ec.TEXTURE_WRAP_T,G),this.wrap=G)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:V}=this.context;V.deleteTexture(this.texture),this.texture=null}};let h=class h extends V.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new V.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(V){if(this.loaded!==V&&(this.loaded=V,V)){for(let{ids:V,callback:G}of this.requestors)this._notify(V,G);this.requestors=[]}}getImage(V){return this.images[V]}addImage(V,G){if(this.images[V])throw Error(`Image id ${V} already exist, use updateImage instead`);this._validate(V,G)&&(this.images[V]=G)}_validate(G,el){let eh=!0;return this._validateStretch(el.stretchX,el.data&&el.data.width)||(this.fire(new V.ErrorEvent(Error(`Image "${G}" has invalid "stretchX" value`))),eh=!1),this._validateStretch(el.stretchY,el.data&&el.data.height)||(this.fire(new V.ErrorEvent(Error(`Image "${G}" has invalid "stretchY" value`))),eh=!1),this._validateContent(el.content,el)||(this.fire(new V.ErrorEvent(Error(`Image "${G}" has invalid "content" value`))),eh=!1),eh}_validateStretch(V,G){if(!V)return!0;let el=0;for(let eh of V){if(eh[0]<el||eh[1]<eh[0]||G<eh[1])return!1;el=eh[1]}return!0}_validateContent(V,G){return!(V&&(4!==V.length||V[0]<0||G.data.width<V[0]||V[1]<0||G.data.height<V[1]||V[2]<0||G.data.width<V[2]||V[3]<0||G.data.height<V[3]||V[2]<V[0]||V[3]<V[1]))}updateImage(V,G){let el=this.images[V];if(el.data.width!==G.data.width||el.data.height!==G.data.height)throw Error(`size mismatch between old image (${el.data.width}x${el.data.height}) and new image (${G.data.width}x${G.data.height}).`);G.version=el.version+1,this.images[V]=G,this.updatedImages[V]=!0}removeImage(V){let G=this.images[V];delete this.images[V],delete this.patterns[V],G.userImage&&G.userImage.onRemove&&G.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(V,G){let el=!0;if(!this.isLoaded())for(let G of V)this.images[G]||(el=!1);this.isLoaded()||el?this._notify(V,G):this.requestors.push({ids:V,callback:G})}_notify(G,el){let eh={};for(let el of G){this.images[el]||this.fire(new V.Event("styleimagemissing",{id:el}));let G=this.images[el];G?eh[el]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:!!(G.userImage&&G.userImage.render)}:V.warnOnce(`Image "${el}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}el(null,eh)}getPixelSize(){let{width:V,height:G}=this.atlasImage;return{width:V,height:G}}getPattern(G){let el=this.patterns[G],eh=this.getImage(G);if(!eh)return null;if(el&&el.position.version===eh.version)return el.position;if(el)el.position.version=eh.version;else{let el={w:eh.data.width+2,h:eh.data.height+2,x:0,y:0},ec=new V.ImagePosition(el,eh);this.patterns[G]={bin:el,position:ec}}return this._updatePatternAtlas(),this.patterns[G].position}bind(V){let G=V.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l(V,this.atlasImage,G.RGBA),this.atlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE)}_updatePatternAtlas(){let G=[];for(let V in this.patterns)G.push(this.patterns[V].bin);let{w:el,h:eh}=V.potpack(G),ec=this.atlasImage;for(let G in ec.resize({width:el||1,height:eh||1}),this.patterns){let{bin:el}=this.patterns[G],eh=el.x+1,ep=el.y+1,ed=this.images[G].data,em=ed.width,ef=ed.height;V.RGBAImage.copy(ed,ec,{x:0,y:0},{x:eh,y:ep},{width:em,height:ef}),V.RGBAImage.copy(ed,ec,{x:0,y:ef-1},{x:eh,y:ep-1},{width:em,height:1}),V.RGBAImage.copy(ed,ec,{x:0,y:0},{x:eh,y:ep+ef},{width:em,height:1}),V.RGBAImage.copy(ed,ec,{x:em-1,y:0},{x:eh-1,y:ep},{width:1,height:ef}),V.RGBAImage.copy(ed,ec,{x:0,y:0},{x:eh+em,y:ep},{width:1,height:ef})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(G){for(let el of G){if(this.callbackDispatchedThisFrame[el])continue;this.callbackDispatchedThisFrame[el]=!0;let G=this.images[el];G||V.warnOnce(`Image with ID: "${el}" was not found`),function(V){let{userImage:G}=V;return!!(G&&G.render&&G.render())&&(V.data.replace(new Uint8Array(G.data.buffer)),!0)}(G)&&this.updateImage(el,G)}}};function d(V,G,el,eh,ec,ep,ed,em,ef){for(let eg=G;eg<G+eh;eg++)m(V,el*ep+eg,ep,ec,ed,em,ef);for(let eg=el;eg<el+ec;eg++)m(V,eg*ep+G,1,eh,ed,em,ef)}function m(V,G,el,eh,ec,ep,ed){ep[0]=0,ed[0]=-1e20,ed[1]=1e20,ec[0]=V[G];for(let em=1,ef=0,eg=0;em<eh;em++){ec[em]=V[G+em*el];let eh=em*em;do{let V=ep[ef];eg=(ec[em]-ec[V]+eh-V*V)/(em-V)/2}while(eg<=ed[ef]&&--ef>-1);ep[++ef]=em,ed[ef]=eg,ed[ef+1]=1e20}for(let em=0,ef=0;em<eh;em++){for(;ed[ef+1]<em;)ef++;let eh=ep[ef],eg=em-eh;V[G+em*el]=ec[eh]+eg*eg}}let _=class _{constructor(V,G){this.requestManager=V,this.localIdeographFontFamily=G,this.entries={}}setURL(V){this.url=V}getGlyphs(G,el){let eh=[];for(let V in G)for(let el of G[V])eh.push({stack:V,id:el});V.asyncAll(eh,({stack:V,id:G},el)=>{let eh=this.entries[V];eh||(eh=this.entries[V]={glyphs:{},requests:{},ranges:{}});let ec=eh.glyphs[G];if(void 0!==ec)return void el(null,{stack:V,id:G,glyph:ec});if(ec=this._tinySDF(eh,V,G))return eh.glyphs[G]=ec,void el(null,{stack:V,id:G,glyph:ec});let ep=Math.floor(G/256);if(256*ep>65535)return void el(Error("glyphs > 65535 not supported"));if(eh.ranges[ep])return void el(null,{stack:V,id:G,glyph:ec});let ed=eh.requests[ep];ed||(ed=eh.requests[ep]=[],_.loadGlyphRange(V,ep,this.url,this.requestManager,(V,G)=>{if(G){for(let V in G)this._doesCharSupportLocalGlyph(+V)||(eh.glyphs[+V]=G[+V]);eh.ranges[ep]=!0}for(let el of ed)el(V,G);delete eh.requests[ep]})),ed.push((eh,ec)=>{eh?el(eh):ec&&el(null,{stack:V,id:G,glyph:ec[G]||null})})},(V,G)=>{if(V)el(V);else if(G){let V={};for(let{stack:el,id:eh,glyph:ec}of G)(V[el]||(V[el]={}))[eh]=ec&&{id:ec.id,bitmap:ec.bitmap.clone(),metrics:ec.metrics};el(null,V)}})}_doesCharSupportLocalGlyph(G){return!!this.localIdeographFontFamily&&(V.unicodeBlockLookup["CJK Unified Ideographs"](G)||V.unicodeBlockLookup["Hangul Syllables"](G)||V.unicodeBlockLookup.Hiragana(G)||V.unicodeBlockLookup.Katakana(G))}_tinySDF(G,el,eh){let ec=this.localIdeographFontFamily;if(!ec||!this._doesCharSupportLocalGlyph(eh))return;let ep=G.tinySDF;if(!ep){let V="400";/bold/i.test(el)?V="900":/medium/i.test(el)?V="500":/light/i.test(el)&&(V="200"),ep=G.tinySDF=new _.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:ec,fontWeight:V})}let ed=ep.draw(String.fromCharCode(eh));return{id:eh,bitmap:new V.AlphaImage({width:ed.width||30,height:ed.height||30},ed.data),metrics:{width:ed.glyphWidth||24,height:ed.glyphHeight||24,left:ed.glyphLeft||0,top:ed.glyphTop-27||-8,advance:ed.glyphAdvance||24}}}};_.loadGlyphRange=function(G,el,eh,ec,ep){let ed=256*el,em=ed+255,ef=ec.transformRequest(eh.replace("{fontstack}",G).replace("{range}",`${ed}-${em}`),V.ResourceType.Glyphs);V.getArrayBuffer(ef,(G,el)=>{if(G)ep(G);else if(el){let G={};for(let eh of V.parseGlyphPbf(el))G[eh.id]=eh;ep(null,G)}})},_.TinySDF=class{constructor({fontSize:V=24,buffer:G=3,radius:el=8,cutoff:eh=.25,fontFamily:ec="sans-serif",fontWeight:ep="normal",fontStyle:ed="normal"}={}){this.buffer=G,this.cutoff=eh,this.radius=el;let em=this.size=V+4*G,ef=this._createCanvas(em),eg=this.ctx=ef.getContext("2d",{willReadFrequently:!0});eg.font=`${ed} ${ep} ${V}px ${ec}`,eg.textBaseline="alphabetic",eg.textAlign="left",eg.fillStyle="black",this.gridOuter=new Float64Array(em*em),this.gridInner=new Float64Array(em*em),this.f=new Float64Array(em),this.z=new Float64Array(em+1),this.v=new Uint16Array(em)}_createCanvas(V){let G=document.createElement("canvas");return G.width=G.height=V,G}draw(V){let{width:G,actualBoundingBoxAscent:el,actualBoundingBoxDescent:eh,actualBoundingBoxLeft:ec,actualBoundingBoxRight:ep}=this.ctx.measureText(V),ed=Math.ceil(el),em=Math.min(this.size-this.buffer,Math.ceil(ep-ec)),ef=Math.min(this.size-this.buffer,ed+Math.ceil(eh)),eg=em+2*this.buffer,e_=ef+2*this.buffer,ey=Math.max(eg*e_,0),ex=new Uint8ClampedArray(ey),ev={data:ex,width:eg,height:e_,glyphWidth:em,glyphHeight:ef,glyphTop:ed,glyphLeft:0,glyphAdvance:G};if(0===em||0===ef)return ev;let{ctx:eb,buffer:ew,gridInner:eT,gridOuter:eE}=this;eb.clearRect(ew,ew,em,ef),eb.fillText(V,ew,ew+ed);let eS=eb.getImageData(ew,ew,em,ef);eE.fill(1e20,0,ey),eT.fill(0,0,ey);for(let V=0;V<ef;V++)for(let G=0;G<em;G++){let el=eS.data[4*(V*em+G)+3]/255;if(0===el)continue;let eh=(V+ew)*eg+G+ew;if(1===el)eE[eh]=0,eT[eh]=1e20;else{let V=.5-el;eE[eh]=V>0?V*V:0,eT[eh]=V<0?V*V:0}}d(eE,0,0,eg,e_,eg,this.f,this.v,this.z),d(eT,ew,ew,em,ef,eg,this.f,this.v,this.z);for(let V=0;V<ey;V++){let G=Math.sqrt(eE[V])-Math.sqrt(eT[V]);ex[V]=Math.round(255-255*(G/this.radius+this.cutoff))}return ev}};let ed=new V.Properties({anchor:new V.DataConstantProperty(V.spec.light.anchor),position:new class{constructor(){this.specification=V.spec.light.position}possiblyEvaluate(G,el){return V.sphericalToCartesian(G.expression.evaluate(el))}interpolate(G,el,eh){return{x:V.number(G.x,el.x,eh),y:V.number(G.y,el.y,eh),z:V.number(G.z,el.z,eh)}}},color:new V.DataConstantProperty(V.spec.light.color),intensity:new V.DataConstantProperty(V.spec.light.intensity)}),em="-transition";let g=class g extends V.Evented{constructor(G){super(),this._transitionable=new V.Transitionable(ed),this.setLight(G),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(G,el={}){if(!this._validate(V.validateLight,G,el))for(let V in G){let el=G[V];V.endsWith(em)?this._transitionable.setTransition(V.slice(0,-em.length),el):this._transitionable.setValue(V,el)}}updateTransitions(V){this._transitioning=this._transitionable.transitioned(V,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(V){this.properties=this._transitioning.possiblyEvaluate(V)}_validate(G,el,eh){return(!eh||!1!==eh.validate)&&V.emitValidationErrors(this,G.call(V.validateStyle,V.extend({value:el,style:{glyphs:!0,sprite:!0},styleSpec:V.spec})))}};let x=class x{constructor(V,G){this.width=V,this.height=G,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(V,G){let el=V.join(",")+String(G);return this.dashEntry[el]||(this.dashEntry[el]=this.addDash(V,G)),this.dashEntry[el]}getDashRanges(V,G,el){let eh=[],ec=V.length%2==1?-V[V.length-1]*el:0,ep=V[0]*el,ed=!0;eh.push({left:ec,right:ep,isDash:ed,zeroLength:0===V[0]});let em=V[0];for(let G=1;G<V.length;G++){ed=!ed;let ef=V[G];ec=em*el,em+=ef,ep=em*el,eh.push({left:ec,right:ep,isDash:ed,zeroLength:0===ef})}return eh}addRoundDash(V,G,el){let eh=G/2;for(let G=-el;G<=el;G++){let ec=this.width*(this.nextRow+el+G),ep=0,ed=V[0];for(let em=0;em<this.width;em++){let ef;em/ed.right>1&&(ed=V[++ep]);let eg=Math.abs(em-ed.left),e_=Math.abs(em-ed.right),ey=Math.min(eg,e_),ex=G/el*(eh+1);if(ed.isDash){let V=eh-Math.abs(ex);ef=Math.sqrt(ey*ey+V*V)}else ef=eh-Math.sqrt(ey*ey+ex*ex);this.data[ec+em]=Math.max(0,Math.min(255,ef+128))}}}addRegularDash(V){for(let G=V.length-1;G>=0;--G){let el=V[G],eh=V[G+1];el.zeroLength?V.splice(G,1):eh&&eh.isDash===el.isDash&&(eh.left=el.left,V.splice(G,1))}let G=V[0],el=V[V.length-1];G.isDash===el.isDash&&(G.left=el.left-this.width,el.right=G.right+this.width);let eh=this.width*this.nextRow,ec=0,ep=V[0];for(let G=0;G<this.width;G++){G/ep.right>1&&(ep=V[++ec]);let el=Math.abs(G-ep.left),ed=Math.abs(G-ep.right),em=Math.min(el,ed);this.data[eh+G]=Math.max(0,Math.min(255,(ep.isDash?em:-em)+128))}}addDash(G,el){let eh=el?7:0,ec=2*eh+1;if(this.nextRow+ec>this.height)return V.warnOnce("LineAtlas out of space"),null;let ep=0;for(let V=0;V<G.length;V++)ep+=G[V];if(0!==ep){let V=this.width/ep,ec=this.getDashRanges(G,this.width,V);el?this.addRoundDash(ec,V,eh):this.addRegularDash(ec)}let ed={y:(this.nextRow+eh+.5)/this.height,height:2*eh/this.height,width:ep};return this.nextRow+=ec,this.dirty=!0,ed}bind(V){let G=V.gl;this.texture?(G.bindTexture(G.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,G.texSubImage2D(G.TEXTURE_2D,0,0,0,this.width,this.height,G.ALPHA,G.UNSIGNED_BYTE,this.data))):(this.texture=G.createTexture(),G.bindTexture(G.TEXTURE_2D,this.texture),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.REPEAT),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.REPEAT),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),G.texImage2D(G.TEXTURE_2D,0,G.ALPHA,this.width,this.height,0,G.ALPHA,G.UNSIGNED_BYTE,this.data))}};let v=class v{constructor(G,el){this.workerPool=G,this.actors=[],this.currentActor=0,this.id=V.uniqueId();let eh=this.workerPool.acquire(this.id);for(let V=0;V<eh.length;V++){let G=new v.Actor(eh[V],el,this.id);G.name=`Worker ${V}`,this.actors.push(G)}if(!this.actors.length)throw Error("No actors found")}broadcast(G,el,eh){V.asyncAll(this.actors,(V,eh)=>{V.send(G,el,eh)},eh=eh||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(V=>{V.remove()}),this.actors=[],this.workerPool.release(this.id)}};function y(G,el,eh){let a=function(el,ec){if(el)return eh(el);if(ec){let el=V.pick(V.extend(ec,G),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);ec.vector_layers&&(el.vectorLayers=ec.vector_layers,el.vectorLayerIds=el.vectorLayers.map(V=>V.id)),eh(null,el)}};return G.url?V.getJSON(el.transformRequest(G.url,V.ResourceType.Source),a):V.exported.frame(()=>a(null,G))}v.Actor=V.Actor;let b=class b{constructor(G,el,eh){this.bounds=V.LngLatBounds.convert(this.validateBounds(G)),this.minzoom=el||0,this.maxzoom=eh||24}validateBounds(V){return Array.isArray(V)&&4===V.length?[Math.max(-180,V[0]),Math.max(-90,V[1]),Math.min(180,V[2]),Math.min(90,V[3])]:[-180,-90,180,90]}contains(G){let el=Math.pow(2,G.z),eh=Math.floor(V.mercatorXfromLng(this.bounds.getWest())*el),ec=Math.floor(V.mercatorYfromLat(this.bounds.getNorth())*el),ep=Math.ceil(V.mercatorXfromLng(this.bounds.getEast())*el),ed=Math.ceil(V.mercatorYfromLat(this.bounds.getSouth())*el);return G.x>=eh&&G.x<ep&&G.y>=ec&&G.y<ed}};let w=class w extends V.Evented{constructor(G,el,eh,ec){if(super(),this.id=G,this.dispatcher=eh,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,V.extend(this,V.pick(el,["url","scheme","tileSize","promoteId"])),this._options=V.extend({type:"vector"},el),this._collectResourceTiming=el.collectResourceTiming,512!==this.tileSize)throw Error("vector tile sources must have a tileSize of 512");this.setEventedParent(ec)}load(){this._loaded=!1,this.fire(new V.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=y(this._options,this.map._requestManager,(G,el)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),G?this.fire(new V.ErrorEvent(G)):el&&(V.extend(this,el),el.bounds&&(this.tileBounds=new b(el.bounds,this.minzoom,this.maxzoom)),this.fire(new V.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new V.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(V){return!this.tileBounds||this.tileBounds.contains(V.canonical)}onAdd(V){this.map=V,this.load()}setSourceProperty(V){this._tileJSONRequest&&this._tileJSONRequest.cancel(),V(),this.load()}setTiles(V){return this.setSourceProperty(()=>{this._options.tiles=V}),this}setUrl(V){return this.setSourceProperty(()=>{this.url=V,this._options.url=V}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return V.extend({},this._options)}loadTile(G,el){let eh=G.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),ec={request:this.map._requestManager.transformRequest(eh,V.ResourceType.Tile),uid:G.uid,tileID:G.tileID,zoom:G.tileID.overscaledZ,tileSize:this.tileSize*G.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function r(eh,ec){return delete G.request,G.aborted?el(null):eh&&404!==eh.status?el(eh):(ec&&ec.resourceTiming&&(G.resourceTiming=ec.resourceTiming),this.map._refreshExpiredTiles&&ec&&G.setExpiryData(ec),G.loadVectorData(ec,this.map.painter),V.cacheEntryPossiblyAdded(this.dispatcher),el(null),void(G.reloadCallback&&(this.loadTile(G,G.reloadCallback),G.reloadCallback=null)))}ec.request.collectResourceTiming=this._collectResourceTiming,G.actor&&"expired"!==G.state?"loading"===G.state?G.reloadCallback=el:G.request=G.actor.send("reloadTile",ec,r.bind(this)):(G.actor=this.dispatcher.getActor(),G.request=G.actor.send("loadTile",ec,r.bind(this)))}abortTile(V){V.request&&(V.request.cancel(),delete V.request),V.actor&&V.actor.send("abortTile",{uid:V.uid,type:this.type,source:this.id},void 0)}unloadTile(V){V.unloadVectorData(),V.actor&&V.actor.send("removeTile",{uid:V.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}};let T=class T extends V.Evented{constructor(G,el,eh,ec){super(),this.id=G,this.dispatcher=eh,this.setEventedParent(ec),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=V.extend({type:"raster"},el),V.extend(this,V.pick(el,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new V.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=y(this._options,this.map._requestManager,(G,el)=>{this._tileJSONRequest=null,this._loaded=!0,G?this.fire(new V.ErrorEvent(G)):el&&(V.extend(this,el),el.bounds&&(this.tileBounds=new b(el.bounds,this.minzoom,this.maxzoom)),this.fire(new V.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new V.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(V){this.map=V,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return V.extend({},this._options)}hasTile(V){return!this.tileBounds||this.tileBounds.contains(V.canonical)}loadTile(G,el){let eh=G.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);G.request=V.getImage(this.map._requestManager.transformRequest(eh,V.ResourceType.Tile),(eh,ec,ep)=>{if(delete G.request,G.aborted)G.state="unloaded",el(null);else if(eh)G.state="errored",el(eh);else if(ec){this.map._refreshExpiredTiles&&G.setExpiryData(ep);let eh=this.map.painter.context,ed=eh.gl;G.texture=this.map.painter.getTileTexture(ec.width),G.texture?G.texture.update(ec,{useMipmap:!0}):(G.texture=new l(eh,ec,ed.RGBA,{useMipmap:!0}),G.texture.bind(ed.LINEAR,ed.CLAMP_TO_EDGE,ed.LINEAR_MIPMAP_NEAREST),eh.extTextureFilterAnisotropic&&ed.texParameterf(ed.TEXTURE_2D,eh.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,eh.extTextureFilterAnisotropicMax)),G.state="loaded",V.cacheEntryPossiblyAdded(this.dispatcher),el(null)}})}abortTile(V,G){V.request&&(V.request.cancel(),delete V.request),G()}unloadTile(V,G){V.texture&&this.map.painter.saveTileTexture(V.texture),G()}hasTransition(){return!1}};let I=class I extends T{constructor(G,el,eh,ec){super(G,el,eh,ec),this.type="raster-dem",this.maxzoom=22,this._options=V.extend({type:"raster-dem"},el),this.encoding=el.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(el,eh){let ec=el.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function a(V,G){V&&(el.state="errored",eh(V)),G&&(el.dem=G,el.needsHillshadePrepare=!0,el.needsTerrainPrepare=!0,el.state="loaded",eh(null))}el.request=V.getImage(this.map._requestManager.transformRequest(ec,V.ResourceType.Tile),(function(ec,ep){if(delete el.request,el.aborted)el.state="unloaded",eh(null);else if(ec)el.state="errored",eh(ec);else if(ep){this.map._refreshExpiredTiles&&el.setExpiryData(ep),delete ep.cacheControl,delete ep.expires;let eh=V.isImageBitmap(ep)&&(null==G&&(G="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),G)?ep:V.exported.getImageData(ep,1),ec={uid:el.uid,coord:el.tileID,source:this.id,rawImageData:eh,encoding:this.encoding};el.actor&&"expired"!==el.state||(el.actor=this.dispatcher.getActor(),el.actor.send("loadDEMTile",ec,a.bind(this)))}}).bind(this)),el.neighboringTiles=this._getNeighboringTiles(el.tileID)}_getNeighboringTiles(G){let el=G.canonical,eh=Math.pow(2,el.z),ec=(el.x-1+eh)%eh,ep=0===el.x?G.wrap-1:G.wrap,ed=(el.x+1+eh)%eh,em=el.x+1===eh?G.wrap+1:G.wrap,ef={};return ef[new V.OverscaledTileID(G.overscaledZ,ep,el.z,ec,el.y).key]={backfilled:!1},ef[new V.OverscaledTileID(G.overscaledZ,em,el.z,ed,el.y).key]={backfilled:!1},el.y>0&&(ef[new V.OverscaledTileID(G.overscaledZ,ep,el.z,ec,el.y-1).key]={backfilled:!1},ef[new V.OverscaledTileID(G.overscaledZ,G.wrap,el.z,el.x,el.y-1).key]={backfilled:!1},ef[new V.OverscaledTileID(G.overscaledZ,em,el.z,ed,el.y-1).key]={backfilled:!1}),el.y+1<eh&&(ef[new V.OverscaledTileID(G.overscaledZ,ep,el.z,ec,el.y+1).key]={backfilled:!1},ef[new V.OverscaledTileID(G.overscaledZ,G.wrap,el.z,el.x,el.y+1).key]={backfilled:!1},ef[new V.OverscaledTileID(G.overscaledZ,em,el.z,ed,el.y+1).key]={backfilled:!1}),ef}unloadTile(V){V.demTexture&&this.map.painter.saveTileTexture(V.demTexture),V.fbo&&(V.fbo.destroy(),delete V.fbo),V.dem&&delete V.dem,delete V.neighboringTiles,V.state="unloaded",V.actor&&V.actor.send("removeDEMTile",{uid:V.uid,source:this.id})}};let C=class C extends V.Evented{constructor(G,el,eh,ec){super(),this.id=G,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=eh.getActor(),this.setEventedParent(ec),this._data=el.data,this._options=V.extend({},el),this._collectResourceTiming=el.collectResourceTiming,void 0!==el.maxzoom&&(this.maxzoom=el.maxzoom),el.type&&(this.type=el.type),el.attribution&&(this.attribution=el.attribution),this.promoteId=el.promoteId;let ep=V.EXTENT/this.tileSize;this.workerOptions=V.extend({source:this.id,cluster:el.cluster||!1,geojsonVtOptions:{buffer:(void 0!==el.buffer?el.buffer:128)*ep,tolerance:(void 0!==el.tolerance?el.tolerance:.375)*ep,extent:V.EXTENT,maxZoom:this.maxzoom,lineMetrics:el.lineMetrics||!1,generateId:el.generateId||!1},superclusterOptions:{maxZoom:void 0!==el.clusterMaxZoom?el.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,el.clusterMinPoints||2),extent:V.EXTENT,radius:(el.clusterRadius||50)*ep,log:!1,generateId:el.generateId||!1},clusterProperties:el.clusterProperties,filter:el.filter},el.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(V){this.map=V,this.load()}setData(V){return this._data=V,this._updateWorkerData("content"),this}getClusterExpansionZoom(V,G){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:V,source:this.id},G),this}getClusterChildren(V,G){return this.actor.send("geojson.getClusterChildren",{clusterId:V,source:this.id},G),this}getClusterLeaves(V,G,el,eh){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:V,limit:G,offset:el},eh),this}_updateWorkerData(G){let el=V.extend({},this.workerOptions),eh=this._data;"string"==typeof eh?(el.request=this.map._requestManager.transformRequest(V.exported.resolveURL(eh),V.ResourceType.Source),el.request.collectResourceTiming=this._collectResourceTiming):el.data=JSON.stringify(eh),this._pendingLoads++,this.fire(new V.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,el,(el,eh)=>{if(this._pendingLoads--,this._removed||eh&&eh.abandoned)return void this.fire(new V.Event("dataabort",{dataType:"source",sourceDataType:G}));let ec=null;if(eh&&eh.resourceTiming&&eh.resourceTiming[this.id]&&(ec=eh.resourceTiming[this.id].slice(0)),el)return void this.fire(new V.ErrorEvent(el));let ep={dataType:"source",sourceDataType:G};this._collectResourceTiming&&ec&&ec.length>0&&V.extend(ep,{resourceTiming:ec}),this.fire(new V.Event("data",ep))})}loaded(){return 0===this._pendingLoads}loadTile(V,G){let el=V.actor?"reloadTile":"loadTile";V.actor=this.actor;let eh={type:this.type,uid:V.uid,tileID:V.tileID,zoom:V.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};V.request=this.actor.send(el,eh,(eh,ec)=>(delete V.request,V.unloadVectorData(),V.aborted?G(null):eh?G(eh):(V.loadVectorData(ec,this.map.painter,"reloadTile"===el),G(null))))}abortTile(V){V.request&&(V.request.cancel(),delete V.request),V.aborted=!0}unloadTile(V){V.unloadVectorData(),this.actor.send("removeTile",{uid:V.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return V.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}};var ef=V.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let D=class D extends V.Evented{constructor(V,G,el,eh){super(),this.id=V,this.dispatcher=el,this.coordinates=G.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(eh),this.options=G}load(G,el){this._loaded=!1,this.fire(new V.Event("dataloading",{dataType:"source"})),this.url=this.options.url,V.getImage(this.map._requestManager.transformRequest(this.url,V.ResourceType.Image),(eh,ec)=>{this._loaded=!0,eh?this.fire(new V.ErrorEvent(eh)):ec&&(this.image=ec,G&&(this.coordinates=G),el&&el(),this._finishLoading())})}loaded(){return this._loaded}updateImage(V){return this.image&&V.url&&(this.options.url=V.url,this.load(V.coordinates,()=>{this.texture=null})),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new V.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(V){this.map=V,this.load()}setCoordinates(G){this.coordinates=G;let el=G.map(V.MercatorCoordinate.fromLngLat);this.tileID=function(G){let el=1/0,eh=1/0,ec=-1/0,ep=-1/0;for(let V of G)el=Math.min(el,V.x),eh=Math.min(eh,V.y),ec=Math.max(ec,V.x),ep=Math.max(ep,V.y);let ed=Math.max(ec-el,ep-eh),em=Math.max(0,Math.floor(-Math.log(ed)/Math.LN2)),ef=Math.pow(2,em);return new V.CanonicalTileID(em,Math.floor((el+ec)/2*ef),Math.floor((eh+ep)/2*ef))}(el),this.minzoom=this.maxzoom=this.tileID.z;let eh=el.map(V=>this.tileID.getTilePoint(V)._round());return this._boundsArray=new V.RasterBoundsArray,this._boundsArray.emplaceBack(eh[0].x,eh[0].y,0,0),this._boundsArray.emplaceBack(eh[1].x,eh[1].y,V.EXTENT,0),this._boundsArray.emplaceBack(eh[3].x,eh[3].y,0,V.EXTENT),this._boundsArray.emplaceBack(eh[2].x,eh[2].y,V.EXTENT,V.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new V.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;let G=this.map.painter.context,el=G.gl;for(let eh in this.boundsBuffer||(this.boundsBuffer=G.createVertexBuffer(this._boundsArray,ef.members)),this.boundsSegments||(this.boundsSegments=V.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new l(G,this.image,el.RGBA),this.texture.bind(el.LINEAR,el.CLAMP_TO_EDGE)),this.tiles){let V=this.tiles[eh];"loaded"!==V.state&&(V.state="loaded",V.texture=this.texture)}}loadTile(V,G){this.tileID&&this.tileID.equals(V.tileID.canonical)?(this.tiles[String(V.tileID.wrap)]=V,V.buckets={}):V.state="errored",G(null)}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}};let z=class z extends D{constructor(V,G,el,eh){super(V,G,el,eh),this.roundZoom=!0,this.type="video",this.options=G}load(){this._loaded=!1;let G=this.options;for(let el of(this.urls=[],G.urls))this.urls.push(this.map._requestManager.transformRequest(el,V.ResourceType.Source).url);V.getVideo(this.urls,(G,el)=>{this._loaded=!0,G?this.fire(new V.ErrorEvent(G)):el&&(this.video=el,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(G){if(this.video){let el=this.video.seekable;G<el.start(0)||G>el.end(0)?this.fire(new V.ErrorEvent(new V.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${el.start(0)} and ${el.end(0)}-second mark.`))):this.video.currentTime=G}}getVideo(){return this.video}onAdd(V){this.map||(this.map=V,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;let G=this.map.painter.context,el=G.gl;for(let eh in this.boundsBuffer||(this.boundsBuffer=G.createVertexBuffer(this._boundsArray,ef.members)),this.boundsSegments||(this.boundsSegments=V.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(el.LINEAR,el.CLAMP_TO_EDGE),el.texSubImage2D(el.TEXTURE_2D,0,0,0,el.RGBA,el.UNSIGNED_BYTE,this.video)):(this.texture=new l(G,this.video,el.RGBA),this.texture.bind(el.LINEAR,el.CLAMP_TO_EDGE)),this.tiles){let V=this.tiles[eh];"loaded"!==V.state&&(V.state="loaded",V.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}};let P=class P extends D{constructor(G,el,eh,ec){super(G,el,eh,ec),el.coordinates?Array.isArray(el.coordinates)&&4===el.coordinates.length&&!el.coordinates.some(V=>!Array.isArray(V)||2!==V.length||V.some(V=>"number"!=typeof V))||this.fire(new V.ErrorEvent(new V.ValidationError(`sources.${G}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new V.ErrorEvent(new V.ValidationError(`sources.${G}`,null,'missing required property "coordinates"'))),el.animate&&"boolean"!=typeof el.animate&&this.fire(new V.ErrorEvent(new V.ValidationError(`sources.${G}`,null,'optional "animate" property must be a boolean value'))),el.canvas?"string"==typeof el.canvas||el.canvas instanceof HTMLCanvasElement||this.fire(new V.ErrorEvent(new V.ValidationError(`sources.${G}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new V.ErrorEvent(new V.ValidationError(`sources.${G}`,null,'missing required property "canvas"'))),this.options=el,this.animate=void 0===el.animate||el.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new V.ErrorEvent(Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(V){this.map=V,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let G=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,G=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,G=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;let el=this.map.painter.context,eh=el.gl;for(let ec in this.boundsBuffer||(this.boundsBuffer=el.createVertexBuffer(this._boundsArray,ef.members)),this.boundsSegments||(this.boundsSegments=V.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(G||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l(el,this.canvas,eh.RGBA,{premultiply:!0}),this.tiles){let V=this.tiles[ec];"loaded"!==V.state&&(V.state="loaded",V.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let V of[this.canvas.width,this.canvas.height])if(isNaN(V)||V<=0)return!0;return!1}};let eg={vector:w,raster:T,"raster-dem":I,geojson:C,video:z,image:D,canvas:P};function R(V,G){let el=V.tileID,eh=G.tileID;return el.overscaledZ-eh.overscaledZ||el.canonical.y-eh.canonical.y||el.wrap-eh.wrap||el.canonical.x-eh.canonical.x}let k=class k{constructor(G,el){this.tileID=G,this.uid=V.uniqueId(),this.uses=0,this.tileSize=el,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(G){let el=G+this.timeAdded;el<V.exported.now()||this.fadeEndTime&&el<this.fadeEndTime||(this.fadeEndTime=el)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(V){this.demTexture&&V.saveTileTexture(this.demTexture),this.textures.forEach(G=>V.saveTileTexture(G)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(G,el,eh){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",G){for(let ec in G.featureIndex&&(this.latestFeatureIndex=G.featureIndex,G.rawTileData?(this.latestRawTileData=G.rawTileData,this.latestFeatureIndex.rawTileData=G.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=G.collisionBoxArray,this.buckets=function(V,G){let el={};if(!G)return el;for(let eh of V){let V=eh.layerIds.map(V=>G.getLayer(V)).filter(Boolean);if(0!==V.length)for(let G of(eh.layers=V,eh.stateDependentLayerIds&&(eh.stateDependentLayers=eh.stateDependentLayerIds.map(G=>V.filter(V=>V.id===G)[0])),V))el[G.id]=eh}return el}(G.buckets,el.style),this.hasSymbolBuckets=!1,this.buckets){let G=this.buckets[ec];if(G instanceof V.SymbolBucket){if(this.hasSymbolBuckets=!0,!eh)break;G.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let G in this.buckets){let el=this.buckets[G];if(el instanceof V.SymbolBucket&&el.hasRTLText){this.hasRTLText=!0,V.lazyLoadRTLTextPlugin();break}}for(let V in this.queryPadding=0,this.buckets){let G=this.buckets[V];this.queryPadding=Math.max(this.queryPadding,el.style.getLayer(V).queryRadius(G))}G.imageAtlas&&(this.imageAtlas=G.imageAtlas),G.glyphAtlasImage&&(this.glyphAtlasImage=G.glyphAtlasImage)}else this.collisionBoxArray=new V.CollisionBoxArray}unloadVectorData(){for(let V in this.buckets)this.buckets[V].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(V){return this.buckets[V.id]}upload(V){for(let G in this.buckets){let el=this.buckets[G];el.uploadPending()&&el.upload(V)}let G=V.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l(V,this.imageAtlas.image,G.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l(V,this.glyphAtlasImage,G.ALPHA),this.glyphAtlasImage=null)}prepare(V){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(V,this.imageAtlasTexture)}queryRenderedFeatures(V,G,el,eh,ec,ep,ed,em,ef,eg){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:eh,cameraQueryGeometry:ec,scale:ep,tileSize:this.tileSize,pixelPosMatrix:eg,transform:em,params:ed,queryPadding:this.queryPadding*ef},V,G,el):{}}querySourceFeatures(G,el){let eh=this.latestFeatureIndex;if(!eh||!eh.rawTileData)return;let ec=eh.loadVTLayers(),ep=el?el.sourceLayer:"",ed=ec._geojsonTileLayer||ec[ep];if(!ed)return;let em=V.createFilter(el&&el.filter),{z:ef,x:eg,y:e_}=this.tileID.canonical,ey={z:ef,x:eg,y:e_};for(let el=0;el<ed.length;el++){let ec=ed.feature(el);if(em.needGeometry){let G=V.toEvaluationFeature(ec,!0);if(!em.filter(new V.EvaluationParameters(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!em.filter(new V.EvaluationParameters(this.tileID.overscaledZ),ec))continue;let ex=eh.getId(ec,ep),ev=new V.GeoJSONFeature(ec,ef,eg,e_,ex);ev.tile=ey,G.push(ev)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(G){let el=this.expirationTime;if(G.cacheControl){let el=V.parseCacheControl(G.cacheControl);el["max-age"]&&(this.expirationTime=Date.now()+1e3*el["max-age"])}else G.expires&&(this.expirationTime=new Date(G.expires).getTime());if(this.expirationTime){let V=Date.now(),G=!1;if(this.expirationTime>V)G=!1;else if(el){if(this.expirationTime<el)G=!0;else{let eh=this.expirationTime-el;eh?this.expirationTime=V+Math.max(eh,3e4):G=!0}}else G=!0;G?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),2147483647)}setFeatureState(V,G){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(V).length)return;let el=this.latestFeatureIndex.loadVTLayers();for(let eh in this.buckets){if(!G.style.hasLayer(eh))continue;let ec=this.buckets[eh],ep=ec.layers[0].sourceLayer||"_geojsonTileLayer",ed=el[ep],em=V[ep];if(!ed||!em||0===Object.keys(em).length)continue;ec.update(em,ed,this.imageAtlas&&this.imageAtlas.patternPositions||{});let ef=G&&G.style&&G.style.getLayer(eh);ef&&(this.queryPadding=Math.max(this.queryPadding,ef.queryRadius(ec)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<V.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(G){this.symbolFadeHoldUntil=V.exported.now()+G}setDependencies(V,G){let el={};for(let V of G)el[V]=!0;this.dependencies[V]=el}hasDependency(V,G){for(let el of V){let V=this.dependencies[el];if(V){for(let el of G)if(V[el])return!0}}return!1}};let B=class B{constructor(V,G){this.max=V,this.onRemove=G,this.reset()}reset(){for(let V in this.data)for(let G of this.data[V])G.timeout&&clearTimeout(G.timeout),this.onRemove(G.value);return this.data={},this.order=[],this}add(V,G,el){let eh=V.wrapped().key;void 0===this.data[eh]&&(this.data[eh]=[]);let ec={value:G,timeout:void 0};if(void 0!==el&&(ec.timeout=setTimeout(()=>{this.remove(V,ec)},el)),this.data[eh].push(ec),this.order.push(eh),this.order.length>this.max){let V=this._getAndRemoveByKey(this.order[0]);V&&this.onRemove(V)}return this}has(V){return V.wrapped().key in this.data}getAndRemove(V){return this.has(V)?this._getAndRemoveByKey(V.wrapped().key):null}_getAndRemoveByKey(V){let G=this.data[V].shift();return G.timeout&&clearTimeout(G.timeout),0===this.data[V].length&&delete this.data[V],this.order.splice(this.order.indexOf(V),1),G.value}getByKey(V){let G=this.data[V];return G?G[0].value:null}get(V){return this.has(V)?this.data[V.wrapped().key][0].value:null}remove(V,G){if(!this.has(V))return this;let el=V.wrapped().key,eh=void 0===G?0:this.data[el].indexOf(G),ec=this.data[el][eh];return this.data[el].splice(eh,1),ec.timeout&&clearTimeout(ec.timeout),0===this.data[el].length&&delete this.data[el],this.onRemove(ec.value),this.order.splice(this.order.indexOf(el),1),this}setMaxSize(V){for(this.max=V;this.order.length>this.max;){let V=this._getAndRemoveByKey(this.order[0]);V&&this.onRemove(V)}return this}filter(V){let G=[];for(let el in this.data)for(let eh of this.data[el])V(eh.value)||G.push(eh);for(let V of G)this.remove(V.value.tileID,V)}};let F=class F{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(G,el,eh){let ec=String(el);if(this.stateChanges[G]=this.stateChanges[G]||{},this.stateChanges[G][ec]=this.stateChanges[G][ec]||{},V.extend(this.stateChanges[G][ec],eh),null===this.deletedStates[G])for(let V in this.deletedStates[G]={},this.state[G])V!==ec&&(this.deletedStates[G][V]=null);else if(this.deletedStates[G]&&null===this.deletedStates[G][ec])for(let V in this.deletedStates[G][ec]={},this.state[G][ec])eh[V]||(this.deletedStates[G][ec][V]=null);else for(let V in eh)this.deletedStates[G]&&this.deletedStates[G][ec]&&null===this.deletedStates[G][ec][V]&&delete this.deletedStates[G][ec][V]}removeFeatureState(V,G,el){if(null===this.deletedStates[V])return;let eh=String(G);if(this.deletedStates[V]=this.deletedStates[V]||{},el&&void 0!==G)null!==this.deletedStates[V][eh]&&(this.deletedStates[V][eh]=this.deletedStates[V][eh]||{},this.deletedStates[V][eh][el]=null);else if(void 0!==G){if(this.stateChanges[V]&&this.stateChanges[V][eh])for(el in this.deletedStates[V][eh]={},this.stateChanges[V][eh])this.deletedStates[V][eh][el]=null;else this.deletedStates[V][eh]=null}else this.deletedStates[V]=null}getState(G,el){let eh=String(el),ec=V.extend({},(this.state[G]||{})[eh],(this.stateChanges[G]||{})[eh]);if(null===this.deletedStates[G])return{};if(this.deletedStates[G]){let V=this.deletedStates[G][el];if(null===V)return{};for(let G in V)delete ec[G]}return ec}initializeTileState(V,G){V.setFeatureState(this.state,G)}coalesceChanges(G,el){let eh={};for(let G in this.stateChanges){this.state[G]=this.state[G]||{};let el={};for(let eh in this.stateChanges[G])this.state[G][eh]||(this.state[G][eh]={}),V.extend(this.state[G][eh],this.stateChanges[G][eh]),el[eh]=this.state[G][eh];eh[G]=el}for(let G in this.deletedStates){this.state[G]=this.state[G]||{};let el={};if(null===this.deletedStates[G])for(let V in this.state[G])el[V]={},this.state[G][V]={};else for(let V in this.deletedStates[G]){if(null===this.deletedStates[G][V])this.state[G][V]={};else for(let el of Object.keys(this.deletedStates[G][V]))delete this.state[G][V][el];el[V]=this.state[G][V]}eh[G]=eh[G]||{},V.extend(eh[G],el)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(eh).length)for(let V in G)G[V].setFeatureState(eh,el)}};let O=class O extends V.Evented{constructor(G,el,eh){super(),this.id=G,this.dispatcher=eh,this.on("data",V=>{"source"===V.dataType&&"metadata"===V.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===V.dataType&&"content"===V.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(G,el,eh,ec){let ep=new eg[el.type](G,el,eh,ec);if(ep.id!==G)throw Error(`Expected Source id to be ${G} instead of ${ep.id}`);return V.bindAll(["load","abort","unload","serialize","prepare"],ep),ep}(G,el,eh,this),this._tiles={},this._cache=new B(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new F}onAdd(V){this.map=V,this._maxTileCacheSize=V?V._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(V)}onRemove(V){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(V)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let V in this._tiles){let G=this._tiles[V];if("loaded"!==G.state&&"errored"!==G.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let V=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,V&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(V,G){return this._source.loadTile(V,G)}_unloadTile(V){if(this._source.unloadTile)return this._source.unloadTile(V,()=>{})}_abortTile(G){this._source.abortTile&&this._source.abortTile(G,()=>{}),this._source.fire(new V.Event("dataabort",{tile:G,coord:G.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(V){for(let G in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){let el=this._tiles[G];el.upload(V),el.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(V=>V.tileID).sort(U).map(V=>V.key)}getRenderableIds(G){let el=[];for(let V in this._tiles)this._isIdRenderable(V,G)&&el.push(this._tiles[V]);return G?el.sort((G,el)=>{let eh=G.tileID,ec=el.tileID,ep=new V.pointGeometry(eh.canonical.x,eh.canonical.y)._rotate(this.transform.angle),ed=new V.pointGeometry(ec.canonical.x,ec.canonical.y)._rotate(this.transform.angle);return eh.overscaledZ-ec.overscaledZ||ed.y-ep.y||ed.x-ep.x}).map(V=>V.tileID.key):el.map(V=>V.tileID).sort(U).map(V=>V.key)}hasRenderableParent(V){let G=this.findLoadedParent(V,0);return!!G&&this._isIdRenderable(G.tileID.key)}_isIdRenderable(V,G){return this._tiles[V]&&this._tiles[V].hasData()&&!this._coveredTiles[V]&&(G||!this._tiles[V].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else for(let V in this._cache.reset(),this._tiles)"errored"!==this._tiles[V].state&&this._reloadTile(V,"reloading")}_reloadTile(V,G){let el=this._tiles[V];el&&("loading"!==el.state&&(el.state=G),this._loadTile(el,this._tileLoaded.bind(this,el,V,G)))}_tileLoaded(G,el,eh,ec){if(ec)return G.state="errored",void(404!==ec.status?this._source.fire(new V.ErrorEvent(ec,{tile:G})):this.update(this.transform,this.terrain));G.timeAdded=V.exported.now(),"expired"===eh&&(G.refreshedUponExpiration=!0),this._setTileReloadTimer(el,G),"raster-dem"===this.getSource().type&&G.dem&&this._backfillDEM(G),this._state.initializeTileState(G,this.map?this.map.painter:null),G.aborted||this._source.fire(new V.Event("data",{dataType:"source",tile:G,coord:G.tileID}))}_backfillDEM(V){let G=this.getRenderableIds();for(let el=0;el<G.length;el++){let eh=G[el];if(V.neighboringTiles&&V.neighboringTiles[eh]){let G=this.getTileByID(eh);i(V,G),i(G,V)}}function i(V,G){V.needsHillshadePrepare=!0,V.needsTerrainPrepare=!0;let el=G.tileID.canonical.x-V.tileID.canonical.x,eh=G.tileID.canonical.y-V.tileID.canonical.y,ec=Math.pow(2,V.tileID.canonical.z),ep=G.tileID.key;0===el&&0===eh||Math.abs(eh)>1||(Math.abs(el)>1&&(1===Math.abs(el+ec)?el+=ec:1===Math.abs(el-ec)&&(el-=ec)),G.dem&&V.dem&&(V.dem.backfillBorder(G.dem,el,eh),V.neighboringTiles&&V.neighboringTiles[ep]&&(V.neighboringTiles[ep].backfilled=!0)))}}getTile(V){return this.getTileByID(V.key)}getTileByID(V){return this._tiles[V]}_retainLoadedChildren(V,G,el,eh){for(let ec in this._tiles){let ep=this._tiles[ec];if(eh[ec]||!ep.hasData()||ep.tileID.overscaledZ<=G||ep.tileID.overscaledZ>el)continue;let ed=ep.tileID;for(;ep&&ep.tileID.overscaledZ>G+1;){let V=ep.tileID.scaledTo(ep.tileID.overscaledZ-1);(ep=this._tiles[V.key])&&ep.hasData()&&(ed=V)}let em=ed;for(;em.overscaledZ>G;)if(V[(em=em.scaledTo(em.overscaledZ-1)).key]){eh[ed.key]=ed;break}}}findLoadedParent(V,G){if(V.key in this._loadedParentTiles){let el=this._loadedParentTiles[V.key];return el&&el.tileID.overscaledZ>=G?el:null}for(let el=V.overscaledZ-1;el>=G;el--){let G=V.scaledTo(el),eh=this._getLoadedTile(G);if(eh)return eh}}_getLoadedTile(V){let G=this._tiles[V.key];return G&&G.hasData()?G:this._cache.getByKey(V.wrapped().key)}updateCacheSize(V){let G=Math.ceil(V.width/this._source.tileSize)+1,el=Math.ceil(V.height/this._source.tileSize)+1,eh=Math.floor(G*el*5),ec="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,eh):eh;this._cache.setMaxSize(ec)}handleWrapJump(V){let G=Math.round((V-(void 0===this._prevLng?V:this._prevLng))/360);if(this._prevLng=V,G){let V={};for(let el in this._tiles){let eh=this._tiles[el];eh.tileID=eh.tileID.unwrapTo(eh.tileID.wrap+G),V[eh.tileID.key]=eh}for(let G in this._tiles=V,this._timers)clearTimeout(this._timers[G]),delete this._timers[G];for(let V in this._tiles)this._setTileReloadTimer(V,this._tiles[V])}}update(G,el){let eh;if(this.transform=G,this.terrain=el,!this._sourceLoaded||this._paused)return;this.updateCacheSize(G),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?eh=G.getVisibleUnwrappedCoordinates(this._source.tileID).map(G=>new V.OverscaledTileID(G.canonical.z,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y)):(eh=G.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:el}),this._source.hasTile&&(eh=eh.filter(V=>this._source.hasTile(V)))):eh=[];let ec=G.coveringZoomLevel(this._source),ep=Math.max(ec-O.maxOverzooming,this._source.minzoom),ed=Math.max(ec+O.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let V={};for(let G of eh)if(G.canonical.z>this._source.minzoom){let el=G.scaledTo(G.canonical.z-1);V[el.key]=el;let eh=G.scaledTo(Math.max(this._source.minzoom,Math.min(G.canonical.z,5)));V[eh.key]=eh}eh=eh.concat(Object.values(V))}let em=this._updateRetainedTiles(eh,ec);if(N(this._source.type)){let G={},ef={},eg=Object.keys(em);for(let el of eg){let eh=em[el],ec=this._tiles[el];if(!ec||ec.fadeEndTime&&ec.fadeEndTime<=V.exported.now())continue;let ed=this.findLoadedParent(eh,ep);ed&&(this._addTile(ed.tileID),G[ed.tileID.key]=ed.tileID),ef[el]=eh}for(let V in this._retainLoadedChildren(ef,ec,ed,em),G)em[V]||(this._coveredTiles[V]=!0,em[V]=G[V]);if(el){let V={},G={};for(let el of eh)this._tiles[el.key].hasData()?V[el.key]=el:G[el.key]=el;for(let el in G){let eh=G[el].children(this._source.maxzoom);this._tiles[eh[0].key]&&this._tiles[eh[1].key]&&this._tiles[eh[2].key]&&this._tiles[eh[3].key]&&(V[eh[0].key]=em[eh[0].key]=eh[0],V[eh[1].key]=em[eh[1].key]=eh[1],V[eh[2].key]=em[eh[2].key]=eh[2],V[eh[3].key]=em[eh[3].key]=eh[3],delete G[el])}for(let el in G){let eh=this.findLoadedParent(G[el],this._source.minzoom);if(eh)for(let G in V[eh.tileID.key]=em[eh.tileID.key]=eh.tileID,V)V[G].isChildOf(eh.tileID)&&delete V[G]}for(let G in this._tiles)V[G]||(this._coveredTiles[G]=!0)}}for(let V in em)this._tiles[V].clearFadeHold();let ef=V.keysDifference(this._tiles,em);for(let V of ef){let G=this._tiles[V];G.hasSymbolBuckets&&!G.holdingForFade()?G.setHoldDuration(this.map._fadeDuration):G.hasSymbolBuckets&&!G.symbolFadeFinished()||this._removeTile(V)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(let V in this._tiles)this._tiles[V].holdingForFade()&&this._removeTile(V)}_updateRetainedTiles(V,G){let el={},eh={},ec=Math.max(G-O.maxOverzooming,this._source.minzoom),ep=Math.max(G+O.maxUnderzooming,this._source.minzoom),ed={};for(let eh of V){let V=this._addTile(eh);el[eh.key]=eh,V.hasData()||G<this._source.maxzoom&&(ed[eh.key]=eh)}for(let em of(this._retainLoadedChildren(ed,G,ep,el),V)){let V=this._tiles[em.key];if(V.hasData())continue;if(G+1>this._source.maxzoom){let V=em.children(this._source.maxzoom)[0],G=this.getTile(V);if(G&&G.hasData()){el[V.key]=V;continue}}else{let V=em.children(this._source.maxzoom);if(el[V[0].key]&&el[V[1].key]&&el[V[2].key]&&el[V[3].key])continue}let ep=V.wasRequested();for(let G=em.overscaledZ-1;G>=ec;--G){let ec=em.scaledTo(G);if(eh[ec.key]||(eh[ec.key]=!0,(V=this.getTile(ec))||!ep||(V=this._addTile(ec)),V&&(el[ec.key]=ec,ep=V.wasRequested(),V.hasData())))break}}return el}_updateLoadedParentTileCache(){for(let V in this._loadedParentTiles={},this._tiles){let G=[],el,eh=this._tiles[V].tileID;for(;eh.overscaledZ>0;){if(eh.key in this._loadedParentTiles){el=this._loadedParentTiles[eh.key];break}G.push(eh.key);let V=eh.scaledTo(eh.overscaledZ-1);if(el=this._getLoadedTile(V))break;eh=V}for(let V of G)this._loadedParentTiles[V]=el}}_addTile(G){let el=this._tiles[G.key];if(el)return el;(el=this._cache.getAndRemove(G))&&(this._setTileReloadTimer(G.key,el),el.tileID=G,this._state.initializeTileState(el,this.map?this.map.painter:null),this._cacheTimers[G.key]&&(clearTimeout(this._cacheTimers[G.key]),delete this._cacheTimers[G.key],this._setTileReloadTimer(G.key,el)));let eh=el;return el||(el=new k(G,this._source.tileSize*G.overscaleFactor()),this._loadTile(el,this._tileLoaded.bind(this,el,G.key,el.state))),el.uses++,this._tiles[G.key]=el,eh||this._source.fire(new V.Event("dataloading",{tile:el,coord:el.tileID,dataType:"source"})),el}_setTileReloadTimer(V,G){V in this._timers&&(clearTimeout(this._timers[V]),delete this._timers[V]);let el=G.getExpiryTimeout();el&&(this._timers[V]=setTimeout(()=>{this._reloadTile(V,"expired"),delete this._timers[V]},el))}_removeTile(V){let G=this._tiles[V];G&&(G.uses--,delete this._tiles[V],this._timers[V]&&(clearTimeout(this._timers[V]),delete this._timers[V]),G.uses>0||(G.hasData()&&"reloading"!==G.state?this._cache.add(G.tileID,G,G.getExpiryTimeout()):(G.aborted=!0,this._abortTile(G),this._unloadTile(G))))}clearTiles(){for(let V in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(V);this._cache.reset()}tilesIn(G,el,eh){let ec=[],ep=this.transform;if(!ep)return ec;let ed=eh?ep.getCameraQueryGeometry(G):G,em=G.map(V=>ep.pointCoordinate(V,this.terrain)),ef=ed.map(V=>ep.pointCoordinate(V,this.terrain)),eg=this.getIds(),e_=1/0,ey=1/0,ex=-1/0,ev=-1/0;for(let V of ef)e_=Math.min(e_,V.x),ey=Math.min(ey,V.y),ex=Math.max(ex,V.x),ev=Math.max(ev,V.y);for(let G=0;G<eg.length;G++){let eh=this._tiles[eg[G]];if(eh.holdingForFade())continue;let ed=eh.tileID,eb=Math.pow(2,ep.zoom-eh.tileID.overscaledZ),ew=el*eh.queryPadding*V.EXTENT/eh.tileSize/eb,eT=[ed.getTilePoint(new V.MercatorCoordinate(e_,ey)),ed.getTilePoint(new V.MercatorCoordinate(ex,ev))];if(eT[0].x-ew<V.EXTENT&&eT[0].y-ew<V.EXTENT&&eT[1].x+ew>=0&&eT[1].y+ew>=0){let V=em.map(V=>ed.getTilePoint(V)),G=ef.map(V=>ed.getTilePoint(V));ec.push({tile:eh,tileID:ed,queryGeometry:V,cameraQueryGeometry:G,scale:eb})}}return ec}getVisibleCoordinates(V){let G=this.getRenderableIds(V).map(V=>this._tiles[V].tileID);for(let V of G)V.posMatrix=this.transform.calculatePosMatrix(V.toUnwrapped());return G}hasTransition(){if(this._source.hasTransition())return!0;if(N(this._source.type))for(let G in this._tiles){let el=this._tiles[G];if(void 0!==el.fadeEndTime&&el.fadeEndTime>=V.exported.now())return!0}return!1}setFeatureState(V,G,el){this._state.updateState(V=V||"_geojsonTileLayer",G,el)}removeFeatureState(V,G,el){this._state.removeFeatureState(V=V||"_geojsonTileLayer",G,el)}getFeatureState(V,G){return this._state.getState(V=V||"_geojsonTileLayer",G)}setDependencies(V,G,el){let eh=this._tiles[V];eh&&eh.setDependencies(G,el)}reloadTilesForDependencies(V,G){for(let el in this._tiles)this._tiles[el].hasDependency(V,G)&&this._reloadTile(el,"reloading");this._cache.filter(el=>!el.hasDependency(V,G))}};function U(V,G){let el=Math.abs(2*V.wrap)-+(V.wrap<0),eh=Math.abs(2*G.wrap)-+(G.wrap<0);return V.overscaledZ-G.overscaledZ||eh-el||G.canonical.y-V.canonical.y||G.canonical.x-V.canonical.x}function N(V){return"raster"===V||"image"===V||"video"===V}O.maxOverzooming=10,O.maxUnderzooming=3;let e_="mapboxgl_preloaded_worker_pool";let Z=class Z{constructor(){this.active={}}acquire(V){if(!this.workers)for(this.workers=[];this.workers.length<Z.workerCount;)this.workers.push(new Worker(e0.workerUrl));return this.active[V]=!0,this.workers.slice()}release(V){delete this.active[V],0===this.numActive()&&(this.workers.forEach(V=>{V.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[e_]}numActive(){return Object.keys(this.active).length}};let ey=Math.floor(V.exported.hardwareConcurrency/2);function j(){return el||(el=new Z),el}function X(G){G=G.slice();let el=Object.create(null);for(let V=0;V<G.length;V++)el[G[V].id]=G[V];for(let eh=0;eh<G.length;eh++)"ref"in G[eh]&&(G[eh]=function(G,el){let eh={};for(let V in G)"ref"!==V&&(eh[V]=G[V]);return V.refProperties.forEach(V=>{V in el&&(eh[V]=el[V])}),eh}(G[eh],el[G[eh].ref]));return G}Z.workerCount=Math.max(Math.min(ey,6),1);let ex={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function H(V,G,el){el.push({command:ex.addSource,args:[V,G[V]]})}function K(V,G,el){G.push({command:ex.removeSource,args:[V]}),el[V]=!0}function Q(V,G,el,eh,ec,ep){let ed;for(ed in G=G||{},V=V||{})Object.prototype.hasOwnProperty.call(V,ed)&&(a(V[ed],G[ed])||el.push({command:ep,args:[eh,ed,G[ed],ec]}));for(ed in G)Object.prototype.hasOwnProperty.call(G,ed)&&!Object.prototype.hasOwnProperty.call(V,ed)&&(a(V[ed],G[ed])||el.push({command:ep,args:[eh,ed,G[ed],ec]}))}function tt(V){return V.id}function et(V,G){return V[G.id]=G,V}let it=class it{constructor(V,G){this.reset(V,G)}reset(V,G){this.points=V||[],this._distances=[0];for(let V=1;V<this.points.length;V++)this._distances[V]=this._distances[V-1]+this.points[V].dist(this.points[V-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(G||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(G){if(1===this.points.length)return this.points[0];G=V.clamp(G,0,1);let el=1,eh=this._distances[el],ec=G*this.paddedLength+this.padding;for(;eh<ec&&el<this._distances.length;)eh=this._distances[++el];let ep=el-1,ed=this._distances[ep],em=eh-ed,ef=em>0?(ec-ed)/em:0;return this.points[ep].mult(1-ef).add(this.points[el].mult(ef))}};function ot(V,G){let el=!0;return"always"===V||"never"!==V&&"never"!==G||(el=!1),el}let at=class at{constructor(V,G,el){let eh=this.boxCells=[],ec=this.circleCells=[];this.xCellCount=Math.ceil(V/el),this.yCellCount=Math.ceil(G/el);for(let V=0;V<this.xCellCount*this.yCellCount;V++)eh.push([]),ec.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=V,this.height=G,this.xScale=this.xCellCount/V,this.yScale=this.yCellCount/G,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(V,G,el,eh,ec){this._forEachCell(G,el,eh,ec,this._insertBoxCell,this.boxUid++),this.boxKeys.push(V),this.bboxes.push(G),this.bboxes.push(el),this.bboxes.push(eh),this.bboxes.push(ec)}insertCircle(V,G,el,eh){this._forEachCell(G-eh,el-eh,G+eh,el+eh,this._insertCircleCell,this.circleUid++),this.circleKeys.push(V),this.circles.push(G),this.circles.push(el),this.circles.push(eh)}_insertBoxCell(V,G,el,eh,ec,ep){this.boxCells[ec].push(ep)}_insertCircleCell(V,G,el,eh,ec,ep){this.circleCells[ec].push(ep)}_query(V,G,el,eh,ec,ep,ed){if(el<0||V>this.width||eh<0||G>this.height)return[];let em=[];if(V<=0&&G<=0&&this.width<=el&&this.height<=eh){if(ec)return[{key:null,x1:V,y1:G,x2:el,y2:eh}];for(let V=0;V<this.boxKeys.length;V++)em.push({key:this.boxKeys[V],x1:this.bboxes[4*V],y1:this.bboxes[4*V+1],x2:this.bboxes[4*V+2],y2:this.bboxes[4*V+3]});for(let V=0;V<this.circleKeys.length;V++){let G=this.circles[3*V],el=this.circles[3*V+1],eh=this.circles[3*V+2];em.push({key:this.circleKeys[V],x1:G-eh,y1:el-eh,x2:G+eh,y2:el+eh})}}else this._forEachCell(V,G,el,eh,this._queryCell,em,{hitTest:ec,overlapMode:ep,seenUids:{box:{},circle:{}}},ed);return em}query(V,G,el,eh){return this._query(V,G,el,eh,!1,null)}hitTest(V,G,el,eh,ec,ep){return this._query(V,G,el,eh,!0,ec,ep).length>0}hitTestCircle(V,G,el,eh,ec){let ep=V-el,ed=V+el,em=G-el,ef=G+el;if(ed<0||ep>this.width||ef<0||em>this.height)return!1;let eg=[];return this._forEachCell(ep,em,ed,ef,this._queryCellCircle,eg,{hitTest:!0,overlapMode:eh,circle:{x:V,y:G,radius:el},seenUids:{box:{},circle:{}}},ec),eg.length>0}_queryCell(V,G,el,eh,ec,ep,ed,em){let{seenUids:ef,hitTest:eg,overlapMode:e_}=ed,ey=this.boxCells[ec];if(null!==ey){let ec=this.bboxes;for(let ed of ey)if(!ef.box[ed]){ef.box[ed]=!0;let ey=4*ed,ex=this.boxKeys[ed];if(V<=ec[ey+2]&&G<=ec[ey+3]&&el>=ec[ey+0]&&eh>=ec[ey+1]&&(!em||em(ex))&&(!eg||!ot(e_,ex.overlapMode))&&(ep.push({key:ex,x1:ec[ey],y1:ec[ey+1],x2:ec[ey+2],y2:ec[ey+3]}),eg))return!0}}let ex=this.circleCells[ec];if(null!==ex){let ec=this.circles;for(let ed of ex)if(!ef.circle[ed]){ef.circle[ed]=!0;let ey=3*ed,ex=this.circleKeys[ed];if(this._circleAndRectCollide(ec[ey],ec[ey+1],ec[ey+2],V,G,el,eh)&&(!em||em(ex))&&(!eg||!ot(e_,ex.overlapMode))){let V=ec[ey],G=ec[ey+1],el=ec[ey+2];if(ep.push({key:ex,x1:V-el,y1:G-el,x2:V+el,y2:G+el}),eg)return!0}}}return!1}_queryCellCircle(V,G,el,eh,ec,ep,ed,em){let{circle:ef,seenUids:eg,overlapMode:e_}=ed,ey=this.boxCells[ec];if(null!==ey){let V=this.bboxes;for(let G of ey)if(!eg.box[G]){eg.box[G]=!0;let el=4*G,eh=this.boxKeys[G];if(this._circleAndRectCollide(ef.x,ef.y,ef.radius,V[el+0],V[el+1],V[el+2],V[el+3])&&(!em||em(eh))&&!ot(e_,eh.overlapMode))return ep.push(!0),!0}}let ex=this.circleCells[ec];if(null!==ex){let V=this.circles;for(let G of ex)if(!eg.circle[G]){eg.circle[G]=!0;let el=3*G,eh=this.circleKeys[G];if(this._circlesCollide(V[el],V[el+1],V[el+2],ef.x,ef.y,ef.radius)&&(!em||em(eh))&&!ot(e_,eh.overlapMode))return ep.push(!0),!0}}}_forEachCell(V,G,el,eh,ec,ep,ed,em){let ef=this._convertToXCellCoord(V),eg=this._convertToYCellCoord(G),e_=this._convertToXCellCoord(el),ey=this._convertToYCellCoord(eh);for(let ex=ef;ex<=e_;ex++)for(let ef=eg;ef<=ey;ef++)if(ec.call(this,V,G,el,eh,this.xCellCount*ef+ex,ep,ed,em))return}_convertToXCellCoord(V){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(V*this.xScale)))}_convertToYCellCoord(V){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(V*this.yScale)))}_circlesCollide(V,G,el,eh,ec,ep){let ed=eh-V,em=ec-G,ef=el+ep;return ef*ef>ed*ed+em*em}_circleAndRectCollide(V,G,el,eh,ec,ep,ed){let em=(ep-eh)/2,ef=Math.abs(V-(eh+em));if(ef>em+el)return!1;let eg=(ed-ec)/2,e_=Math.abs(G-(ec+eg));if(e_>eg+el)return!1;if(ef<=em||e_<=eg)return!0;let ey=ef-em,ex=e_-eg;return ey*ey+ex*ex<=el*el}};function rt(G,el,eh,ec,ep){let ed=V.create();return el?(V.scale(ed,ed,[1/ep,1/ep,1]),eh||V.rotateZ(ed,ed,ec.angle)):V.multiply(ed,ec.labelPlaneMatrix,G),ed}function st(G,el,eh,ec,ep){if(el){let el=V.clone(G);return V.scale(el,el,[ep,ep,1]),eh||V.rotateZ(el,el,-ec.angle),el}return ec.glCoordMatrix}function nt(G,el,eh){let ec;eh?(ec=[G.x,G.y,eh(G.x,G.y),1],V.transformMat4(ec,ec,el)):xt(ec=[G.x,G.y,0,1],ec,el);let ep=ec[3];return{point:new V.pointGeometry(ec[0]/ep,ec[1]/ep),signedDistanceFromCamera:ep}}function lt(V,G){return .5+V/G*.5}function ut(V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex){let ev=em.glyphStartIndex+em.numGlyphs,eb=em.lineStartIndex,ew=em.lineStartIndex+em.lineLength,eT=G.getoffsetX(em.glyphStartIndex),eE=G.getoffsetX(ev-1),eS=pt(V*eT,el,eh,ec,ep,ed,em.segment,eb,ew,ef,eg,e_,ey,ex);if(!eS)return null;let eI=pt(V*eE,el,eh,ec,ep,ed,em.segment,eb,ew,ef,eg,e_,ey,ex);return eI?{first:eS,last:eI}:null}function dt(G,el,eh,ec){return G===V.WritingMode.horizontal&&Math.abs(eh.y-el.y)>Math.abs(eh.x-el.x)*ec?{useVertical:!0}:(G===V.WritingMode.vertical?el.y<eh.y:el.x>eh.x)?{needsFlipping:!0}:null}function mt(G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew,eT){let eE;let eS=el/24,eI=G.lineOffsetX*eS,eA=G.lineOffsetY*eS;if(G.numGlyphs>1){let V=G.glyphStartIndex+G.numGlyphs,el=G.lineStartIndex,ep=G.lineStartIndex+G.lineLength,e_=ut(eS,ef,eI,eA,eh,ey,ex,G,eg,ed,ev,ew,eT);if(!e_)return{notEnoughRoom:!0};let eM=nt(e_.first.point,em,eT).point,eC=nt(e_.last.point,em,eT).point;if(ec&&!eh){let V=dt(G.writingMode,eM,eC,eb);if(V)return V}eE=[e_.first];for(let ec=G.glyphStartIndex+1;ec<V-1;ec++)eE.push(pt(eS*ef.getoffsetX(ec),eI,eA,eh,ey,ex,G.segment,el,ep,eg,ed,ev,ew,eT));eE.push(e_.last)}else{if(ec&&!eh){let el=nt(ex,ep,eT).point,eh=G.lineStartIndex+G.segment+1,ec=new V.pointGeometry(eg.getx(eh),eg.gety(eh)),ed=nt(ec,ep,eT),em=ed.signedDistanceFromCamera>0?ed.point:_t(ex,ec,el,1,ep,eT),ef=dt(G.writingMode,el,em,eb);if(ef)return ef}let el=pt(eS*ef.getoffsetX(G.glyphStartIndex),eI,eA,eh,ey,ex,G.segment,G.lineStartIndex,G.lineStartIndex+G.lineLength,eg,ed,ev,ew,eT);if(!el)return{notEnoughRoom:!0};eE=[el]}for(let G of eE)V.addDynamicAttributes(e_,G.point,G.angle);return{}}function _t(V,G,el,eh,ec,ep){let ed=nt(V.add(V.sub(G)._unit()),ec,ep).point,em=el.sub(ed);return el.add(em._mult(eh/em.mag()))}function pt(G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb){let ew=ec?G-el:G+el,eT=ew>0?1:-1,eE=0;ec&&(eT*=-1,eE=Math.PI),eT<0&&(eE+=Math.PI);let eS=eT>0?ef+em:ef+em+1,eI=ep,eA=ep,eM=0,eC=0,ez=Math.abs(ew),ek=[];for(;eM+eC<=ez;){if((eS+=eT)<ef||eS>=eg)return null;if(eA=eI,ek.push(eI),void 0===(eI=ex[eS])){let G=new V.pointGeometry(e_.getx(eS),e_.gety(eS)),el=nt(G,ey,eb);if(el.signedDistanceFromCamera>0)eI=ex[eS]=el.point;else{let el=eS-eT;eI=_t(0===eM?ed:new V.pointGeometry(e_.getx(el),e_.gety(el)),G,eA,ez-eM+1,ey,eb)}}eM+=eC,eC=eA.dist(eI)}let eP=(ez-eM)/eC,eD=eI.sub(eA),eL=eD.mult(eP)._add(eA);eL._add(eD._unit()._perp()._mult(eh*eT));let eR=eE+Math.atan2(eI.y-eA.y,eI.x-eA.x);return ek.push(eL),{point:eL,angle:ev?eR:0,path:ek}}let ev=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function gt(V,G){for(let el=0;el<V;el++){let V=G.length;G.resize(V+4),G.float32.set(ev,3*V)}}function xt(V,G,el){let eh=G[0],ec=G[1];return V[0]=el[0]*eh+el[4]*ec+el[12],V[1]=el[1]*eh+el[5]*ec+el[13],V[3]=el[3]*eh+el[7]*ec+el[15],V}let yt=class yt{constructor(V,G=new at(V.width+200,V.height+200,25),el=new at(V.width+200,V.height+200,25)){this.transform=V,this.grid=G,this.ignoredGrid=el,this.pitchfactor=Math.cos(V._pitch)*V.cameraToCenterDistance,this.screenRightBoundary=V.width+100,this.screenBottomBoundary=V.height+100,this.gridRightBoundary=V.width+200,this.gridBottomBoundary=V.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(V,G,el,eh,ec,ep){let ed=this.projectAndGetPerspectiveRatio(eh,V.anchorPointX,V.anchorPointY,ep),em=el*ed.perspectiveRatio,ef=V.x1*em+ed.point.x,eg=V.y1*em+ed.point.y,e_=V.x2*em+ed.point.x,ey=V.y2*em+ed.point.y;return!this.isInsideGrid(ef,eg,e_,ey)||"always"!==G&&this.grid.hitTest(ef,eg,e_,ey,G,ec)||ed.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[ef,eg,e_,ey],offscreen:this.isOffscreen(ef,eg,e_,ey)}}placeCollisionCircles(G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb){let ew=[],eT=new V.pointGeometry(el.anchorX,el.anchorY),eE=nt(eT,ed,eb),eS=lt(this.transform.cameraToCenterDistance,eE.signedDistanceFromCamera),eI=(e_?ep/eS:ep*eS)/V.ONE_EM,eA=nt(eT,em,eb).point,eM=ut(eI,ec,el.lineOffsetX*eI,el.lineOffsetY*eI,!1,eA,eT,el,eh,em,{},!1,eb),eC=!1,ez=!1,ek=!0;if(eM){let el=.5*ex*eS+ev,eh=new V.pointGeometry(-100,-100),ec=new V.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ep=new it,ed=eM.first,em=eM.last,e_=[];for(let V=ed.path.length-1;V>=1;V--)e_.push(ed.path[V]);for(let V=1;V<em.path.length;V++)e_.push(em.path[V]);let eT=2.5*el;if(ef){let V=e_.map(V=>nt(V,ef,eb));e_=V.some(V=>V.signedDistanceFromCamera<=0)?[]:V.map(V=>V.point)}let eE=[];if(e_.length>0){let G=e_[0].clone(),el=e_[0].clone();for(let V=1;V<e_.length;V++)G.x=Math.min(G.x,e_[V].x),G.y=Math.min(G.y,e_[V].y),el.x=Math.max(el.x,e_[V].x),el.y=Math.max(el.y,e_[V].y);eE=G.x>=eh.x&&el.x<=ec.x&&G.y>=eh.y&&el.y<=ec.y?[e_]:el.x<eh.x||G.x>ec.x||el.y<eh.y||G.y>ec.y?[]:V.clipLine([e_],eh.x,eh.y,ec.x,ec.y)}for(let V of eE){ep.reset(V,.25*el);let eh=0;eh=ep.length<=.5*el?1:Math.ceil(ep.paddedLength/eT)+1;for(let V=0;V<eh;V++){let ec=V/Math.max(eh-1,1),ed=ep.lerp(ec),em=ed.x+100,ef=ed.y+100;ew.push(em,ef,el,0);let e_=em-el,ex=ef-el,ev=em+el,eb=ef+el;if(ek=ek&&this.isOffscreen(e_,ex,ev,eb),ez=ez||this.isInsideGrid(e_,ex,ev,eb),"always"!==G&&this.grid.hitTestCircle(em,ef,el,G,ey)&&(eC=!0,!eg))return{circles:[],offscreen:!1,collisionDetected:eC}}}}return{circles:!eg&&eC||!ez||eS<this.perspectiveRatioCutoff?[]:ew,offscreen:ek,collisionDetected:eC}}queryRenderedSymbols(G){if(0===G.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};let el=[],eh=1/0,ec=1/0,ep=-1/0,ed=-1/0;for(let em of G){let G=new V.pointGeometry(em.x+100,em.y+100);eh=Math.min(eh,G.x),ec=Math.min(ec,G.y),ep=Math.max(ep,G.x),ed=Math.max(ed,G.y),el.push(G)}let em=this.grid.query(eh,ec,ep,ed).concat(this.ignoredGrid.query(eh,ec,ep,ed)),ef={},eg={};for(let G of em){let eh=G.key;if(void 0===ef[eh.bucketInstanceId]&&(ef[eh.bucketInstanceId]={}),ef[eh.bucketInstanceId][eh.featureIndex])continue;let ec=[new V.pointGeometry(G.x1,G.y1),new V.pointGeometry(G.x2,G.y1),new V.pointGeometry(G.x2,G.y2),new V.pointGeometry(G.x1,G.y2)];V.polygonIntersectsPolygon(el,ec)&&(ef[eh.bucketInstanceId][eh.featureIndex]=!0,void 0===eg[eh.bucketInstanceId]&&(eg[eh.bucketInstanceId]=[]),eg[eh.bucketInstanceId].push(eh.featureIndex))}return eg}insertCollisionBox(V,G,el,eh,ec,ep){(el?this.ignoredGrid:this.grid).insert({bucketInstanceId:eh,featureIndex:ec,collisionGroupID:ep,overlapMode:G},V[0],V[1],V[2],V[3])}insertCollisionCircles(V,G,el,eh,ec,ep){let ed=el?this.ignoredGrid:this.grid,em={bucketInstanceId:eh,featureIndex:ec,collisionGroupID:ep,overlapMode:G};for(let G=0;G<V.length;G+=4)ed.insertCircle(em,V[G],V[G+1],V[G+2])}projectAndGetPerspectiveRatio(G,el,eh,ec){let ep;return ec?(ep=[el,eh,ec(el,eh),1],V.transformMat4(ep,ep,G)):xt(ep=[el,eh,0,1],ep,G),{point:new V.pointGeometry((ep[0]/ep[3]+1)/2*this.transform.width+100,(-ep[1]/ep[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/ep[3]*.5}}isOffscreen(V,G,el,eh){return el<100||V>=this.screenRightBoundary||eh<100||G>this.screenBottomBoundary}isInsideGrid(V,G,el,eh){return el>=0&&V<this.gridRightBoundary&&eh>=0&&G<this.gridBottomBoundary}getViewportMatrix(){let G=V.identity([]);return V.translate(G,G,[-100,-100,0]),G}};function bt(G,el,eh){return el*(V.EXTENT/(G.tileSize*Math.pow(2,eh-G.tileID.overscaledZ)))}let wt=class wt{constructor(V,G,el,eh){this.opacity=V?Math.max(0,Math.min(1,V.opacity+(V.placed?G:-G))):eh&&el?1:0,this.placed=el}isHidden(){return 0===this.opacity&&!this.placed}};let Tt=class Tt{constructor(V,G,el,eh,ec){this.text=new wt(V?V.text:null,G,el,ec),this.icon=new wt(V?V.icon:null,G,eh,ec)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}};let Et=class Et{constructor(V,G,el){this.text=V,this.icon=G,this.skipFade=el}};let It=class It{constructor(){this.invProjMatrix=V.create(),this.viewportMatrix=V.create(),this.circles=[]}};let Ct=class Ct{constructor(V,G,el,eh,ec){this.bucketInstanceId=V,this.featureIndex=G,this.sourceLayerIndex=el,this.bucketIndex=eh,this.tileID=ec}};let St=class St{constructor(V){this.crossSourceCollisions=V,this.maxGroupID=0,this.collisionGroups={}}get(V){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[V]){let G=++this.maxGroupID;this.collisionGroups[V]={ID:G,predicate:V=>V.collisionGroupID===G}}return this.collisionGroups[V]}};function Dt(G,el,eh,ec,ep){let{horizontalAlign:ed,verticalAlign:em}=V.getAnchorAlignment(G),ef=V.evaluateVariableOffset(G,ec);return new V.pointGeometry(-(ed-.5)*el+ef[0]*ep,-(em-.5)*eh+ef[1]*ep)}function zt(G,el,eh,ec,ep,ed){let{x1:em,x2:ef,y1:eg,y2:e_,anchorPointX:ey,anchorPointY:ex}=G,ev=new V.pointGeometry(el,eh);return ec&&ev._rotate(ep?ed:-ed),{x1:em+ev.x,y1:eg+ev.y,x2:ef+ev.x,y2:e_+ev.y,anchorPointX:ey,anchorPointY:ex}}let Pt=class Pt{constructor(V,G,el,eh,ec){this.transform=V.clone(),this.terrain=G,this.collisionIndex=new yt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=el,this.retainedQueryData={},this.collisionGroups=new St(eh),this.collisionCircleArrays={},this.prevPlacement=ec,ec&&(ec.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(G,el,eh,ec){let ep=eh.getBucket(el),ed=eh.latestFeatureIndex;if(!ep||!ed||el.id!==ep.layerIds[0])return;let em=eh.collisionBoxArray,ef=ep.layers[0].layout,eg=Math.pow(2,this.transform.zoom-eh.tileID.overscaledZ),e_=eh.tileSize/V.EXTENT,ey=this.transform.calculatePosMatrix(eh.tileID.toUnwrapped()),ex="map"===ef.get("text-pitch-alignment"),ev="map"===ef.get("text-rotation-alignment"),eb=bt(eh,1,this.transform.zoom),ew=rt(ey,ex,ev,this.transform,eb),eT=null;if(ex){let G=st(ey,ex,ev,this.transform,eb);eT=V.multiply([],this.transform.labelPlaneMatrix,G)}this.retainedQueryData[ep.bucketInstanceId]=new Ct(ep.bucketInstanceId,ed,ep.sourceLayerIndex,ep.index,eh.tileID);let eE={bucket:ep,layout:ef,posMatrix:ey,textLabelPlaneMatrix:ew,labelToScreenMatrix:eT,scale:eg,textPixelRatio:e_,holdingForFade:eh.holdingForFade(),collisionBoxArray:em,partiallyEvaluatedTextSize:V.evaluateSizeForZoom(ep.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(ep.sourceID)};if(ec)for(let V of ep.sortKeyRanges){let{sortKey:el,symbolInstanceStart:eh,symbolInstanceEnd:ec}=V;G.push({sortKey:el,symbolInstanceStart:eh,symbolInstanceEnd:ec,parameters:eE})}else G.push({symbolInstanceStart:0,symbolInstanceEnd:ep.symbolInstances.length,parameters:eE})}attemptAnchorPlacement(V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew){let eT=[ey.textOffset0,ey.textOffset1],eE=Dt(V,el,eh,eT,ec),eS=this.collisionIndex.placeCollisionBox(zt(G,eE.x,eE.y,ep,ed,this.transform.angle),e_,em,ef,eg.predicate,ew);if((!eb||0!==this.collisionIndex.placeCollisionBox(zt(eb,eE.x,eE.y,ep,ed,this.transform.angle),e_,em,ef,eg.predicate,ew).box.length)&&eS.box.length>0){let G;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ey.crossTileID]&&this.prevPlacement.placements[ey.crossTileID]&&this.prevPlacement.placements[ey.crossTileID].text&&(G=this.prevPlacement.variableOffsets[ey.crossTileID].anchor),0===ey.crossTileID)throw Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ey.crossTileID]={textOffset:eT,width:el,height:eh,anchor:V,textBoxScale:ec,prevAnchor:G},this.markUsedJustification(ex,V,ey,ev),ex.allowVerticalPlacement&&(this.markUsedOrientation(ex,ev,ey),this.placedOrientations[ey.crossTileID]=ev),{shift:eE,placedGlyphBoxes:eS}}}placeLayerBucketPart(G,el,eh){let{bucket:ec,layout:ep,posMatrix:ed,textLabelPlaneMatrix:em,labelToScreenMatrix:ef,textPixelRatio:eg,holdingForFade:e_,collisionBoxArray:ey,partiallyEvaluatedTextSize:ex,collisionGroup:ev}=G.parameters,eb=ep.get("text-optional"),ew=ep.get("icon-optional"),eT=V.getOverlapMode(ep,"text-overlap","text-allow-overlap"),eE="always"===eT,eS=V.getOverlapMode(ep,"icon-overlap","icon-allow-overlap"),eI="always"===eS,eA="map"===ep.get("text-rotation-alignment"),eM="map"===ep.get("text-pitch-alignment"),eC="none"!==ep.get("icon-text-fit"),ez="viewport-y"===ep.get("symbol-z-order"),ek=eE&&(eI||!ec.hasIconData()||ew),eP=eI&&(eE||!ec.hasTextData()||eb);!ec.collisionArrays&&ey&&ec.deserializeCollisionBoxes(ey);let C=(G,ey)=>{if(el[G.crossTileID])return;if(e_)return void(this.placements[G.crossTileID]=new Et(!1,!1,!1));let eI=!1,ez=!1,eD=!0,eL=null,eR={box:null,offscreen:null},eB={box:null,offscreen:null},eF=null,eO=null,eU=null,eV=0,eN=0,e$=0;ey.textFeatureIndex?eV=ey.textFeatureIndex:G.useRuntimeCollisionCircles&&(eV=G.featureIndex),ey.verticalTextFeatureIndex&&(eN=ey.verticalTextFeatureIndex);let eq=this.retainedQueryData[ec.bucketInstanceId].tileID,eG=this.terrain?(V,G)=>this.terrain.getElevation(eq,V,G):null;for(let V of["textBox","verticalTextBox","iconBox","verticalIconBox"]){let G=ey[V];G&&(G.elevation=eG?eG(G.anchorPointX,G.anchorPointY):0)}let eZ=ey.textBox;if(eZ){let i=el=>{let eh=V.WritingMode.horizontal;if(ec.allowVerticalPlacement&&!el&&this.prevPlacement){let V=this.prevPlacement.placedOrientations[G.crossTileID];V&&(this.placedOrientations[G.crossTileID]=V,eh=V,this.markUsedOrientation(ec,eh,G))}return eh},o=(el,eh)=>{if(ec.allowVerticalPlacement&&G.numVerticalGlyphVertices>0&&ey.verticalTextBox){for(let G of ec.writingModes)if(G===V.WritingMode.vertical?eB=eR=eh():eR=el(),eR&&eR.box&&eR.box.length)break}else eR=el()};if(ep.get("text-variable-anchor")){let el=ep.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]){let V=this.prevPlacement.variableOffsets[G.crossTileID];el.indexOf(V.anchor)>0&&(el=el.filter(G=>G!==V.anchor)).unshift(V.anchor)}let l=(V,eh,ep)=>{let em=V.x2-V.x1,ef=V.y2-V.y1,e_=G.textBoxScale,ey=eC&&"never"===eS?eh:null,ex={box:[],offscreen:!1},eb="never"!==eT?2*el.length:el.length;for(let eh=0;eh<eb;++eh){let eb=this.attemptAnchorPlacement(el[eh%el.length],V,em,ef,e_,eA,eM,eg,ed,ev,eh>=el.length?eT:"never",G,ec,ep,ey,eG);if(eb&&(ex=eb.placedGlyphBoxes)&&ex.box&&ex.box.length){eI=!0,eL=eb.shift;break}}return ex};o(()=>l(eZ,ey.iconBox,V.WritingMode.horizontal),()=>{let el=ey.verticalTextBox;return ec.allowVerticalPlacement&&!(eR&&eR.box&&eR.box.length)&&G.numVerticalGlyphVertices>0&&el?l(el,ey.verticalIconBox,V.WritingMode.vertical):{box:null,offscreen:null}}),eR&&(eI=eR.box,eD=eR.offscreen);let eh=i(eR&&eR.box);if(!eI&&this.prevPlacement){let V=this.prevPlacement.variableOffsets[G.crossTileID];V&&(this.variableOffsets[G.crossTileID]=V,this.markUsedJustification(ec,V.anchor,G,eh))}}else{let r=(V,el)=>{let eh=this.collisionIndex.placeCollisionBox(V,eT,eg,ed,ev.predicate,eG);return eh&&eh.box&&eh.box.length&&(this.markUsedOrientation(ec,el,G),this.placedOrientations[G.crossTileID]=el),eh};o(()=>r(eZ,V.WritingMode.horizontal),()=>{let el=ey.verticalTextBox;return ec.allowVerticalPlacement&&G.numVerticalGlyphVertices>0&&el?r(el,V.WritingMode.vertical):{box:null,offscreen:null}}),i(eR&&eR.box&&eR.box.length)}}if(eI=(eF=eR)&&eF.box&&eF.box.length>0,eD=eF&&eF.offscreen,G.useRuntimeCollisionCircles){let el=ec.text.placedSymbolArray.get(G.centerJustifiedTextSymbolIndex),eg=V.evaluateSizeForFeature(ec.textSizeData,ex,el),e_=ep.get("text-padding");(eO=this.collisionIndex.placeCollisionCircles(eT,el,ec.lineVertexArray,ec.glyphOffsetArray,eg,ed,em,ef,eh,eM,ev.predicate,G.collisionCircleDiameter,e_,eG)).circles.length&&eO.collisionDetected&&!eh&&V.warnOnce("Collisions detected, but collision boxes are not shown"),eI=eE||eO.circles.length>0&&!eO.collisionDetected,eD=eD&&eO.offscreen}if(ey.iconFeatureIndex&&(e$=ey.iconFeatureIndex),ey.iconBox){let t=V=>{let G=eC&&eL?zt(V,eL.x,eL.y,eA,eM,this.transform.angle):V;return this.collisionIndex.placeCollisionBox(G,eS,eg,ed,ev.predicate,eG)};ez=eB&&eB.box&&eB.box.length&&ey.verticalIconBox?(eU=t(ey.verticalIconBox)).box.length>0:(eU=t(ey.iconBox)).box.length>0,eD=eD&&eU.offscreen}let ej=eb||0===G.numHorizontalGlyphVertices&&0===G.numVerticalGlyphVertices,eX=ew||0===G.numIconVertices;if(ej||eX?eX?ej||(ez=ez&&eI):eI=ez&&eI:ez=eI=ez&&eI,eI&&eF&&eF.box&&this.collisionIndex.insertCollisionBox(eF.box,eT,ep.get("text-ignore-placement"),ec.bucketInstanceId,eB&&eB.box&&eN?eN:eV,ev.ID),ez&&eU&&this.collisionIndex.insertCollisionBox(eU.box,eS,ep.get("icon-ignore-placement"),ec.bucketInstanceId,e$,ev.ID),eO&&(eI&&this.collisionIndex.insertCollisionCircles(eO.circles,eT,ep.get("text-ignore-placement"),ec.bucketInstanceId,eV,ev.ID),eh)){let V=ec.bucketInstanceId,G=this.collisionCircleArrays[V];void 0===G&&(G=this.collisionCircleArrays[V]=new It);for(let V=0;V<eO.circles.length;V+=4)G.circles.push(eO.circles[V+0]),G.circles.push(eO.circles[V+1]),G.circles.push(eO.circles[V+2]),G.circles.push(eO.collisionDetected?1:0)}if(0===G.crossTileID)throw Error("symbolInstance.crossTileID can't be 0");if(0===ec.bucketInstanceId)throw Error("bucket.bucketInstanceId can't be 0");this.placements[G.crossTileID]=new Et(eI||ek,ez||eP,eD||ec.justReloaded),el[G.crossTileID]=!0};if(ez){if(0!==G.symbolInstanceStart)throw Error("bucket.bucketInstanceId should be 0");let V=ec.getSortedSymbolIndexes(this.transform.angle);for(let G=V.length-1;G>=0;--G){let el=V[G];C(ec.symbolInstances.get(el),ec.collisionArrays[el])}}else for(let V=G.symbolInstanceStart;V<G.symbolInstanceEnd;V++)C(ec.symbolInstances.get(V),ec.collisionArrays[V]);if(eh&&ec.bucketInstanceId in this.collisionCircleArrays){let G=this.collisionCircleArrays[ec.bucketInstanceId];V.invert(G.invProjMatrix,ed),G.viewportMatrix=this.collisionIndex.getViewportMatrix()}ec.justReloaded=!1}markUsedJustification(G,el,eh,ec){let ep;ep=ec===V.WritingMode.vertical?eh.verticalPlacedTextSymbolIndex:({left:eh.leftJustifiedTextSymbolIndex,center:eh.centerJustifiedTextSymbolIndex,right:eh.rightJustifiedTextSymbolIndex})[V.getAnchorJustification(el)];let ed=[eh.leftJustifiedTextSymbolIndex,eh.centerJustifiedTextSymbolIndex,eh.rightJustifiedTextSymbolIndex,eh.verticalPlacedTextSymbolIndex];for(let V of ed)V>=0&&(G.text.placedSymbolArray.get(V).crossTileID=ep>=0&&V!==ep?0:eh.crossTileID)}markUsedOrientation(G,el,eh){let ec=el===V.WritingMode.horizontal||el===V.WritingMode.horizontalOnly?el:0,ep=el===V.WritingMode.vertical?el:0,ed=[eh.leftJustifiedTextSymbolIndex,eh.centerJustifiedTextSymbolIndex,eh.rightJustifiedTextSymbolIndex];for(let V of ed)G.text.placedSymbolArray.get(V).placedOrientation=ec;eh.verticalPlacedTextSymbolIndex&&(G.text.placedSymbolArray.get(eh.verticalPlacedTextSymbolIndex).placedOrientation=ep)}commit(V){this.commitTime=V,this.zoomAtLastRecencyCheck=this.transform.zoom;let G=this.prevPlacement,el=!1;this.prevZoomAdjustment=G?G.zoomAdjustment(this.transform.zoom):0;let eh=G?G.symbolFadeChange(V):1,ec=G?G.opacities:{},ep=G?G.variableOffsets:{},ed=G?G.placedOrientations:{};for(let V in this.placements){let G=this.placements[V],ep=ec[V];ep?(this.opacities[V]=new Tt(ep,eh,G.text,G.icon),el=el||G.text!==ep.text.placed||G.icon!==ep.icon.placed):(this.opacities[V]=new Tt(null,eh,G.text,G.icon,G.skipFade),el=el||G.text||G.icon)}for(let V in ec){let G=ec[V];if(!this.opacities[V]){let ec=new Tt(G,eh,!1,!1);ec.isHidden()||(this.opacities[V]=ec,el=el||G.text.placed||G.icon.placed)}}for(let V in ep)this.variableOffsets[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.variableOffsets[V]=ep[V]);for(let V in ed)this.placedOrientations[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.placedOrientations[V]=ed[V]);if(G&&void 0===G.lastPlacementChangeTime)throw Error("Last placement time for previous placement is not defined");el?this.lastPlacementChangeTime=V:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=G?G.lastPlacementChangeTime:V)}updateLayerOpacities(V,G){let el={};for(let eh of G){let G=eh.getBucket(V);G&&eh.latestFeatureIndex&&V.id===G.layerIds[0]&&this.updateBucketOpacities(G,el,eh.collisionBoxArray)}}updateBucketOpacities(G,el,eh){G.hasTextData()&&G.text.opacityVertexArray.clear(),G.hasIconData()&&G.icon.opacityVertexArray.clear(),G.hasIconCollisionBoxData()&&G.iconCollisionBox.collisionVertexArray.clear(),G.hasTextCollisionBoxData()&&G.textCollisionBox.collisionVertexArray.clear();let ec=G.layers[0].layout,ep=new Tt(null,0,!1,!1,!0),ed=ec.get("text-allow-overlap"),em=ec.get("icon-allow-overlap"),ef=ec.get("text-variable-anchor"),eg="map"===ec.get("text-rotation-alignment"),e_="map"===ec.get("text-pitch-alignment"),ey="none"!==ec.get("icon-text-fit"),ex=new Tt(null,0,ed&&(em||!G.hasIconData()||ec.get("icon-optional")),em&&(ed||!G.hasTextData()||ec.get("text-optional")),!0);!G.collisionArrays&&eh&&(G.hasIconCollisionBoxData()||G.hasTextCollisionBoxData())&&G.deserializeCollisionBoxes(eh);let m=(V,G,el)=>{for(let eh=0;eh<G/4;eh++)V.opacityVertexArray.emplaceBack(el)};for(let eh=0;eh<G.symbolInstances.length;eh++){let ec=G.symbolInstances.get(eh),{numHorizontalGlyphVertices:ed,numVerticalGlyphVertices:em,crossTileID:ev}=ec,ew=this.opacities[ev];el[ev]?ew=ep:ew||(ew=ex,this.opacities[ev]=ew),el[ev]=!0;let eT=ec.numIconVertices>0,eE=this.placedOrientations[ec.crossTileID],eS=eE===V.WritingMode.vertical,eI=eE===V.WritingMode.horizontal||eE===V.WritingMode.horizontalOnly;if(ed>0||em>0){let V=Ut(ew.text);m(G.text,ed,eS?eb:V),m(G.text,em,eI?eb:V);let el=ew.text.isHidden();[ec.rightJustifiedTextSymbolIndex,ec.centerJustifiedTextSymbolIndex,ec.leftJustifiedTextSymbolIndex].forEach(V=>{V>=0&&(G.text.placedSymbolArray.get(V).hidden=el||eS?1:0)}),ec.verticalPlacedTextSymbolIndex>=0&&(G.text.placedSymbolArray.get(ec.verticalPlacedTextSymbolIndex).hidden=el||eI?1:0);let eh=this.variableOffsets[ec.crossTileID];eh&&this.markUsedJustification(G,eh.anchor,ec,eE);let ep=this.placedOrientations[ec.crossTileID];ep&&(this.markUsedJustification(G,"left",ec,ep),this.markUsedOrientation(G,ep,ec))}if(eT){let V=Ut(ew.icon),el=!(ey&&ec.verticalPlacedIconSymbolIndex&&eS);ec.placedIconSymbolIndex>=0&&(m(G.icon,ec.numIconVertices,el?V:eb),G.icon.placedSymbolArray.get(ec.placedIconSymbolIndex).hidden=ew.icon.isHidden()),ec.verticalPlacedIconSymbolIndex>=0&&(m(G.icon,ec.numVerticalIconVertices,el?eb:V),G.icon.placedSymbolArray.get(ec.verticalPlacedIconSymbolIndex).hidden=ew.icon.isHidden())}if(G.hasIconCollisionBoxData()||G.hasTextCollisionBoxData()){let el=G.collisionArrays[eh];if(el){let eh=new V.pointGeometry(0,0);if(el.textBox||el.verticalTextBox){let V=!0;if(ef){let G=this.variableOffsets[ev];G?(eh=Dt(G.anchor,G.width,G.height,G.textOffset,G.textBoxScale),eg&&eh._rotate(e_?this.transform.angle:-this.transform.angle)):V=!1}el.textBox&&Mt(G.textCollisionBox.collisionVertexArray,ew.text.placed,!V||eS,eh.x,eh.y),el.verticalTextBox&&Mt(G.textCollisionBox.collisionVertexArray,ew.text.placed,!V||eI,eh.x,eh.y)}let ec=!!(!eI&&el.verticalIconBox);el.iconBox&&Mt(G.iconCollisionBox.collisionVertexArray,ew.icon.placed,ec,ey?eh.x:0,ey?eh.y:0),el.verticalIconBox&&Mt(G.iconCollisionBox.collisionVertexArray,ew.icon.placed,!ec,ey?eh.x:0,ey?eh.y:0)}}}if(G.sortFeatures(this.transform.angle),this.retainedQueryData[G.bucketInstanceId]&&(this.retainedQueryData[G.bucketInstanceId].featureSortOrder=G.featureSortOrder),G.hasTextData()&&G.text.opacityVertexBuffer&&G.text.opacityVertexBuffer.updateData(G.text.opacityVertexArray),G.hasIconData()&&G.icon.opacityVertexBuffer&&G.icon.opacityVertexBuffer.updateData(G.icon.opacityVertexArray),G.hasIconCollisionBoxData()&&G.iconCollisionBox.collisionVertexBuffer&&G.iconCollisionBox.collisionVertexBuffer.updateData(G.iconCollisionBox.collisionVertexArray),G.hasTextCollisionBoxData()&&G.textCollisionBox.collisionVertexBuffer&&G.textCollisionBox.collisionVertexBuffer.updateData(G.textCollisionBox.collisionVertexArray),G.text.opacityVertexArray.length!==G.text.layoutVertexArray.length/4)throw Error(`bucket.text.opacityVertexArray.length (= ${G.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${G.text.layoutVertexArray.length}) / 4`);if(G.icon.opacityVertexArray.length!==G.icon.layoutVertexArray.length/4)throw Error(`bucket.icon.opacityVertexArray.length (= ${G.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${G.icon.layoutVertexArray.length}) / 4`);if(G.bucketInstanceId in this.collisionCircleArrays){let V=this.collisionCircleArrays[G.bucketInstanceId];G.placementInvProjMatrix=V.invProjMatrix,G.placementViewportMatrix=V.viewportMatrix,G.collisionCircleArray=V.circles,delete this.collisionCircleArrays[G.bucketInstanceId]}}symbolFadeChange(V){return 0===this.fadeDuration?1:(V-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(V){return Math.max(0,(this.transform.zoom-V)/1.5)}hasTransitions(V){return this.stale||V-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(V,G){let el=this.zoomAtLastRecencyCheck===G?1-this.zoomAdjustment(G):1;return this.zoomAtLastRecencyCheck=G,this.commitTime+this.fadeDuration*el>V}setStale(){this.stale=!0}};function Mt(V,G,el,eh,ec){V.emplaceBack(G?1:0,el?1:0,eh||0,ec||0),V.emplaceBack(G?1:0,el?1:0,eh||0,ec||0),V.emplaceBack(G?1:0,el?1:0,eh||0,ec||0),V.emplaceBack(G?1:0,el?1:0,eh||0,ec||0)}function Ut(V){if(0===V.opacity&&!V.placed)return 0;if(1===V.opacity&&V.placed)return 4294967295;let G=V.placed?1:0,el=Math.floor(127*V.opacity);return 33554432*el+16777216*G+131072*el+65536*G+512*el+256*G+2*el+G}let eb=0;let Gt=class Gt{constructor(V){this._sortAcrossTiles="viewport-y"!==V.layout.get("symbol-z-order")&&!V.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(V,G,el,eh,ec){let ep=this._bucketParts;for(;this._currentTileIndex<V.length;)if(G.getBucketParts(ep,eh,V[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,ec())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,ep.sort((V,G)=>V.sortKey-G.sortKey));this._currentPartIndex<ep.length;)if(G.placeLayerBucketPart(ep[this._currentPartIndex],this._seenCrossTileIDs,el),this._currentPartIndex++,ec())return!0;return!1}};let Zt=class Zt{constructor(V,G,el,eh,ec,ep,ed,em){this.placement=new Pt(V,G,ep,ed,em),this._currentPlacementIndex=el.length-1,this._forceFullPlacement=eh,this._showCollisionBoxes=ec,this._done=!1}isDone(){return this._done}continuePlacement(G,el,eh){let ec=V.exported.now(),r=()=>{let G=V.exported.now()-ec;return!this._forceFullPlacement&&G>2};for(;this._currentPlacementIndex>=0;){let V=el[G[this._currentPlacementIndex]],ec=this.placement.collisionIndex.transform.zoom;if("symbol"===V.type&&(!V.minzoom||V.minzoom<=ec)&&(!V.maxzoom||V.maxzoom>ec)){if(this._inProgressLayer||(this._inProgressLayer=new Gt(V)),this._inProgressLayer.continuePlacement(eh[V.source],this.placement,this._showCollisionBoxes,V,r))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(V){return this.placement.commit(V),this.placement}};let ew=512/V.EXTENT/2;let qt=class qt{constructor(V,G,el){this.tileID=V,this.indexedSymbolInstances={},this.bucketInstanceId=el;for(let el=0;el<G.length;el++){let eh=G.get(el),ec=eh.key;this.indexedSymbolInstances[ec]||(this.indexedSymbolInstances[ec]=[]),this.indexedSymbolInstances[ec].push({crossTileID:eh.crossTileID,coord:this.getScaledCoordinates(eh,V)})}}getScaledCoordinates(G,el){let eh=ew/Math.pow(2,el.canonical.z-this.tileID.canonical.z);return{x:Math.floor((el.canonical.x*V.EXTENT+G.anchorX)*eh),y:Math.floor((el.canonical.y*V.EXTENT+G.anchorY)*eh)}}findMatches(V,G,el){let eh=this.tileID.canonical.z<G.canonical.z?1:Math.pow(2,this.tileID.canonical.z-G.canonical.z);for(let ec=0;ec<V.length;ec++){let ep=V.get(ec);if(ep.crossTileID)continue;let ed=this.indexedSymbolInstances[ep.key];if(!ed)continue;let em=this.getScaledCoordinates(ep,G);for(let V of ed)if(Math.abs(V.coord.x-em.x)<=eh&&Math.abs(V.coord.y-em.y)<=eh&&!el[V.crossTileID]){el[V.crossTileID]=!0,ep.crossTileID=V.crossTileID;break}}}};let jt=class jt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}};let $t=class $t{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(V){let G=Math.round((V-this.lng)/360);if(0!==G)for(let V in this.indexes){let el=this.indexes[V],eh={};for(let V in el){let ec=el[V];ec.tileID=ec.tileID.unwrapTo(ec.tileID.wrap+G),eh[ec.tileID.key]=ec}this.indexes[V]=eh}this.lng=V}addBucket(V,G,el){if(this.indexes[V.overscaledZ]&&this.indexes[V.overscaledZ][V.key]){if(this.indexes[V.overscaledZ][V.key].bucketInstanceId===G.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(V.overscaledZ,this.indexes[V.overscaledZ][V.key])}for(let V=0;V<G.symbolInstances.length;V++)G.symbolInstances.get(V).crossTileID=0;this.usedCrossTileIDs[V.overscaledZ]||(this.usedCrossTileIDs[V.overscaledZ]={});let eh=this.usedCrossTileIDs[V.overscaledZ];for(let el in this.indexes){let ec=this.indexes[el];if(Number(el)>V.overscaledZ)for(let el in ec){let ep=ec[el];ep.tileID.isChildOf(V)&&ep.findMatches(G.symbolInstances,V,eh)}else{let ep=ec[V.scaledTo(Number(el)).key];ep&&ep.findMatches(G.symbolInstances,V,eh)}}for(let V=0;V<G.symbolInstances.length;V++){let ec=G.symbolInstances.get(V);ec.crossTileID||(ec.crossTileID=el.generate(),eh[ec.crossTileID]=!0)}return void 0===this.indexes[V.overscaledZ]&&(this.indexes[V.overscaledZ]={}),this.indexes[V.overscaledZ][V.key]=new qt(V,G.symbolInstances,G.bucketInstanceId),!0}removeBucketCrossTileIDs(V,G){for(let el in G.indexedSymbolInstances)for(let eh of G.indexedSymbolInstances[el])delete this.usedCrossTileIDs[V][eh.crossTileID]}removeStaleBuckets(V){let G=!1;for(let el in this.indexes){let eh=this.indexes[el];for(let ec in eh)V[eh[ec].bucketInstanceId]||(this.removeBucketCrossTileIDs(el,eh[ec]),delete eh[ec],G=!0)}return G}};let Xt=class Xt{constructor(){this.layerIndexes={},this.crossTileIDs=new jt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(V,G,el){let eh=this.layerIndexes[V.id];void 0===eh&&(eh=this.layerIndexes[V.id]=new $t);let ec=!1,ep={};for(let ed of(eh.handleWrapJump(el),G)){let G=ed.getBucket(V);G&&V.id===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),eh.addBucket(ed.tileID,G,this.crossTileIDs)&&(ec=!0),ep[G.bucketInstanceId]=!0)}return eh.removeStaleBuckets(ep)&&(ec=!0),ec}pruneUnusedLayers(V){let G={};for(let el in V.forEach(V=>{G[V]=!0}),this.layerIndexes)G[el]||delete this.layerIndexes[el]}};var eT=V.createLayout([{name:"a_pos",type:"Int16",components:2}]);let Ht=class Ht extends V.Evented{constructor(V){super(),this.sourceCache=V,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=V._cache.max,V.usedForTerrain=!0,V.tileSize=this.tileSize*2**this.deltaZoom}destruct(){for(let V in this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null,this._tiles){let G=this._tiles[V];G.textures.forEach(V=>V.destroy()),G.textures=[]}}update(G,el){for(let eh of(this.sourceCache.update(G,el),this._renderableTilesKeys=[],G.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:el})))this._renderableTilesKeys.push(eh.key),this._tiles[eh.key]||(eh.posMatrix=new Float64Array(16),V.ortho(eh.posMatrix,0,V.EXTENT,0,V.EXTENT,0,1),this._tiles[eh.key]=new k(eh,this.tileSize))}removeOutdated(V){let G={};for(let V of(this.renderHistory=this.renderHistory.filter((V,G)=>this.renderHistory.indexOf(V)===G).slice(0,this.renderHistorySize),this._renderableTilesKeys))G[V]=!0;for(let V of this.renderHistory)G[V]=!0;for(let el in this._tiles)G[el]||(this._tiles[el].clearTextures(V),delete this._tiles[el])}getRenderableTiles(){return this._renderableTilesKeys.map(V=>this.getTileByID(V))}getTileByID(V){return this._tiles[V]}getTerrainCoords(G){let el={};for(let eh of this._renderableTilesKeys){let ec=this._tiles[eh].tileID;if(ec.canonical.equals(G.canonical)){let ec=G.clone();ec.posMatrix=new Float64Array(16),V.ortho(ec.posMatrix,0,V.EXTENT,0,V.EXTENT,0,1),el[eh]=ec}else if(ec.canonical.isChildOf(G.canonical)){let ep=G.clone();ep.posMatrix=new Float64Array(16);let ed=ec.canonical.z-G.canonical.z,em=ec.canonical.x-(ec.canonical.x>>ed<<ed),ef=ec.canonical.y-(ec.canonical.y>>ed<<ed),eg=V.EXTENT>>ed;V.ortho(ep.posMatrix,0,eg,0,eg,0,1),V.translate(ep.posMatrix,ep.posMatrix,[-em*eg,-ef*eg,0]),el[eh]=ep}else if(G.canonical.isChildOf(ec.canonical)){let ep=G.clone();ep.posMatrix=new Float64Array(16);let ed=G.canonical.z-ec.canonical.z,em=G.canonical.x-(G.canonical.x>>ed<<ed),ef=G.canonical.y-(G.canonical.y>>ed<<ed),eg=V.EXTENT>>ed;V.ortho(ep.posMatrix,0,V.EXTENT,0,V.EXTENT,0,1),V.translate(ep.posMatrix,ep.posMatrix,[em*eg,ef*eg,0]),V.scale(ep.posMatrix,ep.posMatrix,[1/2**ed,1/2**ed,0]),el[eh]=ep}}return el}getSourceTile(V,G){let el=this.sourceCache._source,eh=V.overscaledZ-this.deltaZoom;if(eh>el.maxzoom&&(eh=el.maxzoom),eh<el.minzoom)return null;this._sourceTileCache[V.key]||(this._sourceTileCache[V.key]=V.scaledTo(eh).key);let ec=this.sourceCache.getTileByID(this._sourceTileCache[V.key]);if((!ec||!ec.dem)&&G)for(;eh>=el.minzoom&&(!ec||!ec.dem);)ec=this.sourceCache.getTileByID(V.scaledTo(eh--).key);return ec}tilesAfterTime(V=Date.now()){return Object.values(this._tiles).filter(G=>G.timeLoaded>=V)}};let Kt=class Kt{constructor(V,G,el){this.style=V,this.sourceCache=new Ht(G),this.options=el,this.exaggeration="number"==typeof el.exaggeration?el.exaggeration:1,this.elevationOffset="number"==typeof el.elevationOffset?el.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(G,el,eh,ec=V.EXTENT){if(!(el>=0&&el<ec&&eh>=0&&eh<ec))return this.elevationOffset;let ep=0,ed=this.getTerrainData(G);if(ed.tile&&ed.tile.dem){let G=V.transformMat4$1([],[el/ec*V.EXTENT,eh/ec*V.EXTENT],ed.u_terrain_matrix),em=[G[0]*ed.tile.dem.dim,G[1]*ed.tile.dem.dim],ef=[Math.floor(em[0]),Math.floor(em[1])],eg=ed.tile.dem.get(ef[0],ef[1]),e_=ed.tile.dem.get(ef[0],ef[1]+1),ey=ed.tile.dem.get(ef[0]+1,ef[1]),ex=ed.tile.dem.get(ef[0]+1,ef[1]+1);ep=V.number(V.number(eg,e_,em[0]-ef[0]),V.number(ey,ex,em[0]-ef[0]),em[1]-ef[1])}return ep}rememberForRerender(V,G){for(let el in this.sourceCache._tiles){let eh=this.sourceCache._tiles[el];(eh.tileID.equals(G)||eh.tileID.isChildOf(G))&&(V===this.sourceCache.sourceCache.id&&(eh.timeLoaded=Date.now()),this._rerender[V]=this._rerender[V]||{},this._rerender[V][eh.tileID.key]=!0)}}needsRerender(V,G){return this._rerender[V]&&this._rerender[V][G.key]}clearRerenderCache(){this._rerender={}}getElevation(G,el,eh,ec=V.EXTENT){return(this.getDEMElevation(G,el,eh,ec)+this.elevationOffset)*this.exaggeration}getTerrainData(G){if(!this._emptyDemTexture){let G=this.style.map.painter.context,el=new V.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l(G,el,G.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l(G,new V.RGBAImage({width:1,height:1}),G.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(G.gl.NEAREST,G.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=V.identity([])}let el=this.sourceCache.getSourceTile(G,!0);if(el&&el.dem&&(!el.demTexture||el.needsTerrainPrepare)){let V=this.style.map.painter.context;el.demTexture=this.style.map.painter.getTileTexture(el.dem.stride),el.demTexture?el.demTexture.update(el.dem.getPixels(),{premultiply:!1}):el.demTexture=new l(V,el.dem.getPixels(),V.gl.RGBA,{premultiply:!1}),el.demTexture.bind(V.gl.NEAREST,V.gl.CLAMP_TO_EDGE),el.needsTerrainPrepare=!1}let eh=el&&el+el.tileID.key+G.key;if(eh&&!this._demMatrixCache[eh]){let eh=this.sourceCache.sourceCache._source.maxzoom,ec=G.canonical.z-el.tileID.canonical.z;G.overscaledZ>G.canonical.z&&(G.canonical.z>=eh?ec=G.canonical.z-eh:V.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let ep=G.canonical.x-(G.canonical.x>>ec<<ec),ed=G.canonical.y-(G.canonical.y>>ec<<ec),em=V.fromScaling(new Float64Array(16),[1/(V.EXTENT<<ec),1/(V.EXTENT<<ec),0]);V.translate(em,em,[ep*V.EXTENT,ed*V.EXTENT,0]),this._demMatrixCache[G.key]={matrix:em,coord:G}}return{u_depth:2,u_terrain:3,u_terrain_dim:el&&el.dem&&el.dem.dim||1,u_terrain_matrix:eh?this._demMatrixCache[G.key].matrix:this._emptyDemMatrix,u_terrain_unpack:el&&el.dem&&el.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(el&&el.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:el}}getRTTFramebuffer(){let V=this.style.map.painter;if(!this._rttFramebuffer){let G=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=V.context.createFramebuffer(G,G,!0),this._rttFramebuffer.depthAttachment.set(V.context.createRenderbuffer(V.context.gl.DEPTH_COMPONENT16,G,G))}return this._rttFramebuffer}getFramebuffer(V){let G=this.style.map.painter,el=G.width/devicePixelRatio,eh=G.height/devicePixelRatio;return this._fbo&&(this._fbo.width!==el||this._fbo.height!==eh)&&(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l(G.context,{width:el,height:eh,data:null},G.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(G.context.gl.NEAREST,G.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l(G.context,{width:el,height:eh,data:null},G.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(G.context.gl.NEAREST,G.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=G.context.createFramebuffer(el,eh,!0),this._fbo.depthAttachment.set(G.context.createRenderbuffer(G.context.gl.DEPTH_COMPONENT16,el,eh))),this._fbo.colorAttachment.set("coords"===V?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let G=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;let el=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let V=0,G=0;V<this._coordsTextureSize;V++)for(let eh=0;eh<this._coordsTextureSize;eh++,G+=4)el[G+0]=255&eh,el[G+1]=255&V,el[G+2]=eh>>8<<4|V>>8,el[G+3]=0;let eh=new V.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(el.buffer)),ec=new l(G,eh,G.gl.RGBA,{premultiply:!1});return ec.bind(G.gl.NEAREST,G.gl.CLAMP_TO_EDGE),this._coordsTexture=ec,ec}pointCoordinate(G){let el=new Uint8Array(4),eh=this.style.map.painter,ec=eh.context,ep=ec.gl;ec.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),ep.readPixels(G.x,eh.height/devicePixelRatio-G.y-1,1,1,ep.RGBA,ep.UNSIGNED_BYTE,el),ec.bindFramebuffer.set(null);let ed=el[0]+(el[2]>>4<<8),em=el[1]+((15&el[2])<<8),ef=this.coordsIndex[255-el[3]],eg=ef&&this.sourceCache.getTileByID(ef);if(!eg)return null;let e_=this._coordsTextureSize,ey=(1<<eg.tileID.canonical.z)*e_;return new V.MercatorCoordinate((eg.tileID.canonical.x*e_+ed)/ey,(eg.tileID.canonical.y*e_+em)/ey,this.getElevation(eg.tileID,ed,em,e_))}getTerrainMesh(){if(this._mesh)return this._mesh;let G=this.style.map.painter.context,el=new V.PosArray,eh=new V.TriangleIndexArray,ec=this.meshSize,ep=V.EXTENT/ec,ed=ec*ec;for(let V=0;V<=ec;V++)for(let G=0;G<=ec;G++)el.emplaceBack(G*ep,V*ep);for(let V=0;V<ed;V+=ec+1)for(let G=0;G<ec;G++)eh.emplaceBack(G+V,ec+G+V+1,ec+G+V+2),eh.emplaceBack(G+V,ec+G+V+2,G+V+1);return this._mesh={indexBuffer:G.createIndexBuffer(eh),vertexBuffer:G.createVertexBuffer(el,eT.members),segments:V.SegmentVector.simpleSegment(0,0,el.length,eh.length)},this._mesh}getMinMaxElevation(V){let G=this.getTerrainData(V).tile,el={minElevation:null,maxElevation:null};return G&&G.dem&&(el.minElevation=(G.dem.min+this.elevationOffset)*this.exaggeration,el.maxElevation=(G.dem.max+this.elevationOffset)*this.exaggeration),el}};let Yt=(G,el)=>V.emitValidationErrors(G,el&&el.filter(V=>"source.canvas"!==V.identifier)),eE=V.pick(ex,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),eS=V.pick(ex,["setCenter","setZoom","setBearing","setPitch"]),eI=function(){let G={},el=V.spec.$version;for(let eh in V.spec.$root){let ec=V.spec.$root[eh];if(ec.required){let V=null;null!=(V="version"===eh?el:"array"===ec.type?[]:{})&&(G[eh]=V)}}return G}();let ee=class ee extends V.Evented{constructor(G,el={}){super(),this.map=G,this.dispatcher=new v(j(),this),this.imageManager=new h,this.imageManager.setEventedParent(this),this.glyphManager=new _(G._requestManager,el.localIdeographFontFamily),this.lineAtlas=new x(256,512),this.crossTileSymbolIndex=new Xt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new V.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",V.getReferrer());let eh=this;this._rtlTextPluginCallback=ee.registerForPluginStateChange(G=>{eh.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:G.pluginStatus,pluginURL:G.pluginURL},(G,el)=>{if(V.triggerPluginCompletionEvent(G),el&&el.every(V=>V))for(let V in eh.sourceCaches)eh.sourceCaches[V].reload()})}),this.on("data",V=>{if("source"!==V.dataType||"metadata"!==V.sourceDataType)return;let G=this.sourceCaches[V.sourceId];if(!G)return;let el=G.getSource();if(el&&el.vectorLayerIds)for(let V in this._layers){let G=this._layers[V];G.source===el.id&&this._validateLayer(G)}})}loadURL(G,el={}){this.fire(new V.Event("dataloading",{dataType:"style"}));let eh="boolean"!=typeof el.validate||el.validate,ec=this.map._requestManager.transformRequest(G,V.ResourceType.Style);this._request=V.getJSON(ec,(G,el)=>{this._request=null,G?this.fire(new V.ErrorEvent(G)):el&&this._load(el,eh)})}loadJSON(G,el={}){this.fire(new V.Event("dataloading",{dataType:"style"})),this._request=V.exported.frame(()=>{this._request=null,this._load(G,!1!==el.validate)})}loadEmpty(){this.fire(new V.Event("dataloading",{dataType:"style"})),this._load(eI,!1)}_load(G,el){if(el&&Yt(this,V.validateStyle(G)))return;for(let V in this._loaded=!0,this.stylesheet=G,G.sources)this.addSource(V,G.sources[V],{validate:!1});G.sprite?this._loadSprite(G.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(G.glyphs);let eh=X(this.stylesheet.layers);for(let G of(this._order=eh.map(V=>V.id),this._layers={},this._serializedLayers={},eh))(G=V.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new g(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new V.Event("data",{dataType:"style"})),this.fire(new V.Event("style.load"))}_loadSprite(G){this._spriteRequest=function(G,el,eh,ec){let ep,ed,em;let ef=eh>1?"@2x":"",eg=V.getJSON(el.transformRequest(el.normalizeSpriteURL(G,ef,".json"),V.ResourceType.SpriteJSON),(V,G)=>{eg=null,em||(em=V,ep=G,u())}),e_=V.getImage(el.transformRequest(el.normalizeSpriteURL(G,ef,".png"),V.ResourceType.SpriteImage),(V,G)=>{e_=null,em||(em=V,ed=G,u())});function u(){if(em)ec(em);else if(ep&&ed){let G=V.exported.getImageData(ed),el={};for(let eh in ep){let{width:ec,height:ed,x:em,y:ef,sdf:eg,pixelRatio:e_,stretchX:ey,stretchY:ex,content:ev}=ep[eh],eb=new V.RGBAImage({width:ec,height:ed});V.RGBAImage.copy(G,eb,{x:em,y:ef},{x:0,y:0},{width:ec,height:ed}),el[eh]={data:eb,pixelRatio:e_,sdf:eg,stretchX:ey,stretchY:ex,content:ev}}ec(null,el)}}return{cancel(){eg&&(eg.cancel(),eg=null),e_&&(e_.cancel(),e_=null)}}}(G,this.map._requestManager,this.map.getPixelRatio(),(G,el)=>{if(this._spriteRequest=null,G)this.fire(new V.ErrorEvent(G));else if(el)for(let V in el)this.imageManager.addImage(V,el[V]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new V.Event("data",{dataType:"style"}))})}_validateLayer(G){let el=this.sourceCaches[G.source];if(!el)return;let eh=G.sourceLayer;if(!eh)return;let ec=el.getSource();("geojson"===ec.type||ec.vectorLayerIds&&-1===ec.vectorLayerIds.indexOf(eh))&&this.fire(new V.ErrorEvent(Error(`Source layer "${eh}" does not exist on source "${ec.id}" as specified by style layer "${G.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let V in this.sourceCaches)if(!this.sourceCaches[V].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(V){let G=[];for(let el of V){let V=this._layers[el];"custom"!==V.type&&G.push(V.serialize())}return G}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(let V in this.sourceCaches)if(this.sourceCaches[V].hasTransition())return!0;for(let V in this._layers)if(this._layers[V].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw Error("Style is not done loading.")}update(G){if(!this._loaded)return;let el=this._changed;if(this._changed){let V=Object.keys(this._updatedLayers),el=Object.keys(this._removedLayers);for(let G in(V.length||el.length)&&this._updateWorkerLayers(V,el),this._updatedSources){let V=this._updatedSources[G];if("reload"===V)this._reloadSource(G);else{if("clear"!==V)throw Error(`Invalid action ${V}`);this._clearSource(G)}}for(let V in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[V].updateTransitions(G);this.light.updateTransitions(G),this._resetUpdates()}let eh={};for(let V in this.sourceCaches){let G=this.sourceCaches[V];eh[V]=G.used,G.used=!1}for(let V of this._order){let el=this._layers[V];el.recalculate(G,this._availableImages),!el.isHidden(G.zoom)&&el.source&&(this.sourceCaches[el.source].used=!0)}for(let G in eh){let el=this.sourceCaches[G];eh[G]!==el.used&&el.fire(new V.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:G}))}this.light.recalculate(G),this.z=G.zoom,el&&this.fire(new V.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let V=Object.keys(this._changedImages);if(V.length){for(let G in this.sourceCaches)this.sourceCaches[G].reloadTilesForDependencies(["icons","patterns"],V);this._changedImages={}}}_updateWorkerLayers(V,G){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(V),removedIds:G})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(G){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),G){let V=this.sourceCaches[G.source];if(!V)throw Error(`cannot load terrain, because there exists no source with ID: ${G.source}`);this.terrain=new Kt(this,V,G),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=V=>{V.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=V=>{V.tile&&(V.sourceId===G.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(V.sourceId,V.tile.tileID)):"geojson"===V.source.type&&this.terrain.rememberForRerender(V.sourceId,V.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new V.Event("terrain",{terrain:G}))}setState(G){if(this._checkLoaded(),Yt(this,V.validateStyle(G)))return!1;(G=V.clone$1(G)).layers=X(G.layers);let el=(function(V,G){if(!V)return[{command:ex.setStyle,args:[G]}];let el=[];try{if(!a(V.version,G.version))return[{command:ex.setStyle,args:[G]}];a(V.center,G.center)||el.push({command:ex.setCenter,args:[G.center]}),a(V.zoom,G.zoom)||el.push({command:ex.setZoom,args:[G.zoom]}),a(V.bearing,G.bearing)||el.push({command:ex.setBearing,args:[G.bearing]}),a(V.pitch,G.pitch)||el.push({command:ex.setPitch,args:[G.pitch]}),a(V.sprite,G.sprite)||el.push({command:ex.setSprite,args:[G.sprite]}),a(V.glyphs,G.glyphs)||el.push({command:ex.setGlyphs,args:[G.glyphs]}),a(V.transition,G.transition)||el.push({command:ex.setTransition,args:[G.transition]}),a(V.light,G.light)||el.push({command:ex.setLight,args:[G.light]});let eh={},ec=[];!function(V,G,el,eh){let ec;for(ec in G=G||{},V=V||{})Object.prototype.hasOwnProperty.call(V,ec)&&(Object.prototype.hasOwnProperty.call(G,ec)||K(ec,el,eh));for(ec in G){var ep,ed;Object.prototype.hasOwnProperty.call(G,ec)&&(Object.prototype.hasOwnProperty.call(V,ec)?a(V[ec],G[ec])||("geojson"===V[ec].type&&"geojson"===G[ec].type&&function(V,G,el){let eh;for(eh in V[el])if(Object.prototype.hasOwnProperty.call(V[el],eh)&&"data"!==eh&&!a(V[el][eh],G[el][eh]))return!1;for(eh in G[el])if(Object.prototype.hasOwnProperty.call(G[el],eh)&&"data"!==eh&&!a(V[el][eh],G[el][eh]))return!1;return!0}(V,G,ec)?el.push({command:ex.setGeoJSONSourceData,args:[ec,G[ec].data]}):(ep=ec,ed=G,K(ep,el,eh),H(ep,ed,el))):H(ec,G,el))}}(V.sources,G.sources,ec,eh);let ep=[];V.layers&&V.layers.forEach(V=>{eh[V.source]?el.push({command:ex.removeLayer,args:[V.id]}):ep.push(V)}),el=el.concat(ec),function(V,G,el){let eh,ec,ep,ed,em,ef,eg;G=G||[];let e_=(V=V||[]).map(tt),ey=G.map(tt),ev=V.reduce(et,{}),eb=G.reduce(et,{}),ew=e_.slice(),eT=Object.create(null);for(eh=0,ec=0;eh<e_.length;eh++)ep=e_[eh],Object.prototype.hasOwnProperty.call(eb,ep)?ec++:(el.push({command:ex.removeLayer,args:[ep]}),ew.splice(ew.indexOf(ep,ec),1));for(eh=0,ec=0;eh<ey.length;eh++)ep=ey[ey.length-1-eh],ew[ew.length-1-eh]!==ep&&(Object.prototype.hasOwnProperty.call(ev,ep)?(el.push({command:ex.removeLayer,args:[ep]}),ew.splice(ew.lastIndexOf(ep,ew.length-ec),1)):ec++,ef=ew[ew.length-eh],el.push({command:ex.addLayer,args:[eb[ep],ef]}),ew.splice(ew.length-eh,0,ep),eT[ep]=!0);for(eh=0;eh<ey.length;eh++)if(ed=ev[ep=ey[eh]],em=eb[ep],!eT[ep]&&!a(ed,em)){if(a(ed.source,em.source)&&a(ed["source-layer"],em["source-layer"])&&a(ed.type,em.type)){for(eg in Q(ed.layout,em.layout,el,ep,null,ex.setLayoutProperty),Q(ed.paint,em.paint,el,ep,null,ex.setPaintProperty),a(ed.filter,em.filter)||el.push({command:ex.setFilter,args:[ep,em.filter]}),a(ed.minzoom,em.minzoom)&&a(ed.maxzoom,em.maxzoom)||el.push({command:ex.setLayerZoomRange,args:[ep,em.minzoom,em.maxzoom]}),ed)Object.prototype.hasOwnProperty.call(ed,eg)&&"layout"!==eg&&"paint"!==eg&&"filter"!==eg&&"metadata"!==eg&&"minzoom"!==eg&&"maxzoom"!==eg&&(0===eg.indexOf("paint.")?Q(ed[eg],em[eg],el,ep,eg.slice(6),ex.setPaintProperty):a(ed[eg],em[eg])||el.push({command:ex.setLayerProperty,args:[ep,eg,em[eg]]}));for(eg in em)Object.prototype.hasOwnProperty.call(em,eg)&&!Object.prototype.hasOwnProperty.call(ed,eg)&&"layout"!==eg&&"paint"!==eg&&"filter"!==eg&&"metadata"!==eg&&"minzoom"!==eg&&"maxzoom"!==eg&&(0===eg.indexOf("paint.")?Q(ed[eg],em[eg],el,ep,eg.slice(6),ex.setPaintProperty):a(ed[eg],em[eg])||el.push({command:ex.setLayerProperty,args:[ep,eg,em[eg]]}))}else el.push({command:ex.removeLayer,args:[ep]}),ef=ew[ew.lastIndexOf(ep)+1],el.push({command:ex.addLayer,args:[em,ef]})}}(ep,G.layers,el)}catch(V){console.warn("Unable to compute style diff:",V),el=[{command:ex.setStyle,args:[G]}]}return el})(this.serialize(),G).filter(V=>!(V.command in eS));if(0===el.length)return!1;let eh=el.filter(V=>!(V.command in eE));if(eh.length>0)throw Error(`Unimplemented: ${eh.map(V=>V.command).join(", ")}.`);return el.forEach(V=>{"setTransition"!==V.command&&this[V.command].apply(this,V.args)}),this.stylesheet=G,!0}addImage(G,el){if(this.getImage(G))return this.fire(new V.ErrorEvent(Error(`An image named "${G}" already exists.`)));this.imageManager.addImage(G,el),this._afterImageUpdated(G)}updateImage(V,G){this.imageManager.updateImage(V,G)}getImage(V){return this.imageManager.getImage(V)}removeImage(G){if(!this.getImage(G))return this.fire(new V.ErrorEvent(Error(`An image named "${G}" does not exist.`)));this.imageManager.removeImage(G),this._afterImageUpdated(G)}_afterImageUpdated(G){this._availableImages=this.imageManager.listImages(),this._changedImages[G]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new V.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(G,el,eh={}){if(this._checkLoaded(),void 0!==this.sourceCaches[G])throw Error(`Source "${G}" already exists.`);if(!el.type)throw Error(`The type property must be defined, but only the following properties were given: ${Object.keys(el).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(el.type)>=0&&this._validate(V.validateStyle.source,`sources.${G}`,el,null,eh))return;this.map&&this.map._collectResourceTiming&&(el.collectResourceTiming=!0);let ec=this.sourceCaches[G]=new O(G,el,this.dispatcher);ec.style=this,ec.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:ec.serialize(),sourceId:G})),ec.onAdd(this.map),this._changed=!0}removeSource(G){if(this._checkLoaded(),void 0===this.sourceCaches[G])throw Error("There is no source with this ID");for(let el in this._layers)if(this._layers[el].source===G)return this.fire(new V.ErrorEvent(Error(`Source "${G}" cannot be removed while layer "${el}" is using it.`)));let el=this.sourceCaches[G];delete this.sourceCaches[G],delete this._updatedSources[G],el.fire(new V.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:G})),el.setEventedParent(null),el.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(V,G){if(this._checkLoaded(),void 0===this.sourceCaches[V])throw Error(`There is no source with this ID=${V}`);let el=this.sourceCaches[V].getSource();if("geojson"!==el.type)throw Error(`geojsonSource.type is ${el.type}, which is !== 'geojson`);el.setData(G),this._changed=!0}getSource(V){return this.sourceCaches[V]&&this.sourceCaches[V].getSource()}addLayer(G,el,eh={}){let ec;this._checkLoaded();let ep=G.id;if(this.getLayer(ep))return void this.fire(new V.ErrorEvent(Error(`Layer "${ep}" already exists on this map.`)));if("custom"===G.type){if(Yt(this,V.validateCustomStyleLayer(G)))return;ec=V.createStyleLayer(G)}else{if("object"==typeof G.source&&(this.addSource(ep,G.source),G=V.clone$1(G),G=V.extend(G,{source:ep})),this._validate(V.validateStyle.layer,`layers.${ep}`,G,{arrayIndex:-1},eh))return;ec=V.createStyleLayer(G),this._validateLayer(ec),ec.setEventedParent(this,{layer:{id:ep}}),this._serializedLayers[ec.id]=ec.serialize()}let ed=el?this._order.indexOf(el):this._order.length;if(el&&-1===ed)this.fire(new V.ErrorEvent(Error(`Cannot add layer "${ep}" before non-existing layer "${el}".`)));else{if(this._order.splice(ed,0,ep),this._layerOrderChanged=!0,this._layers[ep]=ec,this._removedLayers[ep]&&ec.source&&"custom"!==ec.type){let V=this._removedLayers[ep];delete this._removedLayers[ep],V.type!==ec.type?this._updatedSources[ec.source]="clear":(this._updatedSources[ec.source]="reload",this.sourceCaches[ec.source].pause())}this._updateLayer(ec),ec.onAdd&&ec.onAdd(this.map)}}moveLayer(G,el){if(this._checkLoaded(),this._changed=!0,!this._layers[G])return void this.fire(new V.ErrorEvent(Error(`The layer '${G}' does not exist in the map's style and cannot be moved.`)));if(G===el)return;let eh=this._order.indexOf(G);this._order.splice(eh,1);let ec=el?this._order.indexOf(el):this._order.length;el&&-1===ec?this.fire(new V.ErrorEvent(Error(`Cannot move layer "${G}" before non-existing layer "${el}".`))):(this._order.splice(ec,0,G),this._layerOrderChanged=!0)}removeLayer(G){this._checkLoaded();let el=this._layers[G];if(!el)return void this.fire(new V.ErrorEvent(Error(`Cannot remove non-existing layer "${G}".`)));el.setEventedParent(null);let eh=this._order.indexOf(G);this._order.splice(eh,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[G]=el,delete this._layers[G],delete this._serializedLayers[G],delete this._updatedLayers[G],delete this._updatedPaintProps[G],el.onRemove&&el.onRemove(this.map)}getLayer(V){return this._layers[V]}hasLayer(V){return V in this._layers}setLayerZoomRange(G,el,eh){this._checkLoaded();let ec=this.getLayer(G);ec?ec.minzoom===el&&ec.maxzoom===eh||(null!=el&&(ec.minzoom=el),null!=eh&&(ec.maxzoom=eh),this._updateLayer(ec)):this.fire(new V.ErrorEvent(Error(`Cannot set the zoom range of non-existing layer "${G}".`)))}setFilter(G,el,eh={}){this._checkLoaded();let ec=this.getLayer(G);if(ec){if(!a(ec.filter,el))return null==el?(ec.filter=void 0,void this._updateLayer(ec)):void(this._validate(V.validateStyle.filter,`layers.${ec.id}.filter`,el,null,eh)||(ec.filter=V.clone$1(el),this._updateLayer(ec)))}else this.fire(new V.ErrorEvent(Error(`Cannot filter non-existing layer "${G}".`)))}getFilter(G){return V.clone$1(this.getLayer(G).filter)}setLayoutProperty(G,el,eh,ec={}){this._checkLoaded();let ep=this.getLayer(G);ep?a(ep.getLayoutProperty(el),eh)||(ep.setLayoutProperty(el,eh,ec),this._updateLayer(ep)):this.fire(new V.ErrorEvent(Error(`Cannot style non-existing layer "${G}".`)))}getLayoutProperty(G,el){let eh=this.getLayer(G);if(eh)return eh.getLayoutProperty(el);this.fire(new V.ErrorEvent(Error(`Cannot get style of non-existing layer "${G}".`)))}setPaintProperty(G,el,eh,ec={}){this._checkLoaded();let ep=this.getLayer(G);ep?a(ep.getPaintProperty(el),eh)||(ep.setPaintProperty(el,eh,ec)&&this._updateLayer(ep),this._changed=!0,this._updatedPaintProps[G]=!0):this.fire(new V.ErrorEvent(Error(`Cannot style non-existing layer "${G}".`)))}getPaintProperty(V,G){return this.getLayer(V).getPaintProperty(G)}setFeatureState(G,el){this._checkLoaded();let eh=G.source,ec=G.sourceLayer,ep=this.sourceCaches[eh];if(void 0===ep)return void this.fire(new V.ErrorEvent(Error(`The source '${eh}' does not exist in the map's style.`)));let ed=ep.getSource().type;"geojson"===ed&&ec?this.fire(new V.ErrorEvent(Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==ed||ec?(void 0===G.id&&this.fire(new V.ErrorEvent(Error("The feature id parameter must be provided."))),ep.setFeatureState(ec,G.id,el)):this.fire(new V.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(G,el){this._checkLoaded();let eh=G.source,ec=this.sourceCaches[eh];if(void 0===ec)return void this.fire(new V.ErrorEvent(Error(`The source '${eh}' does not exist in the map's style.`)));let ep=ec.getSource().type,ed="vector"===ep?G.sourceLayer:void 0;"vector"!==ep||ed?el&&"string"!=typeof G.id&&"number"!=typeof G.id?this.fire(new V.ErrorEvent(Error("A feature id is required to remove its specific state property."))):ec.removeFeatureState(ed,G.id,el):this.fire(new V.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(G){this._checkLoaded();let el=G.source,eh=G.sourceLayer,ec=this.sourceCaches[el];if(void 0!==ec)return"vector"!==ec.getSource().type||eh?(void 0===G.id&&this.fire(new V.ErrorEvent(Error("The feature id parameter must be provided."))),ec.getFeatureState(eh,G.id)):void this.fire(new V.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new V.ErrorEvent(Error(`The source '${el}' does not exist in the map's style.`)))}getTransition(){return V.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return V.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:V.mapObject(this.sourceCaches,V=>V.serialize()),layers:this._serializeLayers(this._order)},V=>void 0!==V)}_updateLayer(V){this._updatedLayers[V.id]=!0,V.source&&!this._updatedSources[V.source]&&"raster"!==this.sourceCaches[V.source].getSource().type&&(this._updatedSources[V.source]="reload",this.sourceCaches[V.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(V){let e=V=>"fill-extrusion"===this._layers[V].type,G={},el=[];for(let eh=this._order.length-1;eh>=0;eh--){let ec=this._order[eh];if(e(ec))for(let ep of(G[ec]=eh,V)){let V=ep[ec];if(V)for(let G of V)el.push(G)}}el.sort((V,G)=>G.intersectionZ-V.intersectionZ);let eh=[];for(let ec=this._order.length-1;ec>=0;ec--){let ep=this._order[ec];if(e(ep))for(let V=el.length-1;V>=0;V--){let ep=el[V].feature;if(G[ep.layer.id]<ec)break;eh.push(ep),el.pop()}else for(let G of V){let V=G[ep];if(V)for(let G of V)eh.push(G.feature)}}return eh}queryRenderedFeatures(G,el,eh){el&&el.filter&&this._validate(V.validateStyle.filter,"queryRenderedFeatures.filter",el.filter,null,el);let ec={};if(el&&el.layers){if(!Array.isArray(el.layers))return this.fire(new V.ErrorEvent(Error("parameters.layers must be an Array."))),[];for(let G of el.layers){let el=this._layers[G];if(!el)return this.fire(new V.ErrorEvent(Error(`The layer '${G}' does not exist in the map's style and cannot be queried for features.`))),[];ec[el.source]=!0}}let ep=[];for(let ed in el.availableImages=this._availableImages,this.sourceCaches)el.layers&&!ec[ed]||ep.push(function(G,el,eh,ec,ep,ed){let em=function(V,G,el){if(V)for(let eh of V){let V=G[eh];if(V&&V.source===el&&"fill-extrusion"===V.type)return!0}else for(let V in G){let eh=G[V];if(eh.source===el&&"fill-extrusion"===eh.type)return!0}return!1}(ep&&ep.layers,el,G.id),ef=ed.maxPitchScaleFactor(),eg=G.tilesIn(ec,ef,em);eg.sort(R);let e_=[];for(let ec of eg)e_.push({wrappedTileID:ec.tileID.wrapped().key,queryResults:ec.tile.queryRenderedFeatures(el,eh,G._state,ec.queryGeometry,ec.cameraQueryGeometry,ec.scale,ep,ed,ef,function(G,el){let eh=V.create();return V.translate(eh,eh,[1,1,0]),V.scale(eh,eh,[.5*G.width,.5*G.height,1]),V.multiply(eh,eh,G.calculatePosMatrix(el.toUnwrapped()))}(G.transform,ec.tileID))});let ey=function(V){let G={},el={};for(let eh of V){let V=eh.queryResults,ec=eh.wrappedTileID,ep=el[ec]=el[ec]||{};for(let el in V){let eh=V[el],ec=ep[el]=ep[el]||{},ed=G[el]=G[el]||[];for(let V of eh)ec[V.featureIndex]||(ec[V.featureIndex]=!0,ed.push(V))}}return G}(e_);for(let V in ey)ey[V].forEach(V=>{let el=V.feature,eh=G.getFeatureState(el.layer["source-layer"],el.id);el.source=el.layer.source,el.layer["source-layer"]&&(el.sourceLayer=el.layer["source-layer"]),el.state=eh});return ey}(this.sourceCaches[ed],this._layers,this._serializedLayers,G,el,eh));return this.placement&&ep.push(function(V,G,el,eh,ec,ep,ed){let em={},ef=ep.queryRenderedSymbols(eh),eg=[];for(let V of Object.keys(ef).map(Number))eg.push(ed[V]);for(let el of(eg.sort(R),eg)){let eh=el.featureIndex.lookupSymbolFeatures(ef[el.bucketInstanceId],G,el.bucketIndex,el.sourceLayerIndex,ec.filter,ec.layers,ec.availableImages,V);for(let V in eh){let G=em[V]=em[V]||[],ec=eh[V];for(let V of(ec.sort((V,G)=>{let eh=el.featureSortOrder;if(eh){let el=eh.indexOf(V.featureIndex);return eh.indexOf(G.featureIndex)-el}return G.featureIndex-V.featureIndex}),ec))G.push(V)}}for(let G in em)em[G].forEach(eh=>{let ec=eh.feature,ep=el[V[G].source].getFeatureState(ec.layer["source-layer"],ec.id);ec.source=ec.layer.source,ec.layer["source-layer"]&&(ec.sourceLayer=ec.layer["source-layer"]),ec.state=ep});return em}(this._layers,this._serializedLayers,this.sourceCaches,G,el,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ep)}querySourceFeatures(G,el){el&&el.filter&&this._validate(V.validateStyle.filter,"querySourceFeatures.filter",el.filter,null,el);let eh=this.sourceCaches[G];return eh?function(V,G){let el=V.getRenderableIds().map(G=>V.getTileByID(G)),eh=[],ec={};for(let V=0;V<el.length;V++){let ep=el[V],ed=ep.tileID.canonical.key;ec[ed]||(ec[ed]=!0,ep.querySourceFeatures(eh,G))}return eh}(eh,el):[]}addSourceType(V,G,el){return ee.getSourceType(V)?el(Error(`A source type called "${V}" already exists.`)):(ee.setSourceType(V,G),G.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:V,url:G.workerSourceURL},el):el(null,null))}getLight(){return this.light.getLight()}setLight(G,el={}){this._checkLoaded();let eh=this.light.getLight(),ec=!1;for(let V in G)if(!a(G[V],eh[V])){ec=!0;break}if(!ec)return;let ep={now:V.exported.now(),transition:V.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(G,el),this.light.updateTransitions(ep)}_validate(G,el,eh,ec,ep={}){return(!ep||!1!==ep.validate)&&Yt(this,G.call(V.validateStyle,V.extend({key:el,style:this.serialize(),value:eh,styleSpec:V.spec},ec)))}_remove(){for(let G in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),V.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[G].setEventedParent(null);for(let V in this.sourceCaches){let G=this.sourceCaches[V];G.setEventedParent(null),G.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(V){this.sourceCaches[V].clearTiles()}_reloadSource(V){this.sourceCaches[V].resume(),this.sourceCaches[V].reload()}_updateSources(V){for(let G in this.sourceCaches)this.sourceCaches[G].update(V,this.terrain)}_generateCollisionBoxes(){for(let V in this.sourceCaches)this._reloadSource(V)}_updatePlacement(G,el,eh,ec,ep=!1){let ed=!1,em=!1,ef={};for(let V of this._order){let el=this._layers[V];if("symbol"!==el.type)continue;if(!ef[el.source]){let V=this.sourceCaches[el.source];ef[el.source]=V.getRenderableIds(!0).map(G=>V.getTileByID(G)).sort((V,G)=>G.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(G.tileID)?-1:1))}let eh=this.crossTileSymbolIndex.addLayer(el,ef[el.source],G.center.lng);ed=ed||eh}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((ep=ep||this._layerOrderChanged||0===eh)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(V.exported.now(),G.zoom))&&(this.pauseablePlacement=new Zt(G,this.terrain,this._order,ep,el,eh,ec,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ef),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(V.exported.now()),em=!0),ed&&this.pauseablePlacement.placement.setStale()),em||ed)for(let V of this._order){let G=this._layers[V];"symbol"===G.type&&this.placement.updateLayerOpacities(G,ef[G.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(V.exported.now())}_releaseSymbolFadeTiles(){for(let V in this.sourceCaches)this.sourceCaches[V].releaseSymbolFadeTiles()}getImages(V,G,el){this.imageManager.getImages(G.icons,el),this._updateTilesForChangedImages();let eh=this.sourceCaches[G.source];eh&&eh.setDependencies(G.tileID.key,G.type,G.icons)}getGlyphs(V,G,el){this.glyphManager.getGlyphs(G.stacks,el)}getResource(G,el,eh){return V.makeRequest(el,eh)}};ee.getSourceType=function(V){return eg[V]},ee.setSourceType=function(V,G){eg[V]=G},ee.registerForPluginStateChange=V.registerForPluginStateChange;var eA="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";let eM={prelude:ae("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:ae("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ae("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ae("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:ae("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ae("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:ae("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ae("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ae("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ae("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ae("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:ae("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:ae("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:ae("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:ae("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ae("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ae("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:ae("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:ae("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:ae("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ae("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:ae("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:ae("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:ae("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",eA),terrainDepth:ae("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",eA),terrainCoords:ae("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",eA)};function ae(V,G){let el=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,eh=G.match(/attribute ([\w]+) ([\w]+)/g),ec=V.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),ep=G.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),ed=ep?ep.concat(ec):ec,em={};return{fragmentSource:V=V.replace(el,(V,G,el,eh,ec)=>(em[ec]=!0,"define"===G?`
#ifndef HAS_UNIFORM_u_${ec}
varying ${el} ${eh} ${ec};
#else
uniform ${el} ${eh} u_${ec};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ec}
    ${el} ${eh} ${ec} = u_${ec};
#endif
`)),vertexSource:G=G.replace(el,(V,G,el,eh,ec)=>{let ep="float"===eh?"vec2":"vec4",ed=ec.match(/color/)?"color":ep;return em[ec]?"define"===G?`
#ifndef HAS_UNIFORM_u_${ec}
uniform lowp float u_${ec}_t;
attribute ${el} ${ep} a_${ec};
varying ${el} ${eh} ${ec};
#else
uniform ${el} ${eh} u_${ec};
#endif
`:"vec4"===ed?`
#ifndef HAS_UNIFORM_u_${ec}
    ${ec} = a_${ec};
#else
    ${el} ${eh} ${ec} = u_${ec};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ec}
    ${ec} = unpack_mix_${ed}(a_${ec}, u_${ec}_t);
#else
    ${el} ${eh} ${ec} = u_${ec};
#endif
`:"define"===G?`
#ifndef HAS_UNIFORM_u_${ec}
uniform lowp float u_${ec}_t;
attribute ${el} ${ep} a_${ec};
#else
uniform ${el} ${eh} u_${ec};
#endif
`:"vec4"===ed?`
#ifndef HAS_UNIFORM_u_${ec}
    ${el} ${eh} ${ec} = a_${ec};
#else
    ${el} ${eh} ${ec} = u_${ec};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ec}
    ${el} ${eh} ${ec} = unpack_mix_${ed}(a_${ec}, u_${ec}_t);
#else
    ${el} ${eh} ${ec} = u_${ec};
#endif
`}),staticAttributes:eh,staticUniforms:ed}}let re=class re{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(V,G,el,eh,ec,ep,ed,em,ef){this.context=V;let eg=this.boundPaintVertexBuffers.length!==eh.length;for(let V=0;!eg&&V<eh.length;V++)this.boundPaintVertexBuffers[V]!==eh[V]&&(eg=!0);V.extVertexArrayObject&&this.vao&&this.boundProgram===G&&this.boundLayoutVertexBuffer===el&&!eg&&this.boundIndexBuffer===ec&&this.boundVertexOffset===ep&&this.boundDynamicVertexBuffer===ed&&this.boundDynamicVertexBuffer2===em&&this.boundDynamicVertexBuffer3===ef?(V.bindVertexArrayOES.set(this.vao),ed&&ed.bind(),ec&&ec.dynamicDraw&&ec.bind(),em&&em.bind(),ef&&ef.bind()):this.freshBind(G,el,eh,ec,ep,ed,em,ef)}freshBind(V,G,el,eh,ec,ep,ed,em){let ef;let eg=V.numAttributes,e_=this.context,ey=e_.gl;if(e_.extVertexArrayObject)this.vao&&this.destroy(),this.vao=e_.extVertexArrayObject.createVertexArrayOES(),e_.bindVertexArrayOES.set(this.vao),ef=0,this.boundProgram=V,this.boundLayoutVertexBuffer=G,this.boundPaintVertexBuffers=el,this.boundIndexBuffer=eh,this.boundVertexOffset=ec,this.boundDynamicVertexBuffer=ep,this.boundDynamicVertexBuffer2=ed,this.boundDynamicVertexBuffer3=em;else{ef=e_.currentNumAttributes||0;for(let V=eg;V<ef;V++)ey.disableVertexAttribArray(V)}for(let eh of(G.enableAttributes(ey,V),el))eh.enableAttributes(ey,V);for(let eh of(ep&&ep.enableAttributes(ey,V),ed&&ed.enableAttributes(ey,V),em&&em.enableAttributes(ey,V),G.bind(),G.setVertexAttribPointers(ey,V,ec),el))eh.bind(),eh.setVertexAttribPointers(ey,V,ec);ep&&(ep.bind(),ep.setVertexAttribPointers(ey,V,ec)),eh&&eh.bind(),ed&&(ed.bind(),ed.setVertexAttribPointers(ey,V,ec)),em&&(em.bind(),em.setVertexAttribPointers(ey,V,ec)),e_.currentNumAttributes=eg}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}};function se(V){let G=[];for(let el=0;el<V.length;el++){if(null===V[el])continue;let eh=V[el].split(" ");G.push(eh.pop())}return G}let ne=class ne{constructor(G,el,eh,ec,ep,ed,em){let ef=G.gl;this.program=ef.createProgram();let eg=se(eh.staticAttributes),e_=ec?ec.getBinderAttributes():[],ey=eg.concat(e_),ex=eM.prelude.staticUniforms?se(eM.prelude.staticUniforms):[],ev=eh.staticUniforms?se(eh.staticUniforms):[],eb=ec?ec.getBinderUniforms():[],ew=ex.concat(ev).concat(eb),eT=[];for(let V of ew)0>eT.indexOf(V)&&eT.push(V);let eE=ec?ec.defines():[];ed&&eE.push("#define OVERDRAW_INSPECTOR;"),em&&eE.push("#define TERRAIN3D;");let eS=eE.concat(eM.prelude.fragmentSource,eh.fragmentSource).join("\n"),eI=eE.concat(eM.prelude.vertexSource,eh.vertexSource).join("\n"),eA=ef.createShader(ef.FRAGMENT_SHADER);if(ef.isContextLost())return void(this.failedToCreate=!0);ef.shaderSource(eA,eS),ef.compileShader(eA),ef.attachShader(this.program,eA);let eC=ef.createShader(ef.VERTEX_SHADER);if(ef.isContextLost())return void(this.failedToCreate=!0);ef.shaderSource(eC,eI),ef.compileShader(eC),ef.attachShader(this.program,eC),this.attributes={};let ez={};this.numAttributes=ey.length;for(let V=0;V<this.numAttributes;V++)ey[V]&&(ef.bindAttribLocation(this.program,V,ey[V]),this.attributes[ey[V]]=V);ef.linkProgram(this.program),ef.deleteShader(eC),ef.deleteShader(eA);for(let V=0;V<eT.length;V++){let G=eT[V];if(G&&!ez[G]){let V=ef.getUniformLocation(this.program,G);V&&(ez[G]=V)}}this.fixedUniforms=ep(G,ez),this.terrainUniforms={u_depth:new V.Uniform1i(G,ez.u_depth),u_terrain:new V.Uniform1i(G,ez.u_terrain),u_terrain_dim:new V.Uniform1f(G,ez.u_terrain_dim),u_terrain_matrix:new V.UniformMatrix4f(G,ez.u_terrain_matrix),u_terrain_unpack:new V.Uniform4f(G,ez.u_terrain_unpack),u_terrain_offset:new V.Uniform1f(G,ez.u_terrain_offset),u_terrain_exaggeration:new V.Uniform1f(G,ez.u_terrain_exaggeration)},this.binderUniforms=ec?ec.getUniforms(G,ez):[]}draw(V,G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex,ev,eb,ew,eT,eE){let eS=V.gl;if(this.failedToCreate)return;if(V.program.set(this.program),V.setDepthMode(el),V.setStencilMode(eh),V.setColorMode(ec),V.setCullFace(ep),em)for(let G in V.activeTexture.set(eS.TEXTURE2),eS.bindTexture(eS.TEXTURE_2D,em.depthTexture),V.activeTexture.set(eS.TEXTURE3),eS.bindTexture(eS.TEXTURE_2D,em.texture),this.terrainUniforms)this.terrainUniforms[G].set(em[G]);for(let V in this.fixedUniforms)this.fixedUniforms[V].set(ed[V]);eb&&eb.setUniforms(V,this.binderUniforms,ex,{zoom:ev});let eI=0;switch(G){case eS.LINES:eI=2;break;case eS.TRIANGLES:eI=3;break;case eS.LINE_STRIP:eI=1}for(let el of ey.get()){let eh=el.vaos||(el.vaos={});(eh[ef]||(eh[ef]=new re)).bind(V,this,eg,eb?eb.getPaintVertexBuffers():[],e_,el.vertexOffset,ew,eT,eE),eS.drawElements(G,el.primitiveLength*eI,eS.UNSIGNED_SHORT,el.primitiveOffset*eI*2)}}};function le(V,G,el){let eh=1/bt(el,1,G.transform.tileZoom),ec=Math.pow(2,el.tileID.overscaledZ),ep=el.tileSize*Math.pow(2,G.transform.tileZoom)/ec,ed=ep*(el.tileID.canonical.x+el.tileID.wrap*ec),em=ep*el.tileID.canonical.y;return{u_image:0,u_texsize:el.imageAtlasTexture.size,u_scale:[eh,V.fromScale,V.toScale],u_fade:V.t,u_pixel_coord_upper:[ed>>16,em>>16],u_pixel_coord_lower:[65535&ed,65535&em]}}let ce=(G,el,eh,ec)=>{let ep=el.style.light,ed=ep.properties.get("position"),em=[ed.x,ed.y,ed.z],ef=V.create$1();"viewport"===ep.properties.get("anchor")&&V.fromRotation(ef,-el.transform.angle),V.transformMat3(em,em,ef);let eg=ep.properties.get("color");return{u_matrix:G,u_lightpos:em,u_lightintensity:ep.properties.get("intensity"),u_lightcolor:[eg.r,eg.g,eg.b],u_vertical_gradient:+eh,u_opacity:ec}},he=(G,el,eh,ec,ep,ed,em)=>V.extend(ce(G,el,eh,ec),le(ed,el,em),{u_height_factor:-Math.pow(2,ep.overscaledZ)/em.tileSize/8}),ue=V=>({u_matrix:V}),de=(G,el,eh,ec)=>V.extend(ue(G),le(eh,el,ec)),me=(V,G)=>({u_matrix:V,u_world:G}),_e=(G,el,eh,ec,ep)=>V.extend(de(G,el,eh,ec),{u_world:ep}),pe=(V,G,el,eh)=>{let ec,ep;let ed=V.transform;if("map"===eh.paint.get("circle-pitch-alignment")){let V=bt(el,1,ed.zoom);ec=!0,ep=[V,V]}else ec=!1,ep=ed.pixelsToGLUnits;return{u_camera_to_center_distance:ed.cameraToCenterDistance,u_scale_with_map:+("map"===eh.paint.get("circle-pitch-scale")),u_matrix:V.translatePosMatrix(G.posMatrix,el,eh.paint.get("circle-translate"),eh.paint.get("circle-translate-anchor")),u_pitch_with_map:+ec,u_device_pixel_ratio:V.pixelRatio,u_extrude_scale:ep}},fe=(V,G,el)=>{let eh=bt(el,1,G.zoom),ec=Math.pow(2,G.zoom-el.tileID.overscaledZ),ep=el.tileID.overscaleFactor();return{u_matrix:V,u_camera_to_center_distance:G.cameraToCenterDistance,u_pixels_to_tile_units:eh,u_extrude_scale:[G.pixelsToGLUnits[0]/(eh*ec),G.pixelsToGLUnits[1]/(eh*ec)],u_overscale_factor:ep}},ge=(V,G,el=1)=>({u_matrix:V,u_color:G,u_overlay:0,u_overlay_scale:el}),xe=V=>({u_matrix:V}),ve=(V,G,el,eh)=>({u_matrix:V,u_extrude_scale:bt(G,1,el),u_intensity:eh}),be=(V,G,el,eh)=>{let ec=V.transform;return{u_matrix:Ce(V,G,el,eh),u_ratio:1/bt(G,1,ec.zoom),u_device_pixel_ratio:V.pixelRatio,u_units_to_pixels:[1/ec.pixelsToGLUnits[0],1/ec.pixelsToGLUnits[1]]}},we=(G,el,eh,ec,ep)=>V.extend(be(G,el,eh,ep),{u_image:0,u_image_height:ec}),Te=(V,G,el,eh,ec)=>{let ep=V.transform,ed=Ie(G,ep);return{u_matrix:Ce(V,G,el,ec),u_texsize:G.imageAtlasTexture.size,u_ratio:1/bt(G,1,ep.zoom),u_device_pixel_ratio:V.pixelRatio,u_image:0,u_scale:[ed,eh.fromScale,eh.toScale],u_fade:eh.t,u_units_to_pixels:[1/ep.pixelsToGLUnits[0],1/ep.pixelsToGLUnits[1]]}},Ee=(G,el,eh,ec,ep,ed)=>{let em=G.lineAtlas,ef=Ie(el,G.transform),eg="round"===eh.layout.get("line-cap"),e_=em.getDash(ec.from,eg),ey=em.getDash(ec.to,eg),ex=e_.width*ep.fromScale,ev=ey.width*ep.toScale;return V.extend(be(G,el,eh,ed),{u_patternscale_a:[ef/ex,-e_.height/2],u_patternscale_b:[ef/ev,-ey.height/2],u_sdfgamma:em.width/(256*Math.min(ex,ev)*G.pixelRatio)/2,u_image:0,u_tex_y_a:e_.y,u_tex_y_b:ey.y,u_mix:ep.t})};function Ie(V,G){return 1/bt(V,1,G.tileZoom)}function Ce(V,G,el,eh){return V.translatePosMatrix(eh?eh.posMatrix:G.tileID.posMatrix,G,el.paint.get("line-translate"),el.paint.get("line-translate-anchor"))}let Se=(V,G,el,eh,ec)=>{var ep,ed;return{u_matrix:V,u_tl_parent:G,u_scale_parent:el,u_buffer_scale:1,u_fade_t:eh.mix,u_opacity:eh.opacity*ec.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:ec.paint.get("raster-brightness-min"),u_brightness_high:ec.paint.get("raster-brightness-max"),u_saturation_factor:(ed=ec.paint.get("raster-saturation"))>0?1-1/(1.001-ed):-ed,u_contrast_factor:(ep=ec.paint.get("raster-contrast"))>0?1/(1-ep):1+ep,u_spin_weights:function(V){V*=Math.PI/180;let G=Math.sin(V),el=Math.cos(V);return[(2*el+1)/3,(-Math.sqrt(3)*G-el+1)/3,(Math.sqrt(3)*G-el+1)/3]}(ec.paint.get("raster-hue-rotate"))}},ze=(V,G,el,eh,ec,ep,ed,em,ef,eg)=>{let e_=ec.transform;return{u_is_size_zoom_constant:+("constant"===V||"source"===V),u_is_size_feature_constant:+("constant"===V||"camera"===V),u_size_t:G?G.uSizeT:0,u_size:G?G.uSize:0,u_camera_to_center_distance:e_.cameraToCenterDistance,u_pitch:e_.pitch/360*2*Math.PI,u_rotate_symbol:+el,u_aspect_ratio:e_.width/e_.height,u_fade_change:ec.options.fadeDuration?ec.symbolFadeChange:1,u_matrix:ep,u_label_plane_matrix:ed,u_coord_matrix:em,u_is_text:+ef,u_pitch_with_map:+eh,u_texsize:eg,u_texture:0}},Pe=(G,el,eh,ec,ep,ed,em,ef,eg,e_,ey)=>{let ex=ep.transform;return V.extend(ze(G,el,eh,ec,ep,ed,em,ef,eg,e_),{u_gamma_scale:ec?Math.cos(ex._pitch)*ex.cameraToCenterDistance:1,u_device_pixel_ratio:ep.pixelRatio,u_is_halo:+ey})},Me=(G,el,eh,ec,ep,ed,em,ef,eg,e_)=>V.extend(Pe(G,el,eh,ec,ep,ed,em,ef,!0,eg,!0),{u_texsize_icon:e_,u_texture_icon:1}),Ae=(V,G,el)=>({u_matrix:V,u_opacity:G,u_color:el}),Le=(G,el,eh,ec,ep,ed)=>V.extend(function(V,G,el,eh){let ec=el.imageManager.getPattern(V.from.toString()),ep=el.imageManager.getPattern(V.to.toString()),{width:ed,height:em}=el.imageManager.getPixelSize(),ef=Math.pow(2,eh.tileID.overscaledZ),eg=eh.tileSize*Math.pow(2,el.transform.tileZoom)/ef,e_=eg*(eh.tileID.canonical.x+eh.tileID.wrap*ef),ey=eg*eh.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ec.tl,u_pattern_br_a:ec.br,u_pattern_tl_b:ep.tl,u_pattern_br_b:ep.br,u_texsize:[ed,em],u_mix:G.t,u_pattern_size_a:ec.displaySize,u_pattern_size_b:ep.displaySize,u_scale_a:G.fromScale,u_scale_b:G.toScale,u_tile_units_to_pixels:1/bt(eh,1,el.transform.tileZoom),u_pixel_coord_upper:[e_>>16,ey>>16],u_pixel_coord_lower:[65535&e_,65535&ey]}}(ec,ed,eh,ep),{u_matrix:G,u_opacity:el}),eC={fillExtrusion:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_lightpos:new V.Uniform3f(G,el.u_lightpos),u_lightintensity:new V.Uniform1f(G,el.u_lightintensity),u_lightcolor:new V.Uniform3f(G,el.u_lightcolor),u_vertical_gradient:new V.Uniform1f(G,el.u_vertical_gradient),u_opacity:new V.Uniform1f(G,el.u_opacity)}),fillExtrusionPattern:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_lightpos:new V.Uniform3f(G,el.u_lightpos),u_lightintensity:new V.Uniform1f(G,el.u_lightintensity),u_lightcolor:new V.Uniform3f(G,el.u_lightcolor),u_vertical_gradient:new V.Uniform1f(G,el.u_vertical_gradient),u_height_factor:new V.Uniform1f(G,el.u_height_factor),u_image:new V.Uniform1i(G,el.u_image),u_texsize:new V.Uniform2f(G,el.u_texsize),u_pixel_coord_upper:new V.Uniform2f(G,el.u_pixel_coord_upper),u_pixel_coord_lower:new V.Uniform2f(G,el.u_pixel_coord_lower),u_scale:new V.Uniform3f(G,el.u_scale),u_fade:new V.Uniform1f(G,el.u_fade),u_opacity:new V.Uniform1f(G,el.u_opacity)}),fill:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix)}),fillPattern:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_image:new V.Uniform1i(G,el.u_image),u_texsize:new V.Uniform2f(G,el.u_texsize),u_pixel_coord_upper:new V.Uniform2f(G,el.u_pixel_coord_upper),u_pixel_coord_lower:new V.Uniform2f(G,el.u_pixel_coord_lower),u_scale:new V.Uniform3f(G,el.u_scale),u_fade:new V.Uniform1f(G,el.u_fade)}),fillOutline:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_world:new V.Uniform2f(G,el.u_world)}),fillOutlinePattern:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_world:new V.Uniform2f(G,el.u_world),u_image:new V.Uniform1i(G,el.u_image),u_texsize:new V.Uniform2f(G,el.u_texsize),u_pixel_coord_upper:new V.Uniform2f(G,el.u_pixel_coord_upper),u_pixel_coord_lower:new V.Uniform2f(G,el.u_pixel_coord_lower),u_scale:new V.Uniform3f(G,el.u_scale),u_fade:new V.Uniform1f(G,el.u_fade)}),circle:(G,el)=>({u_camera_to_center_distance:new V.Uniform1f(G,el.u_camera_to_center_distance),u_scale_with_map:new V.Uniform1i(G,el.u_scale_with_map),u_pitch_with_map:new V.Uniform1i(G,el.u_pitch_with_map),u_extrude_scale:new V.Uniform2f(G,el.u_extrude_scale),u_device_pixel_ratio:new V.Uniform1f(G,el.u_device_pixel_ratio),u_matrix:new V.UniformMatrix4f(G,el.u_matrix)}),collisionBox:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_camera_to_center_distance:new V.Uniform1f(G,el.u_camera_to_center_distance),u_pixels_to_tile_units:new V.Uniform1f(G,el.u_pixels_to_tile_units),u_extrude_scale:new V.Uniform2f(G,el.u_extrude_scale),u_overscale_factor:new V.Uniform1f(G,el.u_overscale_factor)}),collisionCircle:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_inv_matrix:new V.UniformMatrix4f(G,el.u_inv_matrix),u_camera_to_center_distance:new V.Uniform1f(G,el.u_camera_to_center_distance),u_viewport_size:new V.Uniform2f(G,el.u_viewport_size)}),debug:(G,el)=>({u_color:new V.UniformColor(G,el.u_color),u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_overlay:new V.Uniform1i(G,el.u_overlay),u_overlay_scale:new V.Uniform1f(G,el.u_overlay_scale)}),clippingMask:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix)}),heatmap:(G,el)=>({u_extrude_scale:new V.Uniform1f(G,el.u_extrude_scale),u_intensity:new V.Uniform1f(G,el.u_intensity),u_matrix:new V.UniformMatrix4f(G,el.u_matrix)}),heatmapTexture:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_world:new V.Uniform2f(G,el.u_world),u_image:new V.Uniform1i(G,el.u_image),u_color_ramp:new V.Uniform1i(G,el.u_color_ramp),u_opacity:new V.Uniform1f(G,el.u_opacity)}),hillshade:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_image:new V.Uniform1i(G,el.u_image),u_latrange:new V.Uniform2f(G,el.u_latrange),u_light:new V.Uniform2f(G,el.u_light),u_shadow:new V.UniformColor(G,el.u_shadow),u_highlight:new V.UniformColor(G,el.u_highlight),u_accent:new V.UniformColor(G,el.u_accent)}),hillshadePrepare:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_image:new V.Uniform1i(G,el.u_image),u_dimension:new V.Uniform2f(G,el.u_dimension),u_zoom:new V.Uniform1f(G,el.u_zoom),u_unpack:new V.Uniform4f(G,el.u_unpack)}),line:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_ratio:new V.Uniform1f(G,el.u_ratio),u_device_pixel_ratio:new V.Uniform1f(G,el.u_device_pixel_ratio),u_units_to_pixels:new V.Uniform2f(G,el.u_units_to_pixels)}),lineGradient:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_ratio:new V.Uniform1f(G,el.u_ratio),u_device_pixel_ratio:new V.Uniform1f(G,el.u_device_pixel_ratio),u_units_to_pixels:new V.Uniform2f(G,el.u_units_to_pixels),u_image:new V.Uniform1i(G,el.u_image),u_image_height:new V.Uniform1f(G,el.u_image_height)}),linePattern:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_texsize:new V.Uniform2f(G,el.u_texsize),u_ratio:new V.Uniform1f(G,el.u_ratio),u_device_pixel_ratio:new V.Uniform1f(G,el.u_device_pixel_ratio),u_image:new V.Uniform1i(G,el.u_image),u_units_to_pixels:new V.Uniform2f(G,el.u_units_to_pixels),u_scale:new V.Uniform3f(G,el.u_scale),u_fade:new V.Uniform1f(G,el.u_fade)}),lineSDF:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_ratio:new V.Uniform1f(G,el.u_ratio),u_device_pixel_ratio:new V.Uniform1f(G,el.u_device_pixel_ratio),u_units_to_pixels:new V.Uniform2f(G,el.u_units_to_pixels),u_patternscale_a:new V.Uniform2f(G,el.u_patternscale_a),u_patternscale_b:new V.Uniform2f(G,el.u_patternscale_b),u_sdfgamma:new V.Uniform1f(G,el.u_sdfgamma),u_image:new V.Uniform1i(G,el.u_image),u_tex_y_a:new V.Uniform1f(G,el.u_tex_y_a),u_tex_y_b:new V.Uniform1f(G,el.u_tex_y_b),u_mix:new V.Uniform1f(G,el.u_mix)}),raster:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_tl_parent:new V.Uniform2f(G,el.u_tl_parent),u_scale_parent:new V.Uniform1f(G,el.u_scale_parent),u_buffer_scale:new V.Uniform1f(G,el.u_buffer_scale),u_fade_t:new V.Uniform1f(G,el.u_fade_t),u_opacity:new V.Uniform1f(G,el.u_opacity),u_image0:new V.Uniform1i(G,el.u_image0),u_image1:new V.Uniform1i(G,el.u_image1),u_brightness_low:new V.Uniform1f(G,el.u_brightness_low),u_brightness_high:new V.Uniform1f(G,el.u_brightness_high),u_saturation_factor:new V.Uniform1f(G,el.u_saturation_factor),u_contrast_factor:new V.Uniform1f(G,el.u_contrast_factor),u_spin_weights:new V.Uniform3f(G,el.u_spin_weights)}),symbolIcon:(G,el)=>({u_is_size_zoom_constant:new V.Uniform1i(G,el.u_is_size_zoom_constant),u_is_size_feature_constant:new V.Uniform1i(G,el.u_is_size_feature_constant),u_size_t:new V.Uniform1f(G,el.u_size_t),u_size:new V.Uniform1f(G,el.u_size),u_camera_to_center_distance:new V.Uniform1f(G,el.u_camera_to_center_distance),u_pitch:new V.Uniform1f(G,el.u_pitch),u_rotate_symbol:new V.Uniform1i(G,el.u_rotate_symbol),u_aspect_ratio:new V.Uniform1f(G,el.u_aspect_ratio),u_fade_change:new V.Uniform1f(G,el.u_fade_change),u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_label_plane_matrix:new V.UniformMatrix4f(G,el.u_label_plane_matrix),u_coord_matrix:new V.UniformMatrix4f(G,el.u_coord_matrix),u_is_text:new V.Uniform1i(G,el.u_is_text),u_pitch_with_map:new V.Uniform1i(G,el.u_pitch_with_map),u_texsize:new V.Uniform2f(G,el.u_texsize),u_texture:new V.Uniform1i(G,el.u_texture)}),symbolSDF:(G,el)=>({u_is_size_zoom_constant:new V.Uniform1i(G,el.u_is_size_zoom_constant),u_is_size_feature_constant:new V.Uniform1i(G,el.u_is_size_feature_constant),u_size_t:new V.Uniform1f(G,el.u_size_t),u_size:new V.Uniform1f(G,el.u_size),u_camera_to_center_distance:new V.Uniform1f(G,el.u_camera_to_center_distance),u_pitch:new V.Uniform1f(G,el.u_pitch),u_rotate_symbol:new V.Uniform1i(G,el.u_rotate_symbol),u_aspect_ratio:new V.Uniform1f(G,el.u_aspect_ratio),u_fade_change:new V.Uniform1f(G,el.u_fade_change),u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_label_plane_matrix:new V.UniformMatrix4f(G,el.u_label_plane_matrix),u_coord_matrix:new V.UniformMatrix4f(G,el.u_coord_matrix),u_is_text:new V.Uniform1i(G,el.u_is_text),u_pitch_with_map:new V.Uniform1i(G,el.u_pitch_with_map),u_texsize:new V.Uniform2f(G,el.u_texsize),u_texture:new V.Uniform1i(G,el.u_texture),u_gamma_scale:new V.Uniform1f(G,el.u_gamma_scale),u_device_pixel_ratio:new V.Uniform1f(G,el.u_device_pixel_ratio),u_is_halo:new V.Uniform1i(G,el.u_is_halo)}),symbolTextAndIcon:(G,el)=>({u_is_size_zoom_constant:new V.Uniform1i(G,el.u_is_size_zoom_constant),u_is_size_feature_constant:new V.Uniform1i(G,el.u_is_size_feature_constant),u_size_t:new V.Uniform1f(G,el.u_size_t),u_size:new V.Uniform1f(G,el.u_size),u_camera_to_center_distance:new V.Uniform1f(G,el.u_camera_to_center_distance),u_pitch:new V.Uniform1f(G,el.u_pitch),u_rotate_symbol:new V.Uniform1i(G,el.u_rotate_symbol),u_aspect_ratio:new V.Uniform1f(G,el.u_aspect_ratio),u_fade_change:new V.Uniform1f(G,el.u_fade_change),u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_label_plane_matrix:new V.UniformMatrix4f(G,el.u_label_plane_matrix),u_coord_matrix:new V.UniformMatrix4f(G,el.u_coord_matrix),u_is_text:new V.Uniform1i(G,el.u_is_text),u_pitch_with_map:new V.Uniform1i(G,el.u_pitch_with_map),u_texsize:new V.Uniform2f(G,el.u_texsize),u_texsize_icon:new V.Uniform2f(G,el.u_texsize_icon),u_texture:new V.Uniform1i(G,el.u_texture),u_texture_icon:new V.Uniform1i(G,el.u_texture_icon),u_gamma_scale:new V.Uniform1f(G,el.u_gamma_scale),u_device_pixel_ratio:new V.Uniform1f(G,el.u_device_pixel_ratio),u_is_halo:new V.Uniform1i(G,el.u_is_halo)}),background:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_opacity:new V.Uniform1f(G,el.u_opacity),u_color:new V.UniformColor(G,el.u_color)}),backgroundPattern:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_opacity:new V.Uniform1f(G,el.u_opacity),u_image:new V.Uniform1i(G,el.u_image),u_pattern_tl_a:new V.Uniform2f(G,el.u_pattern_tl_a),u_pattern_br_a:new V.Uniform2f(G,el.u_pattern_br_a),u_pattern_tl_b:new V.Uniform2f(G,el.u_pattern_tl_b),u_pattern_br_b:new V.Uniform2f(G,el.u_pattern_br_b),u_texsize:new V.Uniform2f(G,el.u_texsize),u_mix:new V.Uniform1f(G,el.u_mix),u_pattern_size_a:new V.Uniform2f(G,el.u_pattern_size_a),u_pattern_size_b:new V.Uniform2f(G,el.u_pattern_size_b),u_scale_a:new V.Uniform1f(G,el.u_scale_a),u_scale_b:new V.Uniform1f(G,el.u_scale_b),u_pixel_coord_upper:new V.Uniform2f(G,el.u_pixel_coord_upper),u_pixel_coord_lower:new V.Uniform2f(G,el.u_pixel_coord_lower),u_tile_units_to_pixels:new V.Uniform1f(G,el.u_tile_units_to_pixels)}),terrain:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_texture:new V.Uniform1i(G,el.u_texture)}),terrainDepth:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix)}),terrainCoords:(G,el)=>({u_matrix:new V.UniformMatrix4f(G,el.u_matrix),u_texture:new V.Uniform1i(G,el.u_texture),u_terrain_coords_id:new V.Uniform1f(G,el.u_terrain_coords_id)})};let ke=class ke{constructor(V,G,el){this.context=V;let eh=V.gl;this.buffer=eh.createBuffer(),this.dynamicDraw=!!el,this.context.unbindVAO(),V.bindElementBuffer.set(this.buffer),eh.bufferData(eh.ELEMENT_ARRAY_BUFFER,G.arrayBuffer,this.dynamicDraw?eh.DYNAMIC_DRAW:eh.STATIC_DRAW),this.dynamicDraw||delete G.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(V){let G=this.context.gl;if(!this.dynamicDraw)throw Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),G.bufferSubData(G.ELEMENT_ARRAY_BUFFER,0,V.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}};let ez={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};let Fe=class Fe{constructor(V,G,el,eh){this.length=G.length,this.attributes=el,this.itemSize=G.bytesPerElement,this.dynamicDraw=eh,this.context=V;let ec=V.gl;this.buffer=ec.createBuffer(),V.bindVertexBuffer.set(this.buffer),ec.bufferData(ec.ARRAY_BUFFER,G.arrayBuffer,this.dynamicDraw?ec.DYNAMIC_DRAW:ec.STATIC_DRAW),this.dynamicDraw||delete G.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(V){if(V.length!==this.length)throw Error(`Length of new data is ${V.length}, which doesn't match current length of ${this.length}`);let G=this.context.gl;this.bind(),G.bufferSubData(G.ARRAY_BUFFER,0,V.arrayBuffer)}enableAttributes(V,G){for(let el=0;el<this.attributes.length;el++){let eh=G.attributes[this.attributes[el].name];void 0!==eh&&V.enableVertexAttribArray(eh)}}setVertexAttribPointers(V,G,el){for(let eh=0;eh<this.attributes.length;eh++){let ec=this.attributes[eh],ep=G.attributes[ec.name];void 0!==ep&&V.vertexAttribPointer(ep,ec.components,V[ez[ec.type]],!1,this.itemSize,ec.offset+this.itemSize*(el||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}};let Oe=class Oe{constructor(V){this.gl=V.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(V){}getDefault(){return this.default}setDefault(){this.set(this.default)}};let Ue=class Ue extends Oe{getDefault(){return V.Color.transparent}set(V){let G=this.current;(V.r!==G.r||V.g!==G.g||V.b!==G.b||V.a!==G.a||this.dirty)&&(this.gl.clearColor(V.r,V.g,V.b,V.a),this.current=V,this.dirty=!1)}};let Ne=class Ne extends Oe{getDefault(){return 1}set(V){(V!==this.current||this.dirty)&&(this.gl.clearDepth(V),this.current=V,this.dirty=!1)}};let Ge=class Ge extends Oe{getDefault(){return 0}set(V){(V!==this.current||this.dirty)&&(this.gl.clearStencil(V),this.current=V,this.dirty=!1)}};let Ze=class Ze extends Oe{getDefault(){return[!0,!0,!0,!0]}set(V){let G=this.current;(V[0]!==G[0]||V[1]!==G[1]||V[2]!==G[2]||V[3]!==G[3]||this.dirty)&&(this.gl.colorMask(V[0],V[1],V[2],V[3]),this.current=V,this.dirty=!1)}};let Ve=class Ve extends Oe{getDefault(){return!0}set(V){(V!==this.current||this.dirty)&&(this.gl.depthMask(V),this.current=V,this.dirty=!1)}};let qe=class qe extends Oe{getDefault(){return 255}set(V){(V!==this.current||this.dirty)&&(this.gl.stencilMask(V),this.current=V,this.dirty=!1)}};let je=class je extends Oe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(V){let G=this.current;(V.func!==G.func||V.ref!==G.ref||V.mask!==G.mask||this.dirty)&&(this.gl.stencilFunc(V.func,V.ref,V.mask),this.current=V,this.dirty=!1)}};let $e=class $e extends Oe{getDefault(){let V=this.gl;return[V.KEEP,V.KEEP,V.KEEP]}set(V){let G=this.current;(V[0]!==G[0]||V[1]!==G[1]||V[2]!==G[2]||this.dirty)&&(this.gl.stencilOp(V[0],V[1],V[2]),this.current=V,this.dirty=!1)}};let Xe=class Xe extends Oe{getDefault(){return!1}set(V){if(V===this.current&&!this.dirty)return;let G=this.gl;V?G.enable(G.STENCIL_TEST):G.disable(G.STENCIL_TEST),this.current=V,this.dirty=!1}};let We=class We extends Oe{getDefault(){return[0,1]}set(V){let G=this.current;(V[0]!==G[0]||V[1]!==G[1]||this.dirty)&&(this.gl.depthRange(V[0],V[1]),this.current=V,this.dirty=!1)}};let He=class He extends Oe{getDefault(){return!1}set(V){if(V===this.current&&!this.dirty)return;let G=this.gl;V?G.enable(G.DEPTH_TEST):G.disable(G.DEPTH_TEST),this.current=V,this.dirty=!1}};let Ke=class Ke extends Oe{getDefault(){return this.gl.LESS}set(V){(V!==this.current||this.dirty)&&(this.gl.depthFunc(V),this.current=V,this.dirty=!1)}};let Ye=class Ye extends Oe{getDefault(){return!1}set(V){if(V===this.current&&!this.dirty)return;let G=this.gl;V?G.enable(G.BLEND):G.disable(G.BLEND),this.current=V,this.dirty=!1}};let Je=class Je extends Oe{getDefault(){let V=this.gl;return[V.ONE,V.ZERO]}set(V){let G=this.current;(V[0]!==G[0]||V[1]!==G[1]||this.dirty)&&(this.gl.blendFunc(V[0],V[1]),this.current=V,this.dirty=!1)}};let Qe=class Qe extends Oe{getDefault(){return V.Color.transparent}set(V){let G=this.current;(V.r!==G.r||V.g!==G.g||V.b!==G.b||V.a!==G.a||this.dirty)&&(this.gl.blendColor(V.r,V.g,V.b,V.a),this.current=V,this.dirty=!1)}};let ti=class ti extends Oe{getDefault(){return this.gl.FUNC_ADD}set(V){(V!==this.current||this.dirty)&&(this.gl.blendEquation(V),this.current=V,this.dirty=!1)}};let ei=class ei extends Oe{getDefault(){return!1}set(V){if(V===this.current&&!this.dirty)return;let G=this.gl;V?G.enable(G.CULL_FACE):G.disable(G.CULL_FACE),this.current=V,this.dirty=!1}};let ii=class ii extends Oe{getDefault(){return this.gl.BACK}set(V){(V!==this.current||this.dirty)&&(this.gl.cullFace(V),this.current=V,this.dirty=!1)}};let oi=class oi extends Oe{getDefault(){return this.gl.CCW}set(V){(V!==this.current||this.dirty)&&(this.gl.frontFace(V),this.current=V,this.dirty=!1)}};let ai=class ai extends Oe{getDefault(){return null}set(V){(V!==this.current||this.dirty)&&(this.gl.useProgram(V),this.current=V,this.dirty=!1)}};let ri=class ri extends Oe{getDefault(){return this.gl.TEXTURE0}set(V){(V!==this.current||this.dirty)&&(this.gl.activeTexture(V),this.current=V,this.dirty=!1)}};let si=class si extends Oe{getDefault(){let V=this.gl;return[0,0,V.drawingBufferWidth,V.drawingBufferHeight]}set(V){let G=this.current;(V[0]!==G[0]||V[1]!==G[1]||V[2]!==G[2]||V[3]!==G[3]||this.dirty)&&(this.gl.viewport(V[0],V[1],V[2],V[3]),this.current=V,this.dirty=!1)}};let ni=class ni extends Oe{getDefault(){return null}set(V){if(V===this.current&&!this.dirty)return;let G=this.gl;G.bindFramebuffer(G.FRAMEBUFFER,V),this.current=V,this.dirty=!1}};let li=class li extends Oe{getDefault(){return null}set(V){if(V===this.current&&!this.dirty)return;let G=this.gl;G.bindRenderbuffer(G.RENDERBUFFER,V),this.current=V,this.dirty=!1}};let ci=class ci extends Oe{getDefault(){return null}set(V){if(V===this.current&&!this.dirty)return;let G=this.gl;G.bindTexture(G.TEXTURE_2D,V),this.current=V,this.dirty=!1}};let hi=class hi extends Oe{getDefault(){return null}set(V){if(V===this.current&&!this.dirty)return;let G=this.gl;G.bindBuffer(G.ARRAY_BUFFER,V),this.current=V,this.dirty=!1}};let ui=class ui extends Oe{getDefault(){return null}set(V){let G=this.gl;G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,V),this.current=V,this.dirty=!1}};let di=class di extends Oe{constructor(V){super(V),this.vao=V.extVertexArrayObject}getDefault(){return null}set(V){this.vao&&(V!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(V),this.current=V,this.dirty=!1)}};let mi=class mi extends Oe{getDefault(){return 4}set(V){if(V===this.current&&!this.dirty)return;let G=this.gl;G.pixelStorei(G.UNPACK_ALIGNMENT,V),this.current=V,this.dirty=!1}};let _i=class _i extends Oe{getDefault(){return!1}set(V){if(V===this.current&&!this.dirty)return;let G=this.gl;G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,V),this.current=V,this.dirty=!1}};let pi=class pi extends Oe{getDefault(){return!1}set(V){if(V===this.current&&!this.dirty)return;let G=this.gl;G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,V),this.current=V,this.dirty=!1}};let fi=class fi extends Oe{constructor(V,G){super(V),this.context=V,this.parent=G}getDefault(){return null}};let gi=class gi extends fi{setDirty(){this.dirty=!0}set(V){if(V===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let G=this.gl;G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_2D,V,0),this.current=V,this.dirty=!1}};let xi=class xi extends fi{set(V){if(V===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let G=this.gl;G.framebufferRenderbuffer(G.FRAMEBUFFER,G.DEPTH_ATTACHMENT,G.RENDERBUFFER,V),this.current=V,this.dirty=!1}};let vi=class vi{constructor(V,G,el,eh){this.context=V,this.width=G,this.height=el;let ec=V.gl,ep=this.framebuffer=ec.createFramebuffer();if(this.colorAttachment=new gi(V,ep),eh&&(this.depthAttachment=new xi(V,ep)),ec.checkFramebufferStatus(ec.FRAMEBUFFER)!==ec.FRAMEBUFFER_COMPLETE)throw Error("Framebuffer is not complete")}destroy(){let V=this.context.gl,G=this.colorAttachment.get();if(G&&V.deleteTexture(G),this.depthAttachment){let G=this.depthAttachment.get();G&&V.deleteRenderbuffer(G)}V.deleteFramebuffer(this.framebuffer)}};let yi=class yi{constructor(V,G,el){this.blendFunction=V,this.blendColor=G,this.mask=el}};yi.Replace=[1,0],yi.disabled=new yi(yi.Replace,V.Color.transparent,[!1,!1,!1,!1]),yi.unblended=new yi(yi.Replace,V.Color.transparent,[!0,!0,!0,!0]),yi.alphaBlended=new yi([1,771],V.Color.transparent,[!0,!0,!0,!0]);let bi=class bi{constructor(V){this.gl=V,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ue(this),this.clearDepth=new Ne(this),this.clearStencil=new Ge(this),this.colorMask=new Ze(this),this.depthMask=new Ve(this),this.stencilMask=new qe(this),this.stencilFunc=new je(this),this.stencilOp=new $e(this),this.stencilTest=new Xe(this),this.depthRange=new We(this),this.depthTest=new He(this),this.depthFunc=new Ke(this),this.blend=new Ye(this),this.blendFunc=new Je(this),this.blendColor=new Qe(this),this.blendEquation=new ti(this),this.cullFace=new ei(this),this.cullFaceSide=new ii(this),this.frontFace=new oi(this),this.program=new ai(this),this.activeTexture=new ri(this),this.viewport=new si(this),this.bindFramebuffer=new ni(this),this.bindRenderbuffer=new li(this),this.bindTexture=new ci(this),this.bindVertexBuffer=new hi(this),this.bindElementBuffer=new ui(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new di(this),this.pixelStoreUnpack=new mi(this),this.pixelStoreUnpackPremultiplyAlpha=new _i(this),this.pixelStoreUnpackFlipY=new pi(this),this.extTextureFilterAnisotropic=V.getExtension("EXT_texture_filter_anisotropic")||V.getExtension("MOZ_EXT_texture_filter_anisotropic")||V.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=V.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=V.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(V.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=V.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=V.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=V.getParameter(V.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(V,G){return new ke(this,V,G)}createVertexBuffer(V,G,el){return new Fe(this,V,G,el)}createRenderbuffer(V,G,el){let eh=this.gl,ec=eh.createRenderbuffer();return this.bindRenderbuffer.set(ec),eh.renderbufferStorage(eh.RENDERBUFFER,V,G,el),this.bindRenderbuffer.set(null),ec}createFramebuffer(V,G,el){return new vi(this,V,G,el)}clear({color:V,depth:G}){let el=this.gl,eh=0;V&&(eh|=el.COLOR_BUFFER_BIT,this.clearColor.set(V),this.colorMask.set([!0,!0,!0,!0])),void 0!==G&&(eh|=el.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(G),this.depthMask.set(!0)),el.clear(eh)}setCullFace(V){!1===V.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(V.mode),this.frontFace.set(V.frontFace))}setDepthMode(V){V.func!==this.gl.ALWAYS||V.mask?(this.depthTest.set(!0),this.depthFunc.set(V.func),this.depthMask.set(V.mask),this.depthRange.set(V.range)):this.depthTest.set(!1)}setStencilMode(V){V.test.func!==this.gl.ALWAYS||V.mask?(this.stencilTest.set(!0),this.stencilMask.set(V.mask),this.stencilOp.set([V.fail,V.depthFail,V.pass]),this.stencilFunc.set({func:V.test.func,ref:V.ref,mask:V.test.mask})):this.stencilTest.set(!1)}setColorMode(V){a(V.blendFunction,yi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(V.blendFunction),this.blendColor.set(V.blendColor)),this.colorMask.set(V.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}};let wi=class wi{constructor(V,G,el){this.func=V,this.mask=G,this.range=el}};wi.ReadOnly=!1,wi.ReadWrite=!0,wi.disabled=new wi(519,wi.ReadOnly,[0,1]);let Ei=class Ei{constructor(V,G,el,eh,ec,ep){this.test=V,this.ref=G,this.mask=el,this.fail=eh,this.depthFail=ec,this.pass=ep}};Ei.disabled=new Ei({func:519,mask:0},0,0,7680,7680,7680);let Ii=class Ii{constructor(V,G,el){this.enable=V,this.mode=G,this.frontFace=el}};function Si(G,el,ec,ep,ed,em,ef){var eg;let e_=G.context,ey=e_.gl,ex=G.useProgram("collisionBox"),ev=[],eb=0,ew=0;for(let eh=0;eh<ep.length;eh++){let eg=ep[eh],eT=el.getTile(eg),eE=eT.getBucket(ec);if(!eE)continue;let eS=eg.posMatrix;0===ed[0]&&0===ed[1]||(eS=G.translatePosMatrix(eg.posMatrix,eT,ed,em));let eI=ef?eE.textCollisionBox:eE.iconCollisionBox,eA=eE.collisionCircleArray;if(eA.length>0){let el=V.create(),eh=eS;V.mul(el,eE.placementInvProjMatrix,G.transform.glCoordMatrix),V.mul(el,el,eE.placementViewportMatrix),ev.push({circleArray:eA,circleOffset:ew,transform:eh,invTransform:el,coord:eg}),eb+=eA.length/4,ew=eb}eI&&ex.draw(e_,ey.LINES,wi.disabled,Ei.disabled,G.colorModeForRenderPass(),Ii.disabled,fe(eS,G.transform,eT),G.style.terrain&&G.style.terrain.getTerrainData(eg),ec.id,eI.layoutVertexBuffer,eI.indexBuffer,eI.segments,null,G.transform.zoom,null,null,eI.collisionVertexBuffer)}if(!ef||!ev.length)return;let eT=G.useProgram("collisionCircle"),eE=new V.CollisionCircleLayoutArray;eE.resize(4*eb),eE._trim();let eS=0;for(let V of ev)for(let G=0;G<V.circleArray.length/4;G++){let el=4*G,eh=V.circleArray[el+0],ec=V.circleArray[el+1],ep=V.circleArray[el+2],ed=V.circleArray[el+3];eE.emplace(eS++,eh,ec,ep,ed,0),eE.emplace(eS++,eh,ec,ep,ed,1),eE.emplace(eS++,eh,ec,ep,ed,2),eE.emplace(eS++,eh,ec,ep,ed,3)}(!eh||eh.length<2*eb)&&(eh=function(G){let el=2*G,eh=new V.QuadTriangleArray;eh.resize(el),eh._trim();for(let V=0;V<el;V++){let G=6*V;eh.uint16[G+0]=4*V+0,eh.uint16[G+1]=4*V+1,eh.uint16[G+2]=4*V+2,eh.uint16[G+3]=4*V+2,eh.uint16[G+4]=4*V+3,eh.uint16[G+5]=4*V+0}return eh}(eb));let eI=e_.createIndexBuffer(eh,!0),eA=e_.createVertexBuffer(eE,V.collisionCircleLayout.members,!0);for(let el of ev){let eh={u_matrix:el.transform,u_inv_matrix:el.invTransform,u_camera_to_center_distance:(eg=G.transform).cameraToCenterDistance,u_viewport_size:[eg.width,eg.height]};eT.draw(e_,ey.TRIANGLES,wi.disabled,Ei.disabled,G.colorModeForRenderPass(),Ii.disabled,eh,G.style.terrain&&G.style.terrain.getTerrainData(el.coord),ec.id,eA,eI,V.SegmentVector.simpleSegment(0,2*el.circleOffset,el.circleArray.length,el.circleArray.length/2),null,G.transform.zoom,null,null,null)}eA.destroy(),eI.destroy()}Ii.disabled=new Ii(!1,1029,2305),Ii.backCCW=new Ii(!0,1029,2305);let ek=V.identity(new Float32Array(16));function Ai(G,el,eh,ec,ep,ed,em,ef,eg,e_,ey,ex){let ev=G.context,eb=ev.gl,ew=G.transform,eT="map"===ef,eE="map"===eg,eS="viewport"!==ef&&"point"!==eh.layout.get("symbol-placement"),eI=eT&&!eE&&!eS,eA=!eh.layout.get("symbol-sort-key").isConstant(),eM=!1,eC=G.depthModeForSublayer(0,wi.ReadOnly),ez=eh.layout.get("text-variable-anchor"),eP=[];for(let ef of ec){let ec;let eg=el.getTile(ef),ey=eg.getBucket(eh);if(!ey)continue;let ex=ep?ey.text:ey.icon;if(!ex||!ex.segments.get().length)continue;let ev=ex.programConfigurations.get(eh.id),eC=ep||ey.sdfIcons,eD=ep?ey.textSizeData:ey.iconSizeData,eL=eE||0!==ew.pitch,eR=G.useProgram(ey.iconsInText&&ep?"symbolTextAndIcon":eC?"symbolSDF":"symbolIcon",ev),eB=V.evaluateSizeForZoom(eD,ew.zoom),eF=G.style.terrain&&G.style.terrain.getTerrainData(ef),eO,eU,eV,eN,e$=[0,0],eq=null;if(ep){if(eU=eg.glyphAtlasTexture,eV=eb.LINEAR,eO=eg.glyphAtlasTexture.size,ey.iconsInText){e$=eg.imageAtlasTexture.size,eq=eg.imageAtlasTexture;let V="composite"===eD.kind||"camera"===eD.kind;eN=eL||G.options.rotating||G.options.zooming||V?eb.LINEAR:eb.NEAREST}}else{let V=1!==eh.layout.get("icon-size").constantOr(0)||ey.iconsNeedLinear;eU=eg.imageAtlasTexture,eV=eC||G.options.rotating||G.options.zooming||V||eL?eb.LINEAR:eb.NEAREST,eO=eg.imageAtlasTexture.size}let eG=bt(eg,1,G.transform.zoom),eZ=rt(ef.posMatrix,eE,eT,G.transform,eG),ej=st(ef.posMatrix,eE,eT,G.transform,eG),eX=ez&&ey.hasTextData(),eW="none"!==eh.layout.get("icon-text-fit")&&eX&&ey.hasIconData();if(eS){let el=G.style.terrain?(V,el)=>G.style.terrain.getElevation(ef,V,el):null,ec="map"===eh.layout.get("text-rotation-alignment");!function(G,el,eh,ec,ep,ed,em,ef,eg,e_){let ey=ec?G.textSizeData:G.iconSizeData,ex=V.evaluateSizeForZoom(ey,eh.transform.zoom),ev=[256/eh.width*2+1,256/eh.height*2+1],eb=ec?G.text.dynamicLayoutVertexArray:G.icon.dynamicLayoutVertexArray;eb.clear();let ew=G.lineVertexArray,eT=ec?G.text.placedSymbolArray:G.icon.placedSymbolArray,eE=eh.transform.width/eh.transform.height,eS=!1;for(let ec=0;ec<eT.length;ec++){let eI;let eA=eT.get(ec);if(eA.hidden||eA.writingMode===V.WritingMode.vertical&&!eS||(eS=!1,e_?(eI=[eA.anchorX,eA.anchorY,e_(eA.anchorX,eA.anchorY),1],V.transformMat4(eI,eI,el)):xt(eI=[eA.anchorX,eA.anchorY,0,1],eI,el),!function(V,G){let el=V[0]/V[3],eh=V[1]/V[3];return el>=-G[0]&&el<=G[0]&&eh>=-G[1]&&eh<=G[1]}(eI,ev))){gt(eA.numGlyphs,eb);continue}let eM=lt(eh.transform.cameraToCenterDistance,eI[3]),eC=V.evaluateSizeForFeature(ey,ex,eA),ez=em?eC/eM:eC*eM,ek=new V.pointGeometry(eA.anchorX,eA.anchorY),eP=nt(ek,ep,e_).point,eD={},eL=mt(eA,ez,!1,ef,el,ep,ed,G.glyphOffsetArray,ew,eb,eP,ek,eD,eE,eg,e_);eS=eL.useVertical,(eL.notEnoughRoom||eS||eL.needsFlipping&&mt(eA,ez,!0,ef,el,ep,ed,G.glyphOffsetArray,ew,eb,eP,ek,eD,eE,eg,e_).notEnoughRoom)&&gt(eA.numGlyphs,eb)}ec?G.text.dynamicLayoutVertexBuffer.updateData(eb):G.icon.dynamicLayoutVertexBuffer.updateData(eb)}(ey,ef.posMatrix,G,ep,eZ,ej,eE,e_,ec,el)}let eH=G.translatePosMatrix(ef.posMatrix,eg,ed,em),eK=eS||ep&&ez||eW?ek:eZ,eY=G.translatePosMatrix(ej,eg,ed,em,!0),eJ=eC&&0!==eh.paint.get(ep?"text-halo-width":"icon-halo-width").constantOr(1);ec=eC?ey.iconsInText?Me(eD.kind,eB,eI,eE,G,eH,eK,eY,eO,e$):Pe(eD.kind,eB,eI,eE,G,eH,eK,eY,ep,eO,!0):ze(eD.kind,eB,eI,eE,G,eH,eK,eY,ep,eO);let eQ={program:eR,buffers:ex,uniformValues:ec,atlasTexture:eU,atlasTextureIcon:eq,atlasInterpolation:eV,atlasInterpolationIcon:eN,isSDF:eC,hasHalo:eJ};if(eA&&ey.canOverlap){eM=!0;let G=ex.segments.get();for(let el of G)eP.push({segments:new V.SegmentVector([el]),sortKey:el.sortKey,state:eQ,terrainData:eF})}else eP.push({segments:ex.segments,sortKey:0,state:eQ,terrainData:eF})}for(let V of(eM&&eP.sort((V,G)=>V.sortKey-G.sortKey),eP)){let el=V.state;if(ev.activeTexture.set(eb.TEXTURE0),el.atlasTexture.bind(el.atlasInterpolation,eb.CLAMP_TO_EDGE),el.atlasTextureIcon&&(ev.activeTexture.set(eb.TEXTURE1),el.atlasTextureIcon&&el.atlasTextureIcon.bind(el.atlasInterpolationIcon,eb.CLAMP_TO_EDGE)),el.isSDF){let ec=el.uniformValues;el.hasHalo&&(ec.u_is_halo=1,Li(el.buffers,V.segments,eh,G,el.program,eC,ey,ex,ec,V.terrainData)),ec.u_is_halo=0}Li(el.buffers,V.segments,eh,G,el.program,eC,ey,ex,el.uniformValues,V.terrainData)}}function Li(V,G,el,eh,ec,ep,ed,em,ef,eg){let e_=eh.context;ec.draw(e_,e_.gl.TRIANGLES,ep,ed,em,Ii.disabled,ef,eg,el.id,V.layoutVertexBuffer,V.indexBuffer,G,el.paint,eh.transform.zoom,V.programConfigurations.get(el.id),V.dynamicLayoutVertexBuffer,V.opacityVertexBuffer)}function Ri(V,G,el,eh,ec,ep,ed){let em,ef,eg,e_,ey;let ex=V.context.gl,ev=el.paint.get("fill-pattern"),eb=ev&&ev.constantOr(1),ew=el.getCrossfadeParameters();for(let eT of(ed?(ef=eb&&!el.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",em=ex.LINES):(ef=eb?"fillPattern":"fill",em=ex.TRIANGLES),eh)){let eh=G.getTile(eT);if(eb&&!eh.patternsLoaded())continue;let eE=eh.getBucket(el);if(!eE)continue;let eS=eE.programConfigurations.get(el.id),eI=V.useProgram(ef,eS),eA=V.style.terrain&&V.style.terrain.getTerrainData(eT);eb&&(V.context.activeTexture.set(ex.TEXTURE0),eh.imageAtlasTexture.bind(ex.LINEAR,ex.CLAMP_TO_EDGE),eS.updatePaintBuffers(ew));let eM=ev.constantOr(null);if(eM&&eh.imageAtlas){let V=eh.imageAtlas,G=V.patternPositions[eM.to.toString()],el=V.patternPositions[eM.from.toString()];G&&el&&eS.setConstantPatternPositions(G,el)}let eC=eA?eT:null,ez=V.translatePosMatrix(eC?eC.posMatrix:eT.posMatrix,eh,el.paint.get("fill-translate"),el.paint.get("fill-translate-anchor"));if(ed){e_=eE.indexBuffer2,ey=eE.segments2;let G=[ex.drawingBufferWidth,ex.drawingBufferHeight];eg="fillOutlinePattern"===ef&&eb?_e(ez,V,ew,eh,G):me(ez,G)}else e_=eE.indexBuffer,ey=eE.segments,eg=eb?de(ez,V,ew,eh):ue(ez);eI.draw(V.context,em,ec,V.stencilModeForClipping(eT),ep,Ii.disabled,eg,eA,el.id,eE.layoutVertexBuffer,e_,ey,el.paint,V.transform.zoom,eS)}}function ki(V,G,el,eh,ec,ep,ed){let em=V.context,ef=em.gl,eg=el.paint.get("fill-extrusion-pattern"),e_=eg.constantOr(1),ey=el.getCrossfadeParameters(),ex=el.paint.get("fill-extrusion-opacity");for(let ev of eh){let eh=G.getTile(ev),eb=eh.getBucket(el);if(!eb)continue;let ew=V.style.terrain&&V.style.terrain.getTerrainData(ev),eT=eb.programConfigurations.get(el.id),eE=V.useProgram(e_?"fillExtrusionPattern":"fillExtrusion",eT);e_&&(V.context.activeTexture.set(ef.TEXTURE0),eh.imageAtlasTexture.bind(ef.LINEAR,ef.CLAMP_TO_EDGE),eT.updatePaintBuffers(ey));let eS=eg.constantOr(null);if(eS&&eh.imageAtlas){let V=eh.imageAtlas,G=V.patternPositions[eS.to.toString()],el=V.patternPositions[eS.from.toString()];G&&el&&eT.setConstantPatternPositions(G,el)}let eI=V.translatePosMatrix(ev.posMatrix,eh,el.paint.get("fill-extrusion-translate"),el.paint.get("fill-extrusion-translate-anchor")),eA=el.paint.get("fill-extrusion-vertical-gradient"),eM=e_?he(eI,V,eA,ex,ev,ey,eh):ce(eI,V,eA,ex);eE.draw(em,em.gl.TRIANGLES,ec,ep,ed,Ii.backCCW,eM,ew,el.id,eb.layoutVertexBuffer,eb.indexBuffer,eb.segments,el.paint,V.transform.zoom,eT,V.style.terrain&&eb.centroidVertexBuffer)}}let eP=new V.Color(1,0,0,1),eD=new V.Color(0,1,0,1),eL=new V.Color(0,0,1,1),eR=new V.Color(1,0,1,1),eB=new V.Color(0,1,1,1);function qi(V,G,el,eh){$i(V,0,G+el/2,V.transform.width,el,eh)}function ji(V,G,el,eh){$i(V,G-el/2,0,el,V.transform.height,eh)}function $i(V,G,el,eh,ec,ep){let ed=V.context,em=ed.gl;em.enable(em.SCISSOR_TEST),em.scissor(G*V.pixelRatio,el*V.pixelRatio,eh*V.pixelRatio,ec*V.pixelRatio),ed.clear({color:ep}),em.disable(em.SCISSOR_TEST)}function Wi(V,G,el){let eh=V.context,ec=eh.gl,ep=V.colorModeForRenderPass(),ed=new wi(ec.LEQUAL,wi.ReadWrite,V.depthRangeFor3D),em=V.useProgram("terrain"),ef=G.getTerrainMesh(),eg=G.getTerrainData(el.tileID);eh.bindFramebuffer.set(null),eh.viewport.set([0,0,V.width,V.height]),eh.activeTexture.set(ec.TEXTURE0),ec.bindTexture(ec.TEXTURE_2D,G.getRTTFramebuffer().colorAttachment.get());let e_=V.transform.calculatePosMatrix(el.tileID.toUnwrapped());em.draw(eh,ec.TRIANGLES,ed,Ei.disabled,ep,Ii.backCCW,{u_matrix:e_,u_texture:0},eg,"terrain",ef.vertexBuffer,ef.indexBuffer,ef.segments)}function Hi(V,G,el,eh){let ec=V.context,ep=el.tileSize*G.qualityFactor;el.textures[eh]||(el.textures[eh]=V.getTileTexture(ep)||new l(ec,{width:ep,height:ep,data:null},ec.gl.RGBA),el.textures[eh].bind(ec.gl.LINEAR,ec.gl.CLAMP_TO_EDGE),0===eh&&G.sourceCache.renderHistory.unshift(el.tileID.key));let ed=G.getRTTFramebuffer();ed.colorAttachment.set(el.textures[eh].texture),ec.bindFramebuffer.set(ed.framebuffer),ec.viewport.set([0,0,ep,ep])}let Ki=class Ki{constructor(V){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=V,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=V.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){let V=this.painter.style,G=V.terrain;for(let el in V.sourceCaches){this._coordsDescendingInv[el]={};let eh=V.sourceCaches[el].getVisibleCoordinates();for(let V of eh){let eh=G.sourceCache.getTerrainCoords(V);for(let V in eh)this._coordsDescendingInv[el][V]||(this._coordsDescendingInv[el][V]=[]),this._coordsDescendingInv[el][V].push(eh[V])}}for(let G of V._order){let el=V._layers[G],eh=el.source;if(this._renderToTexture[el.type]&&!this._coordsDescendingInvStr[eh])for(let V in this._coordsDescendingInvStr[eh]={},this._coordsDescendingInv[eh])this._coordsDescendingInvStr[eh][V]=this._coordsDescendingInv[eh][V].map(V=>V.key).sort().join()}return this._renderableTiles.forEach(V=>{for(let el in this._coordsDescendingInvStr){let eh=this._coordsDescendingInvStr[el][V.tileID.key];eh&&eh!==V.textureCoords[el]&&V.clearTextures(this.painter),G.needsRerender(el,V.tileID)&&V.clearTextures(this.painter)}this._rerender[V.tileID.key]=!V.textures.length}),G.clearRerenderCache(),G.sourceCache.removeOutdated(this.painter),this}renderLayer(G){let el=G.type,eh=this.painter,ec=eh.style._order,ep=eh.currentLayer,ed=ep+1===ec.length;if(this._renderToTexture[el]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=el,this._stacks[this._stacks.length-1].push(ec[ep]),!ed))return!0;if(this._renderToTexture[this._prevType]||"hillshade"===el||this._renderToTexture[el]&&ed){this._prevType=el;let ed=this._stacks.length-1,em=this._stacks[ed]||[];for(let G of this._renderableTiles){if(Hi(eh,eh.style.terrain,G,ed),this._rerender[G.tileID.key]){eh.context.clear({color:V.Color.transparent});for(let V=0;V<em.length;V++){let el=eh.style._layers[em[V]],ec=el.source?this._coordsDescendingInv[el.source][G.tileID.key]:[G.tileID];eh._renderTileClippingMasks(el,ec),eh.renderLayer(eh,eh.style.sourceCaches[el.source],el,ec),el.source&&(G.textureCoords[el.source]=this._coordsDescendingInvStr[el.source][G.tileID.key])}}Wi(eh,eh.style.terrain,G)}if("hillshade"===el){for(let el of(this._stacks.push([ec[ep]]),this._renderableTiles)){let ec=this._coordsDescendingInv[G.source][el.tileID.key];Hi(eh,eh.style.terrain,el,this._stacks.length-1),eh.context.clear({color:V.Color.transparent}),eh._renderTileClippingMasks(G,ec),eh.renderLayer(eh,eh.style.sourceCaches[G.source],G,ec),Wi(eh,eh.style.terrain,el)}return!0}return this._renderToTexture[el]}return!1}};let eF={symbol:function(G,el,eh,ec,ep){if("translucent"!==G.renderPass)return;let ed=Ei.disabled,em=G.colorModeForRenderPass();eh.layout.get("text-variable-anchor")&&function(G,el,eh,ec,ep,ed,em){let ef=el.transform,eg="map"===ep,e_="map"===ed;for(let ep of G){let G=ec.getTile(ep),ed=G.getBucket(eh);if(!ed||!ed.text||!ed.text.segments.get().length)continue;let ey=V.evaluateSizeForZoom(ed.textSizeData,ef.zoom),ex=bt(G,1,el.transform.zoom),ev=rt(ep.posMatrix,e_,eg,el.transform,ex),eb="none"!==eh.layout.get("icon-text-fit")&&ed.hasIconData();if(ey){let eh=Math.pow(2,ef.zoom-G.tileID.overscaledZ);(function(G,el,eh,ec,ep,ed,em,ef,eg,e_,ey){let ex=G.text.placedSymbolArray,ev=G.text.dynamicLayoutVertexArray,eb=G.icon.dynamicLayoutVertexArray,ew={};ev.clear();for(let eb=0;eb<ex.length;eb++){let eT=ex.get(eb),eE=G.allowVerticalPlacement&&!eT.placedOrientation,eS=eT.hidden||!eT.crossTileID||eE?null:ec[eT.crossTileID];if(eS){let ec=new V.pointGeometry(eT.anchorX,eT.anchorY),ex=nt(ec,eh?em:ed,ey),eb=lt(ep.cameraToCenterDistance,ex.signedDistanceFromCamera),eE=V.evaluateSizeForFeature(G.textSizeData,eg,eT)*eb/V.ONE_EM;eh&&(eE*=G.tilePixelRatio/ef);let{width:eI,height:eA,anchor:eM,textOffset:eC,textBoxScale:ez}=eS,ek=function(G,el,eh,ec,ep,ed){let{horizontalAlign:em,verticalAlign:ef}=V.getAnchorAlignment(G),eg=V.evaluateVariableOffset(G,ec);return new V.pointGeometry((-(em-.5)*el/ep+eg[0])*ed,(-(ef-.5)*eh/ep+eg[1])*ed)}(eM,eI,eA,eC,ez,eE),eP=eh?nt(ec.add(ek),ed,ey).point:ex.point.add(el?ek.rotate(-ep.angle):ek),eD=G.allowVerticalPlacement&&eT.placedOrientation===V.WritingMode.vertical?Math.PI/2:0;for(let G=0;G<eT.numGlyphs;G++)V.addDynamicAttributes(ev,eP,eD);e_&&eT.associatedIconIndex>=0&&(ew[eT.associatedIconIndex]={shiftedAnchor:eP,angle:eD})}else gt(eT.numGlyphs,ev)}if(e_){eb.clear();let el=G.icon.placedSymbolArray;for(let G=0;G<el.length;G++){let eh=el.get(G);if(eh.hidden)gt(eh.numGlyphs,eb);else{let el=ew[G];if(el)for(let G=0;G<eh.numGlyphs;G++)V.addDynamicAttributes(eb,el.shiftedAnchor,el.angle);else gt(eh.numGlyphs,eb)}}G.icon.dynamicLayoutVertexBuffer.updateData(eb)}G.text.dynamicLayoutVertexBuffer.updateData(ev)})(ed,eg,e_,em,ef,ev,ep.posMatrix,eh,ey,eb,el.style.terrain?(V,G)=>el.style.terrain.getElevation(ep,V,G):null)}}}(ec,G,eh,el,eh.layout.get("text-rotation-alignment"),eh.layout.get("text-pitch-alignment"),ep),0!==eh.paint.get("icon-opacity").constantOr(1)&&Ai(G,el,eh,ec,!1,eh.paint.get("icon-translate"),eh.paint.get("icon-translate-anchor"),eh.layout.get("icon-rotation-alignment"),eh.layout.get("icon-pitch-alignment"),eh.layout.get("icon-keep-upright"),ed,em),0!==eh.paint.get("text-opacity").constantOr(1)&&Ai(G,el,eh,ec,!0,eh.paint.get("text-translate"),eh.paint.get("text-translate-anchor"),eh.layout.get("text-rotation-alignment"),eh.layout.get("text-pitch-alignment"),eh.layout.get("text-keep-upright"),ed,em),el.map.showCollisionBoxes&&(Si(G,el,eh,ec,eh.paint.get("text-translate"),eh.paint.get("text-translate-anchor"),!0),Si(G,el,eh,ec,eh.paint.get("icon-translate"),eh.paint.get("icon-translate-anchor"),!1))},circle:function(G,el,eh,ec){if("translucent"!==G.renderPass)return;let ep=eh.paint.get("circle-opacity"),ed=eh.paint.get("circle-stroke-width"),em=eh.paint.get("circle-stroke-opacity"),ef=!eh.layout.get("circle-sort-key").isConstant();if(0===ep.constantOr(1)&&(0===ed.constantOr(1)||0===em.constantOr(1)))return;let eg=G.context,e_=eg.gl,ey=G.depthModeForSublayer(0,wi.ReadOnly),ex=Ei.disabled,ev=G.colorModeForRenderPass(),eb=[];for(let ep=0;ep<ec.length;ep++){let ed=ec[ep],em=el.getTile(ed),eg=em.getBucket(eh);if(!eg)continue;let e_=eg.programConfigurations.get(eh.id),ey=G.useProgram("circle",e_),ex=eg.layoutVertexBuffer,ev=eg.indexBuffer,ew=G.style.terrain&&G.style.terrain.getTerrainData(ed),eT={programConfiguration:e_,program:ey,layoutVertexBuffer:ex,indexBuffer:ev,uniformValues:pe(G,ed,em,eh),terrainData:ew};if(ef){let G=eg.segments.get();for(let el of G)eb.push({segments:new V.SegmentVector([el]),sortKey:el.sortKey,state:eT})}else eb.push({segments:eg.segments,sortKey:0,state:eT})}for(let V of(ef&&eb.sort((V,G)=>V.sortKey-G.sortKey),eb)){let{programConfiguration:el,program:ec,layoutVertexBuffer:ep,indexBuffer:ed,uniformValues:em,terrainData:ef}=V.state;ec.draw(eg,e_.TRIANGLES,ey,ex,ev,Ii.disabled,em,ef,eh.id,ep,ed,V.segments,eh.paint,G.transform.zoom,el)}},heatmap:function(G,el,eh,ec){if(0!==eh.paint.get("heatmap-opacity")){if("offscreen"===G.renderPass){let ep=G.context,ed=ep.gl,em=Ei.disabled,ef=new yi([ed.ONE,ed.ONE],V.Color.transparent,[!0,!0,!0,!0]);(function(V,G,el){let eh=V.gl;V.activeTexture.set(eh.TEXTURE1),V.viewport.set([0,0,G.width/4,G.height/4]);let ec=el.heatmapFbo;if(ec)eh.bindTexture(eh.TEXTURE_2D,ec.colorAttachment.get()),V.bindFramebuffer.set(ec.framebuffer);else{let ep=eh.createTexture();eh.bindTexture(eh.TEXTURE_2D,ep),eh.texParameteri(eh.TEXTURE_2D,eh.TEXTURE_WRAP_S,eh.CLAMP_TO_EDGE),eh.texParameteri(eh.TEXTURE_2D,eh.TEXTURE_WRAP_T,eh.CLAMP_TO_EDGE),eh.texParameteri(eh.TEXTURE_2D,eh.TEXTURE_MIN_FILTER,eh.LINEAR),eh.texParameteri(eh.TEXTURE_2D,eh.TEXTURE_MAG_FILTER,eh.LINEAR),ec=el.heatmapFbo=V.createFramebuffer(G.width/4,G.height/4,!1),function(V,G,el,eh){let ec=V.gl;ec.texImage2D(ec.TEXTURE_2D,0,ec.RGBA,G.width/4,G.height/4,0,ec.RGBA,V.extRenderToTextureHalfFloat?V.extTextureHalfFloat.HALF_FLOAT_OES:ec.UNSIGNED_BYTE,null),eh.colorAttachment.set(el)}(V,G,ep,ec)}})(ep,G,eh),ep.clear({color:V.Color.transparent});for(let V=0;V<ec.length;V++){let eg=ec[V];if(el.hasRenderableParent(eg))continue;let e_=el.getTile(eg),ey=e_.getBucket(eh);if(!ey)continue;let ex=ey.programConfigurations.get(eh.id),ev=G.useProgram("heatmap",ex),{zoom:eb}=G.transform;ev.draw(ep,ed.TRIANGLES,wi.disabled,em,ef,Ii.disabled,ve(eg.posMatrix,e_,eb,eh.paint.get("heatmap-intensity")),null,eh.id,ey.layoutVertexBuffer,ey.indexBuffer,ey.segments,eh.paint,G.transform.zoom,ex)}ep.viewport.set([0,0,G.width,G.height])}else"translucent"===G.renderPass&&(G.context.setColorMode(G.colorModeForRenderPass()),function(G,el){let eh=G.context,ec=eh.gl,ep=el.heatmapFbo;if(!ep)return;eh.activeTexture.set(ec.TEXTURE0),ec.bindTexture(ec.TEXTURE_2D,ep.colorAttachment.get()),eh.activeTexture.set(ec.TEXTURE1);let ed=el.colorRampTexture;ed||(ed=el.colorRampTexture=new l(eh,el.colorRamp,ec.RGBA)),ed.bind(ec.LINEAR,ec.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(eh,ec.TRIANGLES,wi.disabled,Ei.disabled,G.colorModeForRenderPass(),Ii.disabled,((G,el,eh,ec)=>{let ep=V.create();V.ortho(ep,0,G.width,G.height,0,0,1);let ed=G.context.gl;return{u_matrix:ep,u_world:[ed.drawingBufferWidth,ed.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:el.paint.get("heatmap-opacity")}})(G,el),null,el.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,el.paint,G.transform.zoom)}(G,eh))}},line:function(G,el,eh,ec){if("translucent"!==G.renderPass)return;let ep=eh.paint.get("line-opacity"),ed=eh.paint.get("line-width");if(0===ep.constantOr(1)||0===ed.constantOr(1))return;let em=G.depthModeForSublayer(0,wi.ReadOnly),ef=G.colorModeForRenderPass(),eg=eh.paint.get("line-dasharray"),e_=eh.paint.get("line-pattern"),ey=e_.constantOr(1),ex=eh.paint.get("line-gradient"),ev=eh.getCrossfadeParameters(),eb=ey?"linePattern":eg?"lineSDF":ex?"lineGradient":"line",ew=G.context,eT=ew.gl,eE=!0;for(let ep of ec){let ec=el.getTile(ep);if(ey&&!ec.patternsLoaded())continue;let ed=ec.getBucket(eh);if(!ed)continue;let eS=ed.programConfigurations.get(eh.id),eI=G.context.program.get(),eA=G.useProgram(eb,eS),eM=eE||eA.program!==eI,eC=G.style.terrain&&G.style.terrain.getTerrainData(ep),ez=e_.constantOr(null);if(ez&&ec.imageAtlas){let V=ec.imageAtlas,G=V.patternPositions[ez.to.toString()],el=V.patternPositions[ez.from.toString()];G&&el&&eS.setConstantPatternPositions(G,el)}let ek=eC?ep:null,eP=ey?Te(G,ec,eh,ev,ek):eg?Ee(G,ec,eh,eg,ev,ek):ex?we(G,ec,eh,ed.lineClipsArray.length,ek):be(G,ec,eh,ek);if(ey)ew.activeTexture.set(eT.TEXTURE0),ec.imageAtlasTexture.bind(eT.LINEAR,eT.CLAMP_TO_EDGE),eS.updatePaintBuffers(ev);else if(eg&&(eM||G.lineAtlas.dirty))ew.activeTexture.set(eT.TEXTURE0),G.lineAtlas.bind(ew);else if(ex){let ec=ed.gradients[eh.id],em=ec.texture;if(eh.gradientVersion!==ec.version){let ef=256;if(eh.stepInterpolant){let eh=el.getSource().maxzoom,ec=ep.canonical.z===eh?Math.ceil(1<<G.transform.maxZoom-ep.canonical.z):1;ef=V.clamp(V.nextPowerOfTwo(ed.maxLineLength/V.EXTENT*1024*ec),256,ew.maxTextureSize)}ec.gradient=V.renderColorRamp({expression:eh.gradientExpression(),evaluationKey:"lineProgress",resolution:ef,image:ec.gradient||void 0,clips:ed.lineClipsArray}),ec.texture?ec.texture.update(ec.gradient):ec.texture=new l(ew,ec.gradient,eT.RGBA),ec.version=eh.gradientVersion,em=ec.texture}ew.activeTexture.set(eT.TEXTURE0),em.bind(eh.stepInterpolant?eT.NEAREST:eT.LINEAR,eT.CLAMP_TO_EDGE)}eA.draw(ew,eT.TRIANGLES,em,G.stencilModeForClipping(ep),ef,Ii.disabled,eP,eC,eh.id,ed.layoutVertexBuffer,ed.indexBuffer,ed.segments,eh.paint,G.transform.zoom,eS,ed.layoutVertexBuffer2),eE=!1}},fill:function(G,el,eh,ec){let ep=eh.paint.get("fill-color"),ed=eh.paint.get("fill-opacity");if(0===ed.constantOr(1))return;let em=G.colorModeForRenderPass(),ef=eh.paint.get("fill-pattern"),eg=G.opaquePassEnabledForLayer()&&!ef.constantOr(1)&&1===ep.constantOr(V.Color.transparent).a&&1===ed.constantOr(0)?"opaque":"translucent";if(G.renderPass===eg){let V=G.depthModeForSublayer(1,"opaque"===G.renderPass?wi.ReadWrite:wi.ReadOnly);Ri(G,el,eh,ec,V,em,!1)}if("translucent"===G.renderPass&&eh.paint.get("fill-antialias")){let V=G.depthModeForSublayer(eh.getPaintProperty("fill-outline-color")?2:0,wi.ReadOnly);Ri(G,el,eh,ec,V,em,!0)}},"fill-extrusion":function(V,G,el,eh){let ec=el.paint.get("fill-extrusion-opacity");if(0!==ec&&"translucent"===V.renderPass){let ep=new wi(V.context.gl.LEQUAL,wi.ReadWrite,V.depthRangeFor3D);if(1!==ec||el.paint.get("fill-extrusion-pattern").constantOr(1))ki(V,G,el,eh,ep,Ei.disabled,yi.disabled),ki(V,G,el,eh,ep,V.stencilModeFor3D(),V.colorModeForRenderPass());else{let ec=V.colorModeForRenderPass();ki(V,G,el,eh,ep,Ei.disabled,ec)}}},hillshade:function(G,el,eh,ec){if("offscreen"!==G.renderPass&&"translucent"!==G.renderPass)return;let ep=G.context,ed=G.depthModeForSublayer(0,wi.ReadOnly),em=G.colorModeForRenderPass(),[ef,eg]="translucent"===G.renderPass?G.stencilConfigForOverlap(ec):[{},ec];for(let ec of eg){let ep=el.getTile(ec);void 0!==ep.needsHillshadePrepare&&ep.needsHillshadePrepare&&"offscreen"===G.renderPass?function(G,el,eh,ec,ep,ed){let em=G.context,ef=em.gl,eg=el.dem;if(eg&&eg.data){let e_=eg.dim,ey=eg.stride,ex=eg.getPixels();if(em.activeTexture.set(ef.TEXTURE1),em.pixelStoreUnpackPremultiplyAlpha.set(!1),el.demTexture=el.demTexture||G.getTileTexture(ey),el.demTexture){let V=el.demTexture;V.update(ex,{premultiply:!1}),V.bind(ef.NEAREST,ef.CLAMP_TO_EDGE)}else el.demTexture=new l(em,ex,ef.RGBA,{premultiply:!1}),el.demTexture.bind(ef.NEAREST,ef.CLAMP_TO_EDGE);em.activeTexture.set(ef.TEXTURE0);let ev=el.fbo;if(!ev){let V=new l(em,{width:e_,height:e_,data:null},ef.RGBA);V.bind(ef.LINEAR,ef.CLAMP_TO_EDGE),(ev=el.fbo=em.createFramebuffer(e_,e_,!0)).colorAttachment.set(V.texture)}em.bindFramebuffer.set(ev.framebuffer),em.viewport.set([0,0,e_,e_]),G.useProgram("hillshadePrepare").draw(em,ef.TRIANGLES,ec,ep,ed,Ii.disabled,((G,el)=>{let eh=el.stride,ec=V.create();return V.ortho(ec,0,V.EXTENT,-V.EXTENT,0,0,1),V.translate(ec,ec,[0,-V.EXTENT,0]),{u_matrix:ec,u_image:1,u_dimension:[eh,eh],u_zoom:G.overscaledZ,u_unpack:el.getUnpackVector()}})(el.tileID,eg),null,eh.id,G.rasterBoundsBuffer,G.quadTriangleIndexBuffer,G.rasterBoundsSegments),el.needsHillshadePrepare=!1}}(G,ep,eh,ed,Ei.disabled,em):"translucent"===G.renderPass&&function(G,el,eh,ec,ep,ed,em){let ef=G.context,eg=ef.gl,e_=eh.fbo;if(!e_)return;let ey=G.useProgram("hillshade"),ex=G.style.terrain&&G.style.terrain.getTerrainData(el);ef.activeTexture.set(eg.TEXTURE0),eg.bindTexture(eg.TEXTURE_2D,e_.colorAttachment.get()),ey.draw(ef,eg.TRIANGLES,ep,ed,em,Ii.disabled,((G,el,eh,ec)=>{let ep=eh.paint.get("hillshade-shadow-color"),ed=eh.paint.get("hillshade-highlight-color"),em=eh.paint.get("hillshade-accent-color"),ef=eh.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===eh.paint.get("hillshade-illumination-anchor")&&(ef-=G.transform.angle);let eg=!G.options.moving;return{u_matrix:ec?ec.posMatrix:G.transform.calculatePosMatrix(el.tileID.toUnwrapped(),eg),u_image:0,u_latrange:function(G,el){let eh=Math.pow(2,el.canonical.z),ec=el.canonical.y;return[new V.MercatorCoordinate(0,ec/eh).toLngLat().lat,new V.MercatorCoordinate(0,(ec+1)/eh).toLngLat().lat]}(0,el.tileID),u_light:[eh.paint.get("hillshade-exaggeration"),ef],u_shadow:ep,u_highlight:ed,u_accent:em}})(G,eh,ec,ex?el:null),ex,ec.id,G.rasterBoundsBuffer,G.quadTriangleIndexBuffer,G.rasterBoundsSegments)}(G,ec,ep,eh,ed,ef[ec.overscaledZ],em)}ep.viewport.set([0,0,G.width,G.height])},raster:function(G,el,eh,ec){if("translucent"!==G.renderPass||0===eh.paint.get("raster-opacity")||!ec.length)return;let ep=G.context,ed=ep.gl,em=el.getSource(),ef=G.useProgram("raster"),eg=G.colorModeForRenderPass(),[e_,ey]=em instanceof D?[{},ec]:G.stencilConfigForOverlap(ec),ex=ey[ey.length-1].overscaledZ,ev=!G.options.moving;for(let ec of ey){let ey,eb;let ew=G.depthModeForSublayer(ec.overscaledZ-ex,1===eh.paint.get("raster-opacity")?wi.ReadWrite:wi.ReadOnly,ed.LESS),eT=el.getTile(ec);eT.registerFadeDuration(eh.paint.get("raster-fade-duration"));let eE=el.findLoadedParent(ec,0),eS=function(G,el,eh,ec,ep,ed){let em=ec.paint.get("raster-fade-duration");if(!ed&&em>0){let ec=V.exported.now(),ed=(ec-G.timeAdded)/em,ef=el?(ec-el.timeAdded)/em:-1,eg=eh.getSource(),e_=ep.coveringZoomLevel({tileSize:eg.tileSize,roundZoom:eg.roundZoom}),ey=!el||Math.abs(el.tileID.overscaledZ-e_)>Math.abs(G.tileID.overscaledZ-e_),ex=ey&&G.refreshedUponExpiration?1:V.clamp(ey?ed:1-ef,0,1);return G.refreshedUponExpiration&&ed>=1&&(G.refreshedUponExpiration=!1),el?{opacity:1,mix:1-ex}:{opacity:ex,mix:0}}return{opacity:1,mix:0}}(eT,eE,el,eh,G.transform,G.style.terrain),eI="nearest"===eh.paint.get("raster-resampling")?ed.NEAREST:ed.LINEAR;ep.activeTexture.set(ed.TEXTURE0),eT.texture.bind(eI,ed.CLAMP_TO_EDGE,ed.LINEAR_MIPMAP_NEAREST),ep.activeTexture.set(ed.TEXTURE1),eE?(eE.texture.bind(eI,ed.CLAMP_TO_EDGE,ed.LINEAR_MIPMAP_NEAREST),ey=Math.pow(2,eE.tileID.overscaledZ-eT.tileID.overscaledZ),eb=[eT.tileID.canonical.x*ey%1,eT.tileID.canonical.y*ey%1]):eT.texture.bind(eI,ed.CLAMP_TO_EDGE,ed.LINEAR_MIPMAP_NEAREST);let eA=G.style.terrain&&G.style.terrain.getTerrainData(ec),eM=eA?ec:null,eC=eM?eM.posMatrix:G.transform.calculatePosMatrix(ec.toUnwrapped(),ev),ez=Se(eC,eb||[0,0],ey||1,eS,eh);em instanceof D?ef.draw(ep,ed.TRIANGLES,ew,Ei.disabled,eg,Ii.disabled,ez,eA,eh.id,em.boundsBuffer,G.quadTriangleIndexBuffer,em.boundsSegments):ef.draw(ep,ed.TRIANGLES,ew,e_[ec.overscaledZ],eg,Ii.disabled,ez,eA,eh.id,G.rasterBoundsBuffer,G.quadTriangleIndexBuffer,G.rasterBoundsSegments)}},background:function(V,G,el,eh){let ec=el.paint.get("background-color"),ep=el.paint.get("background-opacity");if(0===ep)return;let ed=V.context,em=ed.gl,ef=V.transform,eg=ef.tileSize,e_=el.paint.get("background-pattern");if(V.isPatternMissing(e_))return;let ey=!e_&&1===ec.a&&1===ep&&V.opaquePassEnabledForLayer()?"opaque":"translucent";if(V.renderPass!==ey)return;let ex=Ei.disabled,ev=V.depthModeForSublayer(0,"opaque"===ey?wi.ReadWrite:wi.ReadOnly),eb=V.colorModeForRenderPass(),ew=V.useProgram(e_?"backgroundPattern":"background"),eT=eh||ef.coveringTiles({tileSize:eg,terrain:V.style.terrain});e_&&(ed.activeTexture.set(em.TEXTURE0),V.imageManager.bind(V.context));let eE=el.getCrossfadeParameters();for(let G of eT){let ef=eh?G.posMatrix:V.transform.calculatePosMatrix(G.toUnwrapped()),ey=e_?Le(ef,ep,V,e_,{tileID:G,tileSize:eg},eE):Ae(ef,ep,ec),eT=V.style.terrain&&V.style.terrain.getTerrainData(G);ew.draw(ed,em.TRIANGLES,ev,ex,eb,Ii.disabled,ey,eT,el.id,V.tileExtentBuffer,V.quadTriangleIndexBuffer,V.tileExtentSegments)}},debug:function(G,el,eh){for(let ec=0;ec<eh.length;ec++)!function(G,el,eh){let ec=G.context,ep=ec.gl,ed=eh.posMatrix,em=G.useProgram("debug"),ef=wi.disabled,eg=Ei.disabled,e_=G.colorModeForRenderPass(),ey="$debug",ex=G.style.terrain&&G.style.terrain.getTerrainData(eh);ec.activeTexture.set(ep.TEXTURE0),G.emptyTexture.bind(ep.LINEAR,ep.CLAMP_TO_EDGE);let ev=el.getTileByID(eh.key).latestRawTileData,eb=Math.floor((ev&&ev.byteLength||0)/1024),ew=el.getTile(eh).tileSize,eT=512/Math.min(ew,512)*(eh.overscaledZ/G.transform.zoom)*.5,eE=eh.canonical.toString();eh.overscaledZ!==eh.canonical.z&&(eE+=` => ${eh.overscaledZ}`),function(V,G){V.initDebugOverlayCanvas();let el=V.debugOverlayCanvas,eh=V.context.gl,ec=V.debugOverlayCanvas.getContext("2d");ec.clearRect(0,0,el.width,el.height),ec.shadowColor="white",ec.shadowBlur=2,ec.lineWidth=1.5,ec.strokeStyle="white",ec.textBaseline="top",ec.font="bold 36px Open Sans, sans-serif",ec.fillText(G,5,5),ec.strokeText(G,5,5),V.debugOverlayTexture.update(el),V.debugOverlayTexture.bind(eh.LINEAR,eh.CLAMP_TO_EDGE)}(G,`${eE} ${eb}kB`),em.draw(ec,ep.TRIANGLES,ef,eg,yi.alphaBlended,Ii.disabled,ge(ed,V.Color.transparent,eT),null,ey,G.debugBuffer,G.quadTriangleIndexBuffer,G.debugSegments),em.draw(ec,ep.LINE_STRIP,ef,eg,e_,Ii.disabled,ge(ed,V.Color.red),ex,ey,G.debugBuffer,G.tileBorderIndexBuffer,G.debugSegments)}(G,el,eh[ec])},custom:function(V,G,el){let eh=V.context,ec=el.implementation;if("offscreen"===V.renderPass){let G=ec.prerender;G&&(V.setCustomLayerDefaults(),eh.setColorMode(V.colorModeForRenderPass()),G.call(ec,eh.gl,V.transform.customLayerMatrix()),eh.setDirty(),V.setBaseState())}else if("translucent"===V.renderPass){V.setCustomLayerDefaults(),eh.setColorMode(V.colorModeForRenderPass()),eh.setStencilMode(Ei.disabled);let G="3d"===ec.renderingMode?new wi(V.context.gl.LEQUAL,wi.ReadWrite,V.depthRangeFor3D):V.depthModeForSublayer(0,wi.ReadOnly);eh.setDepthMode(G),ec.render(eh.gl,V.transform.customLayerMatrix()),eh.setDirty(),V.setBaseState(),eh.bindFramebuffer.set(null)}}};let Ji=class Ji{constructor(G,el){this.context=new bi(G),this.transform=el,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:V.create(),renderTime:0},this.setup(),this.numSublayers=O.maxUnderzooming+O.maxOverzooming+1,this.depthEpsilon=1/65536,this.crossTileSymbolIndex=new Xt,this.gpuTimers={}}resize(V,G,el){if(this.width=V*el,this.height=G*el,this.pixelRatio=el,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let V of this.style._order)this.style._layers[V].resize()}setup(){let G=this.context,el=new V.PosArray;el.emplaceBack(0,0),el.emplaceBack(V.EXTENT,0),el.emplaceBack(0,V.EXTENT),el.emplaceBack(V.EXTENT,V.EXTENT),this.tileExtentBuffer=G.createVertexBuffer(el,eT.members),this.tileExtentSegments=V.SegmentVector.simpleSegment(0,0,4,2);let eh=new V.PosArray;eh.emplaceBack(0,0),eh.emplaceBack(V.EXTENT,0),eh.emplaceBack(0,V.EXTENT),eh.emplaceBack(V.EXTENT,V.EXTENT),this.debugBuffer=G.createVertexBuffer(eh,eT.members),this.debugSegments=V.SegmentVector.simpleSegment(0,0,4,5);let ec=new V.RasterBoundsArray;ec.emplaceBack(0,0,0,0),ec.emplaceBack(V.EXTENT,0,V.EXTENT,0),ec.emplaceBack(0,V.EXTENT,0,V.EXTENT),ec.emplaceBack(V.EXTENT,V.EXTENT,V.EXTENT,V.EXTENT),this.rasterBoundsBuffer=G.createVertexBuffer(ec,ef.members),this.rasterBoundsSegments=V.SegmentVector.simpleSegment(0,0,4,2);let ep=new V.PosArray;ep.emplaceBack(0,0),ep.emplaceBack(1,0),ep.emplaceBack(0,1),ep.emplaceBack(1,1),this.viewportBuffer=G.createVertexBuffer(ep,eT.members),this.viewportSegments=V.SegmentVector.simpleSegment(0,0,4,2);let ed=new V.LineStripIndexArray;ed.emplaceBack(0),ed.emplaceBack(1),ed.emplaceBack(3),ed.emplaceBack(2),ed.emplaceBack(0),this.tileBorderIndexBuffer=G.createIndexBuffer(ed);let em=new V.TriangleIndexArray;em.emplaceBack(0,1,2),em.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=G.createIndexBuffer(em),this.emptyTexture=new l(G,{width:1,height:1,data:new Uint8Array([0,0,0,0])},G.gl.RGBA);let eg=this.context.gl;this.stencilClearMode=new Ei({func:eg.ALWAYS,mask:0},0,255,eg.ZERO,eg.ZERO,eg.ZERO)}clearStencil(){let G=this.context,el=G.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let eh=V.create();V.ortho(eh,0,this.width,this.height,0,0,1),V.scale(eh,eh,[el.drawingBufferWidth,el.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(G,el.TRIANGLES,wi.disabled,this.stencilClearMode,yi.disabled,Ii.disabled,xe(eh),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(V,G){if(this.currentStencilSource===V.source||!V.isTileClipped()||!G||!G.length)return;this.currentStencilSource=V.source;let el=this.context,eh=el.gl;this.nextStencilID+G.length>256&&this.clearStencil(),el.setColorMode(yi.disabled),el.setDepthMode(wi.disabled);let ec=this.useProgram("clippingMask");for(let V of(this._tileClippingMaskIDs={},G)){let G=this._tileClippingMaskIDs[V.key]=this.nextStencilID++,ep=this.style.terrain&&this.style.terrain.getTerrainData(V);ec.draw(el,eh.TRIANGLES,wi.disabled,new Ei({func:eh.ALWAYS,mask:0},G,255,eh.KEEP,eh.KEEP,eh.REPLACE),yi.disabled,Ii.disabled,xe(V.posMatrix),ep,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let V=this.nextStencilID++,G=this.context.gl;return new Ei({func:G.NOTEQUAL,mask:255},V,255,G.KEEP,G.KEEP,G.REPLACE)}stencilModeForClipping(V){let G=this.context.gl;return new Ei({func:G.EQUAL,mask:255},this._tileClippingMaskIDs[V.key],0,G.KEEP,G.KEEP,G.REPLACE)}stencilConfigForOverlap(V){let G=this.context.gl,el=V.sort((V,G)=>G.overscaledZ-V.overscaledZ),eh=el[el.length-1].overscaledZ,ec=el[0].overscaledZ-eh+1;if(ec>1){this.currentStencilSource=void 0,this.nextStencilID+ec>256&&this.clearStencil();let V={};for(let el=0;el<ec;el++)V[el+eh]=new Ei({func:G.GEQUAL,mask:255},el+this.nextStencilID,255,G.KEEP,G.KEEP,G.REPLACE);return this.nextStencilID+=ec,[V,el]}return[{[eh]:Ei.disabled},el]}colorModeForRenderPass(){let G=this.context.gl;if(this._showOverdrawInspector){let el=1/8;return new yi([G.CONSTANT_COLOR,G.ONE],new V.Color(el,el,el,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?yi.unblended:yi.alphaBlended}depthModeForSublayer(V,G,el){if(!this.opaquePassEnabledForLayer())return wi.disabled;let eh=1-((1+this.currentLayer)*this.numSublayers+V)*this.depthEpsilon;return new wi(el||this.context.gl.LEQUAL,G,[eh,eh])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(G,el){this.style=G,this.options=el,this.lineAtlas=G.lineAtlas,this.imageManager=G.imageManager,this.glyphManager=G.glyphManager,this.symbolFadeChange=G.placement.symbolFadeChange(V.exported.now()),this.imageManager.beginFrame();let eh=this.style._order,ec=this.style.sourceCaches,ep=this.style.terrain&&new Ki(this);for(let V in ec){let G=ec[V];G.used&&G.prepare(this.context)}let ed={},em={},ef={};for(let V in ec){let G=ec[V];ed[V]=G.getVisibleCoordinates(),em[V]=ed[V].slice().reverse(),ef[V]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let V=0;V<eh.length;V++)if(this.style._layers[eh[V]].is3D()){this.opaquePassCutoff=V;break}if(ep){this.opaquePassCutoff=0;let G=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!V.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||G.length)&&(V.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(G,el){let eh=G.context,ec=eh.gl,ep=yi.unblended,ed=new wi(ec.LEQUAL,wi.ReadWrite,[0,1]),em=el.getTerrainMesh(),ef=el.sourceCache.getRenderableTiles(),eg=G.useProgram("terrainDepth");for(let e_ of(eh.bindFramebuffer.set(el.getFramebuffer("depth").framebuffer),eh.viewport.set([0,0,G.width/devicePixelRatio,G.height/devicePixelRatio]),eh.clear({color:V.Color.transparent,depth:1}),ef)){let V=el.getTerrainData(e_.tileID),ef=G.transform.calculatePosMatrix(e_.tileID.toUnwrapped());eg.draw(eh,ec.TRIANGLES,ed,Ei.disabled,ep,Ii.backCCW,{u_matrix:ef},V,"terrain",em.vertexBuffer,em.indexBuffer,em.segments)}eh.bindFramebuffer.set(null),eh.viewport.set([0,0,G.width,G.height])}(this,this.style.terrain),function(G,el){let eh=G.context,ec=eh.gl,ep=yi.unblended,ed=new wi(ec.LEQUAL,wi.ReadWrite,[0,1]),em=el.getTerrainMesh(),ef=el.getCoordsTexture(),eg=el.sourceCache.getRenderableTiles(),e_=G.useProgram("terrainCoords");for(let ey of(eh.bindFramebuffer.set(el.getFramebuffer("coords").framebuffer),eh.viewport.set([0,0,G.width/devicePixelRatio,G.height/devicePixelRatio]),eh.clear({color:V.Color.transparent,depth:1}),el.coordsIndex=[],eg)){let V=el.getTerrainData(ey.tileID);eh.activeTexture.set(ec.TEXTURE0),ec.bindTexture(ec.TEXTURE_2D,ef.texture);let eg=G.transform.calculatePosMatrix(ey.tileID.toUnwrapped());e_.draw(eh,ec.TRIANGLES,ed,Ei.disabled,ep,Ii.backCCW,{u_matrix:eg,u_terrain_coords_id:(255-el.coordsIndex.length)/255,u_texture:0},V,"terrain",em.vertexBuffer,em.indexBuffer,em.segments),el.coordsIndex.push(ey.tileID.key)}eh.bindFramebuffer.set(null),eh.viewport.set([0,0,G.width,G.height])}(this,this.style.terrain))}for(let V of(this.renderPass="offscreen",eh)){let G=this.style._layers[V];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;let el=em[G.source];("custom"===G.type||el.length)&&this.renderLayer(this,ec[G.source],G,el)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:el.showOverdrawInspector?V.Color.black:V.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=el.showOverdrawInspector,this.depthRangeFor3D=[0,1-(G._order.length+2)*this.numSublayers*this.depthEpsilon],!ep)for(this.renderPass="opaque",this.currentLayer=eh.length-1;this.currentLayer>=0;this.currentLayer--){let V=this.style._layers[eh[this.currentLayer]],G=ec[V.source],el=ed[V.source];this._renderTileClippingMasks(V,el),this.renderLayer(this,G,V,el)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<eh.length;this.currentLayer++){let V=this.style._layers[eh[this.currentLayer]],G=ec[V.source];if(ep&&ep.renderLayer(V))continue;let el=("symbol"===V.type?ef:em)[V.source];this._renderTileClippingMasks(V,ed[V.source]),this.renderLayer(this,G,V,el)}if(this.options.showTileBoundaries){let V,G;Object.values(this.style._layers).forEach(el=>{el.source&&!el.isHidden(this.transform.zoom)&&(el.source!==(G&&G.id)&&(G=this.style.sourceCaches[el.source]),(!V||V.getSource().maxzoom<G.getSource().maxzoom)&&(V=G))}),V&&eF.debug(this,V,V.getVisibleCoordinates())}this.options.showPadding&&function(V){var G,el;let eh=V.transform.padding;qi(V,V.transform.height-(eh.top||0),3,eP),qi(V,eh.bottom||0,3,eD),ji(V,eh.left||0,3,eL),ji(V,V.transform.width-(eh.right||0),3,eR);let ec=V.transform.centerPoint;G=ec.x,el=V.transform.height-ec.y,$i(V,G-1,el-10,2,20,eB),$i(V,G-10,el-1,20,2,eB)}(this),this.context.setDefault()}renderLayer(V,G,el,eh){el.isHidden(this.transform.zoom)||("background"===el.type||"custom"===el.type||(eh||[]).length)&&(this.id=el.id,this.gpuTimingStart(el),eF[el.type](V,G,el,eh,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(V){if(!this.options.gpuTiming)return;let G=this.context.extTimerQuery,el=this.gpuTimers[V.id];el||(el=this.gpuTimers[V.id]={calls:0,cpuTime:0,query:G.createQueryEXT()}),el.calls++,G.beginQueryEXT(G.TIME_ELAPSED_EXT,el.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let V=this.context.extTimerQuery;V.endQueryEXT(V.TIME_ELAPSED_EXT)}collectGpuTimers(){let V=this.gpuTimers;return this.gpuTimers={},V}queryGpuTimers(V){let G={};for(let el in V){let eh=V[el],ec=this.context.extTimerQuery,ep=ec.getQueryObjectEXT(eh.query,ec.QUERY_RESULT_EXT)/1e6;ec.deleteQueryEXT(eh.query),G[el]=ep}return G}translatePosMatrix(G,el,eh,ec,ep){if(!eh[0]&&!eh[1])return G;let ed=ep?"map"===ec?this.transform.angle:0:"viewport"===ec?-this.transform.angle:0;if(ed){let V=Math.sin(ed),G=Math.cos(ed);eh=[eh[0]*G-eh[1]*V,eh[0]*V+eh[1]*G]}let em=[ep?eh[0]:bt(el,eh[0],this.transform.zoom),ep?eh[1]:bt(el,eh[1],this.transform.zoom),0],ef=new Float32Array(16);return V.translate(ef,G,em),ef}saveTileTexture(V){let G=this._tileTextures[V.size[0]];G?G.push(V):this._tileTextures[V.size[0]]=[V]}getTileTexture(V){let G=this._tileTextures[V];return G&&G.length>0?G.pop():null}isPatternMissing(V){if(!V)return!1;if(!V.from||!V.to)return!0;let G=this.imageManager.getPattern(V.from.toString()),el=this.imageManager.getPattern(V.to.toString());return!G||!el}useProgram(V,G){this.cache=this.cache||{};let el=V+(G?G.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[el]||(this.cache[el]=new ne(this.context,V,eM[V],G,eC[V],this._showOverdrawInspector,this.style.terrain)),this.cache[el]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let V=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(V.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}};let Qi=class Qi{constructor(V,G){this.points=V,this.planes=G}static fromInvProjectionMatrix(G,el,eh){let ec=Math.pow(2,eh),ep=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(eh=>{let ep=1/(eh=V.transformMat4([],eh,G))[3]/el*ec;return V.mul$1(eh,eh,[ep,ep,1/eh[3],ep])}),ed=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(G=>{let el=V.sub([],ep[G[0]],ep[G[1]]),eh=V.sub([],ep[G[2]],ep[G[1]]),ec=V.normalize([],V.cross([],el,eh)),ed=-V.dot(ec,ep[G[1]]);return ec.concat(ed)});return new Qi(ep,ed)}};let to=class to{constructor(G,el){this.min=G,this.max=el,this.center=V.scale$1([],V.add([],this.min,this.max),.5)}quadrant(G){let el=[G%2==0,G<2],eh=V.clone$2(this.min),ec=V.clone$2(this.max);for(let V=0;V<el.length;V++)eh[V]=el[V]?this.min[V]:this.center[V],ec[V]=el[V]?this.center[V]:this.max[V];return ec[2]=this.max[2],new to(eh,ec)}distanceX(V){return Math.max(Math.min(this.max[0],V[0]),this.min[0])-V[0]}distanceY(V){return Math.max(Math.min(this.max[1],V[1]),this.min[1])-V[1]}intersects(G){let el=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],eh=!0;for(let ec=0;ec<G.planes.length;ec++){let ep=G.planes[ec],ed=0;for(let G=0;G<el.length;G++)V.dot$1(ep,el[G])>=0&&ed++;if(0===ed)return 0;ed!==el.length&&(eh=!1)}if(eh)return 2;for(let V=0;V<3;V++){let el=Number.MAX_VALUE,eh=-Number.MAX_VALUE;for(let ec=0;ec<G.points.length;ec++){let ep=G.points[ec][V]-this.min[V];el=Math.min(el,ep),eh=Math.max(eh,ep)}if(eh<0||el>this.max[V]-this.min[V])return 0}return 1}};let eo=class eo{constructor(V=0,G=0,el=0,eh=0){if(isNaN(V)||V<0||isNaN(G)||G<0||isNaN(el)||el<0||isNaN(eh)||eh<0)throw Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=V,this.bottom=G,this.left=el,this.right=eh}interpolate(G,el,eh){return null!=el.top&&null!=G.top&&(this.top=V.number(G.top,el.top,eh)),null!=el.bottom&&null!=G.bottom&&(this.bottom=V.number(G.bottom,el.bottom,eh)),null!=el.left&&null!=G.left&&(this.left=V.number(G.left,el.left,eh)),null!=el.right&&null!=G.right&&(this.right=V.number(G.right,el.right,eh)),this}getCenter(G,el){let eh=V.clamp((this.left+G-this.right)/2,0,G),ec=V.clamp((this.top+el-this.bottom)/2,0,el);return new V.pointGeometry(eh,ec)}equals(V){return this.top===V.top&&this.bottom===V.bottom&&this.left===V.left&&this.right===V.right}clone(){return new eo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}};let io=class io{constructor(G,el,eh,ec,ep){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=void 0===ep||!!ep,this._minZoom=G||0,this._maxZoom=el||22,this._minPitch=null==eh?0:eh,this._maxPitch=null==ec?60:ec,this.setMaxBounds(),this.width=0,this.height=0,this._center=new V.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new eo,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){let V=new io(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return V.tileSize=this.tileSize,V.latRange=this.latRange,V.width=this.width,V.height=this.height,V._center=this._center,V._elevation=this._elevation,V.zoom=this.zoom,V.angle=this.angle,V._fov=this._fov,V._pitch=this._pitch,V._unmodified=this._unmodified,V._edgeInsets=this._edgeInsets.clone(),V._calcMatrices(),V}get minZoom(){return this._minZoom}set minZoom(V){this._minZoom!==V&&(this._minZoom=V,this.zoom=Math.max(this.zoom,V))}get maxZoom(){return this._maxZoom}set maxZoom(V){this._maxZoom!==V&&(this._maxZoom=V,this.zoom=Math.min(this.zoom,V))}get minPitch(){return this._minPitch}set minPitch(V){this._minPitch!==V&&(this._minPitch=V,this.pitch=Math.max(this.pitch,V))}get maxPitch(){return this._maxPitch}set maxPitch(V){this._maxPitch!==V&&(this._maxPitch=V,this.pitch=Math.min(this.pitch,V))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(V){void 0===V?V=!0:null===V&&(V=!1),this._renderWorldCopies=V}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new V.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(G){var el,eh,ec,ep,ed,em,ef,eg,e_,ey;let ex=-V.wrap(G,-180,180)*Math.PI/180;this.angle!==ex&&(this._unmodified=!1,this.angle=ex,this._calcMatrices(),this.rotationMatrix=(el=new V.ARRAY_TYPE(4),V.ARRAY_TYPE!=Float32Array&&(el[1]=0,el[2]=0),el[0]=1,el[3]=1,el),eh=this.rotationMatrix,ec=this.rotationMatrix,ep=this.angle,ed=ec[0],em=ec[1],ef=ec[2],eg=ec[3],e_=Math.sin(ep),ey=Math.cos(ep),eh[0]=ed*ey+ef*e_,eh[1]=em*ey+eg*e_,eh[2]=-(ed*e_)+ef*ey,eh[3]=-(em*e_)+eg*ey)}get pitch(){return this._pitch/Math.PI*180}set pitch(G){let el=V.clamp(G,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==el&&(this._unmodified=!1,this._pitch=el,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(V){V=Math.max(.01,Math.min(60,V)),this._fov!==V&&(this._unmodified=!1,this._fov=V/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(V){let G=Math.min(Math.max(V,this.minZoom),this.maxZoom);this._zoom!==G&&(this._unmodified=!1,this._zoom=G,this.scale=this.zoomScale(G),this.tileZoom=Math.floor(G),this.zoomFraction=G-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(V){V.lat===this._center.lat&&V.lng===this._center.lng||(this._unmodified=!1,this._center=V,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(V){V!==this._elevation&&(this._elevation=V,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(V){this._edgeInsets.equals(V)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,V,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(V){return this._edgeInsets.equals(V)}interpolatePadding(V,G,el){this._unmodified=!1,this._edgeInsets.interpolate(V,G,el),this._constrain(),this._calcMatrices()}coveringZoomLevel(V){let G=(V.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/V.tileSize));return Math.max(0,G)}getVisibleUnwrappedCoordinates(G){let el=[new V.UnwrappedTileID(0,G)];if(this._renderWorldCopies){let eh=this.pointCoordinate(new V.pointGeometry(0,0)),ec=this.pointCoordinate(new V.pointGeometry(this.width,0)),ep=this.pointCoordinate(new V.pointGeometry(this.width,this.height)),ed=this.pointCoordinate(new V.pointGeometry(0,this.height)),em=Math.floor(Math.min(eh.x,ec.x,ep.x,ed.x)),ef=Math.floor(Math.max(eh.x,ec.x,ep.x,ed.x));for(let eh=em-1;eh<=ef+1;eh++)0!==eh&&el.push(new V.UnwrappedTileID(eh,G))}return el}coveringTiles(G){var el,eh;let ec=this.coveringZoomLevel(G),ep=ec;if(void 0!==G.minzoom&&ec<G.minzoom)return[];void 0!==G.maxzoom&&ec>G.maxzoom&&(ec=G.maxzoom);let ed=this.pointCoordinate(this.getCameraPoint()),em=V.MercatorCoordinate.fromLngLat(this.center),ef=Math.pow(2,ec),eg=[ef*ed.x,ef*ed.y,0],e_=[ef*em.x,ef*em.y,0],ey=Qi.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,ec),ex=G.minzoom||0;!G.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ex=ec);let ev=G.terrain?2/Math.min(this.tileSize,G.tileSize)*this.tileSize:3,_=V=>({aabb:new to([V*ef,0,0],[(V+1)*ef,ef,0]),zoom:0,x:0,y:0,wrap:V,fullyVisible:!1}),eb=[],ew=[],eT=ec,eE=G.reparseOverscaled?ep:ec;if(this._renderWorldCopies)for(let V=1;V<=3;V++)eb.push(_(-V)),eb.push(_(V));for(eb.push(_(0));eb.length>0;){let ec=eb.pop(),ep=ec.x,ed=ec.y,em=ec.fullyVisible;if(!em){let V=ec.aabb.intersects(ey);if(0===V)continue;em=2===V}let ef=G.terrain?eg:e_,eS=ec.aabb.distanceX(ef),eI=ec.aabb.distanceY(ef),eA=Math.max(Math.abs(eS),Math.abs(eI)),eM=ev+(1<<eT-ec.zoom)-2;if(ec.zoom===eT||eA>eM&&ec.zoom>=ex){let G=eT-ec.zoom,el=eg[0]-.5-(ep<<G),eh=eg[1]-.5-(ed<<G);ew.push({tileID:new V.OverscaledTileID(ec.zoom===eT?eE:ec.zoom,ec.wrap,ec.zoom,ep,ed),distanceSq:V.sqrLen([e_[0]-.5-ep,e_[1]-.5-ed]),tileDistanceToCamera:Math.sqrt(el*el+eh*eh)})}else for(let ef=0;ef<4;ef++){let eg=(ep<<1)+ef%2,e_=(ed<<1)+(ef>>1),ey=ec.zoom+1,ex=ec.aabb.quadrant(ef);if(G.terrain){let ep=new V.OverscaledTileID(ey,ec.wrap,ey,eg,e_),ed=G.terrain.getMinMaxElevation(ep),em=null!==(el=ed.minElevation)&&void 0!==el?el:this.elevation,ef=null!==(eh=ed.maxElevation)&&void 0!==eh?eh:this.elevation;ex=new to([ex.min[0],ex.min[1],em],[ex.max[0],ex.max[1],ef])}eb.push({aabb:ex,zoom:ey,x:eg,y:e_,wrap:ec.wrap,fullyVisible:em})}}return ew.sort((V,G)=>V.distanceSq-G.distanceSq).map(V=>V.tileID)}resize(V,G){this.width=V,this.height=G,this.pixelsToGLUnits=[2/V,-2/G],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(V){return Math.pow(2,V)}scaleZoom(V){return Math.log(V)/Math.LN2}project(G){let el=V.clamp(G.lat,-this.maxValidLatitude,this.maxValidLatitude);return new V.pointGeometry(V.mercatorXfromLng(G.lng)*this.worldSize,V.mercatorYfromLat(el)*this.worldSize)}unproject(G){return new V.MercatorCoordinate(G.x/this.worldSize,G.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(V){this.freezeElevation||(this.elevation=V?this.getElevation(this._center,V):0)}getElevation(G,el){let eh=V.MercatorCoordinate.fromLngLat(G),ec=(1<<this.tileZoom)*V.EXTENT,ep=eh.x*ec,ed=eh.y*ec,em=Math.floor(ep/V.EXTENT),ef=Math.floor(ed/V.EXTENT),eg=new V.OverscaledTileID(this.tileZoom,0,this.tileZoom,em,ef);return el.getElevation(eg,ep%V.EXTENT,ed%V.EXTENT,V.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(G){let el=this.pointLocation(this.centerPoint,G),eh=this.getElevation(el,G);if(!(this.elevation-eh))return;let ec=this.getCameraPosition(),ep=V.MercatorCoordinate.fromLngLat(ec.lngLat,ec.altitude),ed=V.MercatorCoordinate.fromLngLat(el,eh),em=ep.x-ed.x,ef=ep.y-ed.y,eg=ep.z-ed.z,e_=Math.sqrt(em*em+ef*ef+eg*eg),ey=this.scaleZoom(this.cameraToCenterDistance/e_/this.tileSize);this._elevation=eh,this._center=el,this.zoom=ey}setLocationAtPoint(G,el){let eh=this.pointCoordinate(el),ec=this.pointCoordinate(this.centerPoint),ep=this.locationCoordinate(G),ed=new V.MercatorCoordinate(ep.x-(eh.x-ec.x),ep.y-(eh.y-ec.y));this.center=this.coordinateLocation(ed),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(V,G){return G?this.coordinatePoint(this.locationCoordinate(V),this.getElevation(V,G),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(V))}pointLocation(V,G){return this.coordinateLocation(this.pointCoordinate(V,G))}locationCoordinate(G){return V.MercatorCoordinate.fromLngLat(G)}coordinateLocation(V){return V&&V.toLngLat()}pointCoordinate(G,el){if(el){let V=el.pointCoordinate(G);if(null!=V)return V}let eh=[G.x,G.y,0,1],ec=[G.x,G.y,1,1];V.transformMat4(eh,eh,this.pixelMatrixInverse),V.transformMat4(ec,ec,this.pixelMatrixInverse);let ep=eh[3],ed=ec[3],em=eh[1]/ep,ef=ec[1]/ed,eg=eh[2]/ep,e_=ec[2]/ed,ey=eg===e_?0:(0-eg)/(e_-eg);return new V.MercatorCoordinate(V.number(eh[0]/ep,ec[0]/ed,ey)/this.worldSize,V.number(em,ef,ey)/this.worldSize)}coordinatePoint(G,el=0,eh=this.pixelMatrix){let ec=[G.x*this.worldSize,G.y*this.worldSize,el,1];return V.transformMat4(ec,ec,eh),new V.pointGeometry(ec[0]/ec[3],ec[1]/ec[3])}getBounds(){let G=Math.max(0,this.height/2-this.getHorizon());return(new V.LngLatBounds).extend(this.pointLocation(new V.pointGeometry(0,G))).extend(this.pointLocation(new V.pointGeometry(this.width,G))).extend(this.pointLocation(new V.pointGeometry(this.width,this.height))).extend(this.pointLocation(new V.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new V.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(V){V?(this.lngRange=[V.getWest(),V.getEast()],this.latRange=[V.getSouth(),V.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(G,el=!1){let eh=G.key,ec=el?this._alignedPosMatrixCache:this._posMatrixCache;if(ec[eh])return ec[eh];let ep=G.canonical,ed=this.worldSize/this.zoomScale(ep.z),em=ep.x+Math.pow(2,ep.z)*G.wrap,ef=V.identity(new Float64Array(16));return V.translate(ef,ef,[em*ed,ep.y*ed,0]),V.scale(ef,ef,[ed/V.EXTENT,ed/V.EXTENT,1]),V.multiply(ef,el?this.alignedProjMatrix:this.projMatrix,ef),ec[eh]=new Float32Array(ef),ec[eh]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let G,el,eh,ec,ep=-90,ed=90,em=-180,ef=180,eg=this.size,e_=this._unmodified;if(this.latRange){let el=this.latRange;ep=V.mercatorYfromLat(el[1])*this.worldSize,G=(ed=V.mercatorYfromLat(el[0])*this.worldSize)-ep<eg.y?eg.y/(ed-ep):0}if(this.lngRange){let G=this.lngRange;em=V.wrap(V.mercatorXfromLng(G[0])*this.worldSize,0,this.worldSize),(ef=V.wrap(V.mercatorXfromLng(G[1])*this.worldSize,0,this.worldSize))<em&&(ef+=this.worldSize),el=ef-em<eg.x?eg.x/(ef-em):0}let ey=this.point,ex=Math.max(el||0,G||0);if(ex)return this.center=this.unproject(new V.pointGeometry(el?(ef+em)/2:ey.x,G?(ed+ep)/2:ey.y)),this.zoom+=this.scaleZoom(ex),this._unmodified=e_,void(this._constraining=!1);if(this.latRange){let V=ey.y,G=eg.y/2;V-G<ep&&(ec=ep+G),V+G>ed&&(ec=ed-G)}if(this.lngRange){let G=(em+ef)/2,el=V.wrap(ey.x,G-this.worldSize/2,G+this.worldSize/2),ec=eg.x/2;el-ec<em&&(eh=em+ec),el+ec>ef&&(eh=ef-ec)}void 0===eh&&void 0===ec||(this.center=this.unproject(new V.pointGeometry(void 0!==eh?eh:ey.x,void 0!==ec?ec:ey.y)).wrap()),this._unmodified=e_,this._constraining=!1}_calcMatrices(){if(!this.height)return;let G=this.centerOffset,el=this.point.x,eh=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=V.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let ec=V.identity(new Float64Array(16));V.scale(ec,ec,[this.width/2,-this.height/2,1]),V.translate(ec,ec,[1,-1,0]),this.labelPlaneMatrix=ec,ec=V.identity(new Float64Array(16)),V.scale(ec,ec,[1,-1,1]),V.translate(ec,ec,[-1,-1,0]),V.scale(ec,ec,[2/this.width,2/this.height,1]),this.glCoordMatrix=ec,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);let ep=Math.PI/2+this._pitch,ed=this._fov*(.5+G.y/this.height),em=Math.sin(ed)*this.cameraToSeaLevelDistance/Math.sin(V.clamp(Math.PI-ep-ed,.01,Math.PI-.01)),ef=this.getHorizon(),eg=2*Math.atan(ef/this.cameraToCenterDistance)*(.5+G.y/(2*ef)),e_=Math.sin(eg)*this.cameraToSeaLevelDistance/Math.sin(V.clamp(Math.PI-ep-eg,.01,Math.PI-.01)),ey=Math.cos(Math.PI/2-this._pitch)*em+this.cameraToSeaLevelDistance,ex=Math.cos(Math.PI/2-this._pitch)*e_+this.cameraToSeaLevelDistance,ev=1.01*Math.min(ey,ex),eb=this.height/50;ec=new Float64Array(16),V.perspective(ec,this._fov,this.width/this.height,eb,ev),ec[8]=-(2*G.x)/this.width,ec[9]=2*G.y/this.height,V.scale(ec,ec,[1,-1,1]),V.translate(ec,ec,[0,0,-this.cameraToCenterDistance]),V.rotateX(ec,ec,this._pitch),V.rotateZ(ec,ec,this.angle),V.translate(ec,ec,[-el,-eh,0]),this.mercatorMatrix=V.scale([],ec,[this.worldSize,this.worldSize,this.worldSize]),V.scale(ec,ec,[1,1,this._pixelPerMeter]),this.pixelMatrix=V.multiply(new Float64Array(16),this.labelPlaneMatrix,ec),V.translate(ec,ec,[0,0,-this.elevation]),this.projMatrix=ec,this.invProjMatrix=V.invert([],ec),this.pixelMatrix3D=V.multiply(new Float64Array(16),this.labelPlaneMatrix,ec);let ew=this.width%2/2,eT=this.height%2/2,eE=Math.cos(this.angle),eS=Math.sin(this.angle),eI=el-Math.round(el)+eE*ew+eS*eT,eA=eh-Math.round(eh)+eE*eT+eS*ew,eM=new Float64Array(ec);if(V.translate(eM,eM,[eI>.5?eI-1:eI,eA>.5?eA-1:eA,0]),this.alignedProjMatrix=eM,!(ec=V.invert(new Float64Array(16),this.pixelMatrix)))throw Error("failed to invert matrix");this.pixelMatrixInverse=ec,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let G=this.pointCoordinate(new V.pointGeometry(0,0)),el=[G.x*this.worldSize,G.y*this.worldSize,0,1];return V.transformMat4(el,el,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let G=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new V.pointGeometry(0,G))}getCameraQueryGeometry(G){let el=this.getCameraPoint();if(1===G.length)return[G[0],el];{let eh=el.x,ec=el.y,ep=el.x,ed=el.y;for(let V of G)eh=Math.min(eh,V.x),ec=Math.min(ec,V.y),ep=Math.max(ep,V.x),ed=Math.max(ed,V.y);return[new V.pointGeometry(eh,ec),new V.pointGeometry(ep,ec),new V.pointGeometry(ep,ed),new V.pointGeometry(eh,ed),new V.pointGeometry(eh,ec)]}}};let oo=class oo{constructor(G){this._hashName=G&&encodeURIComponent(G),V.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(V,G){let el=!1,eh=null,a=()=>{eh=null,el&&(V(),eh=setTimeout(a,300),el=!1)};return()=>(el=!0,eh||a(),eh)}(this._updateHashUnthrottled.bind(this))}addTo(V){return this._map=V,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(V){let G=this._map.getCenter(),el=Math.round(100*this._map.getZoom())/100,eh=Math.ceil((el*Math.LN2+Math.log(512/360/.5))/Math.LN10),ec=Math.pow(10,eh),ep=Math.round(G.lng*ec)/ec,ed=Math.round(G.lat*ec)/ec,em=this._map.getBearing(),ef=this._map.getPitch(),eg="";if(eg+=V?`/${ep}/${ed}/${el}`:`${el}/${ed}/${ep}`,(em||ef)&&(eg+="/"+Math.round(10*em)/10),ef&&(eg+=`/${Math.round(ef)}`),this._hashName){let V=this._hashName,G=!1,el=window.location.hash.slice(1).split("&").map(el=>{let eh=el.split("=")[0];return eh===V?(G=!0,`${eh}=${eg}`):el}).filter(V=>V);return G||el.push(`${V}=${eg}`),`#${el.join("&")}`}return`#${eg}`}_getCurrentHash(){let V=window.location.hash.replace("#","");if(this._hashName){let G;return V.split("&").map(V=>V.split("=")).forEach(V=>{V[0]===this._hashName&&(G=V)}),(G&&G[1]||"").split("/")}return V.split("/")}_onHashChange(){let V=this._getCurrentHash();if(V.length>=3&&!V.some(V=>isNaN(V))){let G=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(V[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+V[2],+V[1]],zoom:+V[0],bearing:G,pitch:+(V[4]||0)}),!0}return!1}_updateHashUnthrottled(){let V=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,V)}catch(V){}}};let eO={linearity:.3,easing:V.bezier(0,0,.3,1)},eU=V.extend({deceleration:2500,maxSpeed:1400},eO),eV=V.extend({deceleration:20,maxSpeed:1400},eO),eN=V.extend({deceleration:1e3,maxSpeed:360},eO),e$=V.extend({deceleration:1e3,maxSpeed:90},eO);let co=class co{constructor(V){this._map=V,this.clear()}clear(){this._inertiaBuffer=[]}record(G){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:V.exported.now(),settings:G})}_drainInertiaBuffer(){let G=this._inertiaBuffer,el=V.exported.now();for(;G.length>0&&el-G[0].time>160;)G.shift()}_onMoveEnd(G){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let el={zoom:0,bearing:0,pitch:0,pan:new V.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(let{settings:V}of this._inertiaBuffer)el.zoom+=V.zoomDelta||0,el.bearing+=V.bearingDelta||0,el.pitch+=V.pitchDelta||0,V.panDelta&&el.pan._add(V.panDelta),V.around&&(el.around=V.around),V.pinchAround&&(el.pinchAround=V.pinchAround);let eh=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,ec={};if(el.pan.mag()){let ep=uo(el.pan.mag(),eh,V.extend({},eU,G||{}));ec.offset=el.pan.mult(ep.amount/el.pan.mag()),ec.center=this._map.transform.center,ho(ec,ep)}if(el.zoom){let V=uo(el.zoom,eh,eV);ec.zoom=this._map.transform.zoom+V.amount,ho(ec,V)}if(el.bearing){let G=uo(el.bearing,eh,eN);ec.bearing=this._map.transform.bearing+V.clamp(G.amount,-179,179),ho(ec,G)}if(el.pitch){let V=uo(el.pitch,eh,e$);ec.pitch=this._map.transform.pitch+V.amount,ho(ec,V)}if(ec.zoom||ec.bearing){let V=void 0===el.pinchAround?el.around:el.pinchAround;ec.around=V?this._map.unproject(V):this._map.getCenter()}return this.clear(),V.extend(ec,{noMoveStart:!0})}};function ho(V,G){(!V.duration||V.duration<G.duration)&&(V.duration=G.duration,V.easing=G.easing)}function uo(G,el,eh){let{maxSpeed:ec,linearity:ep,deceleration:ed}=eh,em=V.clamp(G*ep/(el/1e3),-ec,ec),ef=Math.abs(em)/(ed*ep);return{easing:eh.easing,duration:1e3*ef,amount:em*(ef/2)}}let mo=class mo extends V.Event{constructor(G,el,eh,ec={}){let ep=r.mousePos(el.getCanvasContainer(),eh),ed=el.unproject(ep);super(G,V.extend({point:ep,lngLat:ed,originalEvent:eh},ec)),this._defaultPrevented=!1,this.target=el}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}};let _o=class _o extends V.Event{constructor(G,el,eh){let ec="touchend"===G?eh.changedTouches:eh.touches,ep=r.touchPos(el.getCanvasContainer(),ec),ed=ep.map(V=>el.unproject(V)),em=ep.reduce((V,G,el,eh)=>V.add(G.div(eh.length)),new V.pointGeometry(0,0));super(G,{points:ep,point:em,lngLats:ed,lngLat:el.unproject(em),originalEvent:eh}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}};let po=class po extends V.Event{constructor(V,G,el){super(V,{originalEvent:el}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}};let fo=class fo{constructor(V,G){this._map=V,this._clickTolerance=G.clickTolerance}reset(){delete this._mousedownPos}wheel(V){return this._firePreventable(new po(V.type,this._map,V))}mousedown(V,G){return this._mousedownPos=G,this._firePreventable(new mo(V.type,this._map,V))}mouseup(V){this._map.fire(new mo(V.type,this._map,V))}click(V,G){this._mousedownPos&&this._mousedownPos.dist(G)>=this._clickTolerance||this._map.fire(new mo(V.type,this._map,V))}dblclick(V){return this._firePreventable(new mo(V.type,this._map,V))}mouseover(V){this._map.fire(new mo(V.type,this._map,V))}mouseout(V){this._map.fire(new mo(V.type,this._map,V))}touchstart(V){return this._firePreventable(new _o(V.type,this._map,V))}touchmove(V){this._map.fire(new _o(V.type,this._map,V))}touchend(V){this._map.fire(new _o(V.type,this._map,V))}touchcancel(V){this._map.fire(new _o(V.type,this._map,V))}_firePreventable(V){if(this._map.fire(V),V.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}};let go=class go{constructor(V){this._map=V}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(V){this._map.fire(new mo(V.type,this._map,V))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(V){this._delayContextMenu?this._contextMenuEvent=V:this._ignoreContextMenu||this._map.fire(new mo(V.type,this._map,V)),this._map.listens("contextmenu")&&V.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}};let xo=class xo{constructor(V,G){this._map=V,this._el=V.getCanvasContainer(),this._container=V.getContainer(),this._clickTolerance=G.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(V,G){this.isEnabled()&&V.shiftKey&&0===V.button&&(r.disableDrag(),this._startPos=this._lastPos=G,this._active=!0)}mousemoveWindow(V,G){if(!this._active||this._lastPos.equals(G)||!this._box&&G.dist(this._startPos)<this._clickTolerance)return;let el=this._startPos;this._lastPos=G,this._box||(this._box=r.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",V));let eh=Math.min(el.x,G.x),ec=Math.max(el.x,G.x),ep=Math.min(el.y,G.y),ed=Math.max(el.y,G.y);r.setTransform(this._box,`translate(${eh}px,${ep}px)`),this._box.style.width=ec-eh+"px",this._box.style.height=ed-ep+"px"}mouseupWindow(G,el){if(!this._active||0!==G.button)return;let eh=this._startPos;if(this.reset(),r.suppressClick(),eh.x!==el.x||eh.y!==el.y)return this._map.fire(new V.Event("boxzoomend",{originalEvent:G})),{cameraAnimation:V=>V.fitScreenCoordinates(eh,el,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",G)}keydown(V){this._active&&27===V.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",V))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(r.remove(this._box),this._box=null),r.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(G,el){return this._map.fire(new V.Event(G,{originalEvent:el}))}};function vo(V,G){if(V.length!==G.length)throw Error(`The number of touches and points are not equal - touches ${V.length}, points ${G.length}`);let el={};for(let eh=0;eh<V.length;eh++)el[V[eh].identifier]=G[eh];return el}let yo=class yo{constructor(V){this.reset(),this.numTouches=V.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(G,el,eh){(this.centroid||eh.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=G.timeStamp),eh.length===this.numTouches&&(this.centroid=function(G){let el=new V.pointGeometry(0,0);for(let V of G)el._add(V);return el.div(G.length)}(el),this.touches=vo(eh,el)))}touchmove(V,G,el){if(this.aborted||!this.centroid)return;let eh=vo(el,G);for(let V in this.touches){let G=this.touches[V],el=eh[V];(!el||el.dist(G)>30)&&(this.aborted=!0)}}touchend(V,G,el){if((!this.centroid||V.timeStamp-this.startTime>500)&&(this.aborted=!0),0===el.length){let V=!this.aborted&&this.centroid;if(this.reset(),V)return V}}};let bo=class bo{constructor(V){this.singleTap=new yo(V),this.numTaps=V.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(V,G,el){this.singleTap.touchstart(V,G,el)}touchmove(V,G,el){this.singleTap.touchmove(V,G,el)}touchend(V,G,el){let eh=this.singleTap.touchend(V,G,el);if(eh){let G=V.timeStamp-this.lastTime<500,el=!this.lastTap||30>this.lastTap.dist(eh);if(G&&el||this.reset(),this.count++,this.lastTime=V.timeStamp,this.lastTap=eh,this.count===this.numTaps)return this.reset(),eh}}};let wo=class wo{constructor(){this._zoomIn=new bo({numTouches:1,numTaps:2}),this._zoomOut=new bo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(V,G,el){this._zoomIn.touchstart(V,G,el),this._zoomOut.touchstart(V,G,el)}touchmove(V,G,el){this._zoomIn.touchmove(V,G,el),this._zoomOut.touchmove(V,G,el)}touchend(V,G,el){let eh=this._zoomIn.touchend(V,G,el),ec=this._zoomOut.touchend(V,G,el);return eh?(this._active=!0,V.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:G=>G.easeTo({duration:300,zoom:G.getZoom()+1,around:G.unproject(eh)},{originalEvent:V})}):ec?(this._active=!0,V.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:G=>G.easeTo({duration:300,zoom:G.getZoom()-1,around:G.unproject(ec)},{originalEvent:V})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let eq={0:1,2:2};let Eo=class Eo{constructor(V){this.reset(),this._clickTolerance=V.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(V,G){return!1}_move(V,G){return{}}mousedown(V,G){if(this._lastPoint)return;let el=r.mouseButton(V);this._correctButton(V,el)&&(this._lastPoint=G,this._eventButton=el)}mousemoveWindow(V,G){let el=this._lastPoint;if(el){if(V.preventDefault(),function(V,G){let el=eq[G];return void 0===V.buttons||(V.buttons&el)!==el}(V,this._eventButton))this.reset();else if(this._moved||!(G.dist(el)<this._clickTolerance))return this._moved=!0,this._lastPoint=G,this._move(el,G)}}mouseupWindow(V){this._lastPoint&&r.mouseButton(V)===this._eventButton&&(this._moved&&r.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let Io=class Io extends Eo{mousedown(V,G){super.mousedown(V,G),this._lastPoint&&(this._active=!0)}_correctButton(V,G){return 0===G&&!V.ctrlKey}_move(V,G){return{around:G,panDelta:G.sub(V)}}};let Co=class Co extends Eo{_correctButton(V,G){return 0===G&&V.ctrlKey||2===G}_move(V,G){let el=.8*(G.x-V.x);if(el)return this._active=!0,{bearingDelta:el}}contextmenu(V){V.preventDefault()}};let So=class So extends Eo{_correctButton(V,G){return 0===G&&V.ctrlKey||2===G}_move(V,G){let el=-.5*(G.y-V.y);if(el)return this._active=!0,{pitchDelta:el}}contextmenu(V){V.preventDefault()}};let Do=class Do{constructor(V,G){this._minTouches=V.cooperativeGestures?2:1,this._clickTolerance=V.clickTolerance||1,this._map=G,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new V.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(V,G,el){return this._calculateTransform(V,G,el)}touchmove(V,G,el){if(this._map._cooperativeGestures&&(2===this._minTouches&&el.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(V,!1,el.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(el.length<this._minTouches))return V.preventDefault(),this._calculateTransform(V,G,el)}touchend(V,G,el){this._calculateTransform(V,G,el),this._active&&el.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(G,el,eh){eh.length>0&&(this._active=!0);let ec=vo(eh,el),ep=new V.pointGeometry(0,0),ed=new V.pointGeometry(0,0),em=0;for(let V in ec){let G=ec[V],el=this._touches[V];el&&(ep._add(G),ed._add(G.sub(el)),em++,ec[V]=G)}if(this._touches=ec,em<this._minTouches||!ed.mag())return;let ef=ed.div(em);return this._sum._add(ef),this._sum.mag()<this._clickTolerance?void 0:{around:ep.div(em),panDelta:ef}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let zo=class zo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(V){}_move(V,G,el){return{}}touchstart(V,G,el){this._firstTwoTouches||el.length<2||(this._firstTwoTouches=[el[0].identifier,el[1].identifier],this._start([G[0],G[1]]))}touchmove(V,G,el){if(!this._firstTwoTouches)return;V.preventDefault();let[eh,ec]=this._firstTwoTouches,ep=Po(el,G,eh),ed=Po(el,G,ec);if(!ep||!ed)return;let em=this._aroundCenter?null:ep.add(ed).div(2);return this._move([ep,ed],em,V)}touchend(V,G,el){if(!this._firstTwoTouches)return;let[eh,ec]=this._firstTwoTouches,ep=Po(el,G,eh),ed=Po(el,G,ec);ep&&ed||(this._active&&r.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(V){this._enabled=!0,this._aroundCenter=!!V&&"center"===V.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};function Po(V,G,el){for(let eh=0;eh<V.length;eh++)if(V[eh].identifier===el)return G[eh]}function Mo(V,G){return Math.log(V/G)/Math.LN2}let Ao=class Ao extends zo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(V){this._startDistance=this._distance=V[0].dist(V[1])}_move(V,G){let el=this._distance;if(this._distance=V[0].dist(V[1]),this._active||!(.1>Math.abs(Mo(this._distance,this._startDistance))))return this._active=!0,{zoomDelta:Mo(this._distance,el),pinchAround:G}}};function Lo(V,G){return 180*V.angleWith(G)/Math.PI}let Ro=class Ro extends zo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(V){this._startVector=this._vector=V[0].sub(V[1]),this._minDiameter=V[0].dist(V[1])}_move(V,G){let el=this._vector;if(this._vector=V[0].sub(V[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Lo(this._vector,el),pinchAround:G}}_isBelowThreshold(V){this._minDiameter=Math.min(this._minDiameter,V.mag());let G=25/(Math.PI*this._minDiameter)*360,el=Lo(V,this._startVector);return Math.abs(el)<G}};function ko(V){return Math.abs(V.y)>Math.abs(V.x)}let Bo=class Bo extends zo{constructor(V){super(),this._map=V}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(V,G,el){super.touchstart(V,G,el),this._currentTouchCount=el.length}_start(V){this._lastPoints=V,ko(V[0].sub(V[1]))&&(this._valid=!1)}_move(V,G,el){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;let eh=V[0].sub(this._lastPoints[0]),ec=V[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(eh,ec,el.timeStamp),this._valid?(this._lastPoints=V,this._active=!0,{pitchDelta:-((eh.y+ec.y)/2*.5)}):void 0}gestureBeginsVertically(V,G,el){if(void 0!==this._valid)return this._valid;let eh=V.mag()>=2,ec=G.mag()>=2;if(!eh&&!ec)return;if(!eh||!ec)return void 0===this._firstMove&&(this._firstMove=el),el-this._firstMove<100&&void 0;let ep=V.y>0==G.y>0;return ko(V)&&ko(G)&&ep}};let Oo=class Oo{constructor(){this._panStep=100,this._bearingStep=15,this._pitchStep=10,this._rotationDisabled=!1}reset(){this._active=!1}keydown(V){if(V.altKey||V.ctrlKey||V.metaKey)return;let G=0,el=0,eh=0,ec=0,ep=0;switch(V.keyCode){case 61:case 107:case 171:case 187:G=1;break;case 189:case 109:case 173:G=-1;break;case 37:V.shiftKey?el=-1:(V.preventDefault(),ec=-1);break;case 39:V.shiftKey?el=1:(V.preventDefault(),ec=1);break;case 38:V.shiftKey?eh=1:(V.preventDefault(),ep=-1);break;case 40:V.shiftKey?eh=-1:(V.preventDefault(),ep=1);break;default:return}return this._rotationDisabled&&(el=0,eh=0),{cameraAnimation:ed=>{let em=ed.getZoom();ed.easeTo({duration:300,easeId:"keyboardHandler",easing:Uo,zoom:G?Math.round(em)+G*(V.shiftKey?2:1):em,bearing:ed.getBearing()+el*this._bearingStep,pitch:ed.getPitch()+eh*this._pitchStep,offset:[-ec*this._panStep,-ep*this._panStep],center:ed.getCenter()},{originalEvent:V})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}};function Uo(V){return V*(2-V)}let Go=class Go{constructor(G,el){this._map=G,this._el=G.getCanvasContainer(),this._handler=el,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,V.bindAll(["_onTimeout"],this)}setZoomRate(V){this._defaultZoomRate=V}setWheelZoomRate(V){this._wheelZoomRate=V}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(V){this.isEnabled()||(this._enabled=!0,this._aroundCenter=V&&"center"===V.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(G){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;G.preventDefault()}let el=G.deltaMode===WheelEvent.DOM_DELTA_LINE?40*G.deltaY:G.deltaY,eh=V.exported.now(),ec=eh-(this._lastWheelEventTime||0);this._lastWheelEventTime=eh,0!==el&&el%4.000244140625==0?this._type="wheel":0!==el&&4>Math.abs(el)?this._type="trackpad":ec>400?(this._type=null,this._lastValue=el,this._timeout=setTimeout(this._onTimeout,40,G)):this._type||(this._type=200>Math.abs(ec*el)?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,el+=this._lastValue)),G.shiftKey&&el&&(el/=4),this._type&&(this._lastWheelEvent=G,this._delta-=el,this._active||this._start(G)),G.preventDefault()}_onTimeout(V){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(V)}_start(G){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let el=r.mousePos(this._el,G);this._around=V.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(el)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let G=this._map.transform;if(0!==this._delta){let V="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,el=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&0!==el&&(el=1/el);let eh="number"==typeof this._targetZoom?G.zoomScale(this._targetZoom):G.scale;this._targetZoom=Math.min(G.maxZoom,Math.max(G.minZoom,G.scaleZoom(eh*el))),"wheel"===this._type&&(this._startZoom=G.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let el="number"==typeof this._targetZoom?this._targetZoom:G.zoom,eh=this._startZoom,ec=this._easing,ep,ed=!1;if("wheel"===this._type&&eh&&ec){let G=Math.min((V.exported.now()-this._lastWheelEventTime)/200,1),em=ec(G);ep=V.number(eh,el,em),G<1?this._frameId||(this._frameId=!0):ed=!0}else ep=el,ed=!0;return this._active=!0,ed&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ed,zoomDelta:ep-G.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(G){let el=V.ease;if(this._prevEase){let G=this._prevEase,eh=(V.exported.now()-G.start)/G.duration,ec=G.easing(eh+.01)-G.easing(eh),ep=.27/Math.sqrt(ec*ec+1e-4)*.01,ed=Math.sqrt(.0729-ep*ep);el=V.bezier(ep,ed,.25,1)}return this._prevEase={start:V.exported.now(),duration:G,easing:el},el}reset(){this._active=!1}};let Zo=class Zo{constructor(V,G){this._clickZoom=V,this._tapZoom=G}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}};let Vo=class Vo{constructor(){this.reset()}reset(){this._active=!1}dblclick(V,G){return V.preventDefault(),{cameraAnimation:el=>{el.easeTo({duration:300,zoom:el.getZoom()+(V.shiftKey?-1:1),around:el.unproject(G)},{originalEvent:V})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let qo=class qo{constructor(){this._tap=new bo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(V,G,el){this._swipePoint||(this._tapTime&&V.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?el.length>0&&(this._swipePoint=G[0],this._swipeTouch=el[0].identifier):this._tap.touchstart(V,G,el))}touchmove(V,G,el){if(this._tapTime){if(this._swipePoint){if(el[0].identifier!==this._swipeTouch)return;let eh=G[0],ec=eh.y-this._swipePoint.y;return this._swipePoint=eh,V.preventDefault(),this._active=!0,{zoomDelta:ec/128}}}else this._tap.touchmove(V,G,el)}touchend(V,G,el){this._tapTime?this._swipePoint&&0===el.length&&this.reset():this._tap.touchend(V,G,el)&&(this._tapTime=V.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let jo=class jo{constructor(V,G,el){this._el=V,this._mousePan=G,this._touchPan=el}enable(V){this._inertiaOptions=V||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}};let $o=class $o{constructor(V,G,el){this._pitchWithRotate=V.pitchWithRotate,this._mouseRotate=G,this._mousePitch=el}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}};let Xo=class Xo{constructor(V,G,el,eh){this._el=V,this._touchZoom=G,this._touchRotate=el,this._tapDragZoom=eh,this._rotationDisabled=!1,this._enabled=!0}enable(V){this._touchZoom.enable(V),this._rotationDisabled||this._touchRotate.enable(V),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}};let Wo=V=>V.zoom||V.drag||V.pitch||V.rotate;let Ho=class Ho extends V.Event{};function Ko(V){return V.panDelta&&V.panDelta.mag()||V.zoomDelta||V.bearingDelta||V.pitchDelta}let Yo=class Yo{constructor(G,el){this._map=G,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new co(G),this._bearingSnap=el.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(el),V.bindAll(["handleEvent","handleWindowEvent"],this);let eh=this._el;for(let[V,G,el]of(this._listeners=[[eh,"touchstart",{passive:!0}],[eh,"touchmove",{passive:!1}],[eh,"touchend",void 0],[eh,"touchcancel",void 0],[eh,"mousedown",void 0],[eh,"mousemove",void 0],[eh,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[eh,"mouseover",void 0],[eh,"mouseout",void 0],[eh,"dblclick",void 0],[eh,"click",void 0],[eh,"keydown",{capture:!1}],[eh,"keyup",void 0],[eh,"wheel",{passive:!1}],[eh,"contextmenu",void 0],[window,"blur",void 0]],this._listeners))r.addEventListener(V,G,V===document?this.handleWindowEvent:this.handleEvent,el)}destroy(){for(let[V,G,el]of this._listeners)r.removeEventListener(V,G,V===document?this.handleWindowEvent:this.handleEvent,el)}_addDefaultHandlers(V){let G=this._map,el=G.getCanvasContainer();this._add("mapEvent",new fo(G,V));let eh=G.boxZoom=new xo(G,V);this._add("boxZoom",eh);let ec=new wo,ep=new Vo;G.doubleClickZoom=new Zo(ep,ec),this._add("tapZoom",ec),this._add("clickZoom",ep);let ed=new qo;this._add("tapDragZoom",ed);let em=G.touchPitch=new Bo(G);this._add("touchPitch",em);let ef=new Co(V),eg=new So(V);G.dragRotate=new $o(V,ef,eg),this._add("mouseRotate",ef,["mousePitch"]),this._add("mousePitch",eg,["mouseRotate"]);let e_=new Io(V),ey=new Do(V,G);G.dragPan=new jo(el,e_,ey),this._add("mousePan",e_),this._add("touchPan",ey,["touchZoom","touchRotate"]);let ex=new Ro,ev=new Ao;G.touchZoomRotate=new Xo(el,ev,ex,ed),this._add("touchRotate",ex,["touchPan","touchZoom"]),this._add("touchZoom",ev,["touchPan","touchRotate"]);let eb=G.scrollZoom=new Go(G,this);this._add("scrollZoom",eb,["mousePan"]);let ew=G.keyboard=new Oo;for(let el of(this._add("keyboard",ew),this._add("blockableMapEvent",new go(G)),["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"]))V.interactive&&V[el]&&G[el].enable(V[el])}_add(V,G,el){this._handlers.push({handlerName:V,handler:G,allowed:el}),this._handlersById[V]=G}stop(V){if(!this._updatingCamera){for(let{handler:V}of this._handlers)V.reset();this._inertia.clear(),this._fireEvents({},{},V),this._changes=[]}}isActive(){for(let{handler:V}of this._handlers)if(V.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Wo(this._eventsInProgress)||this.isZooming()}_blockedByActive(V,G,el){for(let eh in V)if(eh!==el&&(!G||0>G.indexOf(eh)))return!0;return!1}handleWindowEvent(V){this.handleEvent(V,`${V.type}Window`)}_getMapTouches(V){let G=[];for(let el of V)this._el.contains(el.target)&&G.push(el);return G}handleEvent(V,G){if("blur"===V.type)return void this.stop(!0);this._updatingCamera=!0;let el="renderFrame"===V.type?void 0:V,eh={needsRenderFrame:!1},ec={},ep={},ed=V.touches,em=ed?this._getMapTouches(ed):void 0,ef=em?r.touchPos(this._el,em):r.mousePos(this._el,V);for(let{handlerName:ed,handler:eg,allowed:e_}of this._handlers){let ey;eg.isEnabled()&&(this._blockedByActive(ep,e_,ed)?eg.reset():eg[G||V.type]&&(ey=eg[G||V.type](V,ef,em),this.mergeHandlerResult(eh,ec,ey,ed,el),ey&&ey.needsRenderFrame&&this._triggerRenderFrame()),(ey||eg.isActive())&&(ep[ed]=eg))}let eg={};for(let V in this._previousActiveHandlers)ep[V]||(eg[V]=el);this._previousActiveHandlers=ep,(Object.keys(eg).length||Ko(eh))&&(this._changes.push([eh,ec,eg]),this._triggerRenderFrame()),(Object.keys(ep).length||Ko(eh))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:e_}=eh;e_&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],e_(this._map))}mergeHandlerResult(G,el,eh,ec,ep){if(!eh)return;V.extend(G,eh);let ed={handlerName:ec,originalEvent:eh.originalEvent||ep};void 0!==eh.zoomDelta&&(el.zoom=ed),void 0!==eh.panDelta&&(el.drag=ed),void 0!==eh.pitchDelta&&(el.pitch=ed),void 0!==eh.bearingDelta&&(el.rotate=ed)}_applyChanges(){let G={},el={},eh={};for(let[ec,ep,ed]of this._changes)ec.panDelta&&(G.panDelta=(G.panDelta||new V.pointGeometry(0,0))._add(ec.panDelta)),ec.zoomDelta&&(G.zoomDelta=(G.zoomDelta||0)+ec.zoomDelta),ec.bearingDelta&&(G.bearingDelta=(G.bearingDelta||0)+ec.bearingDelta),ec.pitchDelta&&(G.pitchDelta=(G.pitchDelta||0)+ec.pitchDelta),void 0!==ec.around&&(G.around=ec.around),void 0!==ec.pinchAround&&(G.pinchAround=ec.pinchAround),ec.noInertia&&(G.noInertia=ec.noInertia),V.extend(el,ep),V.extend(eh,ed);this._updateMapTransform(G,el,eh),this._changes=[]}_updateMapTransform(G,el,eh){let ec=this._map,ep=ec.transform,ed=ec.style&&ec.style.terrain;if(!(Ko(G)||ed&&this._drag))return this._fireEvents(el,eh,!0);let{panDelta:em,zoomDelta:ef,bearingDelta:eg,pitchDelta:e_,around:ey,pinchAround:ex}=G;void 0!==ex&&(ey=ex),ec._stop(!0),ey=ey||ec.transform.centerPoint;let ev=ep.pointLocation(em?ey.sub(em):ey);eg&&(ep.bearing+=eg),e_&&(ep.pitch+=e_),ef&&(ep.zoom+=ef),ed?el.drag&&!this._drag?(this._drag={center:ep.centerPoint,lngLat:ep.pointLocation(ey),point:ey,handlerName:el.drag.handlerName},ec.fire(new V.Event("freezeElevation",{freeze:!0}))):this._drag&&eh[this._drag.handlerName]?(ec.fire(new V.Event("freezeElevation",{freeze:!1})),this._drag=null):el.drag&&this._drag&&(ep.center=ep.pointLocation(ep.centerPoint.sub(em))):ep.setLocationAtPoint(ev,ey),this._map._update(),G.noInertia||this._inertia.record(G),this._fireEvents(el,eh,!0)}_fireEvents(G,el,eh){let ec;let ep=Wo(this._eventsInProgress),ed=Wo(G),em={};for(let V in G){let{originalEvent:el}=G[V];this._eventsInProgress[V]||(em[`${V}start`]=el),this._eventsInProgress[V]=G[V]}for(let V in!ep&&ed&&this._fireEvent("movestart",ed.originalEvent),em)this._fireEvent(V,em[V]);for(let V in ed&&this._fireEvent("move",ed.originalEvent),G){let{originalEvent:el}=G[V];this._fireEvent(V,el)}let ef={};for(let V in this._eventsInProgress){let{handlerName:G,originalEvent:eh}=this._eventsInProgress[V];this._handlersById[G].isActive()||(delete this._eventsInProgress[V],ec=el[G]||eh,ef[`${V}end`]=ec)}for(let V in ef)this._fireEvent(V,ef[V]);let eg=Wo(this._eventsInProgress);if(eh&&(ep||ed)&&!eg){var e_,ey;this._updatingCamera=!0;let G=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions);G?(0!==(e_=G.bearing||this._map.getBearing())&&-this._bearingSnap<e_&&e_<this._bearingSnap&&(G.bearing=0),this._map.easeTo(G,{originalEvent:ec})):(this._map.fire(new V.Event("moveend",{originalEvent:ec})),0!==(ey=this._map.getBearing())&&-this._bearingSnap<ey&&ey<this._bearingSnap&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(G,el){this._map.fire(new V.Event(G,el?{originalEvent:el}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(V=>{delete this._frameId,this.handleEvent(new Ho("renderFrame",{timeStamp:V})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}};let Qo=class Qo extends V.Evented{constructor(G,el){super(),this._moving=!1,this._zooming=!1,this.transform=G,this._bearingSnap=el.bearingSnap,V.bindAll(["_renderFrameCallback"],this)}getCenter(){return new V.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(V,G){return this.jumpTo({center:V},G)}panBy(G,el,eh){return G=V.pointGeometry.convert(G).mult(-1),this.panTo(this.transform.center,V.extend({offset:G},el),eh)}panTo(G,el,eh){return this.easeTo(V.extend({center:G},el),eh)}getZoom(){return this.transform.zoom}setZoom(V,G){return this.jumpTo({zoom:V},G),this}zoomTo(G,el,eh){return this.easeTo(V.extend({zoom:G},el),eh)}zoomIn(V,G){return this.zoomTo(this.getZoom()+1,V,G),this}zoomOut(V,G){return this.zoomTo(this.getZoom()-1,V,G),this}getBearing(){return this.transform.bearing}setBearing(V,G){return this.jumpTo({bearing:V},G),this}getPadding(){return this.transform.padding}setPadding(V,G){return this.jumpTo({padding:V},G),this}rotateTo(G,el,eh){return this.easeTo(V.extend({bearing:G},el),eh)}resetNorth(G,el){return this.rotateTo(0,V.extend({duration:1e3},G),el),this}resetNorthPitch(G,el){return this.easeTo(V.extend({bearing:0,pitch:0,duration:1e3},G),el),this}snapToNorth(V,G){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(V,G):this}getPitch(){return this.transform.pitch}setPitch(V,G){return this.jumpTo({pitch:V},G),this}cameraForBounds(G,el){G=V.LngLatBounds.convert(G);let eh=el&&el.bearing||0;return this._cameraForBoxAndBearing(G.getNorthWest(),G.getSouthEast(),eh,el)}_cameraForBoxAndBearing(G,el,eh,ec){let ep={top:0,bottom:0,right:0,left:0};if("number"==typeof(ec=V.extend({padding:ep,offset:[0,0],maxZoom:this.transform.maxZoom},ec)).padding){let V=ec.padding;ec.padding={top:V,bottom:V,right:V,left:V}}ec.padding=V.extend(ep,ec.padding);let ed=this.transform,em=ed.padding,ef=ed.project(V.LngLat.convert(G)),eg=ed.project(V.LngLat.convert(el)),e_=ef.rotate(-eh*Math.PI/180),ey=eg.rotate(-eh*Math.PI/180),ex=new V.pointGeometry(Math.max(e_.x,ey.x),Math.max(e_.y,ey.y)),ev=new V.pointGeometry(Math.min(e_.x,ey.x),Math.min(e_.y,ey.y)),eb=ex.sub(ev),ew=(ed.width-(em.left+em.right+ec.padding.left+ec.padding.right))/eb.x,eT=(ed.height-(em.top+em.bottom+ec.padding.top+ec.padding.bottom))/eb.y;if(eT<0||ew<0)return void V.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let eE=Math.min(ed.scaleZoom(ed.scale*Math.min(ew,eT)),ec.maxZoom),eS=V.pointGeometry.convert(ec.offset),eI=new V.pointGeometry((ec.padding.left-ec.padding.right)/2,(ec.padding.top-ec.padding.bottom)/2).rotate(eh*Math.PI/180),eA=eS.add(eI).mult(ed.scale/ed.zoomScale(eE));return{center:ed.unproject(ef.add(eg).div(2).sub(eA)),zoom:eE,bearing:eh}}fitBounds(V,G,el){return this._fitInternal(this.cameraForBounds(V,G),G,el)}fitScreenCoordinates(G,el,eh,ec,ep){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(V.pointGeometry.convert(G)),this.transform.pointLocation(V.pointGeometry.convert(el)),eh,ec),ec,ep)}_fitInternal(G,el,eh){return G?(delete(el=V.extend(G,el)).padding,el.linear?this.easeTo(el,eh):this.flyTo(el,eh)):this}jumpTo(G,el){this.stop();let eh=this.transform,ec=!1,ep=!1,ed=!1;return"zoom"in G&&eh.zoom!==+G.zoom&&(ec=!0,eh.zoom=+G.zoom),void 0!==G.center&&(eh.center=V.LngLat.convert(G.center)),"bearing"in G&&eh.bearing!==+G.bearing&&(ep=!0,eh.bearing=+G.bearing),"pitch"in G&&eh.pitch!==+G.pitch&&(ed=!0,eh.pitch=+G.pitch),null==G.padding||eh.isPaddingEqual(G.padding)||(eh.padding=G.padding),this.fire(new V.Event("movestart",el)).fire(new V.Event("move",el)),ec&&this.fire(new V.Event("zoomstart",el)).fire(new V.Event("zoom",el)).fire(new V.Event("zoomend",el)),ep&&this.fire(new V.Event("rotatestart",el)).fire(new V.Event("rotate",el)).fire(new V.Event("rotateend",el)),ed&&this.fire(new V.Event("pitchstart",el)).fire(new V.Event("pitch",el)).fire(new V.Event("pitchend",el)),this.fire(new V.Event("moveend",el))}calculateCameraOptionsFromTo(G,el,eh,ec=0){let ep=V.MercatorCoordinate.fromLngLat(G,el),ed=V.MercatorCoordinate.fromLngLat(eh,ec),em=ed.x-ep.x,ef=ed.y-ep.y,eg=ed.z-ep.z,e_=Math.hypot(em,ef,eg);if(0===e_)throw Error("Can't calculate camera options with same From and To");let ey=Math.hypot(em,ef),ex=this.transform.scaleZoom(this.transform.cameraToCenterDistance/e_/this.transform.tileSize),ev=180*Math.atan2(em,-ef)/Math.PI,eb=180*Math.acos(ey/e_)/Math.PI;return eb=eg<0?90-eb:90+eb,{center:ed.toLngLat(),zoom:ex,pitch:eb,bearing:ev}}easeTo(G,el){let eh,ec;this._stop(!1,G.easeId),(!1===(G=V.extend({offset:[0,0],duration:500,easing:V.ease},G)).animate||!G.essential&&V.exported.prefersReducedMotion)&&(G.duration=0);let ep=this.transform,ed=this.getZoom(),em=this.getBearing(),ef=this.getPitch(),eg=this.getPadding(),e_="zoom"in G?+G.zoom:ed,ey="bearing"in G?this._normalizeBearing(G.bearing,em):em,ex="pitch"in G?+G.pitch:ef,ev="padding"in G?G.padding:ep.padding,eb=V.pointGeometry.convert(G.offset),ew=ep.centerPoint.add(eb),eT=ep.pointLocation(ew),eE=V.LngLat.convert(G.center||eT);this._normalizeCenter(eE);let eS=ep.project(eT),eI=ep.project(eE).sub(eS),eA=ep.zoomScale(e_-ed);G.around&&(eh=V.LngLat.convert(G.around),ec=ep.locationPoint(eh));let eM={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||e_!==ed,this._rotating=this._rotating||em!==ey,this._pitching=this._pitching||ex!==ef,this._padding=!ep.isPaddingEqual(ev),this._easeId=G.easeId,this._prepareEase(el,G.noMoveStart,eM),this._ease(G=>{if(this._zooming&&(ep.zoom=V.number(ed,e_,G)),this._rotating&&(ep.bearing=V.number(em,ey,G)),this._pitching&&(ep.pitch=V.number(ef,ex,G)),this._padding&&(ep.interpolatePadding(eg,ev,G),ew=ep.centerPoint.add(eb)),eh)ep.setLocationAtPoint(eh,ec);else{let V=ep.zoomScale(ep.zoom-ed),el=e_>ed?Math.min(2,eA):Math.max(.5,eA),eh=Math.pow(el,1-G),ec=ep.unproject(eS.add(eI.mult(G*eh)).mult(V));ep.setLocationAtPoint(ep.renderWorldCopies?ec.wrap():ec,ew)}this._fireMoveEvents(el)},V=>{this._afterEase(el,V)},G),this}_prepareEase(G,el,eh={}){this._moving=!0,this.fire(new V.Event("freezeElevation",{freeze:!0})),el||eh.moving||this.fire(new V.Event("movestart",G)),this._zooming&&!eh.zooming&&this.fire(new V.Event("zoomstart",G)),this._rotating&&!eh.rotating&&this.fire(new V.Event("rotatestart",G)),this._pitching&&!eh.pitching&&this.fire(new V.Event("pitchstart",G))}_fireMoveEvents(G){this.fire(new V.Event("move",G)),this._zooming&&this.fire(new V.Event("zoom",G)),this._rotating&&this.fire(new V.Event("rotate",G)),this._pitching&&this.fire(new V.Event("pitch",G))}_afterEase(G,el){if(this._easeId&&el&&this._easeId===el)return;delete this._easeId,this.fire(new V.Event("freezeElevation",{freeze:!1}));let eh=this._zooming,ec=this._rotating,ep=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,eh&&this.fire(new V.Event("zoomend",G)),ec&&this.fire(new V.Event("rotateend",G)),ep&&this.fire(new V.Event("pitchend",G)),this.fire(new V.Event("moveend",G))}flyTo(G,el){if(!G.essential&&V.exported.prefersReducedMotion){let eh=V.pick(G,["center","zoom","bearing","pitch","around"]);return this.jumpTo(eh,el)}this.stop(),G=V.extend({offset:[0,0],speed:1.2,curve:1.42,easing:V.ease},G);let eh=this.transform,ec=this.getZoom(),ep=this.getBearing(),ed=this.getPitch(),em=this.getPadding(),ef="zoom"in G?V.clamp(+G.zoom,eh.minZoom,eh.maxZoom):ec,eg="bearing"in G?this._normalizeBearing(G.bearing,ep):ep,e_="pitch"in G?+G.pitch:ed,ey="padding"in G?G.padding:eh.padding,ex=eh.zoomScale(ef-ec),ev=V.pointGeometry.convert(G.offset),eb=eh.centerPoint.add(ev),ew=eh.pointLocation(eb),eT=V.LngLat.convert(G.center||ew);this._normalizeCenter(eT);let eE=eh.project(ew),eS=eh.project(eT).sub(eE),eI=G.curve,eA=Math.max(eh.width,eh.height),eM=eA/ex,eC=eS.mag();if("minZoom"in G){let el=V.clamp(Math.min(G.minZoom,ec,ef),eh.minZoom,eh.maxZoom),ep=eA/eh.zoomScale(el-ec);eI=Math.sqrt(ep/eC*2)}let ez=eI*eI;function E(V){let G=(eM*eM-eA*eA+(V?-1:1)*ez*ez*eC*eC)/(2*(V?eM:eA)*ez*eC);return Math.log(Math.sqrt(G*G+1)-G)}function I(V){return(Math.exp(V)-Math.exp(-V))/2}function C(V){return(Math.exp(V)+Math.exp(-V))/2}let ek=E(0),D=function(V){return C(ek)/C(ek+eI*V)},z=function(V){var G;return eA*((C(ek)*(I(G=ek+eI*V)/C(G))-I(ek))/ez)/eC},eP=(E(1)-ek)/eI;if(1e-6>Math.abs(eC)||!isFinite(eP)){if(1e-6>Math.abs(eA-eM))return this.easeTo(G,el);let V=eM<eA?-1:1;eP=Math.abs(Math.log(eM/eA))/eI,z=function(){return 0},D=function(G){return Math.exp(V*eI*G)}}return G.duration="duration"in G?+G.duration:1e3*eP/("screenSpeed"in G?+G.screenSpeed/eI:+G.speed),G.maxDuration&&G.duration>G.maxDuration&&(G.duration=0),this._zooming=!0,this._rotating=ep!==eg,this._pitching=e_!==ed,this._padding=!eh.isPaddingEqual(ey),this._prepareEase(el,!1),this._ease(G=>{let ex=G*eP,ew=1/D(ex);eh.zoom=1===G?ef:ec+eh.scaleZoom(ew),this._rotating&&(eh.bearing=V.number(ep,eg,G)),this._pitching&&(eh.pitch=V.number(ed,e_,G)),this._padding&&(eh.interpolatePadding(em,ey,G),eb=eh.centerPoint.add(ev));let eI=1===G?eT:eh.unproject(eE.add(eS.mult(z(ex))).mult(ew));eh.setLocationAtPoint(eh.renderWorldCopies?eI.wrap():eI,eb),this._fireMoveEvents(el)},()=>this._afterEase(el),G),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(V,G){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let V=this._onEaseEnd;delete this._onEaseEnd,V.call(this,G)}if(!V){let V=this.handlers;V&&V.stop(!1)}return this}_ease(G,el,eh){!1===eh.animate||0===eh.duration?(G(1),el()):(this._easeStart=V.exported.now(),this._easeOptions=eh,this._onEaseFrame=G,this._onEaseEnd=el,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let G=Math.min((V.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(G)),G<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(G,el){G=V.wrap(G,-180,180);let eh=Math.abs(G-el);return Math.abs(G-360-el)<eh&&(G-=360),Math.abs(G+360-el)<eh&&(G+=360),G}_normalizeCenter(V){let G=this.transform;if(!G.renderWorldCopies||G.lngRange)return;let el=V.lng-G.center.lng;V.lng+=el>180?-360:el<-180?360:0}};let ta=class ta{constructor(G={}){this.options=G,V.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(V){return this._map=V,this._compact=this.options&&this.options.compact,this._container=r.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=r.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=r.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){r.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(V,G){let el=this._map._getUIString(`AttributionControl.${G}`);V.title=el,V.setAttribute("aria-label",el)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(V){V&&("metadata"===V.sourceDataType||"visibility"===V.sourceDataType||"style"===V.dataType||"terrain"===V.type)&&this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let V=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?V=V.concat(this.options.customAttribution.map(V=>"string"!=typeof V?"":V)):"string"==typeof this.options.customAttribution&&V.push(this.options.customAttribution)),this._map.style.stylesheet){let V=this._map.style.stylesheet;this.styleOwner=V.owner,this.styleId=V.id}let G=this._map.style.sourceCaches;for(let el in G){let eh=G[el];if(eh.used||eh.usedForTerrain){let G=eh.getSource();G.attribution&&0>V.indexOf(G.attribution)&&V.push(G.attribution)}}(V=V.filter(V=>String(V).trim())).sort((V,G)=>V.length-G.length),V=V.filter((G,el)=>{for(let eh=el+1;eh<V.length;eh++)if(V[eh].indexOf(G)>=0)return!1;return!0});let el=V.join(" | ");el!==this._attribHTML&&(this._attribHTML=el,V.length?(this._innerContainer.innerHTML=el,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}};let ea=class ea{constructor(G={}){this.options=G,V.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(V){this._map=V,this._compact=this.options&&this.options.compact,this._container=r.create("div","maplibregl-ctrl mapboxgl-ctrl");let G=r.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return G.target="_blank",G.rel="noopener nofollow",G.href="https://maplibre.org/",G.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),G.setAttribute("rel","noopener nofollow"),this._container.appendChild(G),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){r.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){let V=this._container.children;if(V.length){let G=V[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&G.classList.add("maplibregl-compact","mapboxgl-compact"):G.classList.remove("maplibregl-compact","mapboxgl-compact")}}};let ia=class ia{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(V){let G=++this._id;return this._queue.push({callback:V,id:G,cancelled:!1}),G}remove(V){let G=this._currentlyRunning,el=G?this._queue.concat(G):this._queue;for(let G of el)if(G.id===V)return void(G.cancelled=!0)}run(V=0){if(this._currentlyRunning)throw Error("Attempting to run(), but is already running.");let G=this._currentlyRunning=this._queue;for(let el of(this._queue=[],G))if(!el.cancelled&&(el.callback(V),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}};let eG={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},eZ={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},ej={showCompass:!0,showZoom:!0,visualizePitch:!1};let sa=class sa{constructor(G,el,eh=!1){this._clickTolerance=10,this.element=el,this.mouseRotate=new Co({clickTolerance:G.dragRotate._mouseRotate._clickTolerance}),this.map=G,eh&&(this.mousePitch=new So({clickTolerance:G.dragRotate._mousePitch._clickTolerance})),V.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener(el,"mousedown",this.mousedown),r.addEventListener(el,"touchstart",this.touchstart,{passive:!1}),r.addEventListener(el,"touchmove",this.touchmove),r.addEventListener(el,"touchend",this.touchend),r.addEventListener(el,"touchcancel",this.reset)}down(V,G){this.mouseRotate.mousedown(V,G),this.mousePitch&&this.mousePitch.mousedown(V,G),r.disableDrag()}move(V,G){let el=this.map,eh=this.mouseRotate.mousemoveWindow(V,G);if(eh&&eh.bearingDelta&&el.setBearing(el.getBearing()+eh.bearingDelta),this.mousePitch){let eh=this.mousePitch.mousemoveWindow(V,G);eh&&eh.pitchDelta&&el.setPitch(el.getPitch()+eh.pitchDelta)}}off(){let V=this.element;r.removeEventListener(V,"mousedown",this.mousedown),r.removeEventListener(V,"touchstart",this.touchstart,{passive:!1}),r.removeEventListener(V,"touchmove",this.touchmove),r.removeEventListener(V,"touchend",this.touchend),r.removeEventListener(V,"touchcancel",this.reset),this.offTemp()}offTemp(){r.enableDrag(),r.removeEventListener(window,"mousemove",this.mousemove),r.removeEventListener(window,"mouseup",this.mouseup)}mousedown(G){this.down(V.extend({},G,{ctrlKey:!0,preventDefault:()=>G.preventDefault()}),r.mousePos(this.element,G)),r.addEventListener(window,"mousemove",this.mousemove),r.addEventListener(window,"mouseup",this.mouseup)}mousemove(V){this.move(V,r.mousePos(this.element,V))}mouseup(V){this.mouseRotate.mouseupWindow(V),this.mousePitch&&this.mousePitch.mouseupWindow(V),this.offTemp()}touchstart(V){1!==V.targetTouches.length?this.reset():(this._startPos=this._lastPos=r.touchPos(this.element,V.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>V.preventDefault()},this._startPos))}touchmove(V){1!==V.targetTouches.length?this.reset():(this._lastPos=r.touchPos(this.element,V.targetTouches)[0],this.move({preventDefault:()=>V.preventDefault()},this._lastPos))}touchend(V){0===V.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}};function na(G,el,eh){if(G=new V.LngLat(G.lng,G.lat),el){let ec=new V.LngLat(G.lng-360,G.lat),ep=new V.LngLat(G.lng+360,G.lat),ed=eh.locationPoint(G).distSqr(el);eh.locationPoint(ec).distSqr(el)<ed?G=ec:eh.locationPoint(ep).distSqr(el)<ed&&(G=ep)}for(;Math.abs(G.lng-eh.center.lng)>180;){let V=eh.locationPoint(G);if(V.x>=0&&V.y>=0&&V.x<=eh.width&&V.y<=eh.height)break;G.lng>eh.center.lng?G.lng-=360:G.lng+=360}return G}let eX={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ca(V,G,el){let eh=V.classList;for(let V in eX)eh.remove(`maplibregl-${el}-anchor-${V}`,`mapboxgl-${el}-anchor-${V}`);eh.add(`maplibregl-${el}-anchor-${G}`,`mapboxgl-${el}-anchor-${G}`)}let ha=class ha extends V.Evented{constructor(G,el){if(super(),(G instanceof HTMLElement||el)&&(G=V.extend({element:G},el)),V.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=G&&G.anchor||"center",this._color=G&&G.color||"#3FB1CE",this._scale=G&&G.scale||1,this._draggable=G&&G.draggable||!1,this._clickTolerance=G&&G.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=G&&G.rotation||0,this._rotationAlignment=G&&G.rotationAlignment||"auto",this._pitchAlignment=G&&G.pitchAlignment&&"auto"!==G.pitchAlignment?G.pitchAlignment:this._rotationAlignment,G&&G.element)this._element=G.element,this._offset=V.pointGeometry.convert(G&&G.offset||[0,0]);else{this._defaultMarker=!0,this._element=r.create("div"),this._element.setAttribute("aria-label","Map marker");let el=r.createNS("http://www.w3.org/2000/svg","svg");el.setAttributeNS(null,"display","block"),el.setAttributeNS(null,"height","41px"),el.setAttributeNS(null,"width","27px"),el.setAttributeNS(null,"viewBox","0 0 27 41");let eh=r.createNS("http://www.w3.org/2000/svg","g");eh.setAttributeNS(null,"stroke","none"),eh.setAttributeNS(null,"stroke-width","1"),eh.setAttributeNS(null,"fill","none"),eh.setAttributeNS(null,"fill-rule","evenodd");let ec=r.createNS("http://www.w3.org/2000/svg","g");ec.setAttributeNS(null,"fill-rule","nonzero");let ep=r.createNS("http://www.w3.org/2000/svg","g");for(let V of(ep.setAttributeNS(null,"transform","translate(3.0, 29.0)"),ep.setAttributeNS(null,"fill","#000000"),[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}])){let G=r.createNS("http://www.w3.org/2000/svg","ellipse");G.setAttributeNS(null,"opacity","0.04"),G.setAttributeNS(null,"cx","10.5"),G.setAttributeNS(null,"cy","5.80029008"),G.setAttributeNS(null,"rx",V.rx),G.setAttributeNS(null,"ry",V.ry),ep.appendChild(G)}let ed=r.createNS("http://www.w3.org/2000/svg","g");ed.setAttributeNS(null,"fill",this._color);let em=r.createNS("http://www.w3.org/2000/svg","path");em.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ed.appendChild(em);let ef=r.createNS("http://www.w3.org/2000/svg","g");ef.setAttributeNS(null,"opacity","0.25"),ef.setAttributeNS(null,"fill","#000000");let eg=r.createNS("http://www.w3.org/2000/svg","path");eg.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ef.appendChild(eg);let e_=r.createNS("http://www.w3.org/2000/svg","g");e_.setAttributeNS(null,"transform","translate(6.0, 7.0)"),e_.setAttributeNS(null,"fill","#FFFFFF");let ey=r.createNS("http://www.w3.org/2000/svg","g");ey.setAttributeNS(null,"transform","translate(8.0, 8.0)");let ex=r.createNS("http://www.w3.org/2000/svg","circle");ex.setAttributeNS(null,"fill","#000000"),ex.setAttributeNS(null,"opacity","0.25"),ex.setAttributeNS(null,"cx","5.5"),ex.setAttributeNS(null,"cy","5.5"),ex.setAttributeNS(null,"r","5.4999962");let ev=r.createNS("http://www.w3.org/2000/svg","circle");ev.setAttributeNS(null,"fill","#FFFFFF"),ev.setAttributeNS(null,"cx","5.5"),ev.setAttributeNS(null,"cy","5.5"),ev.setAttributeNS(null,"r","5.4999962"),ey.appendChild(ex),ey.appendChild(ev),ec.appendChild(ep),ec.appendChild(ed),ec.appendChild(ef),ec.appendChild(e_),ec.appendChild(ey),el.appendChild(ec),el.setAttributeNS(null,"height",41*this._scale+"px"),el.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(el),this._offset=V.pointGeometry.convert(G&&G.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",V=>{V.preventDefault()}),this._element.addEventListener("mousedown",V=>{V.preventDefault()}),ca(this._element,this._anchor,"marker"),this._popup=null}addTo(V){return this.remove(),this._map=V,V.getCanvasContainer().appendChild(this._element),V.on("move",this._update),V.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),r.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(G){return this._lngLat=V.LngLat.convert(G),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(V){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),V){if(!("offset"in V.options)){let G=Math.sqrt(91.125);V.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[G,-1*(24.6+G)],"bottom-right":[-G,-1*(24.6+G)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=V,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(V){let G=V.code,el=V.charCode||V.keyCode;"Space"!==G&&"Enter"!==G&&32!==el&&13!==el||this.togglePopup()}_onMapClick(V){let G=V.originalEvent.target,el=this._element;this._popup&&(G===el||el.contains(G))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let V=this._popup;return V&&(V.isOpen()?V.remove():V.addTo(this._map)),this}_update(V){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=na(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let G="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?G=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(G=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let el="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?el="rotateX(0deg)":"map"===this._pitchAlignment&&(el=`rotateX(${this._map.getPitch()}deg)`),V&&"moveend"!==V.type||(this._pos=this._pos.round()),r.setTransform(this._element,`${eX[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${el} ${G}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{let V=this._map.unproject(this._pos),G=40075016.686*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=V.distanceTo(this._lngLat)>20*G?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(G){return this._offset=V.pointGeometry.convert(G),this._update(),this}_onMove(G){if(!this._isDragging){let V=this._clickTolerance||this._map._clickTolerance;this._isDragging=G.point.dist(this._pointerdownPos)>=V}this._isDragging&&(this._pos=G.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new V.Event("dragstart"))),this.fire(new V.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new V.Event("dragend")),this._state="inactive"}_addDragHandler(V){this._element.contains(V.originalEvent.target)&&(V.preventDefault(),this._positionDelta=V.point.sub(this._pos).add(this._offset),this._pointerdownPos=V.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(V){return this._draggable=!!V,this._map&&(V?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(V){return this._rotation=V||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(V){return this._rotationAlignment=V||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(V){return this._pitchAlignment=V&&"auto"!==V?V:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}};let eW={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},eH,eK=0,eY=!1,eJ={maxWidth:100,unit:"metric"};function fa(V,G,el){let eh=el&&el.maxWidth||100,ec=V._container.clientHeight/2,ep=V.unproject([0,ec]),ed=V.unproject([eh,ec]),em=ep.distanceTo(ed);if(el&&"imperial"===el.unit){let el=3.2808*em;el>5280?ga(G,eh,el/5280,V._getUIString("ScaleControl.Miles")):ga(G,eh,el,V._getUIString("ScaleControl.Feet"))}else el&&"nautical"===el.unit?ga(G,eh,em/1852,V._getUIString("ScaleControl.NauticalMiles")):em>=1e3?ga(G,eh,em/1e3,V._getUIString("ScaleControl.Kilometers")):ga(G,eh,em,V._getUIString("ScaleControl.Meters"))}function ga(V,G,el,eh){let ec=function(V){let G=Math.pow(10,`${Math.floor(V)}`.length-1),el=V/G;return G*(el=el>=10?10:el>=5?5:el>=3?3:el>=2?2:el>=1?1:function(V){let G=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*G)/G}(el))}(el);V.style.width=G*(ec/el)+"px",V.innerHTML=`${ec}&nbsp;${eh}`}let eQ={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},e0={supported:i,setRTLTextPlugin:V.setRTLTextPlugin,getRTLTextPluginStatus:V.getRTLTextPluginStatus,Map:class extends Qo{constructor(G){var el;if(V.PerformanceUtils.mark(V.PerformanceMarkers.create),null!=(G=V.extend({},eZ,G)).minZoom&&null!=G.maxZoom&&G.minZoom>G.maxZoom)throw Error("maxZoom must be greater than or equal to minZoom");if(null!=G.minPitch&&null!=G.maxPitch&&G.minPitch>G.maxPitch)throw Error("maxPitch must be greater than or equal to minPitch");if(null!=G.minPitch&&G.minPitch<0)throw Error("minPitch must be greater than or equal to 0");if(null!=G.maxPitch&&G.maxPitch>85)throw Error("maxPitch must be less than or equal to 85");if(super(new io(G.minZoom,G.maxZoom,G.minPitch,G.maxPitch,G.renderWorldCopies),{bearingSnap:G.bearingSnap}),this._interactive=G.interactive,this._cooperativeGestures=G.cooperativeGestures,this._maxTileCacheSize=G.maxTileCacheSize,this._failIfMajorPerformanceCaveat=G.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=G.preserveDrawingBuffer,this._antialias=G.antialias,this._trackResize=G.trackResize,this._bearingSnap=G.bearingSnap,this._refreshExpiredTiles=G.refreshExpiredTiles,this._fadeDuration=G.fadeDuration,this._crossSourceCollisions=G.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=G.collectResourceTiming,this._renderTaskQueue=new ia,this._controls=[],this._mapId=V.uniqueId(),this._locale=V.extend({},eG,G.locale),this._clickTolerance=G.clickTolerance,this._pixelRatio=null!==(el=G.pixelRatio)&&void 0!==el?el:devicePixelRatio,this._requestManager=new s(G.transformRequest),"string"==typeof G.container){if(this._container=document.getElementById(G.container),!this._container)throw Error(`Container '${G.container}' not found.`)}else{if(!(G.container instanceof HTMLElement))throw Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=G.container}if(G.maxBounds&&this.setMaxBounds(G.maxBounds),V.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),"undefined"!=typeof window&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Yo(this,G),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=G.hash&&new oo("string"==typeof G.hash&&G.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:G.center,zoom:G.zoom,bearing:G.bearing,pitch:G.pitch}),G.bounds&&(this.resize(),this.fitBounds(G.bounds,V.extend({},G.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=G.localIdeographFontFamily,G.style&&this.setStyle(G.style,{localIdeographFontFamily:G.localIdeographFontFamily}),G.attributionControl&&this.addControl(new ta({customAttribution:G.customAttribution})),G.maplibreLogo&&this.addControl(new ea,G.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",G=>{this._update("style"===G.dataType),this.fire(new V.Event(`${G.dataType}data`,G))}),this.on("dataloading",G=>{this.fire(new V.Event(`${G.dataType}dataloading`,G))}),this.on("dataabort",G=>{this.fire(new V.Event("sourcedataabort",G))})}_getMapId(){return this._mapId}addControl(G,el){if(void 0===el&&(el=G.getDefaultPosition?G.getDefaultPosition():"top-right"),!G||!G.onAdd)return this.fire(new V.ErrorEvent(Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let eh=G.onAdd(this);this._controls.push(G);let ec=this._controlPositions[el];return -1!==el.indexOf("bottom")?ec.insertBefore(eh,ec.firstChild):ec.appendChild(eh),this}removeControl(G){if(!G||!G.onRemove)return this.fire(new V.ErrorEvent(Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let el=this._controls.indexOf(G);return el>-1&&this._controls.splice(el,1),G.onRemove(this),this}hasControl(V){return this._controls.indexOf(V)>-1}calculateCameraOptionsFromTo(V,G,el,eh){return null==eh&&this.style.terrain&&(eh=this.transform.getElevation(el,this.style.terrain)),super.calculateCameraOptionsFromTo(V,G,el,eh)}resize(G){let el=this._containerDimensions(),eh=el[0],ec=el[1];this._resizeCanvas(eh,ec,this.getPixelRatio()),this.transform.resize(eh,ec),this.painter.resize(eh,ec,this.getPixelRatio());let ep=!this._moving;return ep&&(this.stop(),this.fire(new V.Event("movestart",G)).fire(new V.Event("move",G))),this.fire(new V.Event("resize",G)),ep&&this.fire(new V.Event("moveend",G)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(V){let[G,el]=this._containerDimensions();this._pixelRatio=V,this._resizeCanvas(G,el,V),this.painter.resize(G,el,V)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(G){return this.transform.setMaxBounds(V.LngLatBounds.convert(G)),this._update()}setMinZoom(V){if((V=null==V?-2:V)>=-2&&V<=this.transform.maxZoom)return this.transform.minZoom=V,this._update(),this.getZoom()<V&&this.setZoom(V),this;throw Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(V){if((V=null==V?22:V)>=this.transform.minZoom)return this.transform.maxZoom=V,this._update(),this.getZoom()>V&&this.setZoom(V),this;throw Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(V){if((V=null==V?0:V)<0)throw Error("minPitch must be greater than or equal to 0");if(V>=0&&V<=this.transform.maxPitch)return this.transform.minPitch=V,this._update(),this.getPitch()<V&&this.setPitch(V),this;throw Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(V){if((V=null==V?60:V)>85)throw Error("maxPitch must be less than or equal to 85");if(V>=this.transform.minPitch)return this.transform.maxPitch=V,this._update(),this.getPitch()>V&&this.setPitch(V),this;throw Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(V){return this.transform.renderWorldCopies=V,this._update()}project(G){return this.transform.locationPoint(V.LngLat.convert(G),this.style&&this.style.terrain)}unproject(G){return this.transform.pointLocation(V.pointGeometry.convert(G),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(V,G,el){if("mouseenter"===V||"mouseover"===V){let eh=!1;return{layer:G,listener:el,delegates:{mousemove:ec=>{let ep=this.getLayer(G)?this.queryRenderedFeatures(ec.point,{layers:[G]}):[];ep.length?eh||(eh=!0,el.call(this,new mo(V,this,ec.originalEvent,{features:ep}))):eh=!1},mouseout:()=>{eh=!1}}}}if("mouseleave"===V||"mouseout"===V){let eh=!1;return{layer:G,listener:el,delegates:{mousemove:ec=>{(this.getLayer(G)?this.queryRenderedFeatures(ec.point,{layers:[G]}):[]).length?eh=!0:eh&&(eh=!1,el.call(this,new mo(V,this,ec.originalEvent)))},mouseout:G=>{eh&&(eh=!1,el.call(this,new mo(V,this,G.originalEvent)))}}}}return{layer:G,listener:el,delegates:{[V]:V=>{let eh=this.getLayer(G)?this.queryRenderedFeatures(V.point,{layers:[G]}):[];eh.length&&(V.features=eh,el.call(this,V),delete V.features)}}}}on(V,G,el){if(void 0===el)return super.on(V,G);let eh=this._createDelegatedListener(V,G,el);for(let G in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[V]=this._delegatedListeners[V]||[],this._delegatedListeners[V].push(eh),eh.delegates)this.on(G,eh.delegates[G]);return this}once(V,G,el){if(void 0===el)return super.once(V,G);let eh=this._createDelegatedListener(V,G,el);for(let V in eh.delegates)this.once(V,eh.delegates[V]);return this}off(V,G,el){return void 0===el?super.off(V,G):(this._delegatedListeners&&this._delegatedListeners[V]&&(eh=>{let ec=this._delegatedListeners[V];for(let V=0;V<ec.length;V++){let eh=ec[V];if(eh.layer===G&&eh.listener===el){for(let V in eh.delegates)this.off(V,eh.delegates[V]);return ec.splice(V,1),this}}})(),this)}queryRenderedFeatures(G,el){let eh;if(!this.style)return[];if(void 0!==el||void 0===G||G instanceof V.pointGeometry||Array.isArray(G)||(el=G,G=void 0),el=el||{},(G=G||[[0,0],[this.transform.width,this.transform.height]])instanceof V.pointGeometry||"number"==typeof G[0])eh=[V.pointGeometry.convert(G)];else{let el=V.pointGeometry.convert(G[0]),ec=V.pointGeometry.convert(G[1]);eh=[el,new V.pointGeometry(ec.x,el.y),ec,new V.pointGeometry(el.x,ec.y),el]}return this.style.queryRenderedFeatures(eh,el,this.transform)}querySourceFeatures(V,G){return this.style.querySourceFeatures(V,G)}setStyle(G,el){return!1!==(el=V.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},el)).diff&&el.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&G?(this._diffStyle(G,el),this):(this._localIdeographFontFamily=el.localIdeographFontFamily,this._updateStyle(G,el))}setTransformRequest(V){return this._requestManager.setTransformRequest(V),this}_getUIString(V){let G=this._locale[V];if(null==G)throw Error(`Missing UI string '${V}'`);return G}_updateStyle(V,G){return this.style&&(this.style.setEventedParent(null),this.style._remove()),V?(this.style=new ee(this,G||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof V?this.style.loadURL(V):this.style.loadJSON(V)):delete this.style,this}_lazyInitEmptyStyle(){this.style||(this.style=new ee(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(G,el){if("string"==typeof G){let eh=this._requestManager.transformRequest(G,V.ResourceType.Style);V.getJSON(eh,(G,eh)=>{G?this.fire(new V.ErrorEvent(G)):eh&&this._updateDiff(eh,el)})}else"object"==typeof G&&this._updateDiff(G,el)}_updateDiff(G,el){try{this.style.setState(G)&&this._update(!0)}catch(eh){V.warnOnce(`Unable to perform style diff: ${eh.message||eh.error||eh}.  Rebuilding the style from scratch.`),this._updateStyle(G,el)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():V.warnOnce("There is no style added to the map.")}addSource(V,G){return this._lazyInitEmptyStyle(),this.style.addSource(V,G),this._update(!0)}isSourceLoaded(G){let el=this.style&&this.style.sourceCaches[G];if(void 0!==el)return el.loaded();this.fire(new V.ErrorEvent(Error(`There is no source with ID '${G}'`)))}setTerrain(V){return this.style.setTerrain(V),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){let V=this.style&&this.style.sourceCaches;for(let G in V){let el=V[G]._tiles;for(let V in el){let G=el[V];if("loaded"!==G.state&&"errored"!==G.state)return!1}}return!0}addSourceType(V,G,el){return this._lazyInitEmptyStyle(),this.style.addSourceType(V,G,el)}removeSource(V){return this.style.removeSource(V),this._update(!0)}getSource(V){return this.style.getSource(V)}addImage(G,el,{pixelRatio:eh=1,sdf:ec=!1,stretchX:ep,stretchY:ed,content:em}={}){if(this._lazyInitEmptyStyle(),el instanceof HTMLImageElement||V.isImageBitmap(el)){let{width:ef,height:eg,data:e_}=V.exported.getImageData(el);this.style.addImage(G,{data:new V.RGBAImage({width:ef,height:eg},e_),pixelRatio:eh,stretchX:ep,stretchY:ed,content:em,sdf:ec,version:0})}else{if(void 0===el.width||void 0===el.height)return this.fire(new V.ErrorEvent(Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:ef,height:eg,data:e_}=el;this.style.addImage(G,{data:new V.RGBAImage({width:ef,height:eg},new Uint8Array(e_)),pixelRatio:eh,stretchX:ep,stretchY:ed,content:em,sdf:ec,version:0,userImage:el}),el.onAdd&&el.onAdd(this,G)}}}updateImage(G,el){let eh=this.style.getImage(G);if(!eh)return this.fire(new V.ErrorEvent(Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let ec=el instanceof HTMLImageElement||V.isImageBitmap(el)?V.exported.getImageData(el):el,{width:ep,height:ed,data:em}=ec;if(void 0===ep||void 0===ed)return this.fire(new V.ErrorEvent(Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(ep!==eh.data.width||ed!==eh.data.height)return this.fire(new V.ErrorEvent(Error("The width and height of the updated image must be that same as the previous version of the image")));let ef=!(el instanceof HTMLImageElement||V.isImageBitmap(el));eh.data.replace(em,ef),this.style.updateImage(G,eh)}hasImage(G){return G?!!this.style.getImage(G):(this.fire(new V.ErrorEvent(Error("Missing required image id"))),!1)}removeImage(V){this.style.removeImage(V)}loadImage(G,el){V.getImage(this._requestManager.transformRequest(G,V.ResourceType.Image),el)}listImages(){return this.style.listImages()}addLayer(V,G){return this._lazyInitEmptyStyle(),this.style.addLayer(V,G),this._update(!0)}moveLayer(V,G){return this.style.moveLayer(V,G),this._update(!0)}removeLayer(V){return this.style.removeLayer(V),this._update(!0)}getLayer(V){return this.style.getLayer(V)}setLayerZoomRange(V,G,el){return this.style.setLayerZoomRange(V,G,el),this._update(!0)}setFilter(V,G,el={}){return this.style.setFilter(V,G,el),this._update(!0)}getFilter(V){return this.style.getFilter(V)}setPaintProperty(V,G,el,eh={}){return this.style.setPaintProperty(V,G,el,eh),this._update(!0)}getPaintProperty(V,G){return this.style.getPaintProperty(V,G)}setLayoutProperty(V,G,el,eh={}){return this.style.setLayoutProperty(V,G,el,eh),this._update(!0)}getLayoutProperty(V,G){return this.style.getLayoutProperty(V,G)}setLight(V,G={}){return this._lazyInitEmptyStyle(),this.style.setLight(V,G),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(V,G){return this.style.setFeatureState(V,G),this._update()}removeFeatureState(V,G){return this.style.removeFeatureState(V,G),this._update()}getFeatureState(V){return this.style.getFeatureState(V)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let V=0,G=0;return this._container&&(V=this._container.clientWidth||400,G=this._container.clientHeight||300),[V,G]}_setupContainer(){let V=this._container;V.classList.add("maplibregl-map","mapboxgl-map");let G=this._canvasContainer=r.create("div","maplibregl-canvas-container mapboxgl-canvas-container",V);this._interactive&&G.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=r.create("canvas","maplibregl-canvas mapboxgl-canvas",G),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");let el=this._containerDimensions();this._resizeCanvas(el[0],el[1],this.getPixelRatio());let eh=this._controlContainer=r.create("div","maplibregl-control-container mapboxgl-control-container",V),ec=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(V=>{ec[V]=r.create("div",`maplibregl-ctrl-${V} mapboxgl-ctrl-${V}`,eh)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){let V=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=r.create("div","maplibregl-cooperative-gesture-screen",V);let G="Control",el="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";0===navigator.platform.indexOf("Mac")&&(el="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",G="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${el}</div>
            <div class="maplibregl-mobile-message">${"boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",V=>{V.key===G&&(this._metaPress=!0)}),document.addEventListener("keyup",V=>{V.key===G&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",V=>{this._onCooperativeGesture(V,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(V,G,el){this._canvas.width=el*V,this._canvas.height=el*G,this._canvas.style.width=`${V}px`,this._canvas.style.height=`${G}px`}_setupPainter(){let G=V.extend({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),el=this._canvas.getContext("webgl",G)||this._canvas.getContext("experimental-webgl",G);el?(this.painter=new Ji(el,this.transform),V.exported$1.testSupport(el)):this.fire(new V.ErrorEvent(Error("Failed to initialize WebGL")))}_contextLost(G){G.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new V.Event("webglcontextlost",{originalEvent:G}))}_contextRestored(G){this._setupPainter(),this.resize(),this._update(),this.fire(new V.Event("webglcontextrestored",{originalEvent:G}))}_onMapScroll(V){if(V.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(V,G,el){return!G&&el<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(V){return this.style&&(this._styleDirty=this._styleDirty||V,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(V){return this._update(),this._renderTaskQueue.add(V)}_cancelRenderFrame(V){this._renderTaskQueue.remove(V)}_render(G){let el,eh=0,ec=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(el=ec.createQueryEXT(),ec.beginQueryEXT(ec.TIME_ELAPSED_EXT,el),eh=V.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(G),this._removed)return;let ep=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let G=this.transform.zoom,el=V.exported.now();this.style.zoomHistory.update(G,el);let eh=new V.EvaluationParameters(G,{now:el,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ec=eh.crossFadingFactor();1===ec&&ec===this._crossFadingFactor||(ep=!0,this._crossFadingFactor=ec),this.style.update(eh)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new V.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,V.PerformanceUtils.mark(V.PerformanceMarkers.load),this.fire(new V.Event("load"))),this.style&&(this.style.hasTransitions()||ep)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){let G=V.exported.now()-eh;ec.endQueryEXT(ec.TIME_ELAPSED_EXT,el),setTimeout(()=>{let eh=ec.getQueryObjectEXT(el,ec.QUERY_RESULT_EXT)/1e6;ec.deleteQueryEXT(el),this.fire(new V.Event("gpu-timing-frame",{cpuTime:G,gpuTime:eh}))},50)}if(this.listens("gpu-timing-layer")){let G=this.painter.collectGpuTimers();setTimeout(()=>{let el=this.painter.queryGpuTimers(G);this.fire(new V.Event("gpu-timing-layer",{layerTimes:el}))},50)}let ed=this._sourcesDirty||this._styleDirty||this._placementDirty;return ed||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new V.Event("idle")),!this._loaded||this._fullyLoaded||ed||(this._fullyLoaded=!0,V.PerformanceUtils.mark(V.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){for(let V of(this._hash&&this._hash.remove(),this._controls))V.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));let G=this.painter.context.gl.getExtension("WEBGL_lose_context");G&&G.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),r.remove(this._canvasContainer),r.remove(this._controlContainer),this._cooperativeGestures&&r.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),V.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new V.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=V.exported.frame(G=>{V.PerformanceUtils.frame(G),this._frame=null,this._render(G)}))}_onWindowOnline(){this._update()}_onWindowResize(V){this._trackResize&&this.resize({originalEvent:V})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(V){this._showTileBoundaries!==V&&(this._showTileBoundaries=V,this._update())}get showPadding(){return!!this._showPadding}set showPadding(V){this._showPadding!==V&&(this._showPadding=V,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(V){this._showCollisionBoxes!==V&&(this._showCollisionBoxes=V,V?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(V){this._showOverdrawInspector!==V&&(this._showOverdrawInspector=V,this._update())}get repaint(){return!!this._repaint}set repaint(V){this._repaint!==V&&(this._repaint=V,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(V){this._vertices=V,this._update()}_setCacheLimits(G,el){V.setCacheLimits(G,el)}get version(){return"2.4.0"}},NavigationControl:class{constructor(G){this.options=V.extend({},ej,G),this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",V=>V.preventDefault()),this.options.showZoom&&(V.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",V=>this._map.zoomIn({},{originalEvent:V})),r.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",V=>this._map.zoomOut({},{originalEvent:V})),r.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(V.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",V=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:V}):this._map.resetNorth({},{originalEvent:V})}),this._compassIcon=r.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let V=this._map.getZoom(),G=V===this._map.getMaxZoom(),el=V===this._map.getMinZoom();this._zoomInButton.disabled=G,this._zoomOutButton.disabled=el,this._zoomInButton.setAttribute("aria-disabled",G.toString()),this._zoomOutButton.setAttribute("aria-disabled",el.toString())}_rotateCompassArrow(){let V=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=V}onAdd(V){return this._map=V,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new sa(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){r.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(V,G){let el=r.create("button",V,this._container);return el.type="button",el.addEventListener("click",G),el}_setButtonTitle(V,G){let el=this._map._getUIString(`NavigationControl.${G}`);V.title=el,V.setAttribute("aria-label",el)}},GeolocateControl:class extends V.Evented{constructor(G){super(),this.options=V.extend({},eW,G),V.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(V){var G;return this._map=V,this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),G=this._setupUI,void 0!==eH?G(eH):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(V=>{G(eH="denied"!==V.state)}):G(eH=!!window.navigator.geolocation),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),r.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,eK=0,eY=!1}_isOutOfMapMaxBounds(V){let G=this._map.getMaxBounds(),el=V.coords;return G&&(el.longitude<G.getWest()||el.longitude>G.getEast()||el.latitude<G.getSouth()||el.latitude>G.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(G){if(this._map){if(this._isOutOfMapMaxBounds(G))return this._setErrorState(),this.fire(new V.Event("outofmaxbounds",G)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=G,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(G),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(G),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new V.Event("geolocate",G)),this._finish()}}_updateCamera(G){let el=new V.LngLat(G.coords.longitude,G.coords.latitude),eh=G.coords.accuracy,ec=this._map.getBearing(),ep=V.extend({bearing:ec},this.options.fitBoundsOptions);this._map.fitBounds(el.toBounds(eh),ep,{geolocateSource:!0})}_updateMarker(G){if(G){let el=new V.LngLat(G.coords.longitude,G.coords.latitude);this._accuracyCircleMarker.setLngLat(el).addTo(this._map),this._userLocationDotMarker.setLngLat(el).addTo(this._map),this._accuracy=G.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let V=this._map._container.clientHeight/2,G=this._map.unproject([0,V]),el=this._map.unproject([1,V]),eh=G.distanceTo(el),ec=Math.ceil(2*this._accuracy/eh);this._circleElement.style.width=`${ec}px`,this._circleElement.style.height=`${ec}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(G){if(this._map){if(this.options.trackUserLocation){if(1===G.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let V=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=V,this._geolocateButton.setAttribute("aria-label",V),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===G.code&&eY)return;this._setErrorState()}}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new V.Event("error",G)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(G){if(this._container.addEventListener("contextmenu",V=>V.preventDefault()),this._geolocateButton=r.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),r.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===G){V.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let G=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=G,this._geolocateButton.setAttribute("aria-label",G)}else{let V=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=V,this._geolocateButton.setAttribute("aria-label",V)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=r.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ha(this._dotElement),this._circleElement=r.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ha({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",G=>{G.geolocateSource||"ACTIVE_LOCK"!==this._watchState||G.originalEvent&&"resize"===G.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new V.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return V.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new V.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":eK--,eY=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new V.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new V.Event("trackuserlocationstart"));break;default:throw Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let V;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++eK>1?(V={maximumAge:6e5,timeout:0},eY=!0):(V=this.options.positionOptions,eY=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,V)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ta,LogoControl:ea,ScaleControl:class{constructor(G){this.options=V.extend({},eJ,G),V.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){fa(this._map,this._container,this.options)}onAdd(V){return this._map=V,this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",V.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){r.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(V){this.options.unit=V,fa(this._map,this._container,this.options)}},FullscreenControl:class{constructor(G){this._fullscreen=!1,G&&G.container&&(G.container instanceof HTMLElement?this._container=G.container:V.warnOnce("Full screen control 'container' must be a DOM element.")),V.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(G){return this._map=G,this._container||(this._container=this._map.getContainer()),this._controlContainer=r.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",V.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){r.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){let V=this._fullscreenButton=r.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);r.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",V).setAttribute("aria-hidden","true"),V.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let V=this._getTitle();this._fullscreenButton.setAttribute("aria-label",V),this._fullscreenButton.title=V}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(G){this.options=G,V.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(V){return this._map=V,this._container=r.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=r.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),r.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){r.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends V.Evented{constructor(G){super(),this.options=V.extend(Object.create(eQ),G),V.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(G){return this._map&&this.remove(),this._map=G,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new V.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&r.remove(this._content),this._container&&(r.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new V.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(G){return this._lngLat=V.LngLat.convert(G),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(V){return this.setDOMContent(document.createTextNode(V))}setHTML(V){let G;let el=document.createDocumentFragment(),eh=document.createElement("body");for(eh.innerHTML=V;G=eh.firstChild;)el.appendChild(G);return this.setDOMContent(el)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(V){return this.options.maxWidth=V,this._update(),this}setDOMContent(V){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=r.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(V),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(V){this._container&&this._container.classList.add(V)}removeClassName(V){this._container&&this._container.classList.remove(V)}setOffset(V){return this.options.offset=V,this._update(),this}toggleClassName(V){if(this._container)return this._container.classList.toggle(V)}_createCloseButton(){this.options.closeButton&&(this._closeButton=r.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(V){this._update(V.point)}_onMouseMove(V){this._update(V.point)}_onDrag(V){this._update(V.point)}_update(G){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=r.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=r.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(V=>this._container.classList.add(V)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=na(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!G))return;let el=this._pos=this._trackPointer&&G?G:this._map.project(this._lngLat),eh=this.options.anchor,ec=function ya(G){if(G){if("number"==typeof G){let el=Math.round(Math.sqrt(.5*Math.pow(G,2)));return{center:new V.pointGeometry(0,0),top:new V.pointGeometry(0,G),"top-left":new V.pointGeometry(el,el),"top-right":new V.pointGeometry(-el,el),bottom:new V.pointGeometry(0,-G),"bottom-left":new V.pointGeometry(el,-el),"bottom-right":new V.pointGeometry(-el,-el),left:new V.pointGeometry(G,0),right:new V.pointGeometry(-G,0)}}if(G instanceof V.pointGeometry||Array.isArray(G)){let el=V.pointGeometry.convert(G);return{center:el,top:el,"top-left":el,"top-right":el,bottom:el,"bottom-left":el,"bottom-right":el,left:el,right:el}}return{center:V.pointGeometry.convert(G.center||[0,0]),top:V.pointGeometry.convert(G.top||[0,0]),"top-left":V.pointGeometry.convert(G["top-left"]||[0,0]),"top-right":V.pointGeometry.convert(G["top-right"]||[0,0]),bottom:V.pointGeometry.convert(G.bottom||[0,0]),"bottom-left":V.pointGeometry.convert(G["bottom-left"]||[0,0]),"bottom-right":V.pointGeometry.convert(G["bottom-right"]||[0,0]),left:V.pointGeometry.convert(G.left||[0,0]),right:V.pointGeometry.convert(G.right||[0,0])}}return ya(new V.pointGeometry(0,0))}(this.options.offset);if(!eh){let V;let G=this._container.offsetWidth,ep=this._container.offsetHeight;V=el.y+ec.bottom.y<ep?["top"]:el.y>this._map.transform.height-ep?["bottom"]:[],el.x<G/2?V.push("left"):el.x>this._map.transform.width-G/2&&V.push("right"),eh=0===V.length?"bottom":V.join("-")}let ep=el.add(ec[eh]).round();r.setTransform(this._container,`${eX[eh]} translate(${ep.x}px,${ep.y}px)`),ca(this._container,eh,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let V=this._container.querySelector("a[href], [tabindex]:not([tabindex='-1']), [contenteditable]:not([contenteditable='false']), button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled])");V&&V.focus()}_onClose(){this.remove()}},Marker:ha,Style:ee,LngLat:V.LngLat,LngLatBounds:V.LngLatBounds,Point:V.pointGeometry,MercatorCoordinate:V.MercatorCoordinate,Evented:V.Evented,AJAXError:V.AJAXError,config:V.config,CanvasSource:P,GeoJSONSource:C,ImageSource:D,RasterDEMTileSource:I,RasterTileSource:T,VectorTileSource:w,VideoSource:z,prewarm:function(){j().acquire(e_)},clearPrewarmedResources:function(){let V=el;V&&(V.isPreloaded()&&1===V.numActive()?(V.release(e_),el=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Z.workerCount},set workerCount(t){Z.workerCount=t},get maxParallelImageRequests(){return V.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){V.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(G){V.clearTileCache(G)},workerUrl:"",addProtocol(G,el){V.config.REGISTERED_PROTOCOLS[G]=el},removeProtocol(G){delete V.config.REGISTERED_PROTOCOLS[G]}};return({extend:(G,...el)=>V.extend(G,...el),run(V){V()},logToElement(V,G=!1,el="log"){let eh=window.document.getElementById(el);eh&&(G&&(eh.innerHTML=""),eh.innerHTML+=`<br>${V}`)}}).extend(e0,{isSafari:V.isSafari,getPerformanceMetrics:V.PerformanceUtils.getPerformanceMetrics}),e0}),el}()}}]);